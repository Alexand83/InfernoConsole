var ke=Object.defineProperty;var Ee=(D,t,n)=>t in D?ke(D,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):D[t]=n;var se=(D,t,n)=>(Ee(D,typeof t!="symbol"?t+"":t,n),n);import{c as te,l as P,p as re,r as g,j as e,A as le,a as he,C as fe,E as Ce,S as Pe,b as ge,d as $e,X as we,M as ce,g as Fe}from"./index-5b2d746f.js";import{U as Me}from"./upload-d716cde2.js";const Te=te("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),ze=te("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),Se=te("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),Ae=te("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),pe=te("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),De=te("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),xe=te("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),de=te("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);async function Re(D,t=200){try{const n=await D.arrayBuffer(),c=window.AudioContext||window.webkitAudioContext,s=new c,i=await s.decodeAudioData(n);try{s.state!=="closed"&&await s.close()}catch{}const o=i.getChannelData(0);if(!o||o.length===0)return[];const l=Math.max(1,Math.floor(o.length/t)),x=[];for(let y=0;y<t;y++){const f=y*l,F=Math.min(f+l,o.length);let b=0;for(let d=f;d<F;d++){const N=Math.abs(o[d]);N>b&&(b=N)}x.push(Math.min(1,b))}return x}catch{return[]}}const Z=async(D,t,n=3)=>{let c=null;for(let s=1;s<=n;s++)try{return await D()}catch(i){if(c=i instanceof Error?i:new Error(String(i)),console.warn(`Database operation ${t} failed (attempt ${s}/${n}):`,c),s<n){const o=Math.min(1e3*Math.pow(2,s-1),5e3);await new Promise(l=>setTimeout(l,o))}}throw new Error(`Database operation ${t} failed after ${n} attempts: ${c==null?void 0:c.message}`)};class ye{constructor(t){se(this,"supportedFormats",["audio/mp3","audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/flac","audio/aac","audio/aacp","audio/x-m4a","audio/mp4","audio/ogg","audio/webm","audio/opus"]);se(this,"supportedExtensions",[".mp3",".wav",".flac",".aac",".m4a",".ogg",".webm",".opus"]);se(this,"maxFileSize",100*1024*1024);se(this,"onProgress");this.onProgress=t}async uploadFiles(t){const c=Array.from(t).filter(i=>this.isValidFile(i));if(c.length===0)throw new Error("No valid audio files found");const s=[];for(const i of c)try{const o=await this.processFile(i);o&&s.push(o)}catch(o){console.error(`Error processing file ${i.name}:`,o),this.updateProgress(i,0,"error",o instanceof Error?o.message:"Unknown error")}return s}isValidFile(t){if(!(t.type&&this.supportedFormats.includes(t.type))){const n=t.name.toLowerCase();if(!this.supportedExtensions.some(s=>n.endsWith(s)))return console.warn(`Unsupported file type: ${t.type||"unknown"} for file: ${t.name}`),!1}return t.size>this.maxFileSize?(console.warn(`File too large: ${t.name} (${(t.size/1024/1024).toFixed(2)}MB)`),!1):!0}async processFile(t){var n,c,s,i,o,l,x,y,f,F,b,d,N,U,p,$,E,M,H,T,j,W,V,v,I,J,X;try{try{(c=(n=window.log)==null?void 0:n.info)==null||c.call(n,`processFile start: ${t.name} (${t.type||"unknown"}, ${t.size} bytes)`)}catch{}try{this.updateProgress(t,0,"processing")}catch(R){try{(i=(s=window.log)==null?void 0:s.warn)==null||i.call(s,`updateProgress processing threw: ${String(R)}`)}catch{}}const L=this.extractMetadataFromFilename(t.name);try{(l=(o=window.log)==null?void 0:o.info)==null||l.call(o,`metadata extracted: title='${L.title}' artist='${L.artist}'`)}catch{}const k=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");let C=0,B=[];if(k)try{C=await this.getAudioDuration(t);try{(F=(f=window.log)==null?void 0:f.info)==null||F.call(f,`electron duration computed: ${t.name} => ${C}s`)}catch{}}catch{try{(d=(b=window.log)==null?void 0:b.warn)==null||d.call(b,`electron duration failed for ${t.name}`)}catch{}C=0}else{const R=await this.safeAnalyzeAudio(t);try{(y=(x=window.log)==null?void 0:x.info)==null||y.call(x,`analyzed: ${t.name} duration=${R.duration}s peaks=${R.peaks.length}`)}catch{}C=R.duration,B=R.peaks}const q={title:L.title,artist:L.artist,album:L.album,genre:L.genre,duration:C,bpm:L.bpm,key:L.key,energy:L.energy,url:"idb:pending",waveform:B};try{(U=(N=window.log)==null?void 0:N.info)==null||U.call(N,`about to addTrack for ${t.name}`)}catch{}const z=await P.addTrack(q);try{($=(p=window.log)==null?void 0:p.info)==null||$.call(p,`track added id=${z} for ${t.name}`)}catch{}if((!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron"))&&((E=window.fileStore)!=null&&E.saveAudio))try{const R=await t.arrayBuffer(),A=await window.fileStore.saveAudio(z,t.name,R);if(A!=null&&A.ok&&A.path){try{(H=(M=window.log)==null?void 0:M.info)==null||H.call(M,`file saved at ${A.path}`)}catch{}await Z(()=>P.updateTrack(z,{blobId:z,url:`file://${A.path}`,fileUrl:`file://${A.path}`}),`updateTrack file path for ${t.name}`);try{await Z(()=>re(z,t),`putBlob for ${t.name}`);try{(j=(T=window.log)==null?void 0:T.info)==null||j.call(T,`also stored in IndexedDB as blobId=${z}`)}catch{}}catch(Y){try{(V=(W=window.log)==null?void 0:W.warn)==null||V.call(W,`failed to store in IndexedDB: ${Y instanceof Error?Y.message:String(Y)}`)}catch{}}}else throw new Error((A==null?void 0:A.error)||"saveAudio failed")}catch(R){try{(I=(v=window.log)==null?void 0:v.warn)==null||I.call(v,`saveAudio failed, fallback to idb: ${R instanceof Error?R.message:String(R)}`)}catch{}await Z(()=>re(z,t),`putBlob fallback for ${t.name}`),await Z(()=>P.updateTrack(z,{blobId:z,url:`idb:${z}`}),`updateTrack idb fallback for ${t.name}`)}else await Z(()=>re(z,t),`putBlob for ${t.name}`),await Z(()=>P.updateTrack(z,{blobId:z,url:`idb:${z}`}),`updateTrack idb for ${t.name}`);const O=await P.getTrack(z);return O?(this.updateProgress(t,100,"completed"),O):null}catch(L){console.error(`Error processing file ${t.name}:`,L);try{(X=(J=window.log)==null?void 0:J.error)==null||X.call(J,`processFile error ${t.name}: ${L instanceof Error?L.message:String(L)}`)}catch{}return this.updateProgress(t,0,"error",L instanceof Error?L.message:"Unknown error"),null}}async safeAnalyzeAudio(t){try{const n=new Promise((i,o)=>{setTimeout(()=>o(new Error("Audio analysis timeout")),1e4)}),c=this.performAudioAnalysis(t);return await Promise.race([c,n])}catch{return{duration:0,peaks:[]}}}async performAudioAnalysis(t){try{const n=await t.arrayBuffer(),c=window.AudioContext||window.webkitAudioContext,s=new c;try{const i=await s.decodeAudioData(n),o=Number.isFinite(i.duration)?Math.round(i.duration):0,l=this.buildPeaksFromChannel(i.getChannelData(0),200);try{s.state!=="closed"&&s.close()}catch{}return{duration:o,peaks:l}}catch(i){try{s.state!=="closed"&&s.close()}catch{}throw i}}catch{return{duration:0,peaks:[]}}}buildPeaksFromChannel(t,n=200){if(!t||t.length===0)return[];const c=Math.max(1,Math.floor(t.length/n)),s=[];for(let i=0;i<n;i++){const o=i*c,l=Math.min(o+c,t.length);let x=0;for(let y=o;y<l;y++){const f=Math.abs(t[y]);f>x&&(x=f)}s.push(Math.min(1,x))}return s}async generateWaveformPeaks(t,n=200){try{const c=await t.arrayBuffer(),s=window.AudioContext||window.webkitAudioContext,i=new s;try{const l=(await i.decodeAudioData(c)).getChannelData(0),x=Math.floor(l.length/n),y=[];for(let f=0;f<n;f++){const F=f*x,b=Math.min(F+x,l.length);let d=0;for(let N=F;N<b;N++){const U=Math.abs(l[N]);U>d&&(d=U)}y.push(Math.min(1,d))}try{i.state!=="closed"&&i.close()}catch{}return y}catch{try{i.state!=="closed"&&i.close()}catch{}return[]}}catch{return[]}}async getAudioDurationFast(t){return new Promise(n=>{const c=new Audio,s=URL.createObjectURL(t),i=()=>{try{URL.revokeObjectURL(s)}catch{}},o=setTimeout(()=>{i(),n(0)},3e3);c.onloadedmetadata=()=>{clearTimeout(o);try{const l=Math.round(c.duration);i(),n(Number.isFinite(l)?l:0)}catch{i(),n(0)}},c.onerror=()=>{clearTimeout(o),i(),n(0)};try{c.src=s}catch{clearTimeout(o),i(),n(0)}})}generateSyntheticWaveform(t){const c=[];for(let s=0;s<100;s++){const i=s/100*t,o=Math.sin(i*.1)*.5+.5;c.push(Math.min(1,Math.max(0,o)))}return c}extractMetadataFromFilename(t){var i;const n=t.replace(/\.[^/.]+$/,""),c=n.match(/^(.+?)\s*-\s*(.+?)(?:\s*\((.+?)\))?$/);if(c)return{title:c[2].trim(),artist:c[1].trim(),album:(i=c[3])==null?void 0:i.trim(),genre:this.detectGenreFromFilename(n),duration:0,energy:this.detectEnergyFromFilename(n)};const s=n.match(/^(.+?)\s*-\s*(.+?)$/);return s?{title:s[1].trim(),artist:s[2].trim(),genre:this.detectGenreFromFilename(n),duration:0,energy:this.detectEnergyFromFilename(n)}:{title:n,artist:"Unknown Artist",genre:this.detectGenreFromFilename(n),duration:0,energy:this.detectEnergyFromFilename(n)}}detectGenreFromFilename(t){const n=t.toLowerCase(),c={Electronic:["electronic","edm","techno","house","trance","dubstep","drum","bass"],Rock:["rock","metal","punk","grunge","alternative"],Pop:["pop","pop-rock","indie-pop"],"Hip Hop":["hip-hop","rap","trap","r&b"],Jazz:["jazz","blues","soul","funk"],Classical:["classical","orchestra","symphony"],Country:["country","folk","bluegrass"],Reggae:["reggae","dub","ska"]};for(const[s,i]of Object.entries(c))if(i.some(o=>n.includes(o)))return s;return"Other"}detectEnergyFromFilename(t){const n=t.toLowerCase();return n.includes("fast")||n.includes("upbeat")||n.includes("energetic")||n.includes("intense")?"high":n.includes("slow")||n.includes("chill")||n.includes("ambient")||n.includes("relaxing")?"low":"medium"}async getAudioDuration(t){return new Promise(n=>{const c=new Audio,s=URL.createObjectURL(t),i=()=>{try{URL.revokeObjectURL(s)}catch(l){console.warn(`Failed to revoke object URL for ${t.name}:`,l)}};c.onloadedmetadata=()=>{try{const l=Math.round(c.duration);i(),n(Number.isFinite(l)?l:0)}catch(l){console.warn(`Failed to get metadata for ${t.name}:`,l),i(),n(0)}},c.onerror=l=>{console.warn(`Audio error for ${t.name}:`,l),i(),n(0)};const o=setTimeout(()=>{i(),n(0)},5e3);c.onloadedmetadata=()=>{clearTimeout(o);try{const l=Math.round(c.duration);i(),n(Number.isFinite(l)?l:0)}catch(l){console.warn(`Failed to get metadata for ${t.name}:`,l),i(),n(0)}},c.onerror=l=>{clearTimeout(o),console.warn(`Audio error for ${t.name}:`,l),i(),n(0)};try{c.src=s}catch(l){console.warn(`Failed to set audio src for ${t.name}:`,l),clearTimeout(o),i(),n(0)}})}async getAudioDurationHybrid(t){try{if(console.log(`üîç [DURATION] Calcolo durata ibrido per: ${t.name}`),!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron"))try{console.log(`üéØ [DURATION] Tentativo FFmpeg in Electron per: ${t.name}`);const o=128e3,l=t.size*8/o;return console.log(`üìä [DURATION] Durata stimata Electron per ${t.name}: ${Math.round(l)}s`),Math.round(l)}catch(o){console.warn(`‚ö†Ô∏è [DURATION] FFmpeg Electron fallito per ${t.name}:`,o)}let c;try{console.log(`üåê [DURATION] Tentativo HTML5 Audio nel browser per: ${t.name}`),c=URL.createObjectURL(t);const o=new Audio;o.preload="metadata";const x=await new Promise((y,f)=>{const F=setTimeout(()=>{f(new Error("Timeout caricamento metadata"))},1e4);o.addEventListener("loadedmetadata",()=>{clearTimeout(F);const b=o.duration;isFinite(b)&&b>0?y(b):f(new Error("Durata non valida"))}),o.addEventListener("error",b=>{clearTimeout(F),f(new Error(`Errore caricamento audio: ${b}`))}),o.src=c});return URL.revokeObjectURL(c),o.src="",o.load(),console.log(`‚úÖ [DURATION] Durata HTML5 Audio per ${t.name}: ${Math.round(x)}s`),Math.round(x)}catch(o){console.warn(`‚ö†Ô∏è [DURATION] HTML5 Audio fallito per ${t.name}:`,o);try{c&&URL.revokeObjectURL(c)}catch{}}const s=128e3,i=t.size*8/s;return console.log(`üìä [DURATION] Durata fallback per ${t.name}: ${Math.round(i)}s`),Math.round(i)}catch(n){console.warn(`‚ùå [DURATION] Errore calcolo durata ibrido per ${t.name}:`,n);const c=128e3,s=t.size*8/c;return Math.round(s)}}updateProgress(t,n,c,s){this.onProgress&&this.onProgress({file:t,progress:n,status:c,error:s})}async uploadWithProgress(t){var o,l,x,y;const c=Array.from(t).filter(f=>this.isValidFile(f)),s=[],i=[];for(let f=0;f<c.length;f++){const F=c[f],b=Math.round((f+1)/c.length*100);try{this.updateProgress(F,b,"uploading");const d=await this.processFile(F);if(d){try{(l=(o=window.log)==null?void 0:o.info)==null||l.call(o,`Uploaded track ${d.id} (${F.name}) ok`)}catch{}s.push(d)}}catch(d){const N=`Failed to upload ${F.name}: ${d instanceof Error?d.message:"Unknown error"}`;try{(y=(x=window.log)==null?void 0:x.error)==null||y.call(x,N)}catch{}i.push(N),this.updateProgress(F,0,"error",N)}}return{tracks:s,errors:i}}validateFiles(t){const n=Array.from(t),c=[],s=[];return n.forEach(i=>{const o=i.name.toLowerCase(),l=this.supportedExtensions.some(x=>o.endsWith(x));!i.type&&!l?s.push({file:i,reason:"Unsupported file format"}):i.type&&!this.supportedFormats.includes(i.type)&&!l?s.push({file:i,reason:"Unsupported file format"}):i.size>this.maxFileSize?s.push({file:i,reason:"File too large"}):c.push(i)}),{valid:c,invalid:s}}getSupportedFormats(){return[...this.supportedFormats]}getMaxFileSizeMB(){return this.maxFileSize/1024/1024}cleanupObjectUrls(t){t.forEach(n=>{n.url.startsWith("blob:")&&URL.revokeObjectURL(n.url)})}forceMemoryCleanup(){try{if("gc"in window&&window.gc(),"WeakRef"in window)for(let t=0;t<1e3;t++)new window.WeakRef({});return new Promise(t=>setTimeout(t,50))}catch{return Promise.resolve()}}async processFileOptimized(t,n=!1){var c,s,i,o,l,x,y,f,F,b,d,N,U,p,$;try{console.log(`üöÄ [FILE] Inizio processamento: ${t.name} (${t.size} bytes)`);try{this.updateProgress(t,0,"processing"),console.log(`üìä [FILE] Progresso aggiornato per: ${t.name}`)}catch(v){console.warn(`‚ö†Ô∏è [FILE] Errore aggiornamento progresso: ${t.name}`,v)}console.log(`üîç [FILE] Estrazione metadata per: ${t.name}`);const E=this.extractMetadataFromFilename(t.name);console.log(`‚úÖ [FILE] Metadata estratti: ${t.name} - Title: "${E.title}", Artist: "${E.artist}"`);let M=0,H=[];try{M=await this.getAudioDurationHybrid(t),console.log(`‚úÖ [FILE] Durata calcolata ibrida: ${t.name} - ${M}s`)}catch(v){console.warn(`‚ö†Ô∏è [FILE] Errore calcolo durata ibrida per ${t.name}:`,v),M=0}console.log(`‚è≠Ô∏è [FILE] Waveform saltato per import veloce: ${t.name}`),console.log(`üìù [FILE] Creazione oggetto track per: ${t.name}`);const T={title:E.title,artist:E.artist,album:E.album,genre:E.genre,duration:M,bpm:E.bpm,key:E.key,energy:E.energy,url:"",blobId:void 0,fileUrl:void 0,waveform:H};console.log(`‚úÖ [FILE] Oggetto track creato per: ${t.name}`);try{(s=(c=window.log)==null?void 0:c.info)==null||s.call(c,`about to addTrack for ${t.name}`)}catch{}let j;try{j=await Z(()=>P.addTrack(T),`addTrack for ${t.name}`);try{(o=(i=window.log)==null?void 0:i.info)==null||o.call(i,`track added id=${j} for ${t.name}`)}catch{}}catch(v){throw console.error(`Failed to add track to database for ${t.name}:`,v),new Error(`Database error: ${v instanceof Error?v.message:"Unknown database error"}`)}const W=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");try{if(W&&((l=window.fileStore)!=null&&l.saveAudio))try{const v=await t.arrayBuffer(),I=await window.fileStore.saveAudio(j,t.name,v);if(I!=null&&I.ok&&I.path){try{(y=(x=window.log)==null?void 0:x.info)==null||y.call(x,`file saved at ${I.path}`)}catch{}await P.updateTrack(j,{blobId:j,url:`file://${I.path}`,fileUrl:`file://${I.path}`});try{await re(j,t);try{(F=(f=window.log)==null?void 0:f.info)==null||F.call(f,`also stored in IndexedDB as blobId=${j}`)}catch{}}catch(J){try{(d=(b=window.log)==null?void 0:b.warn)==null||d.call(b,`failed to store in IndexedDB: ${J instanceof Error?J.message:String(J)}`)}catch{}}}else throw new Error((I==null?void 0:I.error)||"saveAudio failed")}catch(v){try{(U=(N=window.log)==null?void 0:N.warn)==null||U.call(N,`saveAudio failed, fallback to idb: ${v instanceof Error?v.message:String(v)}`)}catch{}await re(j,t),await P.updateTrack(j,{blobId:j,url:`idb:${j}`})}else await re(j,t),await P.updateTrack(j,{blobId:j,url:`idb:${j}`})}catch(v){console.error(`Failed to store audio data for ${t.name}:`,v);try{await Z(()=>P.deleteTrack(j),`deleteTrack cleanup for ${t.name}`)}catch(I){console.error(`Failed to cleanup track ${j} after storage error:`,I)}throw new Error(`Storage error: ${v instanceof Error?v.message:"Unknown storage error"}`)}let V=null;try{V=await Z(()=>P.getTrack(j),`getTrack for ${t.name}`)}catch(v){throw console.error(`Failed to get saved track ${j} for ${t.name}:`,v),new Error(`Failed to retrieve saved track: ${v instanceof Error?v.message:"Unknown error"}`)}if(V){try{this.updateProgress(t,100,"completed")}catch(v){console.warn(`Failed to update progress for ${t.name}:`,v)}return V}return null}catch(E){console.error(`Error processing file ${t.name}:`,E);try{($=(p=window.log)==null?void 0:p.error)==null||$.call(p,`processFileOptimized error ${t.name}: ${E instanceof Error?E.message:String(E)}`)}catch{}return this.updateProgress(t,0,"error",E instanceof Error?E.message:"Unknown error"),null}}}const Be=({isImporting:D,totalFiles:t,completedFiles:n,onMemoryWarning:c})=>{const[s,i]=g.useState({used:0,total:0,percentage:0,status:"low"}),[o,l]=g.useState(!1),[x,y]=g.useState([]),f=g.useCallback(()=>{if("memory"in performance){const p=performance.memory,$=p.usedJSHeapSize,E=p.totalJSHeapSize,M=$/E*100;let H="low";return M>90?H="critical":M>75?H="high":M>50&&(H="medium"),{used:$,total:E,percentage:M,status:H}}return{used:Math.random()*100*1024*1024,total:100*1024*1024,percentage:Math.random()*100,status:"low"}},[]);g.useEffect(()=>{if(!D)return;const p=setInterval(()=>{const $=f();i($),y(E=>{const M=[...E,$.percentage];return M.length>20&&M.shift(),M}),$.status==="critical"&&(b(),console.warn("‚ö†Ô∏è Memoria critica durante import!"))},3e3);return()=>clearInterval(p)},[D,f,c]);const F=g.useCallback(()=>{const p=[];return s.status==="critical"?p.push("Memoria elevata. L'import continuer√† automaticamente con ottimizzazioni"):s.status==="high"&&p.push("Memoria moderata. L'import procede normalmente"),t>500&&p.push("Libreria grande. Ottimizzazioni automatiche attive"),t>1e3&&p.push("Libreria molto grande. Processamento ottimizzato in corso"),p},[s.status,t]),b=g.useCallback(()=>{if(s.status==="critical"){console.warn("üö® [MEMORY] Memoria critica rilevata! Pulizia aggressiva...");try{"gc"in window&&(window.gc(),console.log("üßπ [MEMORY] Garbage collection forzato per memoria critica"))}catch(p){console.warn("Failed to force garbage collection:",p)}setTimeout(()=>{b()},1e3)}else if(s.status==="high"){console.warn("‚ö†Ô∏è [MEMORY] Memoria elevata rilevata. Pulizia preventiva...");try{"gc"in window&&(window.gc(),console.log("üßπ [MEMORY] Garbage collection preventivo per memoria elevata"))}catch(p){console.warn("Failed to force garbage collection:",p)}setTimeout(()=>{b()},500)}else if(s.status==="medium"){console.log("‚ÑπÔ∏è [MEMORY] Memoria moderata. Pulizia leggera...");try{"gc"in window&&(window.gc(),console.log("üßπ [MEMORY] Garbage collection leggero per memoria moderata"))}catch(p){console.warn("Failed to force garbage collection:",p)}}},[s.status]),d=p=>{if(p===0)return"0 B";const $=1024,E=["B","KB","MB","GB"],M=Math.floor(Math.log(p)/Math.log($));return parseFloat((p/Math.pow($,M)).toFixed(2))+" "+E[M]},N=p=>{switch(p){case"low":return"text-green-500";case"medium":return"text-yellow-500";case"high":return"text-orange-500";case"critical":return"text-red-500";default:return"text-gray-500"}},U=p=>{switch(p){case"low":return e.jsx(fe,{className:"w-4 h-4 text-green-500"});case"medium":return e.jsx(he,{className:"w-4 h-4 text-yellow-500"});case"high":return e.jsx(le,{className:"w-4 h-4 text-orange-500"});case"critical":return e.jsx(le,{className:"w-4 h-4 text-red-500"});default:return e.jsx(he,{className:"w-4 h-4 text-gray-500"})}};return D?e.jsxs("div",{className:"memory-manager bg-dj-primary rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-white flex items-center space-x-2",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Gestione Memoria"})]}),e.jsx("button",{onClick:()=>l(!o),className:"text-xs text-dj-light/60 hover:text-dj-light",children:o?"Nascondi":"Dettagli"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-dj-light/60 mb-1",children:[e.jsx("span",{children:"Uso Memoria"}),e.jsxs("span",{className:N(s.status),children:[s.percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-dj-secondary rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${s.status==="critical"?"bg-red-500":s.status==="high"?"bg-orange-500":s.status==="medium"?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.percentage,100)}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-dj-light/60 mt-1",children:[e.jsx("span",{children:d(s.used)}),e.jsx("span",{children:d(s.total)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[U(s.status),e.jsxs("span",{className:`text-sm ${N(s.status)}`,children:[s.status==="low"&&"Memoria OK",s.status==="medium"&&"Memoria Moderata",s.status==="high"&&"Memoria Elevata",s.status==="critical"&&"Memoria Critica!"]})]}),o&&e.jsxs("div",{className:"space-y-3",children:[x.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-dj-light/60 mb-2",children:"Andamento Memoria"}),e.jsx("div",{className:"flex items-end space-x-1 h-16",children:x.map((p,$)=>e.jsx("div",{className:`flex-1 min-w-0 ${p>90?"bg-red-500":p>75?"bg-orange-500":p>50?"bg-yellow-500":"bg-green-500"} rounded-t transition-all duration-300`,style:{height:`${p}%`},title:`${p.toFixed(1)}%`},$))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-dj-secondary p-2 rounded",children:[e.jsx("div",{className:"text-dj-light/60",children:"File Processati"}),e.jsx("div",{className:"text-white font-medium",children:n})]}),e.jsxs("div",{className:"bg-dj-secondary p-2 rounded",children:[e.jsx("div",{className:"text-dj-light/60",children:"File Totali"}),e.jsx("div",{className:"text-white font-medium",children:t})]}),e.jsxs("div",{className:"bg-dj-secondary p-2 rounded",children:[e.jsx("div",{className:"text-dj-light/60",children:"Progresso"}),e.jsxs("div",{className:"text-white font-medium",children:[(n/t*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-dj-secondary p-2 rounded",children:[e.jsx("div",{className:"text-dj-light/60",children:"Rimanenti"}),e.jsx("div",{className:"text-white font-medium",children:t-n})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-dj-light/60 mb-2",children:"Raccomandazioni"}),e.jsx("div",{className:"space-y-1",children:F().map((p,$)=>e.jsxs("div",{className:"text-xs text-dj-light/80 flex items-start space-x-2",children:[e.jsx(le,{className:"w-3 h-3 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:p})]},$))})]})]})]}):null},Ie=({onImportComplete:D})=>{const[t,n]=g.useState(!1),[c,s]=g.useState([]),[i,o]=g.useState(0),[l,x]=g.useState(0),[y,f]=g.useState(!1),[F,b]=g.useState(!1),[d,N]=g.useState(0),[U,p]=g.useState(0),[$,E]=g.useState({batchSize:50,delayBetweenBatches:100,skipWaveformGeneration:!1,maxConcurrentFiles:5}),M=g.useRef(null),H=g.useRef(null),T=g.useRef(null),j=g.useCallback(k=>k<=5?{batchSize:50,delayBetweenBatches:500,skipWaveformGeneration:!1,maxConcurrentFiles:1}:k<=100?{batchSize:50,delayBetweenBatches:400,skipWaveformGeneration:!1,maxConcurrentFiles:1}:k<=500?{batchSize:50,delayBetweenBatches:300,skipWaveformGeneration:!1,maxConcurrentFiles:1}:k<=1e3?{batchSize:50,delayBetweenBatches:200,skipWaveformGeneration:!1,maxConcurrentFiles:1}:{batchSize:50,delayBetweenBatches:100,skipWaveformGeneration:!1,maxConcurrentFiles:1},[]),W=async k=>{const C=k.target.files;if(!(!C||C.length===0))try{const B=j(C.length);E(B),n(!0),f(!0),o(C.length),x(0),N(0),T.current=new ye(A=>{s(Y=>Y.map(Q=>Q.file===A.file.name?{...Q,progress:A.progress,status:A.progress===100?"completed":"processing"}:Q))});const q=Array.from(C).filter(A=>{const Y=A.name.toLowerCase().split(".").pop();return["mp3","wav","flac","aac","ogg","m4a","wma"].includes(Y||"")});if(q.length===0){alert("Nessun file audio trovato nella cartella selezionata"),n(!1),f(!1);return}const z=q.map(A=>({file:A.name,progress:0,status:"pending"}));s(z);const ae=Math.ceil(q.length/B.batchSize);p(ae),H.current=new AbortController;const{tracks:O,errors:R}=await V(q,B);O.length>0&&(x(O.length),window.dispatchEvent(new CustomEvent("djconsole:db-updated")),D()),R.length>0&&(console.warn(`Import completed with ${R.length} errors:`,R),s(A=>A.map(Y=>R.some(Q=>Q.includes(Y.file))?{...Y,status:"error"}:Y))),setTimeout(()=>{f(!1),n(!1),s([]),o(0),x(0),N(0),p(0)},3e3)}catch(B){B instanceof Error&&B.name==="AbortError"?console.log("Import cancelled by user"):(console.error("Folder import failed:",B),alert("Errore durante l'importazione della cartella: "+(B instanceof Error?B.message:"Errore sconosciuto"))),n(!1),f(!1)}},V=async(k,C)=>{var ae;const B=[],q=[];console.log(`üöÄ [IMPORT] Inizio import in batch di ${C.batchSize} per ${k.length} file`);const z=Math.ceil(k.length/C.batchSize);for(let O=0;O<z;O++){if((ae=H.current)!=null&&ae.signal.aborted)throw console.log("üìÅ [IMPORT] Operazione cancellata dall'utente"),new Error("Operazione cancellata dall'utente");const R=O*C.batchSize,A=Math.min(R+C.batchSize,k.length),Y=k.slice(R,A);console.log(`üìÅ [IMPORT] Processando batch ${O+1}/${z} (${Y.length} file)`),N(O+1);const Q=Y.map(async G=>{try{if(!T.current)throw new Error("FileUploadManager non inizializzato");console.log(`‚ö° [IMPORT] Inizio processamento: ${G.name}`);const K=await T.current.processFileOptimized(G,C.skipWaveformGeneration);return K?(console.log(`‚úÖ [IMPORT] File completato: ${G.name}`),K):(console.warn(`‚ö†Ô∏è [IMPORT] File fallito: ${G.name}`),null)}catch(K){const oe=`Failed to process ${G.name}: ${K instanceof Error?K.message:"Unknown error"}`;return q.push(oe),console.error(`‚ùå [IMPORT] Errore file: ${G.name}`,K),null}}),ne=(await Promise.all(Q)).filter(G=>G!==null);if(B.push(...ne),x(G=>G+ne.length),O<z-1){console.log(`‚è∏Ô∏è [BATCH] Pausa di ${C.delayBetweenBatches}ms dopo batch ${O+1}/${z}`),await new Promise(G=>setTimeout(G,C.delayBetweenBatches));try{console.log(`üßπ [MEMORY] Pulizia memoria dopo batch ${O+1}`),"gc"in window&&(window.gc(),console.log("‚úÖ [MEMORY] Garbage collection forzato")),console.log("üò¥ [MEMORY] Pausa aggiuntiva per recupero memoria..."),await new Promise(G=>setTimeout(G,500)),console.log(`‚úÖ [MEMORY] Pulizia memoria completata per batch ${O+1}`)}catch(G){console.warn("‚ö†Ô∏è [MEMORY] Errore durante pulizia memoria:",G)}}}return console.log(`üéâ [IMPORT] Import in batch completato: ${B.length} file, ${q.length} errori`),{tracks:B,errors:q}},v=()=>{H.current&&H.current.abort()},I=()=>{alert("‚ö†Ô∏è Attenzione: Memoria critica rilevata! Considera di fermare l'import per evitare crash.")},J=()=>{M.current&&M.current.click()},X=k=>{switch(k){case"completed":return e.jsx(fe,{className:"w-4 h-4 text-green-500"});case"error":return e.jsx($e,{className:"w-4 h-4 text-red-500"});case"processing":return e.jsx(ge,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx(ge,{className:"w-4 h-4 text-gray-400"})}},L=k=>{switch(k){case"completed":return"Completato";case"error":return"Errore";case"processing":return"Elaborazione";default:return"In attesa"}};return e.jsx(Ce,{children:e.jsxs("div",{className:"folder-importer",children:[e.jsx("input",{ref:M,type:"file",webkitdirectory:"",directory:"",multiple:!0,onChange:W,className:"hidden",accept:".mp3,.wav,.flac,.aac,.ogg,.m4a,.wma","aria-label":"Seleziona cartella con file audio"}),e.jsxs("button",{onClick:J,disabled:t,className:"dj-button flex items-center space-x-2 w-full",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:t?"Importazione in corso...":"Seleziona Cartella"})]}),e.jsxs("button",{onClick:()=>b(!F),className:"mt-2 text-sm text-dj-light/60 hover:text-dj-light flex items-center space-x-2",children:[e.jsx(Pe,{className:"w-3 h-3"}),e.jsx("span",{children:"Impostazioni Import"})]}),F&&e.jsx("div",{className:"mt-3 p-3 bg-dj-primary rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-dj-light/80",children:"Dimensione Batch:"}),e.jsxs("select",{value:$.batchSize,onChange:k=>E(C=>({...C,batchSize:Number(k.target.value)})),className:"ml-2 bg-dj-secondary text-white text-sm rounded px-2 py-1","aria-label":"Dimensione batch per importazione",children:[e.jsx("option",{value:25,children:"25 file"}),e.jsx("option",{value:50,children:"50 file"}),e.jsx("option",{value:100,children:"100 file"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-dj-light/80",children:"Pausa tra Batch (ms):"}),e.jsxs("select",{value:$.delayBetweenBatches,onChange:k=>E(C=>({...C,delayBetweenBatches:Number(k.target.value)})),className:"ml-2 bg-dj-secondary text-white text-sm rounded px-2 py-1","aria-label":"Pausa tra batch per importazione",children:[e.jsx("option",{value:50,children:"50ms"}),e.jsx("option",{value:100,children:"100ms"}),e.jsx("option",{value:200,children:"200ms"})]})]}),e.jsx("div",{className:"text-sm text-dj-light/80 bg-dj-highlight/20 p-2 rounded border border-dj-highlight/30",children:e.jsx("span",{className:"text-dj-highlight",children:"üéµ Waveform sempre generati per qualit√† audio ottimale"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-dj-light/80",children:"File concorrenti:"}),e.jsxs("select",{value:$.maxConcurrentFiles,onChange:k=>E(C=>({...C,maxConcurrentFiles:Number(k.target.value)})),className:"ml-2 bg-dj-secondary text-white text-sm rounded px-2 py-1","aria-label":"Numero di file concorrenti per importazione",children:[e.jsx("option",{value:3,children:"3"}),e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:8,children:"8"})]})]})]})}),i>0&&e.jsxs("div",{className:"text-xs text-dj-light/60 bg-green-500/20 p-2 rounded border border-green-500/30",children:[e.jsx("strong",{children:"üöÄ Import Ottimizzato (Batch di 50):"}),e.jsxs("span",{className:"text-green-400",children:["Processamento in batch di ",$.batchSize," file con waveform completi e durate accurate. Pausa: ",$.delayBetweenBatches,"ms tra batch. Performance massima!"]})]}),t&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-dj-light/60 mb-2",children:[e.jsx("span",{children:"Progresso Import Ottimizzato"}),e.jsxs("span",{children:[l," / ",i]})]}),e.jsx("div",{className:"w-full bg-dj-primary rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-dj-success to-dj-highlight transition-all duration-300",style:{width:`${l/i*100}%`}})}),e.jsxs("div",{className:"text-xs text-dj-light/60 mt-1",children:["Batch: ",d," / ",Math.ceil(i/$.batchSize)," | File: ",l," (",Math.round(l/i*100),"%)"]})]}),t&&e.jsx("button",{onClick:v,className:"mt-3 w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors",children:"Cancella Import"}),y&&e.jsxs("div",{className:"mt-4 max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Dettaglio file:"}),e.jsx("div",{className:"space-y-2",children:c.map((k,C)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-dj-primary rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[X(k.status),e.jsx("span",{className:"text-sm text-white truncate",children:k.file})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-dj-light/60",children:L(k.status)}),k.status==="processing"&&e.jsx("div",{className:"w-16 bg-dj-secondary rounded-full h-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-dj-highlight transition-all duration-300",style:{width:`${k.progress}%`}})})]})]},C))})]}),e.jsx(Be,{isImporting:t,totalFiles:i,completedFiles:l,onMemoryWarning:I})]})})},Le=({filters:D,onFiltersChange:t,availableGenres:n,availableArtists:c,availableAlbums:s})=>{const[i,o]=g.useState(!1),[l,x]=g.useState(D);g.useEffect(()=>{x(D)},[D]),g.useEffect(()=>{const d=setTimeout(()=>{t(l)},300);return()=>clearTimeout(d)},[l,t]);const y=(d,N)=>{x(U=>({...U,[d]:N}))},f=()=>{x({genre:"",artist:"",album:"",minDuration:0,maxDuration:9999,minRating:0,maxRating:5,minPlayCount:0,maxPlayCount:9999,addedAfter:"",addedBefore:""})},F=Object.values(l).some(d=>d!==""&&d!==0&&d!==9999),b=d=>{const N=Math.floor(d/60),U=Math.floor(d%60);return`${N}:${U.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"advanced-search",children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:()=>o(!i),className:`px-3 py-2 rounded-md text-sm transition-all duration-200 flex items-center space-x-2 ${i?"bg-dj-accent text-white":"bg-dj-secondary text-dj-light hover:bg-dj-accent/20"}`,title:i?"Nascondi filtri avanzati":"Mostra filtri avanzati","aria-label":i?"Nascondi filtri avanzati":"Mostra filtri avanzati",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:i?"Nascondi":"Filtri"})]})}),i&&e.jsxs("div",{className:"bg-dj-secondary rounded-lg p-4 mb-4 border border-dj-accent/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Filtri Avanzati"}),e.jsx("div",{className:"flex items-center space-x-2",children:F&&e.jsx("button",{onClick:f,className:"px-2 py-1 bg-dj-error hover:bg-red-600 rounded text-xs transition-all duration-200",title:"Cancella filtri","aria-label":"Cancella filtri",children:e.jsx(we,{className:"w-3 h-3"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Genere"}),e.jsxs("select",{value:l.genre,onChange:d=>y("genre",d.target.value),className:"dj-input w-full","aria-label":"Seleziona genere",children:[e.jsx("option",{value:"",children:"Tutti i generi"}),n.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Artista"}),e.jsxs("select",{value:l.artist,onChange:d=>y("artist",d.target.value),className:"dj-input w-full","aria-label":"Seleziona artista",children:[e.jsx("option",{value:"",children:"Tutti gli artisti"}),c.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Album"}),e.jsxs("select",{value:l.album,onChange:d=>y("album",d.target.value),className:"dj-input w-full","aria-label":"Seleziona album",children:[e.jsx("option",{value:"",children:"Tutti gli album"}),s.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Durata Min (sec)"}),e.jsx("input",{type:"number",min:"0",max:"9999",value:l.minDuration,onChange:d=>y("minDuration",parseInt(d.target.value)||0),className:"dj-input w-full",placeholder:"0","aria-label":"Durata minima in secondi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Durata Max (sec)"}),e.jsx("input",{type:"number",min:"0",max:"9999",value:l.maxDuration,onChange:d=>y("maxDuration",parseInt(d.target.value)||9999),className:"dj-input w-full",placeholder:"9999","aria-label":"Durata massima in secondi"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Rating Min"}),e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(d=>e.jsx("button",{onClick:()=>y("minRating",d),className:`p-1 rounded ${l.minRating>=d?"text-yellow-400":"text-dj-light/40"}`,title:`Rating minimo: ${d} stelle`,"aria-label":`Rating minimo: ${d} stelle`,children:e.jsx(xe,{className:"w-4 h-4"})},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Rating Max"}),e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(d=>e.jsx("button",{onClick:()=>y("maxRating",d),className:`p-1 rounded ${l.maxRating>=d?"text-yellow-400":"text-dj-light/40"}`,title:`Rating massimo: ${d} stelle`,"aria-label":`Rating massimo: ${d} stelle`,children:e.jsx(xe,{className:"w-4 h-4"})},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Play Count Min"}),e.jsx("input",{type:"number",min:"0",value:l.minPlayCount,onChange:d=>y("minPlayCount",parseInt(d.target.value)||0),className:"dj-input w-full",placeholder:"0","aria-label":"Play count minimo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Play Count Max"}),e.jsx("input",{type:"number",min:"0",value:l.maxPlayCount,onChange:d=>y("maxPlayCount",parseInt(d.target.value)||9999),className:"dj-input w-full",placeholder:"9999","aria-label":"Play count massimo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Aggiunto dopo"}),e.jsx("input",{type:"date",value:l.addedAfter,onChange:d=>y("addedAfter",d.target.value),className:"dj-input w-full","aria-label":"Data di aggiunta dopo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dj-light/60 mb-2",children:"Aggiunto prima"}),e.jsx("input",{type:"date",value:l.addedBefore,onChange:d=>y("addedBefore",d.target.value),className:"dj-input w-full","aria-label":"Data di aggiunta prima"})]})]}),F&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-dj-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Filtri Attivi:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.genre&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Genere: ",l.genre]}),l.artist&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Artista: ",l.artist]}),l.album&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Album: ",l.album]}),l.minDuration>0&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Durata ‚â• ",b(l.minDuration)]}),l.maxDuration<9999&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Durata ‚â§ ",b(l.maxDuration)]}),l.minRating>0&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Rating ‚â• ",l.minRating,"‚≠ê"]}),l.maxRating<5&&e.jsxs("span",{className:"px-2 py-1 bg-dj-accent/20 text-dj-accent rounded text-xs",children:["Rating ‚â§ ",l.maxRating,"‚≠ê"]})]})]})]})]})},Ge=()=>{const[D,t]=g.useState([]),[n,c]=g.useState([]),[s,i]=g.useState(""),[o,l]=g.useState({genre:"",artist:"",album:"",minDuration:0,maxDuration:9999,minRating:0,maxRating:5,minPlayCount:0,maxPlayCount:9999,addedAfter:"",addedBefore:""}),[x,y]=g.useState("title"),[f,F]=g.useState("asc"),[b,d]=g.useState(null),[N,U]=g.useState(!1),[p,$]=g.useState([]),[E,M]=g.useState(!1),H=g.useRef(null),[T,j]=g.useState([]),[W,V]=g.useState(""),[v,I]=g.useState(""),[J,X]=g.useState(!1),[L,k]=g.useState(null),[C,B]=g.useState(""),[q,z]=g.useState(null),[ae,O]=g.useState(null),R=a=>{z(a),console.log("üéµ Started dragging track:",a.title)},A=(a,r)=>{a.preventDefault(),O(r)},Y=()=>{O(null)},Q=async(a,r)=>{if(a.preventDefault(),!!q)try{console.log("üéµ Dropping track into playlist:",{track:q.title,playlistId:r});const u=T.find(w=>w.id===r);if(!u)return;if(u.tracks.some(w=>w.id===q.id)){console.log("‚ö†Ô∏è Track already in playlist");return}const m=[...u.tracks,q];await P.updatePlaylist(r,{tracks:m.map(w=>w.id)});const h=T.map(w=>w.id===r?{...w,tracks:m}:w);j(h),console.log("‚úÖ Track added to playlist successfully"),window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:r,updatedTracks:m,updatedPlaylists:h}}))}catch(u){console.error("‚ùå Error adding track to playlist:",u)}finally{z(null),O(null)}},me=async(a,r)=>{try{console.log("üóëÔ∏è Removing track from playlist:",{trackId:a,playlistId:r});const u=T.find(w=>w.id===r);if(!u)return;const m=u.tracks.filter(w=>w.id!==a);await P.updatePlaylist(r,{tracks:m.map(w=>w.id)});const h=T.map(w=>w.id===r?{...w,tracks:m}:w);j(h),console.log("‚úÖ Track removed from playlist successfully"),window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:r,updatedTracks:m,updatedPlaylists:h}}))}catch(u){console.error("‚ùå Error removing track from playlist:",u)}},ne=async a=>{if(!W){window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"warning",message:"Seleziona prima una playlist per aggiungere la canzone!"}}));return}try{console.log("üéµ Adding track to selected playlist:",{track:a.title,playlistId:W});const r=T.find(h=>h.id===W);if(!r)return;if(r.tracks.some(h=>h.id===a.id)){window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"info",message:"Questa canzone √® gi√† nella playlist!"}}));return}const u=[...r.tracks,a];await P.updatePlaylist(W,{tracks:u.map(h=>h.id)});const m=T.map(h=>h.id===W?{...h,tracks:u}:h);j(m),console.log("‚úÖ Track added to selected playlist successfully"),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"success",message:`"${a.title}" aggiunta alla playlist "${r.name}"`}})),window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:W,updatedTracks:u,updatedPlaylists:m}}))}catch(r){console.error("‚ùå Error adding track to selected playlist:",r),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"error",message:"Errore durante l'aggiunta della canzone alla playlist"}}))}};g.useEffect(()=>{let a=[...D];if(s){const r=s.toLowerCase();a=a.filter(u=>u.title.toLowerCase().includes(r)||u.artist.toLowerCase().includes(r)||u.album&&u.album.toLowerCase().includes(r)||u.genre&&u.genre.toLowerCase().includes(r))}o.genre&&(a=a.filter(r=>r.genre===o.genre)),o.artist&&(a=a.filter(r=>r.artist===o.artist)),o.album&&(a=a.filter(r=>r.album===o.album)),o.minDuration>0&&(a=a.filter(r=>r.duration>=o.minDuration)),o.maxDuration<9999&&(a=a.filter(r=>r.duration<=o.maxDuration)),o.minRating>0&&(a=a.filter(r=>(r.rating||0)>=o.minRating)),o.maxRating<5&&(a=a.filter(r=>(r.rating||0)<=o.maxRating)),o.minPlayCount>0&&(a=a.filter(r=>(r.playCount||0)>=o.minPlayCount)),o.maxPlayCount<9999&&(a=a.filter(r=>(r.playCount||0)<=o.maxPlayCount)),a.sort((r,u)=>{let m,h;switch(x){case"title":m=r.title.toLowerCase(),h=u.title.toLowerCase();break;case"artist":m=r.artist.toLowerCase(),h=u.artist.toLowerCase();break;case"duration":m=r.duration,h=u.duration;break;case"addedAt":m=new Date(r.addedAt||0),h=new Date(u.addedAt||0);break;case"playCount":m=r.playCount||0,h=u.playCount||0;break;case"rating":m=r.rating||0,h=u.rating||0;break;default:m=r.title.toLowerCase(),h=u.title.toLowerCase()}return f==="asc"?m<h?-1:m>h?1:0:m>h?-1:m<h?1:0}),c(a)},[D,s,o,x,f]),g.useEffect(()=>{const a=async()=>{var m,h;try{await P.waitForInitialization();const w=await P.getAllTracks();if(!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron"))try{(h=(m=window.log)==null?void 0:m.info)==null||h.call(m,"Waveform regen skipped in Electron to keep UI responsive")}catch{}else for(const S of w)if((!S.waveform||S.waveform.length===0)&&S.blobId)try{const ue=await Fe(S.blobId);if(ue){const ie=await Re(ue,200);ie.length>0&&(await P.updateTrack(S.id,{waveform:ie}),S.waveform=ie)}}catch{}t(w),c(w)}catch(w){console.error("Failed to load tracks:",w)}};a();const r=m=>{a()};window.addEventListener("djconsole:db-updated",r);const u=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",u),()=>{window.removeEventListener("djconsole:db-updated",r),document.removeEventListener("visibilitychange",u)}},[]);const G=async()=>{try{console.log("üîÑ Forcing database restoration..."),await P.waitForInitialization();const a=await P.getAllTracks();t(a),c(a);const r=await P.getAllPlaylists(),u=await Promise.all(r.map(async m=>{try{const w=(await Promise.all(m.tracks.map(async _=>{try{const S=await P.getTrack(_);return S||(console.warn(`‚ö†Ô∏è Track ${_} not found during restore, skipping`),null)}catch(S){return console.error(`‚ùå Error loading track ${_} during restore:`,S),null}}))).filter(_=>_!==null);return{...m,tracks:w}}catch(h){return console.error(`‚ùå Error reconstructing playlist ${m.id} during restore:`,h),{...m,tracks:[]}}}));j(u),console.log("‚úÖ Database restored successfully")}catch(a){console.error("‚ùå Failed to restore database:",a)}};g.useEffect(()=>{(async()=>{try{console.log("üîÑ Loading playlists from database...");const r=await P.getAllPlaylists();if(r&&r.length>0){console.log("‚úÖ Found saved playlists:",r.length);const u=await Promise.all(r.map(async m=>{try{const w=(await Promise.all(m.tracks.map(async _=>{try{const S=await P.getTrack(_);return S||(console.warn(`‚ö†Ô∏è Track ${_} not found, skipping`),null)}catch(S){return console.error(`‚ùå Error loading track ${_}:`,S),null}}))).filter(_=>_!==null);return{...m,tracks:w}}catch(h){return console.error(`‚ùå Error reconstructing playlist ${m.id}:`,h),{...m,tracks:[]}}}));console.log("‚úÖ Playlists reconstructed with full tracks:",u.length),j(u),u.length>0&&V(u[0].id)}else console.log("üìù No saved playlists found - starting with empty state"),j([]),V("")}catch(r){console.error("‚ùå Error loading playlists:",r),j([]),V("")}})()},[]),g.useCallback(async(a=T)=>{try{console.log("üíæ Saving playlists to database IMMEDIATELY:",a.length);for(const r of a)await P.updatePlaylist(r.id,{tracks:r.tracks.map(u=>u.id),name:r.name,createdAt:r.createdAt});console.log("‚úÖ Playlists saved successfully to database"),localStorage.setItem("djconsole_playlists_backup",JSON.stringify(a)),console.log("üíæ Backup saved to localStorage")}catch(r){console.error("‚ùå Error saving playlists:",r);try{localStorage.setItem("djconsole_playlists_backup",JSON.stringify(a)),console.log("üíæ Fallback: saved to localStorage")}catch(u){console.error("‚ùå Even localStorage failed:",u)}}},[P]);const K=async()=>{try{const a=v.trim()||"Nuova Playlist",r=!v.trim();console.log("üéµ Creating playlist with name:",a,"wasEmpty:",r);const u=await P.createPlaylist({name:a,tracks:[]});console.log("‚úÖ Playlist created in database with ID:",u);const m={id:u,name:a,tracks:[],createdAt:new Date,updatedAt:new Date,isPublic:!0,totalDuration:0},h=[...T,m];j(h),V(m.id),I(""),X(!1),r&&(k(m.id),B("")),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"success",message:`Playlist "${m.name}" creata`}})),window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:m.id,updatedTracks:m.tracks||[],updatedPlaylists:h}}))}catch(a){console.error("‚ùå Errore durante la creazione della playlist:",a),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"error",message:"Errore durante la creazione della playlist"}}))}},oe=async a=>{if(C.trim())try{await P.updatePlaylist(a,{name:C.trim()});const r=T.map(m=>m.id===a?{...m,name:C.trim()}:m);j(r),k(null),B(""),console.log("‚úÖ Playlist rinominata con successo"),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"success",message:`Playlist rinominata in "${C.trim()}"`}}));const u=r.find(m=>m.id===a);window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:a,updatedTracks:(u==null?void 0:u.tracks)||[],updatedPlaylists:r}}))}catch(r){console.error("‚ùå Errore durante la rinominazione della playlist:",r),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"error",message:"Errore durante la rinominazione della playlist"}}))}},je=async a=>{const r=T.find(m=>m.id===a),u=(r==null?void 0:r.name)||"Playlist";if(window.confirm(`Sei sicuro di voler eliminare la playlist "${u}"?`))try{await P.deletePlaylist(a);const m=T.filter(w=>w.id!==a);j(m),W===a&&(m.length>0?V(m[0].id):V("")),console.log("‚úÖ Playlist eliminata con successo"),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"success",message:`Playlist "${u}" eliminata`}}));const h=m.find(w=>w.id===a);window.dispatchEvent(new CustomEvent("djconsole:library-playlist-updated",{detail:{playlistId:a,updatedTracks:(h==null?void 0:h.tracks)||[],updatedPlaylists:m}}))}catch(m){console.error("‚ùå Errore durante l'eliminazione della playlist:",m),window.dispatchEvent(new CustomEvent("djconsole:notification",{detail:{type:"error",message:"Errore durante l'eliminazione della playlist"}}))}},be=async a=>{if(window.confirm("Sei sicuro di voler eliminare questa traccia? Verr√† rimossa anche da tutte le playlist."))try{await P.deleteTrack(a),t(u=>u.filter(m=>m.id!==a)),c(u=>u.filter(m=>m.id!==a)),b===a&&d(null);const r=T.map(u=>({...u,tracks:u.tracks.filter(m=>m.id!==a)}));j(r);for(const u of T)if(u.tracks.some(m=>m.id===a)){const m=u.tracks.filter(h=>h.id!==a);await P.updatePlaylist(u.id,{tracks:m.map(h=>h.id)})}console.log("‚úÖ Traccia eliminata e sincronizzata con tutte le playlist")}catch(r){console.error("Errore durante l'eliminazione della traccia:",r)}},ve=async a=>{M(!0),$([]);try{const u=await new ye().uploadFiles(a,h=>{$(w=>w.find(S=>S.fileName===h.fileName)?w.map(S=>S.fileName===h.fileName?h:S):[...w,h])});console.log("Upload completato:",u),U(!1);const m=await P.getAllTracks();t(m),c(m)}catch(r){console.error("Errore durante l'upload:",r)}finally{M(!1),$([])}},Ne=async()=>{if(window.confirm("‚ö†Ô∏è ATTENZIONE: Questa operazione eliminer√† TUTTE le canzoni dalla libreria. Sei sicuro di voler continuare?"))try{console.log("üóëÔ∏è [LIBRARY] Inizio pulizia libreria...");const a=await P.getAllTracks();for(const r of a)await P.deleteTrack(r.id);t([]),c([]),d(null),console.log("‚úÖ [LIBRARY] Libreria pulita con successo")}catch(a){console.error("‚ùå [LIBRARY] Errore durante la pulizia della libreria:",a),alert("Errore durante la pulizia della libreria. Controlla la console per i dettagli.")}},ee=T.find(a=>a.id===W);return g.useEffect(()=>{const a=u=>{const{playlistId:m,updatedTracks:h,updatedPlaylists:w}=u.detail;console.log("üîÑ Playlist updated from console - syncing library:",{playlistId:m,trackCount:(h==null?void 0:h.length)||0}),w&&Array.isArray(w)?j(w):m&&h&&Array.isArray(h)&&j(_=>_.map(S=>S.id===m?{...S,tracks:h}:S))},r=()=>{console.log("üîÑ Sync request from console - sending current playlist state")};return window.addEventListener("djconsole:playlist-updated",a),window.addEventListener("djconsole:request-playlists-sync",r),()=>{window.removeEventListener("djconsole:playlist-updated",a),window.removeEventListener("djconsole:request-playlists-sync",r)}},[]),e.jsxs("div",{className:"min-h-screen bg-dj-dark text-white p-4 md:p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-dj font-bold text-white mb-2",children:"üéµ Libreria & Playlist"}),e.jsx("p",{className:"text-dj-light/60",children:"Gestisci la tua libreria musicale e organizza le playlist - Vista Unificata"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>U(!N),className:"dj-button flex items-center space-x-2",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Carica File"})]}),e.jsxs("button",{onClick:G,className:"dj-button-warning flex items-center space-x-2",title:"Ripristina Database e Playlist",children:[e.jsx("span",{children:"üîÑ"}),e.jsx("span",{children:"Ripristina DB"})]}),e.jsxs("button",{onClick:Ne,className:"dj-button-danger flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Pulisci Libreria"})]})]})]}),N&&e.jsxs("div",{className:"bg-dj-secondary rounded-xl p-6 mb-6 border border-dj-accent/20",children:[e.jsx("h2",{className:"text-xl font-dj font-bold text-white mb-4",children:"Carica File Musicali"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Carica File Singoli"}),e.jsx("input",{ref:H,type:"file",multiple:!0,accept:"audio/*",onChange:a=>a.target.files&&ve(a.target.files),className:"dj-input w-full"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Importa Cartella"}),e.jsx(Ie,{onImportComplete:()=>{}})]})]}),E&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Progresso Upload:"}),p.map((a,r)=>e.jsxs("div",{className:"text-sm text-dj-light/60",children:[a.fileName||"File",": ",Math.round(a.progress||0),"%"]},r))]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-dj-light/60"}),e.jsx("input",{type:"text",placeholder:"Cerca canzoni, artisti, album...",value:s,onChange:a=>i(a.target.value),className:"dj-input w-full pl-10"})]}),e.jsx(Le,{filters:o,onFiltersChange:l,availableGenres:[],availableArtists:[],availableAlbums:[]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-dj-light/60",children:"Ordina per:"}),e.jsxs("select",{value:x,onChange:a=>y(a.target.value),className:"dj-select bg-dj-secondary border-dj-accent/30 text-white",title:"Seleziona criterio di ordinamento",children:[e.jsx("option",{value:"title",children:"Titolo"}),e.jsx("option",{value:"artist",children:"Artista"}),e.jsx("option",{value:"duration",children:"Durata"}),e.jsx("option",{value:"addedAt",children:"Data Aggiunta"}),e.jsx("option",{value:"playCount",children:"Conteggio Riproduzioni"}),e.jsx("option",{value:"rating",children:"Valutazione"})]})]}),e.jsx("button",{onClick:()=>F(f==="asc"?"desc":"asc"),className:"dj-button-secondary",children:f==="asc"?"‚Üë Crescente":"‚Üì Decrescente"})]})]}),e.jsxs("div",{className:"bg-dj-secondary rounded-xl border border-dj-accent/20 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-dj-accent/20",children:e.jsxs("h3",{className:"text-lg font-dj font-bold text-white",children:["Libreria (",n.length," tracce)"]})}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:n.length===0?e.jsxs("div",{className:"text-center py-12 text-dj-light/60",children:[e.jsx(ce,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"Nessuna traccia trovata"}),e.jsx("p",{className:"text-sm",children:"Prova a modificare i filtri di ricerca o carica nuovi file"})]}):e.jsx("div",{className:"divide-y divide-dj-accent/10",children:n.map(a=>e.jsx("div",{draggable:!0,onDragStart:()=>R(a),onDoubleClick:()=>ne(a),className:`p-4 hover:bg-dj-primary/20 transition-all cursor-move ${b===a.id?"bg-dj-accent/10 border-l-4 border-dj-accent":""}`,onClick:()=>d(a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white truncate",children:a.title}),e.jsx("p",{className:"text-sm text-dj-light/60 truncate",children:a.artist}),a.album&&e.jsx("p",{className:"text-xs text-dj-light/40 truncate",children:a.album})]}),e.jsxs("div",{className:"flex items-center space-x-3 ml-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-dj-light/60",children:[Math.floor(a.duration/60),":",(a.duration%60).toString().padStart(2,"0")]}),a.playCount>0&&e.jsxs("div",{className:"text-xs text-dj-accent",children:["‚ñ∂ ",a.playCount]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:r=>{r.stopPropagation(),be(a.id)},className:"p-2 bg-red-500/20 hover:bg-red-500/30 rounded transition-all",title:"Elimina traccia",children:e.jsx(de,{size:16,className:"text-red-400"})})})]})]})},a.id))})})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-dj-accent/10 border border-dj-accent/30 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-dj font-bold text-white mb-2",children:"üìù Come aggiungere canzoni"}),e.jsxs("div",{className:"text-sm text-dj-light/80 space-y-2",children:[e.jsxs("p",{children:["‚Ä¢ ",e.jsx("strong",{children:"Drag & Drop:"})," Trascina una canzone dalla libreria alla playlist"]}),e.jsxs("p",{children:["‚Ä¢ ",e.jsx("strong",{children:"Doppio Click:"})," Fai doppio click su una canzone per aggiungerla alla playlist selezionata"]}),e.jsxs("p",{children:["‚Ä¢ ",e.jsx("strong",{children:"Seleziona playlist:"})," Clicca su una playlist per selezionarla (evidenziata in verde)"]})]})]}),e.jsxs("div",{className:"bg-dj-primary border border-dj-accent/30 rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-dj-accent/20",children:[e.jsx("h3",{className:"text-lg font-dj font-bold text-white mb-2",children:"Playlist"}),e.jsxs("p",{className:"text-sm text-dj-light/60",children:[T.length," playlist create"]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[T.map(a=>e.jsx("div",{className:`w-full p-3 rounded-lg text-left transition-all ${W===a.id?"bg-dj-accent text-white shadow-lg":"bg-dj-primary/50 text-dj-light/80 hover:bg-dj-accent/20 hover:text-white"} ${ae===a.id?"border-2 border-green-400 bg-green-400/20":""}`,onDragOver:r=>A(r,a.id),onDragLeave:Y,onDrop:r=>Q(r,a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{onClick:()=>V(a.id),className:"flex-1 flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{size:16}),L===a.id?e.jsx("input",{type:"text",value:C,onChange:r=>B(r.target.value),onKeyPress:r=>r.key==="Enter"&&oe(a.id),onBlur:()=>{k(null),B("")},className:"bg-transparent border-none outline-none text-white placeholder-dj-light/40",placeholder:"Nuovo nome playlist",title:"Inserisci il nuovo nome della playlist",autoFocus:!0}):e.jsx("span",{className:"font-medium",children:a.name})]}),e.jsx("span",{className:"text-xs bg-dj-accent/20 px-2 py-1 rounded-full",children:a.tracks?a.tracks.filter(r=>r&&r.id).length:0})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[L===a.id?e.jsx("button",{onClick:()=>oe(a.id),className:"p-1 hover:bg-green-500/30 rounded",title:"Conferma",children:e.jsx("span",{className:"text-green-400",children:"‚úì"})}):e.jsx("button",{onClick:r=>{r.stopPropagation(),k(a.id),B(a.name)},className:"p-1 hover:bg-dj-accent/30 rounded",title:"Rinomina",children:e.jsx(Ae,{size:14,className:"text-dj-light/60"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),je(a.id)},className:"p-1 hover:bg-red-500/30 rounded",title:"Elimina playlist",children:e.jsx(de,{size:14,className:"text-red-400"})})]})]})},a.id)),J?e.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-dj-accent/20 rounded-lg",children:[e.jsx("input",{type:"text",value:v,onChange:a=>I(a.target.value),placeholder:"Nome playlist...",className:"flex-1 bg-transparent border-none outline-none text-white placeholder-dj-light/40",title:"Inserisci il nome della nuova playlist",autoFocus:!0,onKeyPress:a=>a.key==="Enter"&&K(),onBlur:()=>{v.trim()?K():(X(!1),I(""))}}),e.jsx("button",{onClick:K,className:"p-1 hover:bg-dj-accent/30 rounded",title:"Crea playlist",children:e.jsx(pe,{size:16})})]}):e.jsxs("button",{onClick:()=>X(!0),className:"w-full flex items-center justify-center space-x-2 p-3 bg-dj-accent/20 text-dj-light/80 hover:bg-dj-accent/30 hover:text-white rounded-lg transition-all",children:[e.jsx(pe,{size:16}),e.jsx("span",{children:"Nuova Playlist"})]})]})]}),ee&&e.jsxs("div",{className:"bg-dj-secondary rounded-xl p-4 border border-dj-accent/20",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-lg font-dj font-bold text-white",children:ee.name}),e.jsxs("p",{className:"text-sm text-dj-light/60",children:[ee.tracks?ee.tracks.filter(a=>a&&a.id).length:0," tracce"]})]}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:!ee.tracks||ee.tracks.filter(a=>a&&a.id).length===0?e.jsxs("div",{className:"text-center py-8 text-dj-light/40",children:[e.jsx(ce,{size:32,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Playlist vuota"})]}):(ee.tracks||[]).filter(a=>!a||typeof a!="object"?(console.warn("‚ö†Ô∏è Track is not a valid object:",a),!1):a.id?a.title?!0:(console.warn("‚ö†Ô∏è Track missing title:",a),!1):(console.warn("‚ö†Ô∏è Track missing id:",a),!1)).map((a,r)=>!a||!a.title?(console.error("‚ùå CRITICAL: Track passed filter but is invalid:",a),null):e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-dj-primary/20 rounded hover:bg-dj-primary/30",children:[e.jsx("span",{className:"text-xs text-dj-accent font-bold w-6",children:r+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white truncate",children:a.title||"Titolo sconosciuto"}),e.jsx("p",{className:"text-xs text-dj-light/60 truncate",children:a.artist||"Artista sconosciuto"})]}),e.jsx("button",{onClick:()=>me(a.id,ee.id),className:"p-1 hover:bg-red-500/30 rounded",title:"Rimuovi",children:e.jsx(we,{size:14,className:"text-red-400"})})]},a.id)).filter(a=>a!==null)})]})]})]})]})};export{Ge as default};
//# sourceMappingURL=LibraryManager-c9bac000.js.map
