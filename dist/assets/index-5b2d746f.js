var Hf=Object.defineProperty;var Kf=(e,t,n)=>t in e?Hf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var U=(e,t,n)=>(Kf(e,typeof t!="symbol"?t+"":t,n),n);function Wf(e,t){for(var n=0;n<t.length;n++){const o=t[n];if(typeof o!="string"&&!Array.isArray(o)){for(const r in o)if(r!=="default"&&!(r in e)){const i=Object.getOwnPropertyDescriptor(o,r);i&&Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:()=>o[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function qf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var td={exports:{}},bs={},nd={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var di=Symbol.for("react.element"),Yf=Symbol.for("react.portal"),Xf=Symbol.for("react.fragment"),Qf=Symbol.for("react.strict_mode"),Jf=Symbol.for("react.profiler"),Zf=Symbol.for("react.provider"),eg=Symbol.for("react.context"),tg=Symbol.for("react.forward_ref"),ng=Symbol.for("react.suspense"),og=Symbol.for("react.memo"),rg=Symbol.for("react.lazy"),Rc=Symbol.iterator;function ig(e){return e===null||typeof e!="object"?null:(e=Rc&&e[Rc]||e["@@iterator"],typeof e=="function"?e:null)}var od={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rd=Object.assign,id={};function pr(e,t,n){this.props=e,this.context=t,this.refs=id,this.updater=n||od}pr.prototype.isReactComponent={};pr.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};pr.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function sd(){}sd.prototype=pr.prototype;function Sl(e,t,n){this.props=e,this.context=t,this.refs=id,this.updater=n||od}var El=Sl.prototype=new sd;El.constructor=Sl;rd(El,pr.prototype);El.isPureReactComponent=!0;var Ic=Array.isArray,ad=Object.prototype.hasOwnProperty,Cl={current:null},ld={key:!0,ref:!0,__self:!0,__source:!0};function cd(e,t,n){var o,r={},i=null,a=null;if(t!=null)for(o in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)ad.call(t,o)&&!ld.hasOwnProperty(o)&&(r[o]=t[o]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(o in l=e.defaultProps,l)r[o]===void 0&&(r[o]=l[o]);return{$$typeof:di,type:e,key:i,ref:a,props:r,_owner:Cl.current}}function sg(e,t){return{$$typeof:di,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function kl(e){return typeof e=="object"&&e!==null&&e.$$typeof===di}function ag(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Mc=/\/+/g;function Ys(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ag(""+e.key):t.toString(36)}function Oi(e,t,n,o,r){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case di:case Yf:a=!0}}if(a)return a=e,r=r(a),e=o===""?"."+Ys(a,0):o,Ic(r)?(n="",e!=null&&(n=e.replace(Mc,"$&/")+"/"),Oi(r,t,n,"",function(d){return d})):r!=null&&(kl(r)&&(r=sg(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Mc,"$&/")+"/")+e)),t.push(r)),1;if(a=0,o=o===""?".":o+":",Ic(e))for(var l=0;l<e.length;l++){i=e[l];var c=o+Ys(i,l);a+=Oi(i,t,n,c,r)}else if(c=ig(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=o+Ys(i,l++),a+=Oi(i,t,n,c,r);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function xi(e,t,n){if(e==null)return e;var o=[],r=0;return Oi(e,o,"","",function(i){return t.call(n,i,r++)}),o}function lg(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ut={current:null},Fi={transition:null},cg={ReactCurrentDispatcher:Ut,ReactCurrentBatchConfig:Fi,ReactCurrentOwner:Cl};function ud(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:xi,forEach:function(e,t,n){xi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return xi(e,function(){t++}),t},toArray:function(e){return xi(e,function(t){return t})||[]},only:function(e){if(!kl(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Me.Component=pr;Me.Fragment=Xf;Me.Profiler=Jf;Me.PureComponent=Sl;Me.StrictMode=Qf;Me.Suspense=ng;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cg;Me.act=ud;Me.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=rd({},e.props),r=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=Cl.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)ad.call(t,c)&&!ld.hasOwnProperty(c)&&(o[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)o.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];o.children=l}return{$$typeof:di,type:e.type,key:r,ref:i,props:o,_owner:a}};Me.createContext=function(e){return e={$$typeof:eg,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Zf,_context:e},e.Consumer=e};Me.createElement=cd;Me.createFactory=function(e){var t=cd.bind(null,e);return t.type=e,t};Me.createRef=function(){return{current:null}};Me.forwardRef=function(e){return{$$typeof:tg,render:e}};Me.isValidElement=kl;Me.lazy=function(e){return{$$typeof:rg,_payload:{_status:-1,_result:e},_init:lg}};Me.memo=function(e,t){return{$$typeof:og,type:e,compare:t===void 0?null:t}};Me.startTransition=function(e){var t=Fi.transition;Fi.transition={};try{e()}finally{Fi.transition=t}};Me.unstable_act=ud;Me.useCallback=function(e,t){return Ut.current.useCallback(e,t)};Me.useContext=function(e){return Ut.current.useContext(e)};Me.useDebugValue=function(){};Me.useDeferredValue=function(e){return Ut.current.useDeferredValue(e)};Me.useEffect=function(e,t){return Ut.current.useEffect(e,t)};Me.useId=function(){return Ut.current.useId()};Me.useImperativeHandle=function(e,t,n){return Ut.current.useImperativeHandle(e,t,n)};Me.useInsertionEffect=function(e,t){return Ut.current.useInsertionEffect(e,t)};Me.useLayoutEffect=function(e,t){return Ut.current.useLayoutEffect(e,t)};Me.useMemo=function(e,t){return Ut.current.useMemo(e,t)};Me.useReducer=function(e,t,n){return Ut.current.useReducer(e,t,n)};Me.useRef=function(e){return Ut.current.useRef(e)};Me.useState=function(e){return Ut.current.useState(e)};Me.useSyncExternalStore=function(e,t,n){return Ut.current.useSyncExternalStore(e,t,n)};Me.useTransition=function(){return Ut.current.useTransition()};Me.version="18.3.1";nd.exports=Me;var u=nd.exports;const Qn=qf(u),ug=Wf({__proto__:null,default:Qn},[u]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dg=u,mg=Symbol.for("react.element"),fg=Symbol.for("react.fragment"),gg=Object.prototype.hasOwnProperty,hg=dg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,pg={key:!0,ref:!0,__self:!0,__source:!0};function dd(e,t,n){var o,r={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(o in t)gg.call(t,o)&&!pg.hasOwnProperty(o)&&(r[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)r[o]===void 0&&(r[o]=t[o]);return{$$typeof:mg,type:e,key:i,ref:a,props:r,_owner:hg.current}}bs.Fragment=fg;bs.jsx=dd;bs.jsxs=dd;td.exports=bs;var s=td.exports,ka={},md={exports:{}},rn={},fd={exports:{}},gd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(W,D){var M=W.length;W.push(D);e:for(;0<M;){var J=M-1>>>1,Q=W[J];if(0<r(Q,D))W[J]=D,W[M]=Q,M=J;else break e}}function n(W){return W.length===0?null:W[0]}function o(W){if(W.length===0)return null;var D=W[0],M=W.pop();if(M!==D){W[0]=M;e:for(var J=0,Q=W.length,he=Q>>>1;J<he;){var Be=2*(J+1)-1,ut=W[Be],qe=Be+1,Fe=W[qe];if(0>r(ut,M))qe<Q&&0>r(Fe,ut)?(W[J]=Fe,W[qe]=M,J=qe):(W[J]=ut,W[Be]=M,J=Be);else if(qe<Q&&0>r(Fe,M))W[J]=Fe,W[qe]=M,J=qe;else break e}}return D}function r(W,D){var M=W.sortIndex-D.sortIndex;return M!==0?M:W.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();e.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,p=null,y=3,x=!1,S=!1,w=!1,C=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(W){for(var D=n(d);D!==null;){if(D.callback===null)o(d);else if(D.startTime<=W)o(d),D.sortIndex=D.expirationTime,t(c,D);else break;D=n(d)}}function v(W){if(w=!1,m(W),!S)if(n(c)!==null)S=!0,se(N);else{var D=n(d);D!==null&&ae(v,D.startTime-W)}}function N(W,D){S=!1,w&&(w=!1,f(I),I=-1),x=!0;var M=y;try{for(m(D),p=n(c);p!==null&&(!(p.expirationTime>D)||W&&!F());){var J=p.callback;if(typeof J=="function"){p.callback=null,y=p.priorityLevel;var Q=J(p.expirationTime<=D);D=e.unstable_now(),typeof Q=="function"?p.callback=Q:p===n(c)&&o(c),m(D)}else o(c);p=n(c)}if(p!==null)var he=!0;else{var Be=n(d);Be!==null&&ae(v,Be.startTime-D),he=!1}return he}finally{p=null,y=M,x=!1}}var A=!1,b=null,I=-1,j=5,R=-1;function F(){return!(e.unstable_now()-R<j)}function te(){if(b!==null){var W=e.unstable_now();R=W;var D=!0;try{D=b(!0,W)}finally{D?oe():(A=!1,b=null)}}else A=!1}var oe;if(typeof g=="function")oe=function(){g(te)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,V=ie.port2;ie.port1.onmessage=te,oe=function(){V.postMessage(null)}}else oe=function(){C(te,0)};function se(W){b=W,A||(A=!0,oe())}function ae(W,D){I=C(function(){W(e.unstable_now())},D)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){S||x||(S=!0,se(N))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(W){switch(y){case 1:case 2:case 3:var D=3;break;default:D=y}var M=y;y=D;try{return W()}finally{y=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,D){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var M=y;y=W;try{return D()}finally{y=M}},e.unstable_scheduleCallback=function(W,D,M){var J=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?J+M:J):M=J,W){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=M+Q,W={id:h++,callback:D,priorityLevel:W,startTime:M,expirationTime:Q,sortIndex:-1},M>J?(W.sortIndex=M,t(d,W),n(c)===null&&W===n(d)&&(w?(f(I),I=-1):w=!0,ae(v,M-J))):(W.sortIndex=Q,t(c,W),S||x||(S=!0,se(N))),W},e.unstable_shouldYield=F,e.unstable_wrapCallback=function(W){var D=y;return function(){var M=y;y=D;try{return W.apply(this,arguments)}finally{y=M}}}})(gd);fd.exports=gd;var yg=fd.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg=u,on=yg;function K(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hd=new Set,Gr={};function Oo(e,t){ar(e,t),ar(e+"Capture",t)}function ar(e,t){for(Gr[e]=t,e=0;e<t.length;e++)hd.add(t[e])}var On=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ta=Object.prototype.hasOwnProperty,xg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pc={},Lc={};function wg(e){return Ta.call(Lc,e)?!0:Ta.call(Pc,e)?!1:xg.test(e)?Lc[e]=!0:(Pc[e]=!0,!1)}function Sg(e,t,n,o){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return o?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Eg(e,t,n,o){if(t===null||typeof t>"u"||Sg(e,t,n,o))return!0;if(o)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Bt(e,t,n,o,r,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=o,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var At={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){At[e]=new Bt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];At[t]=new Bt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){At[e]=new Bt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){At[e]=new Bt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){At[e]=new Bt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){At[e]=new Bt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){At[e]=new Bt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){At[e]=new Bt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){At[e]=new Bt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Tl=/[\-:]([a-z])/g;function bl(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Tl,bl);At[t]=new Bt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Tl,bl);At[t]=new Bt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Tl,bl);At[t]=new Bt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){At[e]=new Bt(e,1,!1,e.toLowerCase(),null,!1,!1)});At.xlinkHref=new Bt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){At[e]=new Bt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Nl(e,t,n,o){var r=At.hasOwnProperty(t)?At[t]:null;(r!==null?r.type!==0:o||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Eg(t,n,r,o)&&(n=null),o||r===null?wg(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,o=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,o?e.setAttributeNS(o,t,n):e.setAttribute(t,n))))}var Un=vg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wi=Symbol.for("react.element"),Go=Symbol.for("react.portal"),Vo=Symbol.for("react.fragment"),Al=Symbol.for("react.strict_mode"),ba=Symbol.for("react.profiler"),pd=Symbol.for("react.provider"),yd=Symbol.for("react.context"),Dl=Symbol.for("react.forward_ref"),Na=Symbol.for("react.suspense"),Aa=Symbol.for("react.suspense_list"),jl=Symbol.for("react.memo"),Hn=Symbol.for("react.lazy"),vd=Symbol.for("react.offscreen"),$c=Symbol.iterator;function Sr(e){return e===null||typeof e!="object"?null:(e=$c&&e[$c]||e["@@iterator"],typeof e=="function"?e:null)}var it=Object.assign,Xs;function Dr(e){if(Xs===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Xs=t&&t[1]||""}return`
`+Xs+e}var Qs=!1;function Js(e,t){if(!e||Qs)return"";Qs=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var o=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){o=d}e.call(t.prototype)}else{try{throw Error()}catch(d){o=d}e()}}catch(d){if(d&&o&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),i=o.stack.split(`
`),a=r.length-1,l=i.length-1;1<=a&&0<=l&&r[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(r[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||r[a]!==i[l]){var c=`
`+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=l);break}}}finally{Qs=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Dr(e):""}function Cg(e){switch(e.tag){case 5:return Dr(e.type);case 16:return Dr("Lazy");case 13:return Dr("Suspense");case 19:return Dr("SuspenseList");case 0:case 2:case 15:return e=Js(e.type,!1),e;case 11:return e=Js(e.type.render,!1),e;case 1:return e=Js(e.type,!0),e;default:return""}}function Da(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Vo:return"Fragment";case Go:return"Portal";case ba:return"Profiler";case Al:return"StrictMode";case Na:return"Suspense";case Aa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case yd:return(e.displayName||"Context")+".Consumer";case pd:return(e._context.displayName||"Context")+".Provider";case Dl:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case jl:return t=e.displayName||null,t!==null?t:Da(e.type)||"Memo";case Hn:t=e._payload,e=e._init;try{return Da(e(t))}catch{}}return null}function kg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Da(t);case 8:return t===Al?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function fo(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function xd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Tg(e){var t=xd(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(a){o=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return o},setValue:function(a){o=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Si(e){e._valueTracker||(e._valueTracker=Tg(e))}function wd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),o="";return e&&(o=xd(e)?e.checked?"true":"false":e.value),e=o,e!==n?(t.setValue(e),!0):!1}function Qi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ja(e,t){var n=t.checked;return it({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Oc(e,t){var n=t.defaultValue==null?"":t.defaultValue,o=t.checked!=null?t.checked:t.defaultChecked;n=fo(t.value!=null?t.value:n),e._wrapperState={initialChecked:o,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Sd(e,t){t=t.checked,t!=null&&Nl(e,"checked",t,!1)}function Ra(e,t){Sd(e,t);var n=fo(t.value),o=t.type;if(n!=null)o==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Ia(e,t.type,n):t.hasOwnProperty("defaultValue")&&Ia(e,t.type,fo(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Fc(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var o=t.type;if(!(o!=="submit"&&o!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Ia(e,t,n){(t!=="number"||Qi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var jr=Array.isArray;function tr(e,t,n,o){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&o&&(e[n].defaultSelected=!0)}else{for(n=""+fo(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,o&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function Ma(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(K(91));return it({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function zc(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(K(92));if(jr(n)){if(1<n.length)throw Error(K(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:fo(n)}}function Ed(e,t){var n=fo(t.value),o=fo(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),o!=null&&(e.defaultValue=""+o)}function _c(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Cd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pa(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Cd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ei,kd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,o,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,o,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ei=Ei||document.createElement("div"),Ei.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ei.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Vr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Mr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bg=["Webkit","ms","Moz","O"];Object.keys(Mr).forEach(function(e){bg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Mr[t]=Mr[e]})});function Td(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Mr.hasOwnProperty(e)&&Mr[e]?(""+t).trim():t+"px"}function bd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var o=n.indexOf("--")===0,r=Td(n,t[n],o);n==="float"&&(n="cssFloat"),o?e.setProperty(n,r):e[n]=r}}var Ng=it({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function La(e,t){if(t){if(Ng[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(K(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(K(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(K(61))}if(t.style!=null&&typeof t.style!="object")throw Error(K(62))}}function $a(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Oa=null;function Rl(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Fa=null,nr=null,or=null;function Uc(e){if(e=gi(e)){if(typeof Fa!="function")throw Error(K(280));var t=e.stateNode;t&&(t=Rs(t),Fa(e.stateNode,e.type,t))}}function Nd(e){nr?or?or.push(e):or=[e]:nr=e}function Ad(){if(nr){var e=nr,t=or;if(or=nr=null,Uc(e),t)for(e=0;e<t.length;e++)Uc(t[e])}}function Dd(e,t){return e(t)}function jd(){}var Zs=!1;function Rd(e,t,n){if(Zs)return e(t,n);Zs=!0;try{return Dd(e,t,n)}finally{Zs=!1,(nr!==null||or!==null)&&(jd(),Ad())}}function Hr(e,t){var n=e.stateNode;if(n===null)return null;var o=Rs(n);if(o===null)return null;n=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(K(231,t,typeof n));return n}var za=!1;if(On)try{var Er={};Object.defineProperty(Er,"passive",{get:function(){za=!0}}),window.addEventListener("test",Er,Er),window.removeEventListener("test",Er,Er)}catch{za=!1}function Ag(e,t,n,o,r,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(n,d)}catch(h){this.onError(h)}}var Pr=!1,Ji=null,Zi=!1,_a=null,Dg={onError:function(e){Pr=!0,Ji=e}};function jg(e,t,n,o,r,i,a,l,c){Pr=!1,Ji=null,Ag.apply(Dg,arguments)}function Rg(e,t,n,o,r,i,a,l,c){if(jg.apply(this,arguments),Pr){if(Pr){var d=Ji;Pr=!1,Ji=null}else throw Error(K(198));Zi||(Zi=!0,_a=d)}}function Fo(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Id(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Bc(e){if(Fo(e)!==e)throw Error(K(188))}function Ig(e){var t=e.alternate;if(!t){if(t=Fo(e),t===null)throw Error(K(188));return t!==e?null:e}for(var n=e,o=t;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(o=r.return,o!==null){n=o;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return Bc(r),e;if(i===o)return Bc(r),t;i=i.sibling}throw Error(K(188))}if(n.return!==o.return)n=r,o=i;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,o=i;break}if(l===o){a=!0,o=r,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,o=r;break}if(l===o){a=!0,o=i,n=r;break}l=l.sibling}if(!a)throw Error(K(189))}}if(n.alternate!==o)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?e:t}function Md(e){return e=Ig(e),e!==null?Pd(e):null}function Pd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Pd(e);if(t!==null)return t;e=e.sibling}return null}var Ld=on.unstable_scheduleCallback,Gc=on.unstable_cancelCallback,Mg=on.unstable_shouldYield,Pg=on.unstable_requestPaint,gt=on.unstable_now,Lg=on.unstable_getCurrentPriorityLevel,Il=on.unstable_ImmediatePriority,$d=on.unstable_UserBlockingPriority,es=on.unstable_NormalPriority,$g=on.unstable_LowPriority,Od=on.unstable_IdlePriority,Ns=null,Dn=null;function Og(e){if(Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(Ns,e,void 0,(e.current.flags&128)===128)}catch{}}var En=Math.clz32?Math.clz32:_g,Fg=Math.log,zg=Math.LN2;function _g(e){return e>>>=0,e===0?32:31-(Fg(e)/zg|0)|0}var Ci=64,ki=4194304;function Rr(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ts(e,t){var n=e.pendingLanes;if(n===0)return 0;var o=0,r=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var l=a&~r;l!==0?o=Rr(l):(i&=a,i!==0&&(o=Rr(i)))}else a=n&~r,a!==0?o=Rr(a):i!==0&&(o=Rr(i));if(o===0)return 0;if(t!==0&&t!==o&&!(t&r)&&(r=o&-o,i=t&-t,r>=i||r===16&&(i&4194240)!==0))return t;if(o&4&&(o|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=o;0<t;)n=31-En(t),r=1<<n,o|=e[n],t&=~r;return o}function Ug(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bg(e,t){for(var n=e.suspendedLanes,o=e.pingedLanes,r=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-En(i),l=1<<a,c=r[a];c===-1?(!(l&n)||l&o)&&(r[a]=Ug(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Ua(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Fd(){var e=Ci;return Ci<<=1,!(Ci&4194240)&&(Ci=64),e}function ea(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-En(t),e[t]=n}function Gg(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-En(n),i=1<<r;t[r]=0,o[r]=-1,e[r]=-1,n&=~i}}function Ml(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var o=31-En(n),r=1<<o;r&t|e[o]&t&&(e[o]|=t),n&=~r}}var Ve=0;function zd(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var _d,Pl,Ud,Bd,Gd,Ba=!1,Ti=[],to=null,no=null,oo=null,Kr=new Map,Wr=new Map,Yn=[],Vg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vc(e,t){switch(e){case"focusin":case"focusout":to=null;break;case"dragenter":case"dragleave":no=null;break;case"mouseover":case"mouseout":oo=null;break;case"pointerover":case"pointerout":Kr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wr.delete(t.pointerId)}}function Cr(e,t,n,o,r,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:o,nativeEvent:i,targetContainers:[r]},t!==null&&(t=gi(t),t!==null&&Pl(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function Hg(e,t,n,o,r){switch(t){case"focusin":return to=Cr(to,e,t,n,o,r),!0;case"dragenter":return no=Cr(no,e,t,n,o,r),!0;case"mouseover":return oo=Cr(oo,e,t,n,o,r),!0;case"pointerover":var i=r.pointerId;return Kr.set(i,Cr(Kr.get(i)||null,e,t,n,o,r)),!0;case"gotpointercapture":return i=r.pointerId,Wr.set(i,Cr(Wr.get(i)||null,e,t,n,o,r)),!0}return!1}function Vd(e){var t=To(e.target);if(t!==null){var n=Fo(t);if(n!==null){if(t=n.tag,t===13){if(t=Id(n),t!==null){e.blockedOn=t,Gd(e.priority,function(){Ud(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function zi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ga(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var o=new n.constructor(n.type,n);Oa=o,n.target.dispatchEvent(o),Oa=null}else return t=gi(n),t!==null&&Pl(t),e.blockedOn=n,!1;t.shift()}return!0}function Hc(e,t,n){zi(e)&&n.delete(t)}function Kg(){Ba=!1,to!==null&&zi(to)&&(to=null),no!==null&&zi(no)&&(no=null),oo!==null&&zi(oo)&&(oo=null),Kr.forEach(Hc),Wr.forEach(Hc)}function kr(e,t){e.blockedOn===t&&(e.blockedOn=null,Ba||(Ba=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,Kg)))}function qr(e){function t(r){return kr(r,e)}if(0<Ti.length){kr(Ti[0],e);for(var n=1;n<Ti.length;n++){var o=Ti[n];o.blockedOn===e&&(o.blockedOn=null)}}for(to!==null&&kr(to,e),no!==null&&kr(no,e),oo!==null&&kr(oo,e),Kr.forEach(t),Wr.forEach(t),n=0;n<Yn.length;n++)o=Yn[n],o.blockedOn===e&&(o.blockedOn=null);for(;0<Yn.length&&(n=Yn[0],n.blockedOn===null);)Vd(n),n.blockedOn===null&&Yn.shift()}var rr=Un.ReactCurrentBatchConfig,ns=!0;function Wg(e,t,n,o){var r=Ve,i=rr.transition;rr.transition=null;try{Ve=1,Ll(e,t,n,o)}finally{Ve=r,rr.transition=i}}function qg(e,t,n,o){var r=Ve,i=rr.transition;rr.transition=null;try{Ve=4,Ll(e,t,n,o)}finally{Ve=r,rr.transition=i}}function Ll(e,t,n,o){if(ns){var r=Ga(e,t,n,o);if(r===null)ua(e,t,o,os,n),Vc(e,o);else if(Hg(r,e,t,n,o))o.stopPropagation();else if(Vc(e,o),t&4&&-1<Vg.indexOf(e)){for(;r!==null;){var i=gi(r);if(i!==null&&_d(i),i=Ga(e,t,n,o),i===null&&ua(e,t,o,os,n),i===r)break;r=i}r!==null&&o.stopPropagation()}else ua(e,t,o,null,n)}}var os=null;function Ga(e,t,n,o){if(os=null,e=Rl(o),e=To(e),e!==null)if(t=Fo(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Id(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return os=e,null}function Hd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Lg()){case Il:return 1;case $d:return 4;case es:case $g:return 16;case Od:return 536870912;default:return 16}default:return 16}}var Jn=null,$l=null,_i=null;function Kd(){if(_i)return _i;var e,t=$l,n=t.length,o,r="value"in Jn?Jn.value:Jn.textContent,i=r.length;for(e=0;e<n&&t[e]===r[e];e++);var a=n-e;for(o=1;o<=a&&t[n-o]===r[i-o];o++);return _i=r.slice(e,1<o?1-o:void 0)}function Ui(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bi(){return!0}function Kc(){return!1}function sn(e){function t(n,o,r,i,a){this._reactName=n,this._targetInst=r,this.type=o,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?bi:Kc,this.isPropagationStopped=Kc,this}return it(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bi)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bi)},persist:function(){},isPersistent:bi}),t}var yr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ol=sn(yr),fi=it({},yr,{view:0,detail:0}),Yg=sn(fi),ta,na,Tr,As=it({},fi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fl,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Tr&&(Tr&&e.type==="mousemove"?(ta=e.screenX-Tr.screenX,na=e.screenY-Tr.screenY):na=ta=0,Tr=e),ta)},movementY:function(e){return"movementY"in e?e.movementY:na}}),Wc=sn(As),Xg=it({},As,{dataTransfer:0}),Qg=sn(Xg),Jg=it({},fi,{relatedTarget:0}),oa=sn(Jg),Zg=it({},yr,{animationName:0,elapsedTime:0,pseudoElement:0}),eh=sn(Zg),th=it({},yr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nh=sn(th),oh=it({},yr,{data:0}),qc=sn(oh),rh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ih={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ah(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=sh[e])?!!t[e]:!1}function Fl(){return ah}var lh=it({},fi,{key:function(e){if(e.key){var t=rh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ui(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ih[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fl,charCode:function(e){return e.type==="keypress"?Ui(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ui(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),ch=sn(lh),uh=it({},As,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yc=sn(uh),dh=it({},fi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fl}),mh=sn(dh),fh=it({},yr,{propertyName:0,elapsedTime:0,pseudoElement:0}),gh=sn(fh),hh=it({},As,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ph=sn(hh),yh=[9,13,27,32],zl=On&&"CompositionEvent"in window,Lr=null;On&&"documentMode"in document&&(Lr=document.documentMode);var vh=On&&"TextEvent"in window&&!Lr,Wd=On&&(!zl||Lr&&8<Lr&&11>=Lr),Xc=String.fromCharCode(32),Qc=!1;function qd(e,t){switch(e){case"keyup":return yh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ho=!1;function xh(e,t){switch(e){case"compositionend":return Yd(t);case"keypress":return t.which!==32?null:(Qc=!0,Xc);case"textInput":return e=t.data,e===Xc&&Qc?null:e;default:return null}}function wh(e,t){if(Ho)return e==="compositionend"||!zl&&qd(e,t)?(e=Kd(),_i=$l=Jn=null,Ho=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Wd&&t.locale!=="ko"?null:t.data;default:return null}}var Sh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Sh[e.type]:t==="textarea"}function Xd(e,t,n,o){Nd(o),t=rs(t,"onChange"),0<t.length&&(n=new Ol("onChange","change",null,n,o),e.push({event:n,listeners:t}))}var $r=null,Yr=null;function Eh(e){am(e,0)}function Ds(e){var t=qo(e);if(wd(t))return e}function Ch(e,t){if(e==="change")return t}var Qd=!1;if(On){var ra;if(On){var ia="oninput"in document;if(!ia){var Zc=document.createElement("div");Zc.setAttribute("oninput","return;"),ia=typeof Zc.oninput=="function"}ra=ia}else ra=!1;Qd=ra&&(!document.documentMode||9<document.documentMode)}function eu(){$r&&($r.detachEvent("onpropertychange",Jd),Yr=$r=null)}function Jd(e){if(e.propertyName==="value"&&Ds(Yr)){var t=[];Xd(t,Yr,e,Rl(e)),Rd(Eh,t)}}function kh(e,t,n){e==="focusin"?(eu(),$r=t,Yr=n,$r.attachEvent("onpropertychange",Jd)):e==="focusout"&&eu()}function Th(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ds(Yr)}function bh(e,t){if(e==="click")return Ds(t)}function Nh(e,t){if(e==="input"||e==="change")return Ds(t)}function Ah(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var kn=typeof Object.is=="function"?Object.is:Ah;function Xr(e,t){if(kn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(o=0;o<n.length;o++){var r=n[o];if(!Ta.call(t,r)||!kn(e[r],t[r]))return!1}return!0}function tu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function nu(e,t){var n=tu(e);e=0;for(var o;n;){if(n.nodeType===3){if(o=e+n.textContent.length,e<=t&&o>=t)return{node:n,offset:t-e};e=o}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=tu(n)}}function Zd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Zd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function em(){for(var e=window,t=Qi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Qi(e.document)}return t}function _l(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Dh(e){var t=em(),n=e.focusedElem,o=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Zd(n.ownerDocument.documentElement,n)){if(o!==null&&_l(n)){if(t=o.start,e=o.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,i=Math.min(o.start,r);o=o.end===void 0?i:Math.min(o.end,r),!e.extend&&i>o&&(r=o,o=i,i=r),r=nu(n,i);var a=nu(n,o);r&&a&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),i>o?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var jh=On&&"documentMode"in document&&11>=document.documentMode,Ko=null,Va=null,Or=null,Ha=!1;function ou(e,t,n){var o=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ha||Ko==null||Ko!==Qi(o)||(o=Ko,"selectionStart"in o&&_l(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Or&&Xr(Or,o)||(Or=o,o=rs(Va,"onSelect"),0<o.length&&(t=new Ol("onSelect","select",null,t,n),e.push({event:t,listeners:o}),t.target=Ko)))}function Ni(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Wo={animationend:Ni("Animation","AnimationEnd"),animationiteration:Ni("Animation","AnimationIteration"),animationstart:Ni("Animation","AnimationStart"),transitionend:Ni("Transition","TransitionEnd")},sa={},tm={};On&&(tm=document.createElement("div").style,"AnimationEvent"in window||(delete Wo.animationend.animation,delete Wo.animationiteration.animation,delete Wo.animationstart.animation),"TransitionEvent"in window||delete Wo.transitionend.transition);function js(e){if(sa[e])return sa[e];if(!Wo[e])return e;var t=Wo[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in tm)return sa[e]=t[n];return e}var nm=js("animationend"),om=js("animationiteration"),rm=js("animationstart"),im=js("transitionend"),sm=new Map,ru="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function po(e,t){sm.set(e,t),Oo(t,[e])}for(var aa=0;aa<ru.length;aa++){var la=ru[aa],Rh=la.toLowerCase(),Ih=la[0].toUpperCase()+la.slice(1);po(Rh,"on"+Ih)}po(nm,"onAnimationEnd");po(om,"onAnimationIteration");po(rm,"onAnimationStart");po("dblclick","onDoubleClick");po("focusin","onFocus");po("focusout","onBlur");po(im,"onTransitionEnd");ar("onMouseEnter",["mouseout","mouseover"]);ar("onMouseLeave",["mouseout","mouseover"]);ar("onPointerEnter",["pointerout","pointerover"]);ar("onPointerLeave",["pointerout","pointerover"]);Oo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Oo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Oo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Oo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Oo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Oo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ir="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mh=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ir));function iu(e,t,n){var o=e.type||"unknown-event";e.currentTarget=n,Rg(o,t,void 0,e),e.currentTarget=null}function am(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var o=e[n],r=o.event;o=o.listeners;e:{var i=void 0;if(t)for(var a=o.length-1;0<=a;a--){var l=o[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&r.isPropagationStopped())break e;iu(r,l,d),i=c}else for(a=0;a<o.length;a++){if(l=o[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&r.isPropagationStopped())break e;iu(r,l,d),i=c}}}if(Zi)throw e=_a,Zi=!1,_a=null,e}function et(e,t){var n=t[Xa];n===void 0&&(n=t[Xa]=new Set);var o=e+"__bubble";n.has(o)||(lm(t,e,2,!1),n.add(o))}function ca(e,t,n){var o=0;t&&(o|=4),lm(n,e,o,t)}var Ai="_reactListening"+Math.random().toString(36).slice(2);function Qr(e){if(!e[Ai]){e[Ai]=!0,hd.forEach(function(n){n!=="selectionchange"&&(Mh.has(n)||ca(n,!1,e),ca(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ai]||(t[Ai]=!0,ca("selectionchange",!1,t))}}function lm(e,t,n,o){switch(Hd(t)){case 1:var r=Wg;break;case 4:r=qg;break;default:r=Ll}n=r.bind(null,t,n,e),r=void 0,!za||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),o?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function ua(e,t,n,o,r){var i=o;if(!(t&1)&&!(t&2)&&o!==null)e:for(;;){if(o===null)return;var a=o.tag;if(a===3||a===4){var l=o.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(a===4)for(a=o.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;l!==null;){if(a=To(l),a===null)return;if(c=a.tag,c===5||c===6){o=i=a;continue e}l=l.parentNode}}o=o.return}Rd(function(){var d=i,h=Rl(n),p=[];e:{var y=sm.get(e);if(y!==void 0){var x=Ol,S=e;switch(e){case"keypress":if(Ui(n)===0)break e;case"keydown":case"keyup":x=ch;break;case"focusin":S="focus",x=oa;break;case"focusout":S="blur",x=oa;break;case"beforeblur":case"afterblur":x=oa;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Wc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Qg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=mh;break;case nm:case om:case rm:x=eh;break;case im:x=gh;break;case"scroll":x=Yg;break;case"wheel":x=ph;break;case"copy":case"cut":case"paste":x=nh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=Yc}var w=(t&4)!==0,C=!w&&e==="scroll",f=w?y!==null?y+"Capture":null:y;w=[];for(var g=d,m;g!==null;){m=g;var v=m.stateNode;if(m.tag===5&&v!==null&&(m=v,f!==null&&(v=Hr(g,f),v!=null&&w.push(Jr(g,v,m)))),C)break;g=g.return}0<w.length&&(y=new x(y,S,null,n,h),p.push({event:y,listeners:w}))}}if(!(t&7)){e:{if(y=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",y&&n!==Oa&&(S=n.relatedTarget||n.fromElement)&&(To(S)||S[Fn]))break e;if((x||y)&&(y=h.window===h?h:(y=h.ownerDocument)?y.defaultView||y.parentWindow:window,x?(S=n.relatedTarget||n.toElement,x=d,S=S?To(S):null,S!==null&&(C=Fo(S),S!==C||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=d),x!==S)){if(w=Wc,v="onMouseLeave",f="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(w=Yc,v="onPointerLeave",f="onPointerEnter",g="pointer"),C=x==null?y:qo(x),m=S==null?y:qo(S),y=new w(v,g+"leave",x,n,h),y.target=C,y.relatedTarget=m,v=null,To(h)===d&&(w=new w(f,g+"enter",S,n,h),w.target=m,w.relatedTarget=C,v=w),C=v,x&&S)t:{for(w=x,f=S,g=0,m=w;m;m=Bo(m))g++;for(m=0,v=f;v;v=Bo(v))m++;for(;0<g-m;)w=Bo(w),g--;for(;0<m-g;)f=Bo(f),m--;for(;g--;){if(w===f||f!==null&&w===f.alternate)break t;w=Bo(w),f=Bo(f)}w=null}else w=null;x!==null&&su(p,y,x,w,!1),S!==null&&C!==null&&su(p,C,S,w,!0)}}e:{if(y=d?qo(d):window,x=y.nodeName&&y.nodeName.toLowerCase(),x==="select"||x==="input"&&y.type==="file")var N=Ch;else if(Jc(y))if(Qd)N=Nh;else{N=Th;var A=kh}else(x=y.nodeName)&&x.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(N=bh);if(N&&(N=N(e,d))){Xd(p,N,n,h);break e}A&&A(e,y,d),e==="focusout"&&(A=y._wrapperState)&&A.controlled&&y.type==="number"&&Ia(y,"number",y.value)}switch(A=d?qo(d):window,e){case"focusin":(Jc(A)||A.contentEditable==="true")&&(Ko=A,Va=d,Or=null);break;case"focusout":Or=Va=Ko=null;break;case"mousedown":Ha=!0;break;case"contextmenu":case"mouseup":case"dragend":Ha=!1,ou(p,n,h);break;case"selectionchange":if(jh)break;case"keydown":case"keyup":ou(p,n,h)}var b;if(zl)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Ho?qd(e,n)&&(I="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(Wd&&n.locale!=="ko"&&(Ho||I!=="onCompositionStart"?I==="onCompositionEnd"&&Ho&&(b=Kd()):(Jn=h,$l="value"in Jn?Jn.value:Jn.textContent,Ho=!0)),A=rs(d,I),0<A.length&&(I=new qc(I,e,null,n,h),p.push({event:I,listeners:A}),b?I.data=b:(b=Yd(n),b!==null&&(I.data=b)))),(b=vh?xh(e,n):wh(e,n))&&(d=rs(d,"onBeforeInput"),0<d.length&&(h=new qc("onBeforeInput","beforeinput",null,n,h),p.push({event:h,listeners:d}),h.data=b))}am(p,t)})}function Jr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function rs(e,t){for(var n=t+"Capture",o=[];e!==null;){var r=e,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Hr(e,n),i!=null&&o.unshift(Jr(e,i,r)),i=Hr(e,t),i!=null&&o.push(Jr(e,i,r))),e=e.return}return o}function Bo(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function su(e,t,n,o,r){for(var i=t._reactName,a=[];n!==null&&n!==o;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===o)break;l.tag===5&&d!==null&&(l=d,r?(c=Hr(n,i),c!=null&&a.unshift(Jr(n,c,l))):r||(c=Hr(n,i),c!=null&&a.push(Jr(n,c,l)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var Ph=/\r\n?/g,Lh=/\u0000|\uFFFD/g;function au(e){return(typeof e=="string"?e:""+e).replace(Ph,`
`).replace(Lh,"")}function Di(e,t,n){if(t=au(t),au(e)!==t&&n)throw Error(K(425))}function is(){}var Ka=null,Wa=null;function qa(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ya=typeof setTimeout=="function"?setTimeout:void 0,$h=typeof clearTimeout=="function"?clearTimeout:void 0,lu=typeof Promise=="function"?Promise:void 0,Oh=typeof queueMicrotask=="function"?queueMicrotask:typeof lu<"u"?function(e){return lu.resolve(null).then(e).catch(Fh)}:Ya;function Fh(e){setTimeout(function(){throw e})}function da(e,t){var n=t,o=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(o===0){e.removeChild(r),qr(t);return}o--}else n!=="$"&&n!=="$?"&&n!=="$!"||o++;n=r}while(n);qr(t)}function ro(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function cu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var vr=Math.random().toString(36).slice(2),An="__reactFiber$"+vr,Zr="__reactProps$"+vr,Fn="__reactContainer$"+vr,Xa="__reactEvents$"+vr,zh="__reactListeners$"+vr,_h="__reactHandles$"+vr;function To(e){var t=e[An];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Fn]||n[An]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=cu(e);e!==null;){if(n=e[An])return n;e=cu(e)}return t}e=n,n=e.parentNode}return null}function gi(e){return e=e[An]||e[Fn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function qo(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(K(33))}function Rs(e){return e[Zr]||null}var Qa=[],Yo=-1;function yo(e){return{current:e}}function tt(e){0>Yo||(e.current=Qa[Yo],Qa[Yo]=null,Yo--)}function Je(e,t){Yo++,Qa[Yo]=e.current,e.current=t}var go={},$t=yo(go),Yt=yo(!1),Io=go;function lr(e,t){var n=e.type.contextTypes;if(!n)return go;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===t)return o.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=t[i];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Xt(e){return e=e.childContextTypes,e!=null}function ss(){tt(Yt),tt($t)}function uu(e,t,n){if($t.current!==go)throw Error(K(168));Je($t,t),Je(Yt,n)}function cm(e,t,n){var o=e.stateNode;if(t=t.childContextTypes,typeof o.getChildContext!="function")return n;o=o.getChildContext();for(var r in o)if(!(r in t))throw Error(K(108,kg(e)||"Unknown",r));return it({},n,o)}function as(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||go,Io=$t.current,Je($t,e),Je(Yt,Yt.current),!0}function du(e,t,n){var o=e.stateNode;if(!o)throw Error(K(169));n?(e=cm(e,t,Io),o.__reactInternalMemoizedMergedChildContext=e,tt(Yt),tt($t),Je($t,e)):tt(Yt),Je(Yt,n)}var Mn=null,Is=!1,ma=!1;function um(e){Mn===null?Mn=[e]:Mn.push(e)}function Uh(e){Is=!0,um(e)}function vo(){if(!ma&&Mn!==null){ma=!0;var e=0,t=Ve;try{var n=Mn;for(Ve=1;e<n.length;e++){var o=n[e];do o=o(!0);while(o!==null)}Mn=null,Is=!1}catch(r){throw Mn!==null&&(Mn=Mn.slice(e+1)),Ld(Il,vo),r}finally{Ve=t,ma=!1}}return null}var Xo=[],Qo=0,ls=null,cs=0,cn=[],un=0,Mo=null,Pn=1,Ln="";function Eo(e,t){Xo[Qo++]=cs,Xo[Qo++]=ls,ls=e,cs=t}function dm(e,t,n){cn[un++]=Pn,cn[un++]=Ln,cn[un++]=Mo,Mo=e;var o=Pn;e=Ln;var r=32-En(o)-1;o&=~(1<<r),n+=1;var i=32-En(t)+r;if(30<i){var a=r-r%5;i=(o&(1<<a)-1).toString(32),o>>=a,r-=a,Pn=1<<32-En(t)+r|n<<r|o,Ln=i+e}else Pn=1<<i|n<<r|o,Ln=e}function Ul(e){e.return!==null&&(Eo(e,1),dm(e,1,0))}function Bl(e){for(;e===ls;)ls=Xo[--Qo],Xo[Qo]=null,cs=Xo[--Qo],Xo[Qo]=null;for(;e===Mo;)Mo=cn[--un],cn[un]=null,Ln=cn[--un],cn[un]=null,Pn=cn[--un],cn[un]=null}var nn=null,en=null,nt=!1,Sn=null;function mm(e,t){var n=dn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function mu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,nn=e,en=ro(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,nn=e,en=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Mo!==null?{id:Pn,overflow:Ln}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=dn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,nn=e,en=null,!0):!1;default:return!1}}function Ja(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Za(e){if(nt){var t=en;if(t){var n=t;if(!mu(e,t)){if(Ja(e))throw Error(K(418));t=ro(n.nextSibling);var o=nn;t&&mu(e,t)?mm(o,n):(e.flags=e.flags&-4097|2,nt=!1,nn=e)}}else{if(Ja(e))throw Error(K(418));e.flags=e.flags&-4097|2,nt=!1,nn=e}}}function fu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;nn=e}function ji(e){if(e!==nn)return!1;if(!nt)return fu(e),nt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!qa(e.type,e.memoizedProps)),t&&(t=en)){if(Ja(e))throw fm(),Error(K(418));for(;t;)mm(e,t),t=ro(t.nextSibling)}if(fu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(K(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){en=ro(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}en=null}}else en=nn?ro(e.stateNode.nextSibling):null;return!0}function fm(){for(var e=en;e;)e=ro(e.nextSibling)}function cr(){en=nn=null,nt=!1}function Gl(e){Sn===null?Sn=[e]:Sn.push(e)}var Bh=Un.ReactCurrentBatchConfig;function br(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(K(309));var o=n.stateNode}if(!o)throw Error(K(147,e));var r=o,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var l=r.refs;a===null?delete l[i]:l[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(K(284));if(!n._owner)throw Error(K(290,e))}return e}function Ri(e,t){throw e=Object.prototype.toString.call(t),Error(K(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function gu(e){var t=e._init;return t(e._payload)}function gm(e){function t(f,g){if(e){var m=f.deletions;m===null?(f.deletions=[g],f.flags|=16):m.push(g)}}function n(f,g){if(!e)return null;for(;g!==null;)t(f,g),g=g.sibling;return null}function o(f,g){for(f=new Map;g!==null;)g.key!==null?f.set(g.key,g):f.set(g.index,g),g=g.sibling;return f}function r(f,g){return f=lo(f,g),f.index=0,f.sibling=null,f}function i(f,g,m){return f.index=m,e?(m=f.alternate,m!==null?(m=m.index,m<g?(f.flags|=2,g):m):(f.flags|=2,g)):(f.flags|=1048576,g)}function a(f){return e&&f.alternate===null&&(f.flags|=2),f}function l(f,g,m,v){return g===null||g.tag!==6?(g=xa(m,f.mode,v),g.return=f,g):(g=r(g,m),g.return=f,g)}function c(f,g,m,v){var N=m.type;return N===Vo?h(f,g,m.props.children,v,m.key):g!==null&&(g.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Hn&&gu(N)===g.type)?(v=r(g,m.props),v.ref=br(f,g,m),v.return=f,v):(v=qi(m.type,m.key,m.props,null,f.mode,v),v.ref=br(f,g,m),v.return=f,v)}function d(f,g,m,v){return g===null||g.tag!==4||g.stateNode.containerInfo!==m.containerInfo||g.stateNode.implementation!==m.implementation?(g=wa(m,f.mode,v),g.return=f,g):(g=r(g,m.children||[]),g.return=f,g)}function h(f,g,m,v,N){return g===null||g.tag!==7?(g=Do(m,f.mode,v,N),g.return=f,g):(g=r(g,m),g.return=f,g)}function p(f,g,m){if(typeof g=="string"&&g!==""||typeof g=="number")return g=xa(""+g,f.mode,m),g.return=f,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case wi:return m=qi(g.type,g.key,g.props,null,f.mode,m),m.ref=br(f,null,g),m.return=f,m;case Go:return g=wa(g,f.mode,m),g.return=f,g;case Hn:var v=g._init;return p(f,v(g._payload),m)}if(jr(g)||Sr(g))return g=Do(g,f.mode,m,null),g.return=f,g;Ri(f,g)}return null}function y(f,g,m,v){var N=g!==null?g.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return N!==null?null:l(f,g,""+m,v);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case wi:return m.key===N?c(f,g,m,v):null;case Go:return m.key===N?d(f,g,m,v):null;case Hn:return N=m._init,y(f,g,N(m._payload),v)}if(jr(m)||Sr(m))return N!==null?null:h(f,g,m,v,null);Ri(f,m)}return null}function x(f,g,m,v,N){if(typeof v=="string"&&v!==""||typeof v=="number")return f=f.get(m)||null,l(g,f,""+v,N);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case wi:return f=f.get(v.key===null?m:v.key)||null,c(g,f,v,N);case Go:return f=f.get(v.key===null?m:v.key)||null,d(g,f,v,N);case Hn:var A=v._init;return x(f,g,m,A(v._payload),N)}if(jr(v)||Sr(v))return f=f.get(m)||null,h(g,f,v,N,null);Ri(g,v)}return null}function S(f,g,m,v){for(var N=null,A=null,b=g,I=g=0,j=null;b!==null&&I<m.length;I++){b.index>I?(j=b,b=null):j=b.sibling;var R=y(f,b,m[I],v);if(R===null){b===null&&(b=j);break}e&&b&&R.alternate===null&&t(f,b),g=i(R,g,I),A===null?N=R:A.sibling=R,A=R,b=j}if(I===m.length)return n(f,b),nt&&Eo(f,I),N;if(b===null){for(;I<m.length;I++)b=p(f,m[I],v),b!==null&&(g=i(b,g,I),A===null?N=b:A.sibling=b,A=b);return nt&&Eo(f,I),N}for(b=o(f,b);I<m.length;I++)j=x(b,f,I,m[I],v),j!==null&&(e&&j.alternate!==null&&b.delete(j.key===null?I:j.key),g=i(j,g,I),A===null?N=j:A.sibling=j,A=j);return e&&b.forEach(function(F){return t(f,F)}),nt&&Eo(f,I),N}function w(f,g,m,v){var N=Sr(m);if(typeof N!="function")throw Error(K(150));if(m=N.call(m),m==null)throw Error(K(151));for(var A=N=null,b=g,I=g=0,j=null,R=m.next();b!==null&&!R.done;I++,R=m.next()){b.index>I?(j=b,b=null):j=b.sibling;var F=y(f,b,R.value,v);if(F===null){b===null&&(b=j);break}e&&b&&F.alternate===null&&t(f,b),g=i(F,g,I),A===null?N=F:A.sibling=F,A=F,b=j}if(R.done)return n(f,b),nt&&Eo(f,I),N;if(b===null){for(;!R.done;I++,R=m.next())R=p(f,R.value,v),R!==null&&(g=i(R,g,I),A===null?N=R:A.sibling=R,A=R);return nt&&Eo(f,I),N}for(b=o(f,b);!R.done;I++,R=m.next())R=x(b,f,I,R.value,v),R!==null&&(e&&R.alternate!==null&&b.delete(R.key===null?I:R.key),g=i(R,g,I),A===null?N=R:A.sibling=R,A=R);return e&&b.forEach(function(te){return t(f,te)}),nt&&Eo(f,I),N}function C(f,g,m,v){if(typeof m=="object"&&m!==null&&m.type===Vo&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case wi:e:{for(var N=m.key,A=g;A!==null;){if(A.key===N){if(N=m.type,N===Vo){if(A.tag===7){n(f,A.sibling),g=r(A,m.props.children),g.return=f,f=g;break e}}else if(A.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Hn&&gu(N)===A.type){n(f,A.sibling),g=r(A,m.props),g.ref=br(f,A,m),g.return=f,f=g;break e}n(f,A);break}else t(f,A);A=A.sibling}m.type===Vo?(g=Do(m.props.children,f.mode,v,m.key),g.return=f,f=g):(v=qi(m.type,m.key,m.props,null,f.mode,v),v.ref=br(f,g,m),v.return=f,f=v)}return a(f);case Go:e:{for(A=m.key;g!==null;){if(g.key===A)if(g.tag===4&&g.stateNode.containerInfo===m.containerInfo&&g.stateNode.implementation===m.implementation){n(f,g.sibling),g=r(g,m.children||[]),g.return=f,f=g;break e}else{n(f,g);break}else t(f,g);g=g.sibling}g=wa(m,f.mode,v),g.return=f,f=g}return a(f);case Hn:return A=m._init,C(f,g,A(m._payload),v)}if(jr(m))return S(f,g,m,v);if(Sr(m))return w(f,g,m,v);Ri(f,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,g!==null&&g.tag===6?(n(f,g.sibling),g=r(g,m),g.return=f,f=g):(n(f,g),g=xa(m,f.mode,v),g.return=f,f=g),a(f)):n(f,g)}return C}var ur=gm(!0),hm=gm(!1),us=yo(null),ds=null,Jo=null,Vl=null;function Hl(){Vl=Jo=ds=null}function Kl(e){var t=us.current;tt(us),e._currentValue=t}function el(e,t,n){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===n)break;e=e.return}}function ir(e,t){ds=e,Vl=Jo=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qt=!0),e.firstContext=null)}function fn(e){var t=e._currentValue;if(Vl!==e)if(e={context:e,memoizedValue:t,next:null},Jo===null){if(ds===null)throw Error(K(308));Jo=e,ds.dependencies={lanes:0,firstContext:e}}else Jo=Jo.next=e;return t}var bo=null;function Wl(e){bo===null?bo=[e]:bo.push(e)}function pm(e,t,n,o){var r=t.interleaved;return r===null?(n.next=n,Wl(t)):(n.next=r.next,r.next=n),t.interleaved=n,zn(e,o)}function zn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Kn=!1;function ql(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ym(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function $n(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function io(e,t,n){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,Ue&2){var r=o.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),o.pending=t,zn(e,n)}return r=o.interleaved,r===null?(t.next=t,Wl(o)):(t.next=r.next,r.next=t),o.interleaved=t,zn(e,n)}function Bi(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var o=t.lanes;o&=e.pendingLanes,n|=o,t.lanes=n,Ml(e,n)}}function hu(e,t){var n=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,n===o)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?r=i=t:i=i.next=t}else r=i=t;n={baseState:o.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:o.shared,effects:o.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ms(e,t,n,o){var r=e.updateQueue;Kn=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=e.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var p=r.baseState;a=0,h=d=c=null,l=i;do{var y=l.lane,x=l.eventTime;if((o&y)===y){h!==null&&(h=h.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=e,w=l;switch(y=t,x=n,w.tag){case 1:if(S=w.payload,typeof S=="function"){p=S.call(x,p,y);break e}p=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=w.payload,y=typeof S=="function"?S.call(x,p,y):S,y==null)break e;p=it({},p,y);break e;case 2:Kn=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,y=r.effects,y===null?r.effects=[l]:y.push(l))}else x={eventTime:x,lane:y,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=x,c=p):h=h.next=x,a|=y;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;y=l,l=y.next,y.next=null,r.lastBaseUpdate=y,r.shared.pending=null}}while(1);if(h===null&&(c=p),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=h,t=r.shared.interleaved,t!==null){r=t;do a|=r.lane,r=r.next;while(r!==t)}else i===null&&(r.shared.lanes=0);Lo|=a,e.lanes=a,e.memoizedState=p}}function pu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var o=e[t],r=o.callback;if(r!==null){if(o.callback=null,o=n,typeof r!="function")throw Error(K(191,r));r.call(o)}}}var hi={},jn=yo(hi),ei=yo(hi),ti=yo(hi);function No(e){if(e===hi)throw Error(K(174));return e}function Yl(e,t){switch(Je(ti,t),Je(ei,e),Je(jn,hi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Pa(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Pa(t,e)}tt(jn),Je(jn,t)}function dr(){tt(jn),tt(ei),tt(ti)}function vm(e){No(ti.current);var t=No(jn.current),n=Pa(t,e.type);t!==n&&(Je(ei,e),Je(jn,n))}function Xl(e){ei.current===e&&(tt(jn),tt(ei))}var ot=yo(0);function fs(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fa=[];function Ql(){for(var e=0;e<fa.length;e++)fa[e]._workInProgressVersionPrimary=null;fa.length=0}var Gi=Un.ReactCurrentDispatcher,ga=Un.ReactCurrentBatchConfig,Po=0,rt=null,xt=null,St=null,gs=!1,Fr=!1,ni=0,Gh=0;function Mt(){throw Error(K(321))}function Jl(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!kn(e[n],t[n]))return!1;return!0}function Zl(e,t,n,o,r,i){if(Po=i,rt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Gi.current=e===null||e.memoizedState===null?Wh:qh,e=n(o,r),Fr){i=0;do{if(Fr=!1,ni=0,25<=i)throw Error(K(301));i+=1,St=xt=null,t.updateQueue=null,Gi.current=Yh,e=n(o,r)}while(Fr)}if(Gi.current=hs,t=xt!==null&&xt.next!==null,Po=0,St=xt=rt=null,gs=!1,t)throw Error(K(300));return e}function ec(){var e=ni!==0;return ni=0,e}function Nn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?rt.memoizedState=St=e:St=St.next=e,St}function gn(){if(xt===null){var e=rt.alternate;e=e!==null?e.memoizedState:null}else e=xt.next;var t=St===null?rt.memoizedState:St.next;if(t!==null)St=t,xt=e;else{if(e===null)throw Error(K(310));xt=e,e={memoizedState:xt.memoizedState,baseState:xt.baseState,baseQueue:xt.baseQueue,queue:xt.queue,next:null},St===null?rt.memoizedState=St=e:St=St.next=e}return St}function oi(e,t){return typeof t=="function"?t(e):t}function ha(e){var t=gn(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var o=xt,r=o.baseQueue,i=n.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}o.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,o=o.baseState;var l=a=null,c=null,d=i;do{var h=d.lane;if((Po&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),o=d.hasEagerState?d.eagerState:e(o,d.action);else{var p={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,a=o):c=c.next=p,rt.lanes|=h,Lo|=h}d=d.next}while(d!==null&&d!==i);c===null?a=o:c.next=l,kn(o,t.memoizedState)||(qt=!0),t.memoizedState=o,t.baseState=a,t.baseQueue=c,n.lastRenderedState=o}if(e=n.interleaved,e!==null){r=e;do i=r.lane,rt.lanes|=i,Lo|=i,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function pa(e){var t=gn(),n=t.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=e;var o=n.dispatch,r=n.pending,i=t.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do i=e(i,a.action),a=a.next;while(a!==r);kn(i,t.memoizedState)||(qt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,o]}function xm(){}function wm(e,t){var n=rt,o=gn(),r=t(),i=!kn(o.memoizedState,r);if(i&&(o.memoizedState=r,qt=!0),o=o.queue,tc(Cm.bind(null,n,o,e),[e]),o.getSnapshot!==t||i||St!==null&&St.memoizedState.tag&1){if(n.flags|=2048,ri(9,Em.bind(null,n,o,r,t),void 0,null),Et===null)throw Error(K(349));Po&30||Sm(n,t,r)}return r}function Sm(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Em(e,t,n,o){t.value=n,t.getSnapshot=o,km(t)&&Tm(e)}function Cm(e,t,n){return n(function(){km(t)&&Tm(e)})}function km(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!kn(e,n)}catch{return!0}}function Tm(e){var t=zn(e,1);t!==null&&Cn(t,e,1,-1)}function yu(e){var t=Nn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:e},t.queue=e,e=e.dispatch=Kh.bind(null,rt,e),[t.memoizedState,e]}function ri(e,t,n,o){return e={tag:e,create:t,destroy:n,deps:o,next:null},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(o=n.next,n.next=e,e.next=o,t.lastEffect=e)),e}function bm(){return gn().memoizedState}function Vi(e,t,n,o){var r=Nn();rt.flags|=e,r.memoizedState=ri(1|t,n,void 0,o===void 0?null:o)}function Ms(e,t,n,o){var r=gn();o=o===void 0?null:o;var i=void 0;if(xt!==null){var a=xt.memoizedState;if(i=a.destroy,o!==null&&Jl(o,a.deps)){r.memoizedState=ri(t,n,i,o);return}}rt.flags|=e,r.memoizedState=ri(1|t,n,i,o)}function vu(e,t){return Vi(8390656,8,e,t)}function tc(e,t){return Ms(2048,8,e,t)}function Nm(e,t){return Ms(4,2,e,t)}function Am(e,t){return Ms(4,4,e,t)}function Dm(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function jm(e,t,n){return n=n!=null?n.concat([e]):null,Ms(4,4,Dm.bind(null,t,e),n)}function nc(){}function Rm(e,t){var n=gn();t=t===void 0?null:t;var o=n.memoizedState;return o!==null&&t!==null&&Jl(t,o[1])?o[0]:(n.memoizedState=[e,t],e)}function Im(e,t){var n=gn();t=t===void 0?null:t;var o=n.memoizedState;return o!==null&&t!==null&&Jl(t,o[1])?o[0]:(e=e(),n.memoizedState=[e,t],e)}function Mm(e,t,n){return Po&21?(kn(n,t)||(n=Fd(),rt.lanes|=n,Lo|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qt=!0),e.memoizedState=n)}function Vh(e,t){var n=Ve;Ve=n!==0&&4>n?n:4,e(!0);var o=ga.transition;ga.transition={};try{e(!1),t()}finally{Ve=n,ga.transition=o}}function Pm(){return gn().memoizedState}function Hh(e,t,n){var o=ao(e);if(n={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null},Lm(e))$m(t,n);else if(n=pm(e,t,n,o),n!==null){var r=_t();Cn(n,e,o,r),Om(n,t,o)}}function Kh(e,t,n){var o=ao(e),r={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null};if(Lm(e))$m(t,r);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,l=i(a,n);if(r.hasEagerState=!0,r.eagerState=l,kn(l,a)){var c=t.interleaved;c===null?(r.next=r,Wl(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=pm(e,t,r,o),n!==null&&(r=_t(),Cn(n,e,o,r),Om(n,t,o))}}function Lm(e){var t=e.alternate;return e===rt||t!==null&&t===rt}function $m(e,t){Fr=gs=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Om(e,t,n){if(n&4194240){var o=t.lanes;o&=e.pendingLanes,n|=o,t.lanes=n,Ml(e,n)}}var hs={readContext:fn,useCallback:Mt,useContext:Mt,useEffect:Mt,useImperativeHandle:Mt,useInsertionEffect:Mt,useLayoutEffect:Mt,useMemo:Mt,useReducer:Mt,useRef:Mt,useState:Mt,useDebugValue:Mt,useDeferredValue:Mt,useTransition:Mt,useMutableSource:Mt,useSyncExternalStore:Mt,useId:Mt,unstable_isNewReconciler:!1},Wh={readContext:fn,useCallback:function(e,t){return Nn().memoizedState=[e,t===void 0?null:t],e},useContext:fn,useEffect:vu,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Vi(4194308,4,Dm.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Vi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vi(4,2,e,t)},useMemo:function(e,t){var n=Nn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var o=Nn();return t=n!==void 0?n(t):t,o.memoizedState=o.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},o.queue=e,e=e.dispatch=Hh.bind(null,rt,e),[o.memoizedState,e]},useRef:function(e){var t=Nn();return e={current:e},t.memoizedState=e},useState:yu,useDebugValue:nc,useDeferredValue:function(e){return Nn().memoizedState=e},useTransition:function(){var e=yu(!1),t=e[0];return e=Vh.bind(null,e[1]),Nn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var o=rt,r=Nn();if(nt){if(n===void 0)throw Error(K(407));n=n()}else{if(n=t(),Et===null)throw Error(K(349));Po&30||Sm(o,t,n)}r.memoizedState=n;var i={value:n,getSnapshot:t};return r.queue=i,vu(Cm.bind(null,o,i,e),[e]),o.flags|=2048,ri(9,Em.bind(null,o,i,n,t),void 0,null),n},useId:function(){var e=Nn(),t=Et.identifierPrefix;if(nt){var n=Ln,o=Pn;n=(o&~(1<<32-En(o)-1)).toString(32)+n,t=":"+t+"R"+n,n=ni++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Gh++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},qh={readContext:fn,useCallback:Rm,useContext:fn,useEffect:tc,useImperativeHandle:jm,useInsertionEffect:Nm,useLayoutEffect:Am,useMemo:Im,useReducer:ha,useRef:bm,useState:function(){return ha(oi)},useDebugValue:nc,useDeferredValue:function(e){var t=gn();return Mm(t,xt.memoizedState,e)},useTransition:function(){var e=ha(oi)[0],t=gn().memoizedState;return[e,t]},useMutableSource:xm,useSyncExternalStore:wm,useId:Pm,unstable_isNewReconciler:!1},Yh={readContext:fn,useCallback:Rm,useContext:fn,useEffect:tc,useImperativeHandle:jm,useInsertionEffect:Nm,useLayoutEffect:Am,useMemo:Im,useReducer:pa,useRef:bm,useState:function(){return pa(oi)},useDebugValue:nc,useDeferredValue:function(e){var t=gn();return xt===null?t.memoizedState=e:Mm(t,xt.memoizedState,e)},useTransition:function(){var e=pa(oi)[0],t=gn().memoizedState;return[e,t]},useMutableSource:xm,useSyncExternalStore:wm,useId:Pm,unstable_isNewReconciler:!1};function xn(e,t){if(e&&e.defaultProps){t=it({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function tl(e,t,n,o){t=e.memoizedState,n=n(o,t),n=n==null?t:it({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Ps={isMounted:function(e){return(e=e._reactInternals)?Fo(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var o=_t(),r=ao(e),i=$n(o,r);i.payload=t,n!=null&&(i.callback=n),t=io(e,i,r),t!==null&&(Cn(t,e,r,o),Bi(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var o=_t(),r=ao(e),i=$n(o,r);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=io(e,i,r),t!==null&&(Cn(t,e,r,o),Bi(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=_t(),o=ao(e),r=$n(n,o);r.tag=2,t!=null&&(r.callback=t),t=io(e,r,o),t!==null&&(Cn(t,e,o,n),Bi(t,e,o))}};function xu(e,t,n,o,r,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,i,a):t.prototype&&t.prototype.isPureReactComponent?!Xr(n,o)||!Xr(r,i):!0}function Fm(e,t,n){var o=!1,r=go,i=t.contextType;return typeof i=="object"&&i!==null?i=fn(i):(r=Xt(t)?Io:$t.current,o=t.contextTypes,i=(o=o!=null)?lr(e,r):go),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ps,e.stateNode=t,t._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=i),t}function wu(e,t,n,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,o),t.state!==e&&Ps.enqueueReplaceState(t,t.state,null)}function nl(e,t,n,o){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},ql(e);var i=t.contextType;typeof i=="object"&&i!==null?r.context=fn(i):(i=Xt(t)?Io:$t.current,r.context=lr(e,i)),r.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(tl(e,t,i,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Ps.enqueueReplaceState(r,r.state,null),ms(e,n,r,o),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function mr(e,t){try{var n="",o=t;do n+=Cg(o),o=o.return;while(o);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:r,digest:null}}function ya(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function ol(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Xh=typeof WeakMap=="function"?WeakMap:Map;function zm(e,t,n){n=$n(-1,n),n.tag=3,n.payload={element:null};var o=t.value;return n.callback=function(){ys||(ys=!0,fl=o),ol(e,t)},n}function _m(e,t,n){n=$n(-1,n),n.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var r=t.value;n.payload=function(){return o(r)},n.callback=function(){ol(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ol(e,t),typeof o!="function"&&(so===null?so=new Set([this]):so.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function Su(e,t,n){var o=e.pingCache;if(o===null){o=e.pingCache=new Xh;var r=new Set;o.set(t,r)}else r=o.get(t),r===void 0&&(r=new Set,o.set(t,r));r.has(n)||(r.add(n),e=up.bind(null,e,t,n),t.then(e,e))}function Eu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Cu(e,t,n,o,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=$n(-1,1),t.tag=2,io(n,t,1))),n.lanes|=1),e)}var Qh=Un.ReactCurrentOwner,qt=!1;function zt(e,t,n,o){t.child=e===null?hm(t,null,n,o):ur(t,e.child,n,o)}function ku(e,t,n,o,r){n=n.render;var i=t.ref;return ir(t,r),o=Zl(e,t,n,o,i,r),n=ec(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,_n(e,t,r)):(nt&&n&&Ul(t),t.flags|=1,zt(e,t,o,r),t.child)}function Tu(e,t,n,o,r){if(e===null){var i=n.type;return typeof i=="function"&&!uc(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Um(e,t,i,o,r)):(e=qi(n.type,null,o,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&r)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Xr,n(a,o)&&e.ref===t.ref)return _n(e,t,r)}return t.flags|=1,e=lo(i,o),e.ref=t.ref,e.return=t,t.child=e}function Um(e,t,n,o,r){if(e!==null){var i=e.memoizedProps;if(Xr(i,o)&&e.ref===t.ref)if(qt=!1,t.pendingProps=o=i,(e.lanes&r)!==0)e.flags&131072&&(qt=!0);else return t.lanes=e.lanes,_n(e,t,r)}return rl(e,t,n,o,r)}function Bm(e,t,n){var o=t.pendingProps,r=o.children,i=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Je(er,Zt),Zt|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Je(er,Zt),Zt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=i!==null?i.baseLanes:n,Je(er,Zt),Zt|=o}else i!==null?(o=i.baseLanes|n,t.memoizedState=null):o=n,Je(er,Zt),Zt|=o;return zt(e,t,r,n),t.child}function Gm(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function rl(e,t,n,o,r){var i=Xt(n)?Io:$t.current;return i=lr(t,i),ir(t,r),n=Zl(e,t,n,o,i,r),o=ec(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,_n(e,t,r)):(nt&&o&&Ul(t),t.flags|=1,zt(e,t,n,r),t.child)}function bu(e,t,n,o,r){if(Xt(n)){var i=!0;as(t)}else i=!1;if(ir(t,r),t.stateNode===null)Hi(e,t),Fm(t,n,o),nl(t,n,o,r),o=!0;else if(e===null){var a=t.stateNode,l=t.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=fn(d):(d=Xt(n)?Io:$t.current,d=lr(t,d));var h=n.getDerivedStateFromProps,p=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";p||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==o||c!==d)&&wu(t,a,o,d),Kn=!1;var y=t.memoizedState;a.state=y,ms(t,o,a,r),c=t.memoizedState,l!==o||y!==c||Yt.current||Kn?(typeof h=="function"&&(tl(t,n,h,o),c=t.memoizedState),(l=Kn||xu(t,n,l,o,y,c,d))?(p||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=c),a.props=o,a.state=c,a.context=d,o=l):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{a=t.stateNode,ym(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:xn(t.type,l),a.props=d,p=t.pendingProps,y=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=fn(c):(c=Xt(n)?Io:$t.current,c=lr(t,c));var x=n.getDerivedStateFromProps;(h=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==p||y!==c)&&wu(t,a,o,c),Kn=!1,y=t.memoizedState,a.state=y,ms(t,o,a,r);var S=t.memoizedState;l!==p||y!==S||Yt.current||Kn?(typeof x=="function"&&(tl(t,n,x,o),S=t.memoizedState),(d=Kn||xu(t,n,d,o,y,S,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(o,S,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(o,S,c)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=S),a.props=o,a.state=S,a.context=c,o=d):(typeof a.componentDidUpdate!="function"||l===e.memoizedProps&&y===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&y===e.memoizedState||(t.flags|=1024),o=!1)}return il(e,t,n,o,i,r)}function il(e,t,n,o,r,i){Gm(e,t);var a=(t.flags&128)!==0;if(!o&&!a)return r&&du(t,n,!1),_n(e,t,i);o=t.stateNode,Qh.current=t;var l=a&&typeof n.getDerivedStateFromError!="function"?null:o.render();return t.flags|=1,e!==null&&a?(t.child=ur(t,e.child,null,i),t.child=ur(t,null,l,i)):zt(e,t,l,i),t.memoizedState=o.state,r&&du(t,n,!0),t.child}function Vm(e){var t=e.stateNode;t.pendingContext?uu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&uu(e,t.context,!1),Yl(e,t.containerInfo)}function Nu(e,t,n,o,r){return cr(),Gl(r),t.flags|=256,zt(e,t,n,o),t.child}var sl={dehydrated:null,treeContext:null,retryLane:0};function al(e){return{baseLanes:e,cachePool:null,transitions:null}}function Hm(e,t,n){var o=t.pendingProps,r=ot.current,i=!1,a=(t.flags&128)!==0,l;if((l=a)||(l=e!==null&&e.memoizedState===null?!1:(r&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),Je(ot,r&1),e===null)return Za(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=o.children,e=o.fallback,i?(o=t.mode,i=t.child,a={mode:"hidden",children:a},!(o&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Os(a,o,0,null),e=Do(e,o,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=al(n),t.memoizedState=sl,e):oc(t,a));if(r=e.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return Jh(e,t,a,o,l,r,n);if(i){i=o.fallback,a=t.mode,r=e.child,l=r.sibling;var c={mode:"hidden",children:o.children};return!(a&1)&&t.child!==r?(o=t.child,o.childLanes=0,o.pendingProps=c,t.deletions=null):(o=lo(r,c),o.subtreeFlags=r.subtreeFlags&14680064),l!==null?i=lo(l,i):(i=Do(i,a,n,null),i.flags|=2),i.return=t,o.return=t,o.sibling=i,t.child=o,o=i,i=t.child,a=e.child.memoizedState,a=a===null?al(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=sl,o}return i=e.child,e=i.sibling,o=lo(i,{mode:"visible",children:o.children}),!(t.mode&1)&&(o.lanes=n),o.return=t,o.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function oc(e,t){return t=Os({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ii(e,t,n,o){return o!==null&&Gl(o),ur(t,e.child,null,n),e=oc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Jh(e,t,n,o,r,i,a){if(n)return t.flags&256?(t.flags&=-257,o=ya(Error(K(422))),Ii(e,t,a,o)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=o.fallback,r=t.mode,o=Os({mode:"visible",children:o.children},r,0,null),i=Do(i,r,a,null),i.flags|=2,o.return=t,i.return=t,o.sibling=i,t.child=o,t.mode&1&&ur(t,e.child,null,a),t.child.memoizedState=al(a),t.memoizedState=sl,i);if(!(t.mode&1))return Ii(e,t,a,null);if(r.data==="$!"){if(o=r.nextSibling&&r.nextSibling.dataset,o)var l=o.dgst;return o=l,i=Error(K(419)),o=ya(i,o,void 0),Ii(e,t,a,o)}if(l=(a&e.childLanes)!==0,qt||l){if(o=Et,o!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(o.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,zn(e,r),Cn(o,e,r,-1))}return cc(),o=ya(Error(K(421))),Ii(e,t,a,o)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=dp.bind(null,e),r._reactRetry=t,null):(e=i.treeContext,en=ro(r.nextSibling),nn=t,nt=!0,Sn=null,e!==null&&(cn[un++]=Pn,cn[un++]=Ln,cn[un++]=Mo,Pn=e.id,Ln=e.overflow,Mo=t),t=oc(t,o.children),t.flags|=4096,t)}function Au(e,t,n){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),el(e.return,t,n)}function va(e,t,n,o,r){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:n,tailMode:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=o,i.tail=n,i.tailMode=r)}function Km(e,t,n){var o=t.pendingProps,r=o.revealOrder,i=o.tail;if(zt(e,t,o.children,n),o=ot.current,o&2)o=o&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Au(e,n,t);else if(e.tag===19)Au(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(Je(ot,o),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&fs(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),va(t,!1,r,n,i);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&fs(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}va(t,!0,n,null,i);break;case"together":va(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Hi(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function _n(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Lo|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(K(153));if(t.child!==null){for(e=t.child,n=lo(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=lo(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Zh(e,t,n){switch(t.tag){case 3:Vm(t),cr();break;case 5:vm(t);break;case 1:Xt(t.type)&&as(t);break;case 4:Yl(t,t.stateNode.containerInfo);break;case 10:var o=t.type._context,r=t.memoizedProps.value;Je(us,o._currentValue),o._currentValue=r;break;case 13:if(o=t.memoizedState,o!==null)return o.dehydrated!==null?(Je(ot,ot.current&1),t.flags|=128,null):n&t.child.childLanes?Hm(e,t,n):(Je(ot,ot.current&1),e=_n(e,t,n),e!==null?e.sibling:null);Je(ot,ot.current&1);break;case 19:if(o=(n&t.childLanes)!==0,e.flags&128){if(o)return Km(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Je(ot,ot.current),o)break;return null;case 22:case 23:return t.lanes=0,Bm(e,t,n)}return _n(e,t,n)}var Wm,ll,qm,Ym;Wm=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ll=function(){};qm=function(e,t,n,o){var r=e.memoizedProps;if(r!==o){e=t.stateNode,No(jn.current);var i=null;switch(n){case"input":r=ja(e,r),o=ja(e,o),i=[];break;case"select":r=it({},r,{value:void 0}),o=it({},o,{value:void 0}),i=[];break;case"textarea":r=Ma(e,r),o=Ma(e,o),i=[];break;default:typeof r.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=is)}La(n,o);var a;n=null;for(d in r)if(!o.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var l=r[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Gr.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in o){var c=o[d];if(l=r!=null?r[d]:void 0,o.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Gr.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&et("scroll",e),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(t.updateQueue=d)&&(t.flags|=4)}};Ym=function(e,t,n,o){n!==o&&(t.flags|=4)};function Nr(e,t){if(!nt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Pt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,o=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,o|=r.subtreeFlags&14680064,o|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,o|=r.subtreeFlags,o|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=o,e.childLanes=n,t}function ep(e,t,n){var o=t.pendingProps;switch(Bl(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(t),null;case 1:return Xt(t.type)&&ss(),Pt(t),null;case 3:return o=t.stateNode,dr(),tt(Yt),tt($t),Ql(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(ji(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Sn!==null&&(pl(Sn),Sn=null))),ll(e,t),Pt(t),null;case 5:Xl(t);var r=No(ti.current);if(n=t.type,e!==null&&t.stateNode!=null)qm(e,t,n,o,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(t.stateNode===null)throw Error(K(166));return Pt(t),null}if(e=No(jn.current),ji(t)){o=t.stateNode,n=t.type;var i=t.memoizedProps;switch(o[An]=t,o[Zr]=i,e=(t.mode&1)!==0,n){case"dialog":et("cancel",o),et("close",o);break;case"iframe":case"object":case"embed":et("load",o);break;case"video":case"audio":for(r=0;r<Ir.length;r++)et(Ir[r],o);break;case"source":et("error",o);break;case"img":case"image":case"link":et("error",o),et("load",o);break;case"details":et("toggle",o);break;case"input":Oc(o,i),et("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!i.multiple},et("invalid",o);break;case"textarea":zc(o,i),et("invalid",o)}La(n,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?o.textContent!==l&&(i.suppressHydrationWarning!==!0&&Di(o.textContent,l,e),r=["children",l]):typeof l=="number"&&o.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Di(o.textContent,l,e),r=["children",""+l]):Gr.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&et("scroll",o)}switch(n){case"input":Si(o),Fc(o,i,!0);break;case"textarea":Si(o),_c(o);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(o.onclick=is)}o=r,t.updateQueue=o,o!==null&&(t.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Cd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=a.createElement(n,{is:o.is}):(e=a.createElement(n),n==="select"&&(a=e,o.multiple?a.multiple=!0:o.size&&(a.size=o.size))):e=a.createElementNS(e,n),e[An]=t,e[Zr]=o,Wm(e,t,!1,!1),t.stateNode=e;e:{switch(a=$a(n,o),n){case"dialog":et("cancel",e),et("close",e),r=o;break;case"iframe":case"object":case"embed":et("load",e),r=o;break;case"video":case"audio":for(r=0;r<Ir.length;r++)et(Ir[r],e);r=o;break;case"source":et("error",e),r=o;break;case"img":case"image":case"link":et("error",e),et("load",e),r=o;break;case"details":et("toggle",e),r=o;break;case"input":Oc(e,o),r=ja(e,o),et("invalid",e);break;case"option":r=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},r=it({},o,{value:void 0}),et("invalid",e);break;case"textarea":zc(e,o),r=Ma(e,o),et("invalid",e);break;default:r=o}La(n,r),l=r;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?bd(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&kd(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Vr(e,c):typeof c=="number"&&Vr(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Gr.hasOwnProperty(i)?c!=null&&i==="onScroll"&&et("scroll",e):c!=null&&Nl(e,i,c,a))}switch(n){case"input":Si(e),Fc(e,o,!1);break;case"textarea":Si(e),_c(e);break;case"option":o.value!=null&&e.setAttribute("value",""+fo(o.value));break;case"select":e.multiple=!!o.multiple,i=o.value,i!=null?tr(e,!!o.multiple,i,!1):o.defaultValue!=null&&tr(e,!!o.multiple,o.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=is)}switch(n){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pt(t),null;case 6:if(e&&t.stateNode!=null)Ym(e,t,e.memoizedProps,o);else{if(typeof o!="string"&&t.stateNode===null)throw Error(K(166));if(n=No(ti.current),No(jn.current),ji(t)){if(o=t.stateNode,n=t.memoizedProps,o[An]=t,(i=o.nodeValue!==n)&&(e=nn,e!==null))switch(e.tag){case 3:Di(o.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Di(o.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else o=(n.nodeType===9?n:n.ownerDocument).createTextNode(o),o[An]=t,t.stateNode=o}return Pt(t),null;case 13:if(tt(ot),o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(nt&&en!==null&&t.mode&1&&!(t.flags&128))fm(),cr(),t.flags|=98560,i=!1;else if(i=ji(t),o!==null&&o.dehydrated!==null){if(e===null){if(!i)throw Error(K(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(K(317));i[An]=t}else cr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pt(t),i=!1}else Sn!==null&&(pl(Sn),Sn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(t.child.flags|=8192,t.mode&1&&(e===null||ot.current&1?wt===0&&(wt=3):cc())),t.updateQueue!==null&&(t.flags|=4),Pt(t),null);case 4:return dr(),ll(e,t),e===null&&Qr(t.stateNode.containerInfo),Pt(t),null;case 10:return Kl(t.type._context),Pt(t),null;case 17:return Xt(t.type)&&ss(),Pt(t),null;case 19:if(tt(ot),i=t.memoizedState,i===null)return Pt(t),null;if(o=(t.flags&128)!==0,a=i.rendering,a===null)if(o)Nr(i,!1);else{if(wt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=fs(e),a!==null){for(t.flags|=128,Nr(i,!1),o=a.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=n,n=t.child;n!==null;)i=n,e=o,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Je(ot,ot.current&1|2),t.child}e=e.sibling}i.tail!==null&&gt()>fr&&(t.flags|=128,o=!0,Nr(i,!1),t.lanes=4194304)}else{if(!o)if(e=fs(a),e!==null){if(t.flags|=128,o=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Nr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!nt)return Pt(t),null}else 2*gt()-i.renderingStartTime>fr&&n!==1073741824&&(t.flags|=128,o=!0,Nr(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=gt(),t.sibling=null,n=ot.current,Je(ot,o?n&1|2:n&1),t):(Pt(t),null);case 22:case 23:return lc(),o=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(t.flags|=8192),o&&t.mode&1?Zt&1073741824&&(Pt(t),t.subtreeFlags&6&&(t.flags|=8192)):Pt(t),null;case 24:return null;case 25:return null}throw Error(K(156,t.tag))}function tp(e,t){switch(Bl(t),t.tag){case 1:return Xt(t.type)&&ss(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return dr(),tt(Yt),tt($t),Ql(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Xl(t),null;case 13:if(tt(ot),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(K(340));cr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return tt(ot),null;case 4:return dr(),null;case 10:return Kl(t.type._context),null;case 22:case 23:return lc(),null;case 24:return null;default:return null}}var Mi=!1,Lt=!1,np=typeof WeakSet=="function"?WeakSet:Set,ce=null;function Zo(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(o){lt(e,t,o)}else n.current=null}function cl(e,t,n){try{n()}catch(o){lt(e,t,o)}}var Du=!1;function op(e,t){if(Ka=ns,e=em(),_l(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var o=n.getSelection&&n.getSelection();if(o&&o.rangeCount!==0){n=o.anchorNode;var r=o.anchorOffset,i=o.focusNode;o=o.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,h=0,p=e,y=null;t:for(;;){for(var x;p!==n||r!==0&&p.nodeType!==3||(l=a+r),p!==i||o!==0&&p.nodeType!==3||(c=a+o),p.nodeType===3&&(a+=p.nodeValue.length),(x=p.firstChild)!==null;)y=p,p=x;for(;;){if(p===e)break t;if(y===n&&++d===r&&(l=a),y===i&&++h===o&&(c=a),(x=p.nextSibling)!==null)break;p=y,y=p.parentNode}p=x}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wa={focusedElem:e,selectionRange:n},ns=!1,ce=t;ce!==null;)if(t=ce,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ce=e;else for(;ce!==null;){t=ce;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var w=S.memoizedProps,C=S.memoizedState,f=t.stateNode,g=f.getSnapshotBeforeUpdate(t.elementType===t.type?w:xn(t.type,w),C);f.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var m=t.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(v){lt(t,t.return,v)}if(e=t.sibling,e!==null){e.return=t.return,ce=e;break}ce=t.return}return S=Du,Du=!1,S}function zr(e,t,n){var o=t.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var r=o=o.next;do{if((r.tag&e)===e){var i=r.destroy;r.destroy=void 0,i!==void 0&&cl(t,n,i)}r=r.next}while(r!==o)}}function Ls(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var o=n.create;n.destroy=o()}n=n.next}while(n!==t)}}function ul(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Xm(e){var t=e.alternate;t!==null&&(e.alternate=null,Xm(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[An],delete t[Zr],delete t[Xa],delete t[zh],delete t[_h])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Qm(e){return e.tag===5||e.tag===3||e.tag===4}function ju(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Qm(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function dl(e,t,n){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=is));else if(o!==4&&(e=e.child,e!==null))for(dl(e,t,n),e=e.sibling;e!==null;)dl(e,t,n),e=e.sibling}function ml(e,t,n){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(ml(e,t,n),e=e.sibling;e!==null;)ml(e,t,n),e=e.sibling}var bt=null,wn=!1;function Vn(e,t,n){for(n=n.child;n!==null;)Jm(e,t,n),n=n.sibling}function Jm(e,t,n){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(Ns,n)}catch{}switch(n.tag){case 5:Lt||Zo(n,t);case 6:var o=bt,r=wn;bt=null,Vn(e,t,n),bt=o,wn=r,bt!==null&&(wn?(e=bt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):bt.removeChild(n.stateNode));break;case 18:bt!==null&&(wn?(e=bt,n=n.stateNode,e.nodeType===8?da(e.parentNode,n):e.nodeType===1&&da(e,n),qr(e)):da(bt,n.stateNode));break;case 4:o=bt,r=wn,bt=n.stateNode.containerInfo,wn=!0,Vn(e,t,n),bt=o,wn=r;break;case 0:case 11:case 14:case 15:if(!Lt&&(o=n.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){r=o=o.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&cl(n,t,a),r=r.next}while(r!==o)}Vn(e,t,n);break;case 1:if(!Lt&&(Zo(n,t),o=n.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=n.memoizedProps,o.state=n.memoizedState,o.componentWillUnmount()}catch(l){lt(n,t,l)}Vn(e,t,n);break;case 21:Vn(e,t,n);break;case 22:n.mode&1?(Lt=(o=Lt)||n.memoizedState!==null,Vn(e,t,n),Lt=o):Vn(e,t,n);break;default:Vn(e,t,n)}}function Ru(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new np),t.forEach(function(o){var r=mp.bind(null,e,o);n.has(o)||(n.add(o),o.then(r,r))})}}function vn(e,t){var n=t.deletions;if(n!==null)for(var o=0;o<n.length;o++){var r=n[o];try{var i=e,a=t,l=a;e:for(;l!==null;){switch(l.tag){case 5:bt=l.stateNode,wn=!1;break e;case 3:bt=l.stateNode.containerInfo,wn=!0;break e;case 4:bt=l.stateNode.containerInfo,wn=!0;break e}l=l.return}if(bt===null)throw Error(K(160));Jm(i,a,r),bt=null,wn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(d){lt(r,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Zm(t,e),t=t.sibling}function Zm(e,t){var n=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vn(t,e),Tn(e),o&4){try{zr(3,e,e.return),Ls(3,e)}catch(w){lt(e,e.return,w)}try{zr(5,e,e.return)}catch(w){lt(e,e.return,w)}}break;case 1:vn(t,e),Tn(e),o&512&&n!==null&&Zo(n,n.return);break;case 5:if(vn(t,e),Tn(e),o&512&&n!==null&&Zo(n,n.return),e.flags&32){var r=e.stateNode;try{Vr(r,"")}catch(w){lt(e,e.return,w)}}if(o&4&&(r=e.stateNode,r!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Sd(r,i),$a(l,a);var d=$a(l,i);for(a=0;a<c.length;a+=2){var h=c[a],p=c[a+1];h==="style"?bd(r,p):h==="dangerouslySetInnerHTML"?kd(r,p):h==="children"?Vr(r,p):Nl(r,h,p,d)}switch(l){case"input":Ra(r,i);break;case"textarea":Ed(r,i);break;case"select":var y=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?tr(r,!!i.multiple,x,!1):y!==!!i.multiple&&(i.defaultValue!=null?tr(r,!!i.multiple,i.defaultValue,!0):tr(r,!!i.multiple,i.multiple?[]:"",!1))}r[Zr]=i}catch(w){lt(e,e.return,w)}}break;case 6:if(vn(t,e),Tn(e),o&4){if(e.stateNode===null)throw Error(K(162));r=e.stateNode,i=e.memoizedProps;try{r.nodeValue=i}catch(w){lt(e,e.return,w)}}break;case 3:if(vn(t,e),Tn(e),o&4&&n!==null&&n.memoizedState.isDehydrated)try{qr(t.containerInfo)}catch(w){lt(e,e.return,w)}break;case 4:vn(t,e),Tn(e);break;case 13:vn(t,e),Tn(e),r=e.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(sc=gt())),o&4&&Ru(e);break;case 22:if(h=n!==null&&n.memoizedState!==null,e.mode&1?(Lt=(d=Lt)||h,vn(t,e),Lt=d):vn(t,e),Tn(e),o&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!h&&e.mode&1)for(ce=e,h=e.child;h!==null;){for(p=ce=h;ce!==null;){switch(y=ce,x=y.child,y.tag){case 0:case 11:case 14:case 15:zr(4,y,y.return);break;case 1:Zo(y,y.return);var S=y.stateNode;if(typeof S.componentWillUnmount=="function"){o=y,n=y.return;try{t=o,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(w){lt(o,n,w)}}break;case 5:Zo(y,y.return);break;case 22:if(y.memoizedState!==null){Mu(p);continue}}x!==null?(x.return=y,ce=x):Mu(p)}h=h.sibling}e:for(h=null,p=e;;){if(p.tag===5){if(h===null){h=p;try{r=p.stateNode,d?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Td("display",a))}catch(w){lt(e,e.return,w)}}}else if(p.tag===6){if(h===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(w){lt(e,e.return,w)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;h===p&&(h=null),p=p.return}h===p&&(h=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:vn(t,e),Tn(e),o&4&&Ru(e);break;case 21:break;default:vn(t,e),Tn(e)}}function Tn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Qm(n)){var o=n;break e}n=n.return}throw Error(K(160))}switch(o.tag){case 5:var r=o.stateNode;o.flags&32&&(Vr(r,""),o.flags&=-33);var i=ju(e);ml(e,i,r);break;case 3:case 4:var a=o.stateNode.containerInfo,l=ju(e);dl(e,l,a);break;default:throw Error(K(161))}}catch(c){lt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rp(e,t,n){ce=e,ef(e)}function ef(e,t,n){for(var o=(e.mode&1)!==0;ce!==null;){var r=ce,i=r.child;if(r.tag===22&&o){var a=r.memoizedState!==null||Mi;if(!a){var l=r.alternate,c=l!==null&&l.memoizedState!==null||Lt;l=Mi;var d=Lt;if(Mi=a,(Lt=c)&&!d)for(ce=r;ce!==null;)a=ce,c=a.child,a.tag===22&&a.memoizedState!==null?Pu(r):c!==null?(c.return=a,ce=c):Pu(r);for(;i!==null;)ce=i,ef(i),i=i.sibling;ce=r,Mi=l,Lt=d}Iu(e)}else r.subtreeFlags&8772&&i!==null?(i.return=r,ce=i):Iu(e)}}function Iu(e){for(;ce!==null;){var t=ce;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Lt||Ls(5,t);break;case 1:var o=t.stateNode;if(t.flags&4&&!Lt)if(n===null)o.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:xn(t.type,n.memoizedProps);o.componentDidUpdate(r,n.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&pu(t,i,o);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}pu(t,a,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var p=h.dehydrated;p!==null&&qr(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}Lt||t.flags&512&&ul(t)}catch(y){lt(t,t.return,y)}}if(t===e){ce=null;break}if(n=t.sibling,n!==null){n.return=t.return,ce=n;break}ce=t.return}}function Mu(e){for(;ce!==null;){var t=ce;if(t===e){ce=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ce=n;break}ce=t.return}}function Pu(e){for(;ce!==null;){var t=ce;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Ls(4,t)}catch(c){lt(t,n,c)}break;case 1:var o=t.stateNode;if(typeof o.componentDidMount=="function"){var r=t.return;try{o.componentDidMount()}catch(c){lt(t,r,c)}}var i=t.return;try{ul(t)}catch(c){lt(t,i,c)}break;case 5:var a=t.return;try{ul(t)}catch(c){lt(t,a,c)}}}catch(c){lt(t,t.return,c)}if(t===e){ce=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ce=l;break}ce=t.return}}var ip=Math.ceil,ps=Un.ReactCurrentDispatcher,rc=Un.ReactCurrentOwner,mn=Un.ReactCurrentBatchConfig,Ue=0,Et=null,vt=null,Nt=0,Zt=0,er=yo(0),wt=0,ii=null,Lo=0,$s=0,ic=0,_r=null,Wt=null,sc=0,fr=1/0,In=null,ys=!1,fl=null,so=null,Pi=!1,Zn=null,vs=0,Ur=0,gl=null,Ki=-1,Wi=0;function _t(){return Ue&6?gt():Ki!==-1?Ki:Ki=gt()}function ao(e){return e.mode&1?Ue&2&&Nt!==0?Nt&-Nt:Bh.transition!==null?(Wi===0&&(Wi=Fd()),Wi):(e=Ve,e!==0||(e=window.event,e=e===void 0?16:Hd(e.type)),e):1}function Cn(e,t,n,o){if(50<Ur)throw Ur=0,gl=null,Error(K(185));mi(e,n,o),(!(Ue&2)||e!==Et)&&(e===Et&&(!(Ue&2)&&($s|=n),wt===4&&Xn(e,Nt)),Qt(e,o),n===1&&Ue===0&&!(t.mode&1)&&(fr=gt()+500,Is&&vo()))}function Qt(e,t){var n=e.callbackNode;Bg(e,t);var o=ts(e,e===Et?Nt:0);if(o===0)n!==null&&Gc(n),e.callbackNode=null,e.callbackPriority=0;else if(t=o&-o,e.callbackPriority!==t){if(n!=null&&Gc(n),t===1)e.tag===0?Uh(Lu.bind(null,e)):um(Lu.bind(null,e)),Oh(function(){!(Ue&6)&&vo()}),n=null;else{switch(zd(o)){case 1:n=Il;break;case 4:n=$d;break;case 16:n=es;break;case 536870912:n=Od;break;default:n=es}n=cf(n,tf.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function tf(e,t){if(Ki=-1,Wi=0,Ue&6)throw Error(K(327));var n=e.callbackNode;if(sr()&&e.callbackNode!==n)return null;var o=ts(e,e===Et?Nt:0);if(o===0)return null;if(o&30||o&e.expiredLanes||t)t=xs(e,o);else{t=o;var r=Ue;Ue|=2;var i=of();(Et!==e||Nt!==t)&&(In=null,fr=gt()+500,Ao(e,t));do try{lp();break}catch(l){nf(e,l)}while(1);Hl(),ps.current=i,Ue=r,vt!==null?t=0:(Et=null,Nt=0,t=wt)}if(t!==0){if(t===2&&(r=Ua(e),r!==0&&(o=r,t=hl(e,r))),t===1)throw n=ii,Ao(e,0),Xn(e,o),Qt(e,gt()),n;if(t===6)Xn(e,o);else{if(r=e.current.alternate,!(o&30)&&!sp(r)&&(t=xs(e,o),t===2&&(i=Ua(e),i!==0&&(o=i,t=hl(e,i))),t===1))throw n=ii,Ao(e,0),Xn(e,o),Qt(e,gt()),n;switch(e.finishedWork=r,e.finishedLanes=o,t){case 0:case 1:throw Error(K(345));case 2:Co(e,Wt,In);break;case 3:if(Xn(e,o),(o&130023424)===o&&(t=sc+500-gt(),10<t)){if(ts(e,0)!==0)break;if(r=e.suspendedLanes,(r&o)!==o){_t(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Ya(Co.bind(null,e,Wt,In),t);break}Co(e,Wt,In);break;case 4:if(Xn(e,o),(o&4194240)===o)break;for(t=e.eventTimes,r=-1;0<o;){var a=31-En(o);i=1<<a,a=t[a],a>r&&(r=a),o&=~i}if(o=r,o=gt()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*ip(o/1960))-o,10<o){e.timeoutHandle=Ya(Co.bind(null,e,Wt,In),o);break}Co(e,Wt,In);break;case 5:Co(e,Wt,In);break;default:throw Error(K(329))}}}return Qt(e,gt()),e.callbackNode===n?tf.bind(null,e):null}function hl(e,t){var n=_r;return e.current.memoizedState.isDehydrated&&(Ao(e,t).flags|=256),e=xs(e,t),e!==2&&(t=Wt,Wt=n,t!==null&&pl(t)),e}function pl(e){Wt===null?Wt=e:Wt.push.apply(Wt,e)}function sp(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var o=0;o<n.length;o++){var r=n[o],i=r.getSnapshot;r=r.value;try{if(!kn(i(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Xn(e,t){for(t&=~ic,t&=~$s,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-En(t),o=1<<n;e[n]=-1,t&=~o}}function Lu(e){if(Ue&6)throw Error(K(327));sr();var t=ts(e,0);if(!(t&1))return Qt(e,gt()),null;var n=xs(e,t);if(e.tag!==0&&n===2){var o=Ua(e);o!==0&&(t=o,n=hl(e,o))}if(n===1)throw n=ii,Ao(e,0),Xn(e,t),Qt(e,gt()),n;if(n===6)throw Error(K(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Co(e,Wt,In),Qt(e,gt()),null}function ac(e,t){var n=Ue;Ue|=1;try{return e(t)}finally{Ue=n,Ue===0&&(fr=gt()+500,Is&&vo())}}function $o(e){Zn!==null&&Zn.tag===0&&!(Ue&6)&&sr();var t=Ue;Ue|=1;var n=mn.transition,o=Ve;try{if(mn.transition=null,Ve=1,e)return e()}finally{Ve=o,mn.transition=n,Ue=t,!(Ue&6)&&vo()}}function lc(){Zt=er.current,tt(er)}function Ao(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,$h(n)),vt!==null)for(n=vt.return;n!==null;){var o=n;switch(Bl(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&ss();break;case 3:dr(),tt(Yt),tt($t),Ql();break;case 5:Xl(o);break;case 4:dr();break;case 13:tt(ot);break;case 19:tt(ot);break;case 10:Kl(o.type._context);break;case 22:case 23:lc()}n=n.return}if(Et=e,vt=e=lo(e.current,null),Nt=Zt=t,wt=0,ii=null,ic=$s=Lo=0,Wt=_r=null,bo!==null){for(t=0;t<bo.length;t++)if(n=bo[t],o=n.interleaved,o!==null){n.interleaved=null;var r=o.next,i=n.pending;if(i!==null){var a=i.next;i.next=r,o.next=a}n.pending=o}bo=null}return e}function nf(e,t){do{var n=vt;try{if(Hl(),Gi.current=hs,gs){for(var o=rt.memoizedState;o!==null;){var r=o.queue;r!==null&&(r.pending=null),o=o.next}gs=!1}if(Po=0,St=xt=rt=null,Fr=!1,ni=0,rc.current=null,n===null||n.return===null){wt=1,ii=t,vt=null;break}e:{var i=e,a=n.return,l=n,c=t;if(t=Nt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,p=h.tag;if(!(h.mode&1)&&(p===0||p===11||p===15)){var y=h.alternate;y?(h.updateQueue=y.updateQueue,h.memoizedState=y.memoizedState,h.lanes=y.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Eu(a);if(x!==null){x.flags&=-257,Cu(x,a,l,i,t),x.mode&1&&Su(i,d,t),t=x,c=d;var S=t.updateQueue;if(S===null){var w=new Set;w.add(c),t.updateQueue=w}else S.add(c);break e}else{if(!(t&1)){Su(i,d,t),cc();break e}c=Error(K(426))}}else if(nt&&l.mode&1){var C=Eu(a);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Cu(C,a,l,i,t),Gl(mr(c,l));break e}}i=c=mr(c,l),wt!==4&&(wt=2),_r===null?_r=[i]:_r.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var f=zm(i,c,t);hu(i,f);break e;case 1:l=c;var g=i.type,m=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(so===null||!so.has(m)))){i.flags|=65536,t&=-t,i.lanes|=t;var v=_m(i,l,t);hu(i,v);break e}}i=i.return}while(i!==null)}sf(n)}catch(N){t=N,vt===n&&n!==null&&(vt=n=n.return);continue}break}while(1)}function of(){var e=ps.current;return ps.current=hs,e===null?hs:e}function cc(){(wt===0||wt===3||wt===2)&&(wt=4),Et===null||!(Lo&268435455)&&!($s&268435455)||Xn(Et,Nt)}function xs(e,t){var n=Ue;Ue|=2;var o=of();(Et!==e||Nt!==t)&&(In=null,Ao(e,t));do try{ap();break}catch(r){nf(e,r)}while(1);if(Hl(),Ue=n,ps.current=o,vt!==null)throw Error(K(261));return Et=null,Nt=0,wt}function ap(){for(;vt!==null;)rf(vt)}function lp(){for(;vt!==null&&!Mg();)rf(vt)}function rf(e){var t=lf(e.alternate,e,Zt);e.memoizedProps=e.pendingProps,t===null?sf(e):vt=t,rc.current=null}function sf(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=tp(n,t),n!==null){n.flags&=32767,vt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{wt=6,vt=null;return}}else if(n=ep(n,t,Zt),n!==null){vt=n;return}if(t=t.sibling,t!==null){vt=t;return}vt=t=e}while(t!==null);wt===0&&(wt=5)}function Co(e,t,n){var o=Ve,r=mn.transition;try{mn.transition=null,Ve=1,cp(e,t,n,o)}finally{mn.transition=r,Ve=o}return null}function cp(e,t,n,o){do sr();while(Zn!==null);if(Ue&6)throw Error(K(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(K(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(Gg(e,i),e===Et&&(vt=Et=null,Nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Pi||(Pi=!0,cf(es,function(){return sr(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=mn.transition,mn.transition=null;var a=Ve;Ve=1;var l=Ue;Ue|=4,rc.current=null,op(e,n),Zm(n,e),Dh(Wa),ns=!!Ka,Wa=Ka=null,e.current=n,rp(n),Pg(),Ue=l,Ve=a,mn.transition=i}else e.current=n;if(Pi&&(Pi=!1,Zn=e,vs=r),i=e.pendingLanes,i===0&&(so=null),Og(n.stateNode),Qt(e,gt()),t!==null)for(o=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],o(r.value,{componentStack:r.stack,digest:r.digest});if(ys)throw ys=!1,e=fl,fl=null,e;return vs&1&&e.tag!==0&&sr(),i=e.pendingLanes,i&1?e===gl?Ur++:(Ur=0,gl=e):Ur=0,vo(),null}function sr(){if(Zn!==null){var e=zd(vs),t=mn.transition,n=Ve;try{if(mn.transition=null,Ve=16>e?16:e,Zn===null)var o=!1;else{if(e=Zn,Zn=null,vs=0,Ue&6)throw Error(K(331));var r=Ue;for(Ue|=4,ce=e.current;ce!==null;){var i=ce,a=i.child;if(ce.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ce=d;ce!==null;){var h=ce;switch(h.tag){case 0:case 11:case 15:zr(8,h,i)}var p=h.child;if(p!==null)p.return=h,ce=p;else for(;ce!==null;){h=ce;var y=h.sibling,x=h.return;if(Xm(h),h===d){ce=null;break}if(y!==null){y.return=x,ce=y;break}ce=x}}}var S=i.alternate;if(S!==null){var w=S.child;if(w!==null){S.child=null;do{var C=w.sibling;w.sibling=null,w=C}while(w!==null)}}ce=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ce=a;else e:for(;ce!==null;){if(i=ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:zr(9,i,i.return)}var f=i.sibling;if(f!==null){f.return=i.return,ce=f;break e}ce=i.return}}var g=e.current;for(ce=g;ce!==null;){a=ce;var m=a.child;if(a.subtreeFlags&2064&&m!==null)m.return=a,ce=m;else e:for(a=g;ce!==null;){if(l=ce,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Ls(9,l)}}catch(N){lt(l,l.return,N)}if(l===a){ce=null;break e}var v=l.sibling;if(v!==null){v.return=l.return,ce=v;break e}ce=l.return}}if(Ue=r,vo(),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(Ns,e)}catch{}o=!0}return o}finally{Ve=n,mn.transition=t}}return!1}function $u(e,t,n){t=mr(n,t),t=zm(e,t,1),e=io(e,t,1),t=_t(),e!==null&&(mi(e,1,t),Qt(e,t))}function lt(e,t,n){if(e.tag===3)$u(e,e,n);else for(;t!==null;){if(t.tag===3){$u(t,e,n);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(so===null||!so.has(o))){e=mr(n,e),e=_m(t,e,1),t=io(t,e,1),e=_t(),t!==null&&(mi(t,1,e),Qt(t,e));break}}t=t.return}}function up(e,t,n){var o=e.pingCache;o!==null&&o.delete(t),t=_t(),e.pingedLanes|=e.suspendedLanes&n,Et===e&&(Nt&n)===n&&(wt===4||wt===3&&(Nt&130023424)===Nt&&500>gt()-sc?Ao(e,0):ic|=n),Qt(e,t)}function af(e,t){t===0&&(e.mode&1?(t=ki,ki<<=1,!(ki&130023424)&&(ki=4194304)):t=1);var n=_t();e=zn(e,t),e!==null&&(mi(e,t,n),Qt(e,n))}function dp(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),af(e,n)}function mp(e,t){var n=0;switch(e.tag){case 13:var o=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(K(314))}o!==null&&o.delete(t),af(e,n)}var lf;lf=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Yt.current)qt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qt=!1,Zh(e,t,n);qt=!!(e.flags&131072)}else qt=!1,nt&&t.flags&1048576&&dm(t,cs,t.index);switch(t.lanes=0,t.tag){case 2:var o=t.type;Hi(e,t),e=t.pendingProps;var r=lr(t,$t.current);ir(t,n),r=Zl(null,t,o,e,r,n);var i=ec();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Xt(o)?(i=!0,as(t)):i=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,ql(t),r.updater=Ps,t.stateNode=r,r._reactInternals=t,nl(t,o,e,n),t=il(null,t,o,!0,i,n)):(t.tag=0,nt&&i&&Ul(t),zt(null,t,r,n),t=t.child),t;case 16:o=t.elementType;e:{switch(Hi(e,t),e=t.pendingProps,r=o._init,o=r(o._payload),t.type=o,r=t.tag=gp(o),e=xn(o,e),r){case 0:t=rl(null,t,o,e,n);break e;case 1:t=bu(null,t,o,e,n);break e;case 11:t=ku(null,t,o,e,n);break e;case 14:t=Tu(null,t,o,xn(o.type,e),n);break e}throw Error(K(306,o,""))}return t;case 0:return o=t.type,r=t.pendingProps,r=t.elementType===o?r:xn(o,r),rl(e,t,o,r,n);case 1:return o=t.type,r=t.pendingProps,r=t.elementType===o?r:xn(o,r),bu(e,t,o,r,n);case 3:e:{if(Vm(t),e===null)throw Error(K(387));o=t.pendingProps,i=t.memoizedState,r=i.element,ym(e,t),ms(t,o,null,n);var a=t.memoizedState;if(o=a.element,i.isDehydrated)if(i={element:o,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){r=mr(Error(K(423)),t),t=Nu(e,t,o,n,r);break e}else if(o!==r){r=mr(Error(K(424)),t),t=Nu(e,t,o,n,r);break e}else for(en=ro(t.stateNode.containerInfo.firstChild),nn=t,nt=!0,Sn=null,n=hm(t,null,o,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(cr(),o===r){t=_n(e,t,n);break e}zt(e,t,o,n)}t=t.child}return t;case 5:return vm(t),e===null&&Za(t),o=t.type,r=t.pendingProps,i=e!==null?e.memoizedProps:null,a=r.children,qa(o,r)?a=null:i!==null&&qa(o,i)&&(t.flags|=32),Gm(e,t),zt(e,t,a,n),t.child;case 6:return e===null&&Za(t),null;case 13:return Hm(e,t,n);case 4:return Yl(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=ur(t,null,o,n):zt(e,t,o,n),t.child;case 11:return o=t.type,r=t.pendingProps,r=t.elementType===o?r:xn(o,r),ku(e,t,o,r,n);case 7:return zt(e,t,t.pendingProps,n),t.child;case 8:return zt(e,t,t.pendingProps.children,n),t.child;case 12:return zt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(o=t.type._context,r=t.pendingProps,i=t.memoizedProps,a=r.value,Je(us,o._currentValue),o._currentValue=a,i!==null)if(kn(i.value,a)){if(i.children===r.children&&!Yt.current){t=_n(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===o){if(i.tag===1){c=$n(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),el(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(K(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),el(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}zt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,o=t.pendingProps.children,ir(t,n),r=fn(r),o=o(r),t.flags|=1,zt(e,t,o,n),t.child;case 14:return o=t.type,r=xn(o,t.pendingProps),r=xn(o.type,r),Tu(e,t,o,r,n);case 15:return Um(e,t,t.type,t.pendingProps,n);case 17:return o=t.type,r=t.pendingProps,r=t.elementType===o?r:xn(o,r),Hi(e,t),t.tag=1,Xt(o)?(e=!0,as(t)):e=!1,ir(t,n),Fm(t,o,r),nl(t,o,r,n),il(null,t,o,!0,e,n);case 19:return Km(e,t,n);case 22:return Bm(e,t,n)}throw Error(K(156,t.tag))};function cf(e,t){return Ld(e,t)}function fp(e,t,n,o){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function dn(e,t,n,o){return new fp(e,t,n,o)}function uc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function gp(e){if(typeof e=="function")return uc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Dl)return 11;if(e===jl)return 14}return 2}function lo(e,t){var n=e.alternate;return n===null?(n=dn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function qi(e,t,n,o,r,i){var a=2;if(o=e,typeof e=="function")uc(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Vo:return Do(n.children,r,i,t);case Al:a=8,r|=8;break;case ba:return e=dn(12,n,t,r|2),e.elementType=ba,e.lanes=i,e;case Na:return e=dn(13,n,t,r),e.elementType=Na,e.lanes=i,e;case Aa:return e=dn(19,n,t,r),e.elementType=Aa,e.lanes=i,e;case vd:return Os(n,r,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case pd:a=10;break e;case yd:a=9;break e;case Dl:a=11;break e;case jl:a=14;break e;case Hn:a=16,o=null;break e}throw Error(K(130,e==null?e:typeof e,""))}return t=dn(a,n,t,r),t.elementType=e,t.type=o,t.lanes=i,t}function Do(e,t,n,o){return e=dn(7,e,o,t),e.lanes=n,e}function Os(e,t,n,o){return e=dn(22,e,o,t),e.elementType=vd,e.lanes=n,e.stateNode={isHidden:!1},e}function xa(e,t,n){return e=dn(6,e,null,t),e.lanes=n,e}function wa(e,t,n){return t=dn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function hp(e,t,n,o,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ea(0),this.expirationTimes=ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ea(0),this.identifierPrefix=o,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function dc(e,t,n,o,r,i,a,l,c){return e=new hp(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=dn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:o,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ql(i),e}function pp(e,t,n){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Go,key:o==null?null:""+o,children:e,containerInfo:t,implementation:n}}function uf(e){if(!e)return go;e=e._reactInternals;e:{if(Fo(e)!==e||e.tag!==1)throw Error(K(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Xt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(K(171))}if(e.tag===1){var n=e.type;if(Xt(n))return cm(e,n,t)}return t}function df(e,t,n,o,r,i,a,l,c){return e=dc(n,o,!0,e,r,i,a,l,c),e.context=uf(null),n=e.current,o=_t(),r=ao(n),i=$n(o,r),i.callback=t??null,io(n,i,r),e.current.lanes=r,mi(e,r,o),Qt(e,o),e}function Fs(e,t,n,o){var r=t.current,i=_t(),a=ao(r);return n=uf(n),t.context===null?t.context=n:t.pendingContext=n,t=$n(i,a),t.payload={element:e},o=o===void 0?null:o,o!==null&&(t.callback=o),e=io(r,t,a),e!==null&&(Cn(e,r,a,i),Bi(e,r,a)),a}function ws(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ou(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function mc(e,t){Ou(e,t),(e=e.alternate)&&Ou(e,t)}function yp(){return null}var mf=typeof reportError=="function"?reportError:function(e){console.error(e)};function fc(e){this._internalRoot=e}zs.prototype.render=fc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(K(409));Fs(e,t,null,null)};zs.prototype.unmount=fc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;$o(function(){Fs(null,e,null,null)}),t[Fn]=null}};function zs(e){this._internalRoot=e}zs.prototype.unstable_scheduleHydration=function(e){if(e){var t=Bd();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Yn.length&&t!==0&&t<Yn[n].priority;n++);Yn.splice(n,0,e),n===0&&Vd(e)}};function gc(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function _s(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Fu(){}function vp(e,t,n,o,r){if(r){if(typeof o=="function"){var i=o;o=function(){var d=ws(a);i.call(d)}}var a=df(t,o,e,0,null,!1,!1,"",Fu);return e._reactRootContainer=a,e[Fn]=a.current,Qr(e.nodeType===8?e.parentNode:e),$o(),a}for(;r=e.lastChild;)e.removeChild(r);if(typeof o=="function"){var l=o;o=function(){var d=ws(c);l.call(d)}}var c=dc(e,0,!1,null,null,!1,!1,"",Fu);return e._reactRootContainer=c,e[Fn]=c.current,Qr(e.nodeType===8?e.parentNode:e),$o(function(){Fs(t,c,n,o)}),c}function Us(e,t,n,o,r){var i=n._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var l=r;r=function(){var c=ws(a);l.call(c)}}Fs(t,a,e,r)}else a=vp(n,t,e,r,o);return ws(a)}_d=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Rr(t.pendingLanes);n!==0&&(Ml(t,n|1),Qt(t,gt()),!(Ue&6)&&(fr=gt()+500,vo()))}break;case 13:$o(function(){var o=zn(e,1);if(o!==null){var r=_t();Cn(o,e,1,r)}}),mc(e,1)}};Pl=function(e){if(e.tag===13){var t=zn(e,134217728);if(t!==null){var n=_t();Cn(t,e,134217728,n)}mc(e,134217728)}};Ud=function(e){if(e.tag===13){var t=ao(e),n=zn(e,t);if(n!==null){var o=_t();Cn(n,e,t,o)}mc(e,t)}};Bd=function(){return Ve};Gd=function(e,t){var n=Ve;try{return Ve=e,t()}finally{Ve=n}};Fa=function(e,t,n){switch(t){case"input":if(Ra(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var o=n[t];if(o!==e&&o.form===e.form){var r=Rs(o);if(!r)throw Error(K(90));wd(o),Ra(o,r)}}}break;case"textarea":Ed(e,n);break;case"select":t=n.value,t!=null&&tr(e,!!n.multiple,t,!1)}};Dd=ac;jd=$o;var xp={usingClientEntryPoint:!1,Events:[gi,qo,Rs,Nd,Ad,ac]},Ar={findFiberByHostInstance:To,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wp={bundleType:Ar.bundleType,version:Ar.version,rendererPackageName:Ar.rendererPackageName,rendererConfig:Ar.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Un.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Md(e),e===null?null:e.stateNode},findFiberByHostInstance:Ar.findFiberByHostInstance||yp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Li=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Li.isDisabled&&Li.supportsFiber)try{Ns=Li.inject(wp),Dn=Li}catch{}}rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xp;rn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gc(t))throw Error(K(200));return pp(e,t,null,n)};rn.createRoot=function(e,t){if(!gc(e))throw Error(K(299));var n=!1,o="",r=mf;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=dc(e,1,!1,null,null,n,!1,o,r),e[Fn]=t.current,Qr(e.nodeType===8?e.parentNode:e),new fc(t)};rn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(K(188)):(e=Object.keys(e).join(","),Error(K(268,e)));return e=Md(t),e=e===null?null:e.stateNode,e};rn.flushSync=function(e){return $o(e)};rn.hydrate=function(e,t,n){if(!_s(t))throw Error(K(200));return Us(null,e,t,!0,n)};rn.hydrateRoot=function(e,t,n){if(!gc(e))throw Error(K(405));var o=n!=null&&n.hydratedSources||null,r=!1,i="",a=mf;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=df(t,null,e,1,n??null,r,!1,i,a),e[Fn]=t.current,Qr(e),o)for(e=0;e<o.length;e++)n=o[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new zs(t)};rn.render=function(e,t,n){if(!_s(t))throw Error(K(200));return Us(null,e,t,!1,n)};rn.unmountComponentAtNode=function(e){if(!_s(e))throw Error(K(40));return e._reactRootContainer?($o(function(){Us(null,null,e,!1,function(){e._reactRootContainer=null,e[Fn]=null})}),!0):!1};rn.unstable_batchedUpdates=ac;rn.unstable_renderSubtreeIntoContainer=function(e,t,n,o){if(!_s(n))throw Error(K(200));if(e==null||e._reactInternals===void 0)throw Error(K(38));return Us(e,t,n,!1,o)};rn.version="18.3.1-next-f1338f8080-20240426";function ff(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ff)}catch(e){console.error(e)}}ff(),md.exports=rn;var Sp=md.exports,zu=Sp;ka.createRoot=zu.createRoot,ka.hydrateRoot=zu.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function si(){return si=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},si.apply(this,arguments)}var eo;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(eo||(eo={}));const _u="popstate";function Ep(e){e===void 0&&(e={});function t(o,r){let{pathname:i,search:a,hash:l}=o.location;return Ss("",{pathname:i,search:a,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(o,r){return typeof r=="string"?r:ai(r)}return gf(t,n,null,e)}function Cp(e){e===void 0&&(e={});function t(r,i){let{pathname:a="/",search:l="",hash:c=""}=zo(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Ss("",{pathname:a,search:l,hash:c},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){let a=r.document.querySelector("base"),l="";if(a&&a.getAttribute("href")){let c=r.location.href,d=c.indexOf("#");l=d===-1?c:c.slice(0,d)}return l+"#"+(typeof i=="string"?i:ai(i))}function o(r,i){hc(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return gf(t,n,o,e)}function ct(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function hc(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function kp(){return Math.random().toString(36).substr(2,8)}function Uu(e,t){return{usr:e.state,key:e.key,idx:t}}function Ss(e,t,n,o){return n===void 0&&(n=null),si({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?zo(t):t,{state:n,key:t&&t.key||o||kp()})}function ai(e){let{pathname:t="/",search:n="",hash:o=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function zo(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}function gf(e,t,n,o){o===void 0&&(o={});let{window:r=document.defaultView,v5Compat:i=!1}=o,a=r.history,l=eo.Pop,c=null,d=h();d==null&&(d=0,a.replaceState(si({},a.state,{idx:d}),""));function h(){return(a.state||{idx:null}).idx}function p(){l=eo.Pop;let C=h(),f=C==null?null:C-d;d=C,c&&c({action:l,location:w.location,delta:f})}function y(C,f){l=eo.Push;let g=Ss(w.location,C,f);n&&n(g,C),d=h()+1;let m=Uu(g,d),v=w.createHref(g);try{a.pushState(m,"",v)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;r.location.assign(v)}i&&c&&c({action:l,location:w.location,delta:1})}function x(C,f){l=eo.Replace;let g=Ss(w.location,C,f);n&&n(g,C),d=h();let m=Uu(g,d),v=w.createHref(g);a.replaceState(m,"",v),i&&c&&c({action:l,location:w.location,delta:0})}function S(C){let f=r.location.origin!=="null"?r.location.origin:r.location.href,g=typeof C=="string"?C:ai(C);return g=g.replace(/ $/,"%20"),ct(f,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,f)}let w={get action(){return l},get location(){return e(r,a)},listen(C){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(_u,p),c=C,()=>{r.removeEventListener(_u,p),c=null}},createHref(C){return t(r,C)},createURL:S,encodeLocation(C){let f=S(C);return{pathname:f.pathname,search:f.search,hash:f.hash}},push:y,replace:x,go(C){return a.go(C)}};return w}var Bu;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(Bu||(Bu={}));function Tp(e,t,n){return n===void 0&&(n="/"),bp(e,t,n,!1)}function bp(e,t,n,o){let r=typeof t=="string"?zo(t):t,i=gr(r.pathname||"/",n);if(i==null)return null;let a=hf(e);Np(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=Fp(i);l=$p(a[c],d,o)}return l}function hf(e,t,n,o){t===void 0&&(t=[]),n===void 0&&(n=[]),o===void 0&&(o="");let r=(i,a,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};c.relativePath.startsWith("/")&&(ct(c.relativePath.startsWith(o),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(o.length));let d=co([o,c.relativePath]),h=n.concat(c);i.children&&i.children.length>0&&(ct(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),hf(i.children,t,h,d)),!(i.path==null&&!i.index)&&t.push({path:d,score:Pp(d,i.index),routesMeta:h})};return e.forEach((i,a)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))r(i,a);else for(let c of pf(i.path))r(i,a,c)}),t}function pf(e){let t=e.split("/");if(t.length===0)return[];let[n,...o]=t,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(o.length===0)return r?[i,""]:[i];let a=pf(o.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),r&&l.push(...a),l.map(c=>e.startsWith("/")&&c===""?"/":c)}function Np(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:Lp(t.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}const Ap=/^:[\w-]+$/,Dp=3,jp=2,Rp=1,Ip=10,Mp=-2,Gu=e=>e==="*";function Pp(e,t){let n=e.split("/"),o=n.length;return n.some(Gu)&&(o+=Mp),t&&(o+=jp),n.filter(r=>!Gu(r)).reduce((r,i)=>r+(Ap.test(i)?Dp:i===""?Rp:Ip),o)}function Lp(e,t){return e.length===t.length&&e.slice(0,-1).every((o,r)=>o===t[r])?e[e.length-1]-t[t.length-1]:0}function $p(e,t,n){n===void 0&&(n=!1);let{routesMeta:o}=e,r={},i="/",a=[];for(let l=0;l<o.length;++l){let c=o[l],d=l===o.length-1,h=i==="/"?t:t.slice(i.length)||"/",p=Es({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),y=c.route;if(!p&&d&&n&&!o[o.length-1].route.index&&(p=Es({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:co([i,p.pathname]),pathnameBase:Bp(co([i,p.pathnameBase])),route:y}),p.pathnameBase!=="/"&&(i=co([i,p.pathnameBase]))}return a}function Es(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,o]=Op(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let i=r[0],a=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:o.reduce((d,h,p)=>{let{paramName:y,isOptional:x}=h;if(y==="*"){let w=l[p]||"";a=i.slice(0,i.length-w.length).replace(/(.)\/+$/,"$1")}const S=l[p];return x&&!S?d[y]=void 0:d[y]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:e}}function Op(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),hc(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(o.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),r+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":e!==""&&e!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),o]}function Fp(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return hc(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function gr(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,o=e.charAt(n);return o&&o!=="/"?null:e.slice(n)||"/"}function zp(e,t){t===void 0&&(t="/");let{pathname:n,search:o="",hash:r=""}=typeof e=="string"?zo(e):e;return{pathname:n?n.startsWith("/")?n:_p(n,t):t,search:Gp(o),hash:Vp(r)}}function _p(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function Sa(e,t,n,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Up(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function yf(e,t){let n=Up(e);return t?n.map((o,r)=>r===n.length-1?o.pathname:o.pathnameBase):n.map(o=>o.pathnameBase)}function vf(e,t,n,o){o===void 0&&(o=!1);let r;typeof e=="string"?r=zo(e):(r=si({},e),ct(!r.pathname||!r.pathname.includes("?"),Sa("?","pathname","search",r)),ct(!r.pathname||!r.pathname.includes("#"),Sa("#","pathname","hash",r)),ct(!r.search||!r.search.includes("#"),Sa("#","search","hash",r)));let i=e===""||r.pathname==="",a=i?"/":r.pathname,l;if(a==null)l=n;else{let p=t.length-1;if(!o&&a.startsWith("..")){let y=a.split("/");for(;y[0]==="..";)y.shift(),p-=1;r.pathname=y.join("/")}l=p>=0?t[p]:"/"}let c=zp(r,l),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const co=e=>e.join("/").replace(/\/\/+/g,"/"),Bp=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Gp=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Vp=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Hp(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const xf=["post","put","patch","delete"];new Set(xf);const Kp=["get",...xf];new Set(Kp);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function li(){return li=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},li.apply(this,arguments)}const Bs=u.createContext(null),wf=u.createContext(null),xo=u.createContext(null),Gs=u.createContext(null),_o=u.createContext({outlet:null,matches:[],isDataRoute:!1}),Sf=u.createContext(null);function Wp(e,t){let{relative:n}=t===void 0?{}:t;pi()||ct(!1);let{basename:o,navigator:r}=u.useContext(xo),{hash:i,pathname:a,search:l}=Vs(e,{relative:n}),c=a;return o!=="/"&&(c=a==="/"?o:co([o,a])),r.createHref({pathname:c,search:l,hash:i})}function pi(){return u.useContext(Gs)!=null}function yi(){return pi()||ct(!1),u.useContext(Gs).location}function Ef(e){u.useContext(xo).static||u.useLayoutEffect(e)}function Cf(){let{isDataRoute:e}=u.useContext(_o);return e?sy():qp()}function qp(){pi()||ct(!1);let e=u.useContext(Bs),{basename:t,future:n,navigator:o}=u.useContext(xo),{matches:r}=u.useContext(_o),{pathname:i}=yi(),a=JSON.stringify(yf(r,n.v7_relativeSplatPath)),l=u.useRef(!1);return Ef(()=>{l.current=!0}),u.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){o.go(d);return}let p=vf(d,JSON.parse(a),i,h.relative==="path");e==null&&t!=="/"&&(p.pathname=p.pathname==="/"?t:co([t,p.pathname])),(h.replace?o.replace:o.push)(p,h.state,h)},[t,o,a,i,e])}function Vs(e,t){let{relative:n}=t===void 0?{}:t,{future:o}=u.useContext(xo),{matches:r}=u.useContext(_o),{pathname:i}=yi(),a=JSON.stringify(yf(r,o.v7_relativeSplatPath));return u.useMemo(()=>vf(e,JSON.parse(a),i,n==="path"),[e,a,i,n])}function Yp(e,t){return Xp(e,t)}function Xp(e,t,n,o){pi()||ct(!1);let{navigator:r}=u.useContext(xo),{matches:i}=u.useContext(_o),a=i[i.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let d=yi(),h;if(t){var p;let C=typeof t=="string"?zo(t):t;c==="/"||(p=C.pathname)!=null&&p.startsWith(c)||ct(!1),h=C}else h=d;let y=h.pathname||"/",x=y;if(c!=="/"){let C=c.replace(/^\//,"").split("/");x="/"+y.replace(/^\//,"").split("/").slice(C.length).join("/")}let S=Tp(e,{pathname:x}),w=ty(S&&S.map(C=>Object.assign({},C,{params:Object.assign({},l,C.params),pathname:co([c,r.encodeLocation?r.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?c:co([c,r.encodeLocation?r.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),i,n,o);return t&&w?u.createElement(Gs.Provider,{value:{location:li({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:eo.Pop}},w):w}function Qp(){let e=iy(),t=Hp(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},i=null;return u.createElement(u.Fragment,null,u.createElement("h2",null,"Unexpected Application Error!"),u.createElement("h3",{style:{fontStyle:"italic"}},t),n?u.createElement("pre",{style:r},n):null,i)}const Jp=u.createElement(Qp,null);class Zp extends u.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?u.createElement(_o.Provider,{value:this.props.routeContext},u.createElement(Sf.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ey(e){let{routeContext:t,match:n,children:o}=e,r=u.useContext(Bs);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),u.createElement(_o.Provider,{value:t},o)}function ty(e,t,n,o){var r;if(t===void 0&&(t=[]),n===void 0&&(n=null),o===void 0&&(o=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=o)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,l=(r=n)==null?void 0:r.errors;if(l!=null){let h=a.findIndex(p=>p.route.id&&(l==null?void 0:l[p.route.id])!==void 0);h>=0||ct(!1),a=a.slice(0,Math.min(a.length,h+1))}let c=!1,d=-1;if(n&&o&&o.v7_partialHydration)for(let h=0;h<a.length;h++){let p=a[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=h),p.route.id){let{loaderData:y,errors:x}=n,S=p.route.loader&&y[p.route.id]===void 0&&(!x||x[p.route.id]===void 0);if(p.route.lazy||S){c=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}return a.reduceRight((h,p,y)=>{let x,S=!1,w=null,C=null;n&&(x=l&&p.route.id?l[p.route.id]:void 0,w=p.route.errorElement||Jp,c&&(d<0&&y===0?(ay("route-fallback",!1),S=!0,C=null):d===y&&(S=!0,C=p.route.hydrateFallbackElement||null)));let f=t.concat(a.slice(0,y+1)),g=()=>{let m;return x?m=w:S?m=C:p.route.Component?m=u.createElement(p.route.Component,null):p.route.element?m=p.route.element:m=h,u.createElement(ey,{match:p,routeContext:{outlet:h,matches:f,isDataRoute:n!=null},children:m})};return n&&(p.route.ErrorBoundary||p.route.errorElement||y===0)?u.createElement(Zp,{location:n.location,revalidation:n.revalidation,component:w,error:x,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):g()},null)}var kf=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(kf||{}),Cs=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Cs||{});function ny(e){let t=u.useContext(Bs);return t||ct(!1),t}function oy(e){let t=u.useContext(wf);return t||ct(!1),t}function ry(e){let t=u.useContext(_o);return t||ct(!1),t}function Tf(e){let t=ry(),n=t.matches[t.matches.length-1];return n.route.id||ct(!1),n.route.id}function iy(){var e;let t=u.useContext(Sf),n=oy(Cs.UseRouteError),o=Tf(Cs.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[o]}function sy(){let{router:e}=ny(kf.UseNavigateStable),t=Tf(Cs.UseNavigateStable),n=u.useRef(!1);return Ef(()=>{n.current=!0}),u.useCallback(function(r,i){i===void 0&&(i={}),n.current&&(typeof r=="number"?e.navigate(r):e.navigate(r,li({fromRouteId:t},i)))},[e,t])}const Vu={};function ay(e,t,n){!t&&!Vu[e]&&(Vu[e]=!0)}function bf(e,t){e==null||e.v7_startTransition,(e==null?void 0:e.v7_relativeSplatPath)===void 0&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}function ko(e){ct(!1)}function Nf(e){let{basename:t="/",children:n=null,location:o,navigationType:r=eo.Pop,navigator:i,static:a=!1,future:l}=e;pi()&&ct(!1);let c=t.replace(/^\/*/,"/"),d=u.useMemo(()=>({basename:c,navigator:i,static:a,future:li({v7_relativeSplatPath:!1},l)}),[c,l,i,a]);typeof o=="string"&&(o=zo(o));let{pathname:h="/",search:p="",hash:y="",state:x=null,key:S="default"}=o,w=u.useMemo(()=>{let C=gr(h,c);return C==null?null:{location:{pathname:C,search:p,hash:y,state:x,key:S},navigationType:r}},[c,h,p,y,x,S,r]);return w==null?null:u.createElement(xo.Provider,{value:d},u.createElement(Gs.Provider,{children:n,value:w}))}function ly(e){let{children:t,location:n}=e;return Yp(yl(t),n)}new Promise(()=>{});function yl(e,t){t===void 0&&(t=[]);let n=[];return u.Children.forEach(e,(o,r)=>{if(!u.isValidElement(o))return;let i=[...t,r];if(o.type===u.Fragment){n.push.apply(n,yl(o.props.children,i));return}o.type!==ko&&ct(!1),!o.props.index||!o.props.children||ct(!1);let a={id:o.props.id||i.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(a.children=yl(o.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ks(){return ks=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ks.apply(this,arguments)}function Af(e,t){if(e==null)return{};var n={},o=Object.keys(e),r,i;for(i=0;i<o.length;i++)r=o[i],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function cy(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function uy(e,t){return e.button===0&&(!t||t==="_self")&&!cy(e)}const dy=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],my=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],fy="6";try{window.__reactRouterVersion=fy}catch{}const gy=u.createContext({isTransitioning:!1}),hy="startTransition",Ts=ug[hy];function py(e){let{basename:t,children:n,future:o,window:r}=e,i=u.useRef();i.current==null&&(i.current=Ep({window:r,v5Compat:!0}));let a=i.current,[l,c]=u.useState({action:a.action,location:a.location}),{v7_startTransition:d}=o||{},h=u.useCallback(p=>{d&&Ts?Ts(()=>c(p)):c(p)},[c,d]);return u.useLayoutEffect(()=>a.listen(h),[a,h]),u.useEffect(()=>bf(o),[o]),u.createElement(Nf,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:a,future:o})}function yy(e){let{basename:t,children:n,future:o,window:r}=e,i=u.useRef();i.current==null&&(i.current=Cp({window:r,v5Compat:!0}));let a=i.current,[l,c]=u.useState({action:a.action,location:a.location}),{v7_startTransition:d}=o||{},h=u.useCallback(p=>{d&&Ts?Ts(()=>c(p)):c(p)},[c,d]);return u.useLayoutEffect(()=>a.listen(h),[a,h]),u.useEffect(()=>bf(o),[o]),u.createElement(Nf,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:a,future:o})}const vy=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",xy=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wy=u.forwardRef(function(t,n){let{onClick:o,relative:r,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:h,viewTransition:p}=t,y=Af(t,dy),{basename:x}=u.useContext(xo),S,w=!1;if(typeof d=="string"&&xy.test(d)&&(S=d,vy))try{let m=new URL(window.location.href),v=d.startsWith("//")?new URL(m.protocol+d):new URL(d),N=gr(v.pathname,x);v.origin===m.origin&&N!=null?d=N+v.search+v.hash:w=!0}catch{}let C=Wp(d,{relative:r}),f=Cy(d,{replace:a,state:l,target:c,preventScrollReset:h,relative:r,viewTransition:p});function g(m){o&&o(m),m.defaultPrevented||f(m)}return u.createElement("a",ks({},y,{href:S||C,onClick:w||i?o:g,ref:n,target:c}))}),Sy=u.forwardRef(function(t,n){let{"aria-current":o="page",caseSensitive:r=!1,className:i="",end:a=!1,style:l,to:c,viewTransition:d,children:h}=t,p=Af(t,my),y=Vs(c,{relative:p.relative}),x=yi(),S=u.useContext(wf),{navigator:w,basename:C}=u.useContext(xo),f=S!=null&&ky(y)&&d===!0,g=w.encodeLocation?w.encodeLocation(y).pathname:y.pathname,m=x.pathname,v=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;r||(m=m.toLowerCase(),v=v?v.toLowerCase():null,g=g.toLowerCase()),v&&C&&(v=gr(v,C)||v);const N=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let A=m===g||!a&&m.startsWith(g)&&m.charAt(N)==="/",b=v!=null&&(v===g||!a&&v.startsWith(g)&&v.charAt(g.length)==="/"),I={isActive:A,isPending:b,isTransitioning:f},j=A?o:void 0,R;typeof i=="function"?R=i(I):R=[i,A?"active":null,b?"pending":null,f?"transitioning":null].filter(Boolean).join(" ");let F=typeof l=="function"?l(I):l;return u.createElement(wy,ks({},p,{"aria-current":j,className:R,ref:n,style:F,to:c,viewTransition:d}),typeof h=="function"?h(I):h)});var vl;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(vl||(vl={}));var Hu;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Hu||(Hu={}));function Ey(e){let t=u.useContext(Bs);return t||ct(!1),t}function Cy(e,t){let{target:n,replace:o,state:r,preventScrollReset:i,relative:a,viewTransition:l}=t===void 0?{}:t,c=Cf(),d=yi(),h=Vs(e,{relative:a});return u.useCallback(p=>{if(uy(p,n)){p.preventDefault();let y=o!==void 0?o:ai(d)===ai(h);c(e,{replace:y,state:r,preventScrollReset:i,relative:a,viewTransition:l})}},[d,c,h,o,r,n,e,i,a,l])}function ky(e,t){t===void 0&&(t={});let n=u.useContext(gy);n==null&&ct(!1);let{basename:o}=Ey(vl.useViewTransitionState),r=Vs(e,{relative:t.relative});if(!n.isTransitioning)return!1;let i=gr(n.currentLocation.pathname,o)||n.currentLocation.pathname,a=gr(n.nextLocation.pathname,o)||n.nextLocation.pathname;return Es(r.pathname,a)!=null||Es(r.pathname,i)!=null}const Ty="modulepreload",by=function(e,t){return new URL(e,t).href},Ku={},uo=function(t,n,o){if(!n||n.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=by(i,o),i in Ku)return;Ku[i]=!0;const a=i.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!o)for(let h=r.length-1;h>=0;h--){const p=r[h];if(p.href===i&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Ty,a||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),a)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})},Ny={nav:{console:"Console",library:"Libreria",settings:"Impostazioni",streaming:"Streaming"},console:{deckA:"Deck A",deckB:"Deck B",mixer:"Mixer",mixerDesc:"Sposta per mixare i deck",transitionType:"Tipo di Transizione",volumeControl:"Controllo Volume",linear:"Lineare",smooth:"Fluida",sharp:"Rapida",play:"Play",pause:"Pausa",stop:"Stop",skipBackward:"Indietro (-10s)",skipForward:"Avanti (+10s)",volume:"Volume",pitch:"Pitch",noTrack:"Nessuna traccia caricata",loading:"Caricamento..."},library:{title:"Libreria Musicale",description:"Gestisci la tua collezione musicale",search:"Cerca titolo, artista...",selectFolder:"Seleziona Cartella",loadFolder:"Carica Cartella",importMusic:"Importa Musica",totalTracks:"Totale tracce",duration:"Durata",artist:"Artista",trackTitle:"Titolo",album:"Album",genre:"Genere",year:"Anno",bpm:"BPM",key:"Tonalità",noTracks:"Nessuna traccia trovata",loadToDeck:"Carica nel Deck",analyzing:"Analizzando...",analyzed:"Analizzato",error:"Errore"},settings:{title:"Impostazioni",description:"Configura le preferenze del DJ Console",reset:"Reset",save:"Salva",audio:"Audio",microphone:"Microfono",interface:"Interfaccia",recording:"Registrazione",streaming:"Streaming",advanced:"Avanzate",info:"Info",advancedSettings:"Impostazioni Avanzate",dataManagement:"Gestione Dati",exportSettings:"Esporta Impostazioni",importSettings:"Importa Impostazioni",resetOptions:"Opzioni Reset",resetAudioSettings:"Reset Impostazioni Audio",resetAudioSettingsDesc:"Ripristina configurazione audio predefinita",resetInterfaceSettings:"Reset Impostazioni Interfaccia",resetInterfaceSettingsDesc:"Ripristina preferenze interfaccia predefinite",resetAllSettings:"Reset Tutte le Impostazioni",resetAllSettingsDesc:"Ripristina tutte le impostazioni predefinite",about:"Informazioni",version:"Versione",build:"Build",license:"Licenza",author:"Autore",systemInfo:"Informazioni Sistema",appInfo:"Informazioni App",libraries:"Librerie Utilizzate",checkUpdates:"Verifica Aggiornamenti",lastChecked:"Ultima verifica",checkingUpdates:"Verificando aggiornamenti...",noUpdates:"Nessun aggiornamento disponibile",updatesAvailable:"Aggiornamenti disponibili",checkNow:"Verifica Ora",updateUrl:"URL Aggiornamenti",libraryName:"Nome Libreria",libraryVersion:"Versione",libraryLicense:"Licenza",libraryDescription:"Descrizione",audioSettings:"Impostazioni Audio",sampleRate:"Frequenza di Campionamento",bitDepth:"Profondità Bit",bufferSize:"Dimensione Buffer",latency:"Latenza",crossfadeDuration:"Durata Crossfade",fadeInOut:"Fade In/Out Tracce",outputDevice:"Dispositivo di Uscita",outputDeviceLocal:"Dispositivo di Uscita (Locale)",masterVolume:"Volume Master",microphoneSettings:"Impostazioni Microfono",inputDevice:"Dispositivo di Ingresso",inputGain:"Guadagno Ingresso",monitorLevel:"Livello Monitor",echoCancellation:"Cancellazione Eco",noiseSuppression:"Soppressione Rumore",autoGainControl:"Controllo Guadagno Automatico",duckingPercent:"Percentuale Ducking (Abbassa Musica)",pushToTalkKey:"Tasto Push-to-Talk",interfaceSettings:"Impostazioni Interfaccia",theme:"Tema",language:"Lingua",showWaveforms:"Mostra Forme d'Onda",showSpectrum:"Mostra Analizzatore di Spettro",showBeatGrid:"Mostra Griglia Beat",enableAnimations:"Abilita Animazioni",autoRecord:"Registrazione Automatica",saveLocation:"Posizione Salvataggio",maxFileSize:"Dimensione Massima File (MB)",defaultBitrate:"Bitrate Predefinito",defaultFormat:"Formato Predefinito",autoConnect:"Connessione Automatica",reconnectAttempts:"Tentativi Riconnessione",serverHost:"Host Server",serverPort:"Porta Server",mountPoint:"Punto di Mount",username:"Nome Utente",password:"Password",useSSL:"Usa SSL",stationName:"Nome Stazione",stationUrl:"URL Stazione",genre:"Genere",systemInfo:"Informazioni Sistema",microphonePermissions:"Permessi Microfono",microphoneAccess:"Accesso Microfono",microphoneAccessDesc:"Il browser ha accesso al microfono per la funzionalità DJ.",testMicrophoneAccess:"Testa Accesso Microfono",microphonePermissionGranted:"Permesso microfono concesso!",microphonePermissionDenied:"Permesso microfono negato. Controlla le impostazioni del browser.",browserInfo:"Informazioni Browser",browser:"Browser",platform:"Piattaforma",audioDevices:"Dispositivi Audio",inputDevices:"Dispositivi di Input",outputDevices:"Dispositivi di Output",devicesFound:"dispositivi trovati",noDevicesFound:"Nessun dispositivo trovato",refreshDevices:"Aggiorna Dispositivi",appInfo:"Informazioni App",version:"Versione",build:"Build",license:"Licenza",author:"Autore"},themes:{dark:"🌙 Scuro",light:"☀️ Chiaro",infernal:"🔥 Infernale",auto:"🔄 Automatico"},languages:{it:"🇮🇹 Italiano",en:"🇬🇧 English",es:"🇪🇸 Español",fr:"🇫🇷 Français",de:"🇩🇪 Deutsch"},recording:{title:"Impostazioni Registrazione",format:"Formato",quality:"Qualità",autoRecord:"Registrazione Automatica",saveLocation:"Posizione Salvataggio",maxFileSize:"Dimensione Massima File (MB)"},streaming:{title:"Impostazioni Streaming",description:"Gestisci la trasmissione live",status:"Stato",connect:"Connetti",disconnect:"Disconnetti",connected:"Connesso",disconnected:"Disconnesso",connecting:"Connettendo...",error:"Errore",listeners:"Ascoltatori",bitrate:"Bitrate",format:"Formato",channels:"Canali",sampleRate:"Frequenza Campionamento",uptime:"Tempo di Trasmissione",sendMic:"Invia Microfono",micVolume:"Volume Microfono",pushToTalk:"Push-to-Talk",metadata:"Metadati",currentTrack:"Traccia Corrente",nextTrack:"Prossima Traccia",defaultBitrate:"Bitrate Predefinito",defaultFormat:"Formato Predefinito",autoConnect:"Connessione Automatica",reconnectAttempts:"Tentativi Riconnessione",serverHost:"Host Server",serverPort:"Porta Server",mountPoint:"Punto di Mount",username:"Nome Utente",password:"Password",showPassword:"Mostra Password",hidePassword:"Nascondi Password",useSSL:"Usa SSL",stationName:"Nome Stazione",stationUrl:"URL Stazione",genre:"Genere"},common:{loading:"Caricamento...",error:"Errore",success:"Successo",warning:"Attenzione",info:"Informazione",confirm:"Conferma",cancel:"Annulla",ok:"OK",yes:"Sì",no:"No",enabled:"Abilitato",disabled:"Disabilitato",on:"Acceso",off:"Spento",high:"Alto",medium:"Medio",low:"Basso"},errors:{audioContextFailed:"Impossibile inizializzare il contesto audio",microphoneAccessDenied:"Accesso al microfono negato",fileLoadError:"Errore nel caricamento del file",streamingConnectionFailed:"Connessione streaming fallita",settingsSaveFailed:"Salvataggio impostazioni fallito",databaseError:"Errore del database",unknownError:"Errore sconosciuto"}},Ay={nav:{console:"Console",library:"Library",settings:"Settings",streaming:"Streaming"},console:{deckA:"Deck A",deckB:"Deck B",mixer:"Mixer",mixerDesc:"Move to mix decks",transitionType:"Transition Type",volumeControl:"Volume Control",linear:"Linear",smooth:"Smooth",sharp:"Sharp",play:"Play",pause:"Pause",stop:"Stop",skipBackward:"Skip Backward (-10s)",skipForward:"Skip Forward (+10s)",volume:"Volume",pitch:"Pitch",noTrack:"No track loaded",loading:"Loading..."},library:{title:"Music Library",description:"Manage your music collection",search:"Search title, artist...",selectFolder:"Select Folder",loadFolder:"Load Folder",importMusic:"Import Music",totalTracks:"Total tracks",duration:"Duration",artist:"Artist",trackTitle:"Title",album:"Album",genre:"Genre",year:"Year",bpm:"BPM",key:"Key",noTracks:"No tracks found",loadToDeck:"Load to Deck",analyzing:"Analyzing...",analyzed:"Analyzed",error:"Error"},settings:{title:"Settings",description:"Configure your DJ Console preferences",reset:"Reset",save:"Save",audio:"Audio",microphone:"Microphone",interface:"Interface",recording:"Recording",streaming:"Streaming",advanced:"Advanced",info:"Info",advancedSettings:"Advanced Settings",dataManagement:"Data Management",exportSettings:"Export Settings",importSettings:"Import Settings",resetOptions:"Reset Options",resetAudioSettings:"Reset Audio Settings",resetAudioSettingsDesc:"Restore default audio configuration",resetInterfaceSettings:"Reset Interface Settings",resetInterfaceSettingsDesc:"Restore default interface preferences",resetAllSettings:"Reset All Settings",resetAllSettingsDesc:"Restore all default settings",about:"About",version:"Version",build:"Build",license:"License",author:"Author",systemInfo:"System Information",appInfo:"App Information",libraries:"Used Libraries",checkUpdates:"Check for Updates",lastChecked:"Last checked",checkingUpdates:"Checking for updates...",noUpdates:"No updates available",updatesAvailable:"Updates available",checkNow:"Check Now",updateUrl:"Update URL",libraryName:"Library Name",libraryVersion:"Version",libraryLicense:"License",libraryDescription:"Description",audioSettings:"Audio Settings",sampleRate:"Sample Rate",bufferSize:"Buffer Size",outputDevice:"Output Device",outputDeviceLocal:"Output Device (Local)",masterVolume:"Master Volume",crossfaderCurve:"Crossfader Curve",microphoneSettings:"Microphone Settings",inputDevice:"Input Device",inputGain:"Input Gain",monitorLevel:"Monitor Level",echoCancellation:"Echo Cancellation",noiseSuppression:"Noise Suppression",autoGainControl:"Auto Gain Control",duckingPercent:"Ducking Percent",pushToTalkKey:"Push-to-Talk Key",interfaceSettings:"Interface Settings",theme:"Theme",language:"Language",showWaveforms:"Show Waveforms",showSpectrum:"Show Spectrum Analyzer",showBeatGrid:"Show Beat Grid",enableAnimations:"Enable Animations"},themes:{dark:"🌙 Dark",light:"☀️ Light",infernal:"🔥 Infernal",auto:"🔄 Auto"},languages:{it:"🇮🇹 Italiano",en:"🇬🇧 English",es:"🇪🇸 Español",fr:"🇫🇷 Français",de:"🇩🇪 Deutsch"},recording:{title:"Recording Settings",format:"Format",quality:"Quality",autoRecord:"Auto Record",saveLocation:"Save Location",maxFileSize:"Max File Size (MB)"},streaming:{title:"Streaming Settings",description:"Manage live broadcasting",status:"Status",connect:"Connect",disconnect:"Disconnect",connected:"Connected",disconnected:"Disconnected",connecting:"Connecting...",error:"Error",listeners:"Listeners",bitrate:"Bitrate",format:"Format",channels:"Channels",sampleRate:"Sample Rate",uptime:"Uptime",sendMic:"Send Microphone",micVolume:"Microphone Volume",pushToTalk:"Push-to-Talk",metadata:"Metadata",currentTrack:"Current Track",nextTrack:"Next Track",defaultBitrate:"Default Bitrate",defaultFormat:"Default Format",autoConnect:"Auto Connect",reconnectAttempts:"Reconnect Attempts",serverHost:"Server Host",serverPort:"Server Port",mountPoint:"Mount Point",username:"Username",password:"Password",showPassword:"Show Password",hidePassword:"Hide Password",useSSL:"Use SSL",stationName:"Station Name",stationUrl:"Station URL",genre:"Genre",systemInfo:"System Information",microphonePermissions:"Microphone Permissions",microphoneAccess:"Microphone Access",microphoneAccessDesc:"Browser has access to microphone for DJ functionality.",testMicrophoneAccess:"Test Microphone Access",microphonePermissionGranted:"Microphone permission granted!",microphonePermissionDenied:"Microphone permission denied. Check browser settings.",browserInfo:"Browser Information",browser:"Browser",platform:"Platform",language:"Language",audioDevices:"Audio Devices",inputDevices:"Input Devices",outputDevices:"Output Devices",devicesFound:"devices found",noDevicesFound:"No devices found",refreshDevices:"Refresh Devices",appInfo:"App Information",version:"Version",build:"Build",license:"License",author:"Author"},common:{loading:"Loading...",error:"Error",success:"Success",warning:"Warning",info:"Information",confirm:"Confirm",cancel:"Cancel",ok:"OK",yes:"Yes",no:"No",enabled:"Enabled",disabled:"Disabled",on:"On",off:"Off",high:"High",medium:"Medium",low:"Low"},errors:{audioContextFailed:"Failed to initialize audio context",microphoneAccessDenied:"Microphone access denied",fileLoadError:"File loading error",streamingConnectionFailed:"Streaming connection failed",settingsSaveFailed:"Settings save failed",databaseError:"Database error",unknownError:"Unknown error"}},Dy={nav:{console:"Consola",library:"Biblioteca",settings:"Configuración",streaming:"Transmisión"},console:{deckA:"Deck A",deckB:"Deck B",mixer:"Mezclador",mixerDesc:"Mueve para mezclar los decks",transitionType:"Tipo de Transición",volumeControl:"Control de Volumen",linear:"Lineal",smooth:"Suave",sharp:"Rápida",play:"Reproducir",pause:"Pausa",stop:"Parar",skipBackward:"Atrás (-10s)",skipForward:"Adelante (+10s)",volume:"Volumen",pitch:"Tono",noTrack:"Ninguna pista cargada",loading:"Cargando..."},library:{title:"Biblioteca Musical",description:"Gestiona tu colección musical",search:"Buscar título, artista...",selectFolder:"Seleccionar Carpeta",loadFolder:"Cargar Carpeta",importMusic:"Importar Música",totalTracks:"Total pistas",duration:"Duración",artist:"Artista",trackTitle:"Título",album:"Álbum",genre:"Género",year:"Año",bpm:"BPM",key:"Clave",noTracks:"No se encontraron pistas",loadToDeck:"Cargar al Deck",analyzing:"Analizando...",analyzed:"Analizado",error:"Error"},settings:{title:"Configuración",description:"Configura las preferencias de DJ Console",reset:"Restablecer",save:"Guardar",audio:"Audio",microphone:"Micrófono",interface:"Interfaz",recording:"Grabación",streaming:"Transmisión",advanced:"Avanzado",info:"Info",advancedSettings:"Configuración Avanzada",dataManagement:"Gestión de Datos",exportSettings:"Exportar Configuración",importSettings:"Importar Configuración",resetOptions:"Opciones de Reset",resetAudioSettings:"Reset Configuración Audio",resetAudioSettingsDesc:"Restaurar configuración de audio predeterminada",resetInterfaceSettings:"Reset Configuración Interfaz",resetInterfaceSettingsDesc:"Restaurar preferencias de interfaz predeterminadas",resetAllSettings:"Reset Toda la Configuración",resetAllSettingsDesc:"Restaurar toda la configuración predeterminada",about:"Acerca de",version:"Versión",build:"Build",license:"Licencia",author:"Autor",audioSettings:"Configuración de Audio",sampleRate:"Frecuencia de Muestreo",bitDepth:"Profundidad de Bits",bufferSize:"Tamaño del Buffer",latency:"Latencia",crossfadeDuration:"Duración del Crossfade",fadeInOut:"Fade In/Out de Pistas",outputDevice:"Dispositivo de Salida",outputDeviceLocal:"Dispositivo de Salida (Local)",masterVolume:"Volumen Principal",microphoneSettings:"Configuración del Micrófono",inputDevice:"Dispositivo de Entrada",inputGain:"Ganancia de Entrada",monitorLevel:"Nivel de Monitor",echoCancellation:"Cancelación de Eco",noiseSuppression:"Supresión de Ruido",autoGainControl:"Control Automático de Ganancia",duckingPercent:"Porcentaje de Ducking (Baja Música)",pushToTalkKey:"Tecla Push-to-Talk",interfaceSettings:"Configuración de Interfaz",theme:"Tema",language:"Idioma",showWaveforms:"Mostrar Formas de Onda",showSpectrum:"Mostrar Analizador de Espectro",showBeatGrid:"Mostrar Rejilla de Beat",enableAnimations:"Habilitar Animaciones"},themes:{dark:"🌙 Oscuro",light:"☀️ Claro",infernal:"🔥 Infernal",auto:"🔄 Automático"},languages:{it:"🇮🇹 Italiano",en:"🇬🇧 English",es:"🇪🇸 Español",fr:"🇫🇷 Français",de:"🇩🇪 Deutsch"},recording:{title:"Configuración de Grabación",format:"Formato",quality:"Calidad",autoRecord:"Grabación Automática",saveLocation:"Ubicación de Guardado",maxFileSize:"Tamaño Máximo de Archivo (MB)"},streaming:{title:"Configuración de Transmisión",description:"Gestiona la transmisión en vivo",status:"Estado",connect:"Conectar",disconnect:"Desconectar",connected:"Conectado",disconnected:"Desconectado",connecting:"Conectando...",error:"Error",listeners:"Oyentes",bitrate:"Bitrate",format:"Formato",channels:"Canales",sampleRate:"Frecuencia de Muestreo",uptime:"Tiempo de Transmisión",sendMic:"Enviar Micrófono",micVolume:"Volumen del Micrófono",pushToTalk:"Push-to-Talk",metadata:"Metadatos",currentTrack:"Pista Actual",nextTrack:"Siguiente Pista",defaultBitrate:"Bitrate Predeterminado",defaultFormat:"Formato Predeterminado",autoConnect:"Conexión Automática",reconnectAttempts:"Intentos de Reconexión",serverHost:"Host del Servidor",serverPort:"Puerto del Servidor",mountPoint:"Punto de Montaje",username:"Nombre de usuario",password:"Contraseña",showPassword:"Mostrar contraseña",hidePassword:"Ocultar contraseña",useSSL:"Usar SSL",stationName:"Nombre de la Estación",stationUrl:"URL de la Estación",genre:"Género"},common:{loading:"Cargando...",error:"Error",success:"Éxito",warning:"Advertencia",info:"Información",confirm:"Confirmar",cancel:"Cancelar",ok:"OK",yes:"Sí",no:"No",enabled:"Habilitado",disabled:"Deshabilitado",on:"Encendido",off:"Apagado",high:"Alto",medium:"Medio",low:"Bajo"},errors:{audioContextFailed:"No se pudo inicializar el contexto de audio",microphoneAccessDenied:"Acceso al micrófono denegado",fileLoadError:"Error al cargar archivo",streamingConnectionFailed:"Falló la conexión de transmisión",settingsSaveFailed:"Falló el guardado de configuración",databaseError:"Error de base de datos",unknownError:"Error desconocido"}},jy={nav:{console:"Console",library:"Bibliothèque",settings:"Paramètres",streaming:"Streaming"},console:{deckA:"Deck A",deckB:"Deck B",mixer:"Mixeur",mixerDesc:"Déplacer pour mixer les decks",transitionType:"Type de Transition",volumeControl:"Contrôle du Volume",linear:"Linéaire",smooth:"Fluide",sharp:"Rapide",play:"Lecture",pause:"Pause",stop:"Arrêt",skipBackward:"Retour (-10s)",skipForward:"Avance (+10s)",volume:"Volume",pitch:"Hauteur",noTrack:"Aucune piste chargée",loading:"Chargement..."},library:{title:"Bibliothèque Musicale",description:"Gérez votre collection musicale",search:"Rechercher titre, artiste...",selectFolder:"Sélectionner Dossier",loadFolder:"Charger Dossier",importMusic:"Importer Musique",totalTracks:"Total pistes",duration:"Durée",artist:"Artiste",trackTitle:"Titre",album:"Album",genre:"Genre",year:"Année",bpm:"BPM",key:"Tonalité",noTracks:"Aucune piste trouvée",loadToDeck:"Charger sur Deck",analyzing:"Analyse...",analyzed:"Analysé",error:"Erreur"},settings:{title:"Paramètres",description:"Configurez vos préférences DJ Console",reset:"Réinitialiser",save:"Sauvegarder",audio:"Audio",microphone:"Microphone",interface:"Interface",recording:"Enregistrement",streaming:"Streaming",advanced:"Avancé",info:"Info",advancedSettings:"Paramètres Avancés",dataManagement:"Gestion des Données",exportSettings:"Exporter les Paramètres",importSettings:"Importer les Paramètres",resetOptions:"Options de Reset",resetAudioSettings:"Reset Paramètres Audio",resetAudioSettingsDesc:"Restaurer la configuration audio par défaut",resetInterfaceSettings:"Reset Paramètres Interface",resetInterfaceSettingsDesc:"Restaurer les préférences d'interface par défaut",resetAllSettings:"Reset Tous les Paramètres",resetAllSettingsDesc:"Restaurer tous les paramètres par défaut",about:"À Propos",version:"Version",build:"Build",license:"Licence",author:"Auteur",audioSettings:"Paramètres Audio",sampleRate:"Fréquence d'Échantillonnage",bitDepth:"Profondeur de Bits",bufferSize:"Taille du Buffer",latency:"Latence",crossfadeDuration:"Durée du Crossfade",fadeInOut:"Fade In/Out des Pistes",outputDevice:"Périphérique de Sortie",outputDeviceLocal:"Périphérique de Sortie (Local)",masterVolume:"Volume Principal",microphoneSettings:"Paramètres du Microphone",inputDevice:"Périphérique d'Entrée",inputGain:"Gain d'Entrée",monitorLevel:"Niveau de Monitoring",echoCancellation:"Suppression d'Écho",noiseSuppression:"Suppression de Bruit",autoGainControl:"Contrôle Automatique du Gain",duckingPercent:"Pourcentage de Ducking (Baisse Musique)",pushToTalkKey:"Touche Push-to-Talk",interfaceSettings:"Paramètres d'Interface",theme:"Thème",language:"Langue",showWaveforms:"Afficher les Formes d'Onde",showSpectrum:"Afficher l'Analyseur de Spectre",showBeatGrid:"Afficher la Grille de Beat",enableAnimations:"Activer les Animations"},themes:{dark:"🌙 Sombre",light:"☀️ Clair",infernal:"🔥 Infernal",auto:"🔄 Automatique"},languages:{it:"🇮🇹 Italiano",en:"🇬🇧 English",es:"🇪🇸 Español",fr:"🇫🇷 Français",de:"🇩🇪 Deutsch"},recording:{title:"Paramètres d'Enregistrement",format:"Format",quality:"Qualité",autoRecord:"Enregistrement Automatique",saveLocation:"Emplacement de Sauvegarde",maxFileSize:"Taille Maximale de Fichier (MB)"},streaming:{title:"Paramètres de Streaming",description:"Gérer la diffusion en direct",status:"Statut",connect:"Connecter",disconnect:"Déconnecter",connected:"Connecté",disconnected:"Déconnecté",connecting:"Connexion...",error:"Erreur",listeners:"Auditeurs",bitrate:"Bitrate",format:"Format",channels:"Canaux",sampleRate:"Fréquence d'Échantillonnage",uptime:"Temps de Diffusion",sendMic:"Envoyer Microphone",micVolume:"Volume du Microphone",pushToTalk:"Push-to-Talk",metadata:"Métadonnées",currentTrack:"Piste Actuelle",nextTrack:"Piste Suivante",defaultBitrate:"Bitrate par Défaut",defaultFormat:"Format par Défaut",autoConnect:"Connexion Automatique",reconnectAttempts:"Tentatives de Reconnexion",serverHost:"Hôte du Serveur",serverPort:"Port du Serveur",mountPoint:"Point de Montage",username:"Nom d'utilisateur",password:"Mot de passe",showPassword:"Afficher le mot de passe",hidePassword:"Masquer le mot de passe",useSSL:"Utiliser SSL",stationName:"Nom de la Station",stationUrl:"URL de la Station",genre:"Genre"},common:{loading:"Chargement...",error:"Erreur",success:"Succès",warning:"Avertissement",info:"Information",confirm:"Confirmer",cancel:"Annuler",ok:"OK",yes:"Oui",no:"Non",enabled:"Activé",disabled:"Désactivé",on:"Allumé",off:"Éteint",high:"Élevé",medium:"Moyen",low:"Bas"},errors:{audioContextFailed:"Impossible d'initialiser le contexte audio",microphoneAccessDenied:"Accès au microphone refusé",fileLoadError:"Erreur de chargement de fichier",streamingConnectionFailed:"Échec de la connexion streaming",settingsSaveFailed:"Échec de la sauvegarde des paramètres",databaseError:"Erreur de base de données",unknownError:"Erreur inconnue"}},Ry={nav:{console:"Konsole",library:"Bibliothek",settings:"Einstellungen",streaming:"Streaming"},console:{deckA:"Deck A",deckB:"Deck B",mixer:"Mixer",mixerDesc:"Bewegen zum Mischen der Decks",transitionType:"Übergangstyp",volumeControl:"Lautstärkeregelung",linear:"Linear",smooth:"Sanft",sharp:"Scharf",play:"Abspielen",pause:"Pause",stop:"Stopp",skipBackward:"Zurück (-10s)",skipForward:"Vorwärts (+10s)",volume:"Lautstärke",pitch:"Tonhöhe",noTrack:"Kein Track geladen",loading:"Laden..."},library:{title:"Musikbibliothek",description:"Verwalte deine Musiksammlung",search:"Titel, Künstler suchen...",selectFolder:"Ordner Auswählen",loadFolder:"Ordner Laden",importMusic:"Musik Importieren",totalTracks:"Gesamte Tracks",duration:"Dauer",artist:"Künstler",trackTitle:"Titel",album:"Album",genre:"Genre",year:"Jahr",bpm:"BPM",key:"Tonart",noTracks:"Keine Tracks gefunden",loadToDeck:"Zu Deck Laden",analyzing:"Analysiere...",analyzed:"Analysiert",error:"Fehler"},settings:{title:"Einstellungen",description:"Konfiguriere deine DJ Console Einstellungen",reset:"Zurücksetzen",save:"Speichern",audio:"Audio",microphone:"Mikrofon",interface:"Oberfläche",recording:"Aufnahme",streaming:"Streaming",advanced:"Erweitert",info:"Info",advancedSettings:"Erweiterte Einstellungen",dataManagement:"Datenverwaltung",exportSettings:"Einstellungen Exportieren",importSettings:"Einstellungen Importieren",resetOptions:"Reset-Optionen",resetAudioSettings:"Audio-Einstellungen Zurücksetzen",resetAudioSettingsDesc:"Standard-Audiokonfiguration wiederherstellen",resetInterfaceSettings:"Interface-Einstellungen Zurücksetzen",resetInterfaceSettingsDesc:"Standard-Interface-Präferenzen wiederherstellen",resetAllSettings:"Alle Einstellungen Zurücksetzen",resetAllSettingsDesc:"Alle Standardeinstellungen wiederherstellen",about:"Über",version:"Version",build:"Build",license:"Lizenz",author:"Autor",audioSettings:"Audio-Einstellungen",sampleRate:"Abtastrate",bitDepth:"Bit-Tiefe",bufferSize:"Puffergröße",latency:"Latenz",crossfadeDuration:"Crossfade-Dauer",fadeInOut:"Fade In/Out Tracks",outputDevice:"Ausgabegerät",outputDeviceLocal:"Ausgabegerät (Lokal)",masterVolume:"Master-Lautstärke",microphoneSettings:"Mikrofon-Einstellungen",inputDevice:"Eingabegerät",inputGain:"Eingangsverstärkung",monitorLevel:"Monitor-Pegel",echoCancellation:"Echo-Unterdrückung",noiseSuppression:"Rauschunterdrückung",autoGainControl:"Automatische Verstärkungsregelung",duckingPercent:"Ducking-Prozent (Musik Senken)",pushToTalkKey:"Push-to-Talk Taste",interfaceSettings:"Oberflächen-Einstellungen",theme:"Theme",language:"Sprache",showWaveforms:"Wellenformen Anzeigen",showSpectrum:"Spektrum-Analyzer Anzeigen",showBeatGrid:"Beat-Raster Anzeigen",enableAnimations:"Animationen Aktivieren"},themes:{dark:"🌙 Dunkel",light:"☀️ Hell",infernal:"🔥 Infernal",auto:"🔄 Automatisch"},languages:{it:"🇮🇹 Italiano",en:"🇬🇧 English",es:"🇪🇸 Español",fr:"🇫🇷 Français",de:"🇩🇪 Deutsch"},recording:{title:"Aufnahme-Einstellungen",format:"Format",quality:"Qualität",autoRecord:"Automatische Aufnahme",saveLocation:"Speicherort",maxFileSize:"Maximale Dateigröße (MB)"},streaming:{title:"Streaming-Einstellungen",description:"Live-Übertragung verwalten",status:"Status",connect:"Verbinden",disconnect:"Trennen",connected:"Verbunden",disconnected:"Getrennt",connecting:"Verbinde...",error:"Fehler",listeners:"Zuhörer",bitrate:"Bitrate",format:"Format",channels:"Kanäle",sampleRate:"Abtastrate",uptime:"Sendezeit",sendMic:"Mikrofon Senden",micVolume:"Mikrofon-Lautstärke",pushToTalk:"Push-to-Talk",metadata:"Metadaten",currentTrack:"Aktueller Track",nextTrack:"Nächster Track",defaultBitrate:"Standard-Bitrate",defaultFormat:"Standard-Format",autoConnect:"Automatisch Verbinden",reconnectAttempts:"Wiederverbindungsversuche",serverHost:"Server-Host",serverPort:"Server-Port",mountPoint:"Mount-Point",username:"Benutzername",password:"Passwort",showPassword:"Passwort anzeigen",hidePassword:"Passwort ausblenden",useSSL:"SSL verwenden",stationName:"Sender-Name",stationUrl:"Sender-URL",genre:"Genre"},common:{loading:"Laden...",error:"Fehler",success:"Erfolg",warning:"Warnung",info:"Information",confirm:"Bestätigen",cancel:"Abbrechen",ok:"OK",yes:"Ja",no:"Nein",enabled:"Aktiviert",disabled:"Deaktiviert",on:"Ein",off:"Aus",high:"Hoch",medium:"Mittel",low:"Niedrig"},errors:{audioContextFailed:"Audio-Kontext konnte nicht initialisiert werden",microphoneAccessDenied:"Mikrofon-Zugriff verweigert",fileLoadError:"Datei-Ladefehler",streamingConnectionFailed:"Streaming-Verbindung fehlgeschlagen",settingsSaveFailed:"Speichern der Einstellungen fehlgeschlagen",databaseError:"Datenbankfehler",unknownError:"Unbekannter Fehler"}},Br={it:Ny,en:Ay,es:Dy,fr:jy,de:Ry};let Hs="it";function Df(e,t){const n=t||Hs,o=e.split(".");let r=Br[n]||Br.it;for(const i of o)if(r=r==null?void 0:r[i],r===void 0){r=Br.it;for(const a of o)if(r=r==null?void 0:r[a],r===void 0)return console.warn(`Translation key not found: ${e}`),e;break}return typeof r=="string"?r:e}function pc(e){Br[e]&&(Hs=e,window.dispatchEvent(new CustomEvent("language-changed",{detail:e})))}function Iy(){return Hs}function My(){return Object.keys(Br)}function yc(){const[,e]=u.useState({});return u.useEffect(()=>{const t=()=>{e({})};return window.addEventListener("language-changed",t),()=>window.removeEventListener("language-changed",t)},[]),{t:t=>Df(t),language:Hs,setLanguage:pc}}const Py=Object.freeze(Object.defineProperty({__proto__:null,getAvailableLanguages:My,getCurrentLanguage:Iy,setLanguage:pc,t:Df,useTranslation:yc},Symbol.toStringTag,{value:"Module"})),Ly=()=>{const{t:e}=yc(),t=[{path:"/",label:e("nav.console")},{path:"/library",label:"Libreria & Playlist"},{path:"/settings",label:e("nav.settings")}];return s.jsx("header",{className:"w-full bg-dj-primary border-b border-dj-accent/30",children:s.jsx("div",{className:"max-w-screen-2xl mx-auto px-4",children:s.jsxs("div",{className:"h-14 flex items-center justify-between",children:[s.jsx("div",{className:"text-white font-dj font-bold",children:"DJ Console Pro"}),s.jsx("nav",{className:"flex items-center space-x-1",children:t.map(n=>s.jsx(Sy,{to:n.path,className:({isActive:o})=>`flex items-center space-x-2 px-3 py-2 rounded-md text-sm transition-colors ${o?"bg-dj-accent text-white":"text-dj-light/80 hover:bg-dj-accent/20 hover:text-white"}`,children:s.jsx("span",{className:"font-medium",children:n.label})},n.path))})]})})})};var $y={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Oy=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Fy=(e,t)=>{const n=u.forwardRef(({color:o="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,children:l,...c},d)=>u.createElement("svg",{ref:d,...$y,width:r,height:r,stroke:o,strokeWidth:a?Number(i)*24/Number(r):i,className:`lucide lucide-${Oy(e)}`,...c},[...t.map(([h,p])=>u.createElement(h,p)),...(Array.isArray(l)?l:[l])||[]]));return n.displayName=`${e}`,n};var He=Fy;const Yi=He("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),zy=He("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),vc=He("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),_y=He("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Uy=He("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Ks=He("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),xc=He("Disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),By=He("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),jf=He("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]),Gy=He("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Wu=He("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),wc=He("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),mo=He("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),qu=He("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Sc=He("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),hr=He("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),jo=He("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),Vy=He("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Hy=He("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Ws=He("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ec=He("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),Cc=He("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Rf=He("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Ky=He("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),tn=He("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Xi=He("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Yu=He("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Xu=He("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),xl=He("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);class Wy{constructor(){U(this,"tracks",new Map);U(this,"playlists",new Map);U(this,"settings",this.getDefaultSettings());U(this,"isInitialized",!1);this.initialize()}emitUpdate(t){try{const n=new CustomEvent("djconsole:db-updated",{detail:{kind:t}});window.dispatchEvent(n)}catch{}}getDefaultSettings(){return{audio:{sampleRate:48e3,bitDepth:16,bufferSize:4096,latency:50,crossfadeDuration:3,fadeInOut:!0,outputDevice:"default"},microphone:{inputDevice:"default",sampleRate:48e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,duckingPercent:50,pushToTalkKey:"Space"},interface:{theme:"dark",language:"it",showWaveform:!0,showSpectrum:!0,showBeatGrid:!0,animations:!0},streaming:{defaultBitrate:128,defaultFormat:"opus",channels:2,autoConnect:!1,reconnectAttempts:5,bridgeUrl:"",icecastServers:[{id:"default-server",name:"RadioBoss Server",host:"82.145.63.6",port:5040,mount:"/stream:1",username:"source",password:"811126864dj",useSSL:!1,isDefault:!0},{id:"backup-server",name:"Backup Server",host:"dj.onlinewebone.com",port:8004,mount:"/live",username:"source",password:"inferno@inferno",useSSL:!1,isDefault:!1}],defaultIcecastServerId:"default-server",metadata:{stationName:"DJ Console Pro - Live",stationUrl:"https://dj.onlinewebone.com",genre:"Electronic/Live DJ"}}}}async initialize(){try{await this.loadFromStorage(),this.isInitialized=!0,console.log("LocalDatabase initialized successfully")}catch(t){console.error("Failed to initialize LocalDatabase:",t),this.createDefaultData()}}async loadFromStorage(){try{const t=window.dbStore;if(t&&typeof t.load=="function")try{const i=await t.load();if(i&&i.ok&&i.data){const a=i.data;if(Array.isArray(a.tracks)){let l=!1;for(const c of a.tracks){const d={...c};if(d.addedAt&&(d.addedAt=new Date(d.addedAt)),d.lastPlayed&&(d.lastPlayed=new Date(d.lastPlayed)),typeof d.url=="string"&&d.url.startsWith("blob:")&&!d.blobId){l=!0;continue}this.tracks.set(d.id,d)}l&&await this.saveToStorage()}Array.isArray(a.playlists)&&a.playlists.forEach(l=>{l.createdAt=new Date(l.createdAt),l.updatedAt=new Date(l.updatedAt),this.playlists.set(l.id,l)}),a.settings&&(this.settings={...this.settings,...a.settings});return}}catch(i){console.warn("dbStore.load failed, fallback to localStorage",i)}const n=localStorage.getItem("djconsole_tracks");if(n){const i=JSON.parse(n);let a=!1;for(const l of i){const c={...l};if(c.addedAt=new Date(c.addedAt),c.lastPlayed&&(c.lastPlayed=new Date(c.lastPlayed)),typeof c.url=="string"&&c.url.startsWith("blob:")&&!c.blobId){a=!0;continue}this.tracks.set(c.id,c)}a&&await this.saveToStorage()}const o=localStorage.getItem("djconsole_playlists");o&&JSON.parse(o).forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),this.playlists.set(a.id,a)});const r=localStorage.getItem("djconsole_settings");r&&(this.settings={...this.settings,...JSON.parse(r)})}catch(t){throw console.error("Error loading from storage:",t),t}}async saveToStorage(){try{const t=Array.from(this.tracks.values()).map(i=>{const a={...i};return a.fileUrl&&typeof a.fileUrl=="string"&&a.fileUrl.startsWith("file://")?a.url=a.fileUrl:a.blobId&&(a.url=`idb:${a.blobId}`),a}),n=Array.from(this.playlists.values()),o=this.settings,r=window.dbStore;if(r&&typeof r.save=="function")try{await r.save({tracks:t,playlists:n,settings:o})}catch(i){console.warn("dbStore.save failed, fallback to localStorage",i),localStorage.setItem("djconsole_tracks",JSON.stringify(t)),localStorage.setItem("djconsole_playlists",JSON.stringify(n)),localStorage.setItem("djconsole_settings",JSON.stringify(o))}else localStorage.setItem("djconsole_tracks",JSON.stringify(t)),localStorage.setItem("djconsole_playlists",JSON.stringify(n)),localStorage.setItem("djconsole_settings",JSON.stringify(o))}catch(t){throw console.error("Error saving to storage:",t),t}}createDefaultData(){[{id:"track_1",title:"Sample Track 1",artist:"Sample Artist",album:"Sample Album",genre:"Electronic",duration:180,bpm:128,key:"C",energy:"high",url:"/samples/track1.mp3",playCount:0,rating:0,addedAt:new Date},{id:"track_2",title:"Sample Track 2",artist:"Sample Artist",album:"Sample Album",genre:"House",duration:200,bpm:125,key:"F",energy:"medium",url:"/samples/track2.mp3",playCount:0,rating:0,addedAt:new Date}].forEach(o=>this.tracks.set(o.id,o));const n={id:"playlist_1",name:"Sample Playlist",description:"A sample playlist to get you started",tracks:["track_1","track_2"],isAutoPlaylist:!1,createdAt:new Date,updatedAt:new Date};this.playlists.set(n.id,n)}async addTrack(t){var r,i,a,l;const n=`track_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...t,id:n,playCount:0,rating:0,addedAt:new Date};try{(i=(r=window.log)==null?void 0:r.info)==null||i.call(r,`LocalDatabase.addTrack: ${n}`)}catch{}this.tracks.set(n,o);try{await this.saveToStorage(),this.emitUpdate("tracks")}catch(c){try{(l=(a=window.log)==null?void 0:a.error)==null||l.call(a,`saveToStorage error: ${c instanceof Error?c.message:String(c)}`)}catch{}throw c}return n}async updateTrack(t,n){const o=this.tracks.get(t);if(!o)return!1;const r={...o,...n};return this.tracks.set(t,r),await this.saveToStorage(),this.emitUpdate("tracks"),!0}async deleteTrack(t){const n=this.tracks.delete(t);return n&&(this.playlists.forEach(o=>{o.tracks=o.tracks.filter(r=>r!==t)}),await this.saveToStorage(),this.emitUpdate("tracks")),n}async getTrack(t){return this.tracks.get(t)||null}async getTrackResolved(t){const n=this.tracks.get(t);if(!n)return null;const o={...n};try{const{getBlobUrl:r}=await uo(()=>Promise.resolve().then(()=>Qu),void 0,import.meta.url);if(o.blobId){const i=await r(o.blobId);i&&(o.url=i)}else if(typeof o.url=="string"&&o.url.startsWith("idb:")){const i=o.url.slice(4),a=await r(i);a&&(o.url=a,o.blobId=i)}}catch{o.fileUrl&&o.fileUrl.startsWith("file://")&&(o.url=o.fileUrl)}return o}async getAllTracks(){const t=Array.from(this.tracks.values());try{const{getBlobUrl:n}=await uo(()=>Promise.resolve().then(()=>Qu),void 0,import.meta.url);await Promise.all(t.map(async o=>{try{if(o.blobId){const r=await n(o.blobId);r&&(o.url=r)}else if(typeof o.url=="string"&&o.url.startsWith("idb:")){const r=o.url.slice(4),i=await n(r);i&&(o.url=i,o.blobId=r)}}catch{o.fileUrl&&o.fileUrl.startsWith("file://")&&(o.url=o.fileUrl)}}))}catch{t.forEach(o=>{o.fileUrl&&o.fileUrl.startsWith("file://")&&(o.url=o.fileUrl)})}return t}async searchTracks(t,n){let o=Array.from(this.tracks.values());if(t){const r=t.toLowerCase();o=o.filter(i=>{var a,l;return i.title.toLowerCase().includes(r)||i.artist.toLowerCase().includes(r)||((a=i.album)==null?void 0:a.toLowerCase().includes(r))||((l=i.genre)==null?void 0:l.toLowerCase().includes(r))})}return n&&(n.genre&&(o=o.filter(r=>r.genre===n.genre)),n.bpmRange&&(o=o.filter(r=>r.bpm&&r.bpm>=n.bpmRange.min&&r.bpm<=n.bpmRange.max)),n.energy&&(o=o.filter(r=>r.energy===n.energy)),n.duration&&(o=o.filter(r=>r.duration>=n.duration.min&&r.duration<=n.duration.max))),o}async incrementPlayCount(t){const n=this.tracks.get(t);n&&(n.playCount++,n.lastPlayed=new Date,await this.saveToStorage())}async setRating(t,n){const o=this.tracks.get(t);o&&(o.rating=Math.max(0,Math.min(5,n)),await this.saveToStorage())}async createPlaylist(t){const n=`playlist_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o={...t,id:n,createdAt:new Date,updatedAt:new Date};return this.playlists.set(n,o),await this.saveToStorage(),this.emitUpdate("playlists"),n}async updatePlaylist(t,n){const o=this.playlists.get(t);if(!o)return!1;const r={...o,...n,updatedAt:new Date};return this.playlists.set(t,r),await this.saveToStorage(),this.emitUpdate("playlists"),!0}async deletePlaylist(t){const n=this.playlists.delete(t);return n&&(await this.saveToStorage(),this.emitUpdate("playlists")),n}async getPlaylist(t){return this.playlists.get(t)||null}async getAllPlaylists(){return Array.from(this.playlists.values())}async addTrackToPlaylist(t,n){const o=this.playlists.get(t);return o?(o.tracks.includes(n)||(o.tracks.push(n),o.updatedAt=new Date,await this.saveToStorage()),!0):!1}async removeTrackFromPlaylist(t,n){const o=this.playlists.get(t);if(!o)return!1;const r=o.tracks.indexOf(n);return r>-1&&(o.tracks.splice(r,1),o.updatedAt=new Date,await this.saveToStorage()),!0}async reorderPlaylist(t,n){const o=this.playlists.get(t);return o?(o.tracks=n,o.updatedAt=new Date,await this.saveToStorage(),!0):!1}async getSettings(){return{...this.settings}}async updateSettings(t){this.settings={...this.settings,...t},await this.saveToStorage(),this.emitUpdate("settings")}async getStats(){const t=Array.from(this.tracks.values()),n=Array.from(this.playlists.values()),o=t.reduce((l,c)=>l+c.duration*c.playCount,0),r=t.reduce((l,c)=>c.playCount>l.playCount?c:l,t[0]||null),i=new Map;t.forEach(l=>{l.genre&&i.set(l.genre,(i.get(l.genre)||0)+1)});const a=Array.from(i.entries()).map(([l,c])=>({genre:l,count:c})).sort((l,c)=>c.count-l.count).slice(0,5);return{totalTracks:t.length,totalPlaylists:n.length,totalPlayTime:o,mostPlayedTrack:r,topGenres:a}}async exportData(){const t={tracks:Array.from(this.tracks.values()),playlists:Array.from(this.playlists.values()),settings:this.settings,exportDate:new Date().toISOString()};return JSON.stringify(t,null,2)}async importData(t){try{const n=JSON.parse(t);return n.tracks&&(this.tracks.clear(),n.tracks.forEach(o=>{o.addedAt=new Date(o.addedAt),o.lastPlayed&&(o.lastPlayed=new Date(o.lastPlayed)),this.tracks.set(o.id,o)})),n.playlists&&(this.playlists.clear(),n.playlists.forEach(o=>{o.createdAt=new Date(o.createdAt),o.updatedAt=new Date(o.updatedAt),this.playlists.set(o.id,o)})),n.settings&&(this.settings={...this.settings,...n.settings}),await this.saveToStorage(),!0}catch(n){return console.error("Import failed:",n),!1}}async clearAllData(){this.tracks.clear(),this.playlists.clear(),this.settings=this.getDefaultSettings(),await this.saveToStorage()}async waitForInitialization(){if(!this.isInitialized)return new Promise(t=>{const n=()=>{this.isInitialized?t():setTimeout(n,100)};n()})}async getIcecastServers(){return this.settings.streaming.icecastServers||[]}async getDefaultIcecastServer(){const t=await this.getIcecastServers(),n=this.settings.streaming.defaultIcecastServerId;return n?t.find(o=>o.id===n)||t.find(o=>o.isDefault)||t[0]||null:t.find(o=>o.isDefault)||t[0]||null}async addIcecastServer(t){const n=`server-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o={...t,id:n};return this.settings.streaming.icecastServers.push(o),await this.saveToStorage(),this.emitUpdate("settings"),n}async updateIcecastServer(t,n){const o=this.settings.streaming.icecastServers.findIndex(r=>r.id===t);return o===-1?!1:(this.settings.streaming.icecastServers[o]={...this.settings.streaming.icecastServers[o],...n},await this.saveToStorage(),this.emitUpdate("settings"),!0)}async deleteIcecastServer(t){const n=this.settings.streaming.icecastServers.findIndex(o=>o.id===t);return n===-1?!1:(this.settings.streaming.icecastServers.splice(n,1),this.settings.streaming.defaultIcecastServerId===t&&(this.settings.streaming.defaultIcecastServerId=void 0),await this.saveToStorage(),this.emitUpdate("settings"),!0)}async setDefaultIcecastServer(t){const n=this.settings.streaming.icecastServers.find(o=>o.id===t);return n?(this.settings.streaming.icecastServers.forEach(o=>o.isDefault=!1),n.isDefault=!0,this.settings.streaming.defaultIcecastServerId=t,await this.saveToStorage(),this.emitUpdate("settings"),!0):!1}}const Y=new Wy,Ea=Object.freeze(Object.defineProperty({__proto__:null,default:Y,localDatabase:Y},Symbol.toStringTag,{value:"Module"})),qy="djconsole_blobs",ho="tracks",Yy=1;let $i=null;function kc(){return $i||($i=new Promise((e,t)=>{const n=indexedDB.open(qy,Yy);n.onupgradeneeded=()=>{const o=n.result;o.objectStoreNames.contains(ho)||o.createObjectStore(ho)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}),$i)}async function Xy(e,t){const n=await kc();await new Promise((o,r)=>{const l=n.transaction(ho,"readwrite").objectStore(ho).put(t,e);l.onsuccess=()=>o(),l.onerror=()=>r(l.error)})}async function ci(e){const t=await kc();return await new Promise((n,o)=>{const a=t.transaction(ho,"readonly").objectStore(ho).get(e);a.onsuccess=()=>n(a.result||null),a.onerror=()=>o(a.error)})}const Ro=new Map;async function Qy(e){if(Ro.has(e))return Ro.get(e);const t=await ci(e);if(!t)return null;const n=URL.createObjectURL(t);return Ro.set(e,n),n}async function Jy(e){const t=await kc();await new Promise((o,r)=>{const l=t.transaction(ho,"readwrite").objectStore(ho).delete(e);l.onsuccess=()=>o(),l.onerror=()=>r(l.error)});const n=Ro.get(e);n&&URL.revokeObjectURL(n),Ro.delete(e)}function Zy(){for(const[,e]of Ro)URL.revokeObjectURL(e);Ro.clear()}const Qu=Object.freeze(Object.defineProperty({__proto__:null,deleteBlob:Jy,getBlob:ci,getBlobUrl:Qy,putBlob:Xy,revokeAllUrls:Zy},Symbol.toStringTag,{value:"Module"})),bn={audio:{sampleRate:48e3,bitDepth:16,bufferSize:4096,latency:50,crossfadeDuration:3,fadeInOut:!0},microphone:{inputDevice:"default",sampleRate:48e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,duckingPercent:50,pushToTalkKey:"Space"},interface:{theme:"dark",language:"it",showWaveforms:!0,showSpectrum:!0,showBeatGrid:!0,animations:!0,autoAdvance:!1,playlistLoop:!0},recording:{format:"wav",quality:"high",autoRecord:!1,saveLocation:"/recordings",maxFileSize:100},streaming:{defaultBitrate:128,defaultFormat:"mp3",channels:2,autoConnect:!1,reconnectAttempts:5,icecastServers:[{id:"default-server",name:"RadioBoss Server",host:"82.145.63.6",port:5040,mount:"/stream",username:"source",password:"811126864dj",useSSL:!1,isDefault:!0},{id:"backup-server",name:"Backup Server",host:"dj.onlinewebone.com",port:8004,mount:"/live",username:"source",password:"inferno@inferno",useSSL:!1,isDefault:!1}],defaultIcecastServerId:"default-server",metadata:{stationName:"DJ Console Pro - Live",stationUrl:"https://dj.onlinewebone.com",genre:"Electronic/Live DJ"}}};function ev(e,t){switch(t.type){case"SET_SETTINGS":return t.payload;case"UPDATE_CATEGORY":return{...e,[t.payload.category]:{...e[t.payload.category],...t.payload.settings}};case"UPDATE_SETTING":const n=t.payload.key.split("."),o=t.payload.category;if(n.length===1)return{...e,[o]:{...e[o],[n[0]]:t.payload.value}};{const[r,i]=n;return{...e,[o]:{...e[o],[r]:{...e[o][r],[i]:t.payload.value}}}}case"RESET_SETTINGS":return bn;default:return e}}const If=u.createContext(void 0);function tv({children:e}){const[t,n]=u.useReducer(ev,bn),o=u.useRef(!1),r=x=>{var S,w;return{...bn,...x,audio:{...bn.audio,...x==null?void 0:x.audio},microphone:{...bn.microphone,...x==null?void 0:x.microphone},interface:{...bn.interface,...x==null?void 0:x.interface},recording:{...bn.recording,...x==null?void 0:x.recording},streaming:{...bn.streaming,...x==null?void 0:x.streaming,icecastServers:((S=x==null?void 0:x.streaming)==null?void 0:S.icecastServers)||bn.streaming.icecastServers,defaultIcecastServerId:((w=x==null?void 0:x.streaming)==null?void 0:w.defaultIcecastServerId)||bn.streaming.defaultIcecastServerId}}};u.useEffect(()=>{(async()=>{try{await Y.waitForInitialization();const S=await Y.getSettings();if(S){const w=r(S);n({type:"SET_SETTINGS",payload:w})}}catch(S){console.warn("Failed to load settings:",S)}finally{o.current=!0}})()},[]),u.useEffect(()=>{if(!o.current)return;(async()=>{try{await Y.updateSettings(t),c(t.interface.theme),d(t.interface.language),h(t.interface.showWaveforms,t.interface.showSpectrum,t.interface.showBeatGrid),p(t.interface.animations),window.dispatchEvent(new CustomEvent("djconsole:settings-updated",{detail:t}))}catch(S){console.error("Failed to save settings:",S)}})()},[t]);const i=(x,S,w)=>{console.log("🔧 [SETTINGS] Aggiornamento setting:",{category:x,key:S,value:w}),n({type:"UPDATE_SETTING",payload:{category:x,key:S,value:w}})},a=(x,S)=>{n({type:"UPDATE_CATEGORY",payload:{category:x,settings:S}})},l=()=>{n({type:"RESET_SETTINGS"})},c=x=>{const S=document.documentElement;if(x==="auto"){const w=window.matchMedia("(prefers-color-scheme: dark)"),C=w.matches;S.classList.toggle("dark",C),S.classList.toggle("light",!C),S.classList.remove("infernal"),w.addEventListener("change",f=>{S.classList.toggle("dark",f.matches),S.classList.toggle("light",!f.matches),S.classList.remove("infernal")})}else S.classList.remove("dark","light","infernal"),S.classList.add(x)},d=x=>{document.documentElement.lang=x,uo(()=>Promise.resolve().then(()=>Py),void 0,import.meta.url).then(({setLanguage:S})=>{S(x)}),window.dispatchEvent(new CustomEvent("djconsole:language-changed",{detail:x}))},h=(x,S,w)=>{window.dispatchEvent(new CustomEvent("djconsole:waveform-settings-changed",{detail:{showWaveforms:x,showSpectrum:S,showBeatGrid:w}}))},p=x=>{document.documentElement.style.setProperty("--enable-animations",x?"1":"0"),window.dispatchEvent(new CustomEvent("djconsole:animation-settings-changed",{detail:{animations:x}}))},y={settings:t,updateSetting:i,updateCategory:a,resetSettings:l,applyTheme:c,applyLanguage:d,applyWaveformSettings:h,applyAnimationSettings:p};return s.jsx(If.Provider,{value:y,children:e})}function Bn(){const e=u.useContext(If);if(e===void 0)throw new Error("useSettings must be used within a SettingsProvider");return e}class Mf{constructor(){U(this,"audioContext",null);U(this,"soundEffects",new Map);U(this,"isInitialized",!1);U(this,"masterVolume",.8);U(this,"onDebug");U(this,"onError");this.initializeAudioContext()}setCallbacks(t){this.onDebug=t.onDebug,this.onError=t.onError}async initializeAudioContext(){var t,n,o,r,i,a;try{const l=window.ensureMainAudioContext;if(l&&typeof l=="function")this.audioContext=l(),(t=this.onDebug)==null||t.call(this,"🎵 [SOUND EFFECTS] AudioContext principale ottenuto tramite ensureMainAudioContext");else{(n=this.onDebug)==null||n.call(this,"🎵 [SOUND EFFECTS] ensureMainAudioContext non disponibile, aspetto AudioContext globale...");let c=window.globalAudioContext;if(!c){for(let d=0;d<200;d++)if(await new Promise(h=>setTimeout(h,100)),c=window.globalAudioContext,c){(o=this.onDebug)==null||o.call(this,"🎵 [SOUND EFFECTS] AudioContext globale trovato!");break}}c?(this.audioContext=c,(r=this.onDebug)==null||r.call(this,"🎵 [SOUND EFFECTS] AudioContext GLOBALE utilizzato")):(this.audioContext=new(window.AudioContext||window.webkitAudioContext),(i=this.onDebug)==null||i.call(this,"🎵 [SOUND EFFECTS] AudioContext LOCALE creato (fallback)"))}await this.loadSoundEffects(),this.isInitialized=!0}catch(l){(a=this.onError)==null||a.call(this,`Errore inizializzazione SoundEffects: ${l}`)}}async loadSoundEffects(){var t,n;if(this.audioContext)try{await this.generateApplause(),await this.generateHorn(),await this.generateSwoosh(),await this.generateWhoosh(),await this.generateBeep(),await this.generateDrop(),await this.generateRise(),await this.generateSqueak(),(t=this.onDebug)==null||t.call(this,`🎵 [SOUND EFFECTS] ${this.soundEffects.size} effetti caricati`)}catch(o){(n=this.onError)==null||n.call(this,`Errore caricamento effetti: ${o}`)}}async generateApplause(){if(!this.audioContext)return;const t=2,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n;let c=Math.exp(-l*1.5);const d=Math.sin(l*8)*.3+Math.sin(l*12)*.2,h=(Math.random()*2-1)*.4*Math.exp(-l*2);c*=1+d+h,c=Math.max(0,Math.min(1,c));const p=(Math.random()*2-1)*c*.4,y=Math.sin(2*Math.PI*200*l)*c*.1;r[a]=(p+y)*.8,i[a]=(p+y)*.7}this.soundEffects.set("applause",o)}async generateHorn(){if(!this.audioContext)return;const t=2,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,d=233*(1+.15*Math.sin(2*Math.PI*5.5*l)),h=Math.sin(2*Math.PI*d*l),p=Math.sin(2*Math.PI*d*2*l)*.6,y=Math.sin(2*Math.PI*d*3*l)*.4,x=Math.sin(2*Math.PI*d*4*l)*.25,S=Math.sin(2*Math.PI*d*5*l)*.15;let w;l<.05?w=l/.05:l<.3?w=1:w=Math.exp(-(l-.3)*1.5);const C=1+.1*Math.sin(2*Math.PI*4*l),f=(Math.random()*2-1)*.03*w,g=(h+p+y+x+S)*w*C*.7+f;r[a]=g,i[a]=g*.98}this.soundEffects.set("horn",o)}async generateSwoosh(){if(!this.audioContext)return;const t=1,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=Math.sin(l*Math.PI)*.5,d=(Math.random()*2-1)*c;r[a]=d,i[a]=d*.7}this.soundEffects.set("swoosh",o)}async generateWhoosh(){if(!this.audioContext)return;const t=.8,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=Math.exp(-Math.pow((l-.4)/.2,2))*.6,d=(Math.random()*2-1)*c;r[a]=d,i[a]=d*.8}this.soundEffects.set("whoosh",o)}async generateBeep(){if(!this.audioContext)return;const t=.3,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=Math.exp(-l*8)*.5,d=Math.sin(2*Math.PI*800*l)*c;r[a]=d,i[a]=d}this.soundEffects.set("beep",o)}async generateDrop(){if(!this.audioContext)return;const t=1.2,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=400*Math.exp(-l*3),d=Math.exp(-l*2)*.6,h=Math.sin(2*Math.PI*c*l)*d;r[a]=h,i[a]=h*.9}this.soundEffects.set("drop",o)}async generateRise(){if(!this.audioContext)return;const t=1,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=100+l*300,d=Math.exp(-l*1.5)*.5,h=Math.sin(2*Math.PI*c*l)*d;r[a]=h,i[a]=h*.8}this.soundEffects.set("rise",o)}async generateSqueak(){if(!this.audioContext)return;const t=.5,n=this.audioContext.sampleRate,o=this.audioContext.createBuffer(2,t*n,n),r=o.getChannelData(0),i=o.getChannelData(1);for(let a=0;a<o.length;a++){const l=a/n,c=1e3+500*Math.sin(l*20),d=Math.exp(-l*4)*.4,h=Math.sin(2*Math.PI*c*l)*d;r[a]=h,i[a]=h*.7}this.soundEffects.set("squeak",o)}async playSoundEffect(t,n=1){var r,i,a,l,c,d,h,p,y,x,S;if(!this.isInitialized||!this.audioContext)return(r=this.onError)==null||r.call(this,"SoundEffects non inizializzato"),!1;const o=this.soundEffects.get(t);if(!o)return(i=this.onError)==null||i.call(this,`Effetto sonoro non trovato: ${t}`),!1;try{const w=this.audioContext.createBufferSource(),C=this.audioContext.createGain();w.buffer=o,C.gain.setValueAtTime(n*this.masterVolume,this.audioContext.currentTime);const f=window.mixerGain,g=window.destinationStream;return(a=this.onDebug)==null||a.call(this,"🔍 [SOUND EFFECTS] Debug nodi disponibili:"),(l=this.onDebug)==null||l.call(this,`🔍 [SOUND EFFECTS] - mixerGain: ${f?"✅ DISPONIBILE":"❌ NON DISPONIBILE"}`),(c=this.onDebug)==null||c.call(this,`🔍 [SOUND EFFECTS] - destinationStream: ${g?"✅ DISPONIBILE":"❌ NON DISPONIBILE"}`),w.connect(C),C.connect(this.audioContext.destination),(d=this.onDebug)==null||d.call(this,`🎵 [SOUND EFFECTS] ✅ Effetto collegato al output locale: ${t}`),f?(C.connect(f),(h=this.onDebug)==null||h.call(this,`🎵 [SOUND EFFECTS] ✅ Effetto collegato anche al mixer per streaming: ${t}`)):g?(C.connect(g),(p=this.onDebug)==null||p.call(this,`🎵 [SOUND EFFECTS] ✅ Effetto collegato anche al destination stream per streaming: ${t}`)):(y=this.onDebug)==null||y.call(this,`🎵 [SOUND EFFECTS] ⚠️ Solo output locale (nessun streaming disponibile): ${t}`),w.start(),(x=this.onDebug)==null||x.call(this,`🎵 [SOUND EFFECTS] Riprodotto: ${t} (volume: ${Math.round(n*100)}%)`),!0}catch(w){return(S=this.onError)==null||S.call(this,`Errore riproduzione effetto ${t}: ${w}`),!1}}getAvailableEffects(){return[{id:"applause",name:"Applausi",description:"Applausi del pubblico",duration:2e3,volume:.8,category:"applause"},{id:"horn",name:"Trombetta",description:"Suono di trombetta",duration:1500,volume:.7,category:"horn"},{id:"swoosh",name:"Swoosh",description:"Effetto di transizione",duration:1e3,volume:.6,category:"transition"},{id:"whoosh",name:"Whoosh",description:"Effetto di movimento",duration:800,volume:.6,category:"transition"},{id:"beep",name:"Beep",description:"Suono di notifica",duration:300,volume:.5,category:"comedy"},{id:"drop",name:"Drop",description:"Effetto di caduta",duration:1200,volume:.7,category:"transition"},{id:"rise",name:"Rise",description:"Effetto di ascesa",duration:1e3,volume:.6,category:"transition"},{id:"squeak",name:"Squeak",description:"Suono che perde",duration:500,volume:.4,category:"comedy"}]}setMasterVolume(t){var n;this.masterVolume=Math.max(0,Math.min(1,t)),(n=this.onDebug)==null||n.call(this,`🎵 [SOUND EFFECTS] Volume master impostato: ${Math.round(this.masterVolume*100)}%`)}getMasterVolume(){return this.masterVolume}isReady(){return this.isInitialized}}class nv{constructor(){U(this,"audioContext",null);U(this,"microphoneSource",null);U(this,"effectsChain",[]);U(this,"isInitialized",!1);U(this,"isActive",!1);U(this,"gainNode",null);U(this,"reverbNode",null);U(this,"delayNode",null);U(this,"filterNode",null);U(this,"distortionNode",null);U(this,"chorusNode",null);U(this,"pitchShifterNode",null);U(this,"outputNode",null);U(this,"onDebug");U(this,"onError");this.initializeAudioContext()}setCallbacks(t){this.onDebug=t.onDebug,this.onError=t.onError}async initializeAudioContext(){var t,n;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.createEffectsChain(),this.isInitialized=!0,(t=this.onDebug)==null||t.call(this,"🎤 [MICROPHONE EFFECTS] AudioContext e catena effetti inizializzati")}catch(o){(n=this.onError)==null||n.call(this,`Errore inizializzazione MicrophoneEffects: ${o}`)}}createEffectsChain(){this.audioContext&&(this.gainNode=this.audioContext.createGain(),this.reverbNode=this.audioContext.createConvolver(),this.delayNode=this.audioContext.createDelay(1),this.filterNode=this.audioContext.createBiquadFilter(),this.distortionNode=this.audioContext.createWaveShaper(),this.outputNode=this.audioContext.createGain(),this.gainNode.gain.setValueAtTime(1,this.audioContext.currentTime),this.delayNode.delayTime.setValueAtTime(.1,this.audioContext.currentTime),this.filterNode.type="lowpass",this.filterNode.frequency.setValueAtTime(2e4,this.audioContext.currentTime),this.outputNode.gain.setValueAtTime(1,this.audioContext.currentTime),this.generateReverbImpulse(),this.configureDistortion(),this.connectEffectsChain())}generateReverbImpulse(){if(!this.audioContext||!this.reverbNode)return;const t=this.audioContext.sampleRate*2,n=this.audioContext.createBuffer(2,t,this.audioContext.sampleRate),o=n.getChannelData(0),r=n.getChannelData(1);for(let i=0;i<t;i++){const a=i/this.audioContext.sampleRate,l=Math.exp(-a*2)*(Math.random()*2-1)*.3;o[i]=l,r[i]=l*.8}this.reverbNode.buffer=n}configureDistortion(){if(!this.distortionNode)return;const t=44100,n=new Float32Array(t),o=Math.PI/180;for(let r=0;r<t;r++){const i=r*2/t-1;n[r]=(3+20)*i*20*o/(Math.PI+20*Math.abs(i))}this.distortionNode.curve=n,this.distortionNode.oversample="4x"}connectEffectsChain(){!this.gainNode||!this.reverbNode||!this.delayNode||!this.filterNode||!this.distortionNode||!this.outputNode||(this.gainNode.connect(this.reverbNode),this.reverbNode.connect(this.delayNode),this.delayNode.connect(this.filterNode),this.filterNode.connect(this.distortionNode),this.distortionNode.connect(this.outputNode))}connectMicrophone(t){var n,o,r;if(!this.audioContext||!this.gainNode)return(n=this.onError)==null||n.call(this,"MicrophoneEffects non inizializzato"),!1;try{return this.microphoneSource&&this.microphoneSource.disconnect(),this.microphoneSource=this.audioContext.createMediaStreamSource(t),this.microphoneSource.connect(this.gainNode),this.isActive=!0,(o=this.onDebug)==null||o.call(this,"🎤 [MICROPHONE EFFECTS] Microfono collegato alla catena effetti"),!0}catch(i){return(r=this.onError)==null||r.call(this,`Errore collegamento microfono: ${i}`),!1}}disconnectMicrophone(){var t;this.microphoneSource&&(this.microphoneSource.disconnect(),this.microphoneSource=null,this.isActive=!1,(t=this.onDebug)==null||t.call(this,"🎤 [MICROPHONE EFFECTS] Microfono disconnesso"))}applyReverb(t=.5){var a;if(!this.reverbNode||!this.audioContext)return;const n=Math.max(0,Math.min(1,t)),o=1-n,r=this.audioContext.createGain(),i=this.audioContext.createGain();r.gain.setValueAtTime(o,this.audioContext.currentTime),i.gain.setValueAtTime(n,this.audioContext.currentTime),(a=this.onDebug)==null||a.call(this,`🎤 [MICROPHONE EFFECTS] Reverbero applicato: ${Math.round(t*100)}%`)}applyDelay(t=.3,n=.3){var o;!this.delayNode||!this.audioContext||(this.delayNode.delayTime.setValueAtTime(Math.max(.01,Math.min(1,t)),this.audioContext.currentTime),(o=this.onDebug)==null||o.call(this,`🎤 [MICROPHONE EFFECTS] Delay applicato: ${Math.round(t*1e3)}ms, feedback: ${Math.round(n*100)}%`))}applyFilter(t="lowpass",n=1e3,o=1){var r;!this.filterNode||!this.audioContext||(this.filterNode.type=t,this.filterNode.frequency.setValueAtTime(n,this.audioContext.currentTime),this.filterNode.Q.setValueAtTime(o,this.audioContext.currentTime),(r=this.onDebug)==null||r.call(this,`🎤 [MICROPHONE EFFECTS] Filtro applicato: ${t} @ ${n}Hz, Q: ${o}`))}applyDistortion(t=.5){var n;this.distortionNode&&((n=this.onDebug)==null||n.call(this,`🎤 [MICROPHONE EFFECTS] Distorsione applicata: ${Math.round(t*100)}%`))}applyPreset(t){var n,o,r,i,a,l,c;switch(t){case"cave":this.applyReverb(.9),this.applyFilter("lowpass",1500,3),this.applyDelay(.8,.5),this.applyDistortion(.2),(n=this.onDebug)==null||n.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Grotta" applicato');break;case"radio":this.applyFilter("bandpass",1e3,5),this.applyDistortion(.3),(o=this.onDebug)==null||o.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Radio" applicato');break;case"telephone":this.applyFilter("bandpass",800,10),this.applyFilter("bandpass",1200,10),(r=this.onDebug)==null||r.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Telefono" applicato');break;case"robot":this.applyFilter("lowpass",500,20),this.applyDistortion(.7),this.applyDelay(.1,.2),(i=this.onDebug)==null||i.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Robot" applicato');break;case"echo":this.applyDelay(.4,.6),this.applyReverb(.3),(a=this.onDebug)==null||a.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Eco" applicato');break;case"none":this.applyReverb(0),this.applyDelay(0,0),this.applyFilter("lowpass",2e4,1),this.applyDistortion(0),(l=this.onDebug)==null||l.call(this,'🎤 [MICROPHONE EFFECTS] Preset "Nessuno" applicato');break;default:(c=this.onError)==null||c.call(this,`Preset non trovato: ${t}`)}}getOutputNode(){return this.outputNode}getAvailableEffects(){return[{id:"reverb",name:"Reverbero",description:"Effetto di riverbero",category:"reverb",parameters:{amount:.5}},{id:"delay",name:"Eco/Delay",description:"Effetto di eco",category:"delay",parameters:{delayTime:.3,feedback:.3}},{id:"filter",name:"Filtro",description:"Filtro audio",category:"filter",parameters:{frequency:1e3,q:1}},{id:"distortion",name:"Distorsione",description:"Effetto di distorsione",category:"distortion",parameters:{amount:.5}}]}getAvailablePresets(){return[{id:"none",name:"Nessuno",description:"Nessun effetto"},{id:"cave",name:"Grotta",description:"Effetto grotta con riverbero"},{id:"radio",name:"Radio",description:"Effetto radio vintage"},{id:"telephone",name:"Telefono",description:"Effetto telefono"},{id:"robot",name:"Robot",description:"Effetto robot"},{id:"echo",name:"Eco",description:"Effetto eco"}]}setOutputVolume(t){var n;!this.outputNode||!this.audioContext||(this.outputNode.gain.setValueAtTime(Math.max(0,Math.min(2,t)),this.audioContext.currentTime),(n=this.onDebug)==null||n.call(this,`🎤 [MICROPHONE EFFECTS] Volume output impostato: ${Math.round(t*100)}%`))}isEffectsActive(){return this.isActive}isReady(){return this.isInitialized}}const ov=(e,t)=>{switch(t.type){case"SET_LEFT_DECK_TRACK":return{...e,leftDeck:{...e.leftDeck,track:t.payload}};case"SET_RIGHT_DECK_TRACK":return{...e,rightDeck:{...e.rightDeck,track:t.payload}};case"SET_LEFT_DECK_PLAYING":return{...e,leftDeck:{...e.leftDeck,isPlaying:t.payload}};case"SET_RIGHT_DECK_PLAYING":return{...e,rightDeck:{...e.rightDeck,isPlaying:t.payload}};case"SET_LEFT_DECK_TIME":return{...e,leftDeck:{...e.leftDeck,currentTime:t.payload}};case"SET_RIGHT_DECK_TIME":return{...e,rightDeck:{...e.rightDeck,currentTime:t.payload}};case"SET_LEFT_DECK_DURATION":return{...e,leftDeck:{...e.leftDeck,duration:t.payload}};case"SET_RIGHT_DECK_DURATION":return{...e,rightDeck:{...e.rightDeck,duration:t.payload}};case"SET_LEFT_DECK_VOLUME":return{...e,leftDeck:{...e.leftDeck,volume:t.payload}};case"SET_RIGHT_DECK_VOLUME":return{...e,rightDeck:{...e.rightDeck,volume:t.payload}};case"SET_LEFT_DECK_LOCAL_VOLUME":return{...e,leftDeck:{...e.leftDeck,localVolume:t.payload}};case"SET_RIGHT_DECK_LOCAL_VOLUME":return{...e,rightDeck:{...e.rightDeck,localVolume:t.payload}};case"SET_MASTER_VOLUME":return{...e,masterVolume:t.payload};case"SET_CROSSFADER":return{...e,crossfader:t.payload};case"SET_MICROPHONE_ENABLED":return{...e,microphone:{...e.microphone,isEnabled:t.payload}};case"SET_MICROPHONE_MUTED":return{...e,microphone:{...e.microphone,isMuted:t.payload}};case"SET_SOUND_EFFECTS_MANAGER":return{...e,soundEffectsManager:t.payload};case"SET_MICROPHONE_EFFECTS_MANAGER":return{...e,microphoneEffectsManager:t.payload};case"SET_AUDIO_CONTEXT":return{...e,audioContext:t.payload};default:return e}},rv={leftDeck:{track:null,isPlaying:!1,currentTime:0,duration:0,volume:.8,localVolume:0},rightDeck:{track:null,isPlaying:!1,currentTime:0,duration:0,volume:.8,localVolume:0},masterVolume:1,crossfader:.5,microphone:{isEnabled:!1,isMuted:!0},soundEffectsManager:null,microphoneEffectsManager:null,audioContext:null},Pf=u.createContext(void 0),iv=({children:e})=>{var qe,Fe;const[t,n]=u.useReducer(ov,rv),{settings:o}=Bn(),r=u.useRef(null),i=u.useRef(null),a=u.useRef(null),l=u.useRef(null),c=u.useRef(null);u.useEffect(()=>{(async()=>{try{const E=new Mf;E.setCallbacks({onDebug:L=>console.log(L),onError:L=>console.error(L)}),l.current=E,n({type:"SET_SOUND_EFFECTS_MANAGER",payload:E});const T=new nv;T.setCallbacks({onDebug:L=>console.log(L),onError:L=>console.error(L)}),c.current=T,n({type:"SET_MICROPHONE_EFFECTS_MANAGER",payload:T}),console.log("🎵 [INIT] Manager effetti audio inizializzati")}catch(E){console.error("❌ [INIT] Errore inizializzazione manager effetti:",E)}})()},[]),u.useEffect(()=>{(async()=>{try{console.log("🎤 [INIT] Inizializzazione microfono con impostazioni settings...");const E=await he();if(E)a.current=E,console.log("✅ [INIT] Microfono inizializzato con successo con impostazioni corrette:",E);else{console.warn("⚠️ [INIT] Fallback a microfono generico...");const T=await navigator.mediaDevices.getUserMedia({audio:!0});a.current=T,console.log("✅ [INIT] Microfono fallback inizializzato:",T)}}catch(E){console.warn("⚠️ [INIT] Microfono non disponibile all'avvio:",E.message)}})()},[]);const d=async(k,E,T=!1)=>{var L,B,P,H,G,me,ue,ht,Ye,Gt,hn,ln;console.log("🎵 [GETMIXEDSTREAM] Inizio getMixedStream..."),console.log("🎵 [GETMIXEDSTREAM] leftElement:",!!k),console.log("🎵 [GETMIXEDSTREAM] rightElement:",!!E),console.log("🎵 [GETMIXEDSTREAM] pttActive:",T);try{const Ae=await Y.getSettings();console.log("🎵 [GETMIXEDSTREAM] Settings ottenuti:",!!Ae),console.log("🔧 [DEBUG] Settings completi:",Ae),console.log("🔧 [DEBUG] settings.streaming:",Ae==null?void 0:Ae.streaming),console.log("🔧 [DEBUG] settings.streaming?.defaultFormat:",(L=Ae==null?void 0:Ae.streaming)==null?void 0:L.defaultFormat);const Gn=((B=Ae==null?void 0:Ae.streaming)==null?void 0:B.defaultFormat)||"opus",ne=((P=Ae==null?void 0:Ae.streaming)==null?void 0:P.defaultBitrate)||128,q=((H=Ae==null?void 0:Ae.streaming)==null?void 0:H.channels)||2,fe=((G=Ae==null?void 0:Ae.audio)==null?void 0:G.sampleRate)||48e3;console.log("🔊 [STREAMING] Using format from settings:",Gn),console.log("🔊 [STREAMING] Bitrate:",ne,"Channels:",q,"SampleRate:",fe);try{console.log("🔍 [SERVER CHECK] Verifica connessione al server streaming...");try{let z=Ae;console.log("🔍 [SERVER CHECK] Parametro settings ricevuto:",!!z),console.log("🔍 [SERVER CHECK] Tipo di settings:",typeof z),console.log("🔍 [SERVER CHECK] FORZO lettura dal database per evitare problemi..."),await Y.waitForInitialization(),z=await Y.getSettings(),console.log("🔍 [SERVER CHECK] Settings forzati dal database:",!!z);const De=await Y.getDefaultIcecastServer();if(console.log("🔍 [SERVER CHECK] DEBUG - Server di default:",De),!De)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Nessun server Icecast configurato");if(!De.host||!De.port)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Server di default non valido");if(De.host.trim()===""||De.port===0)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Host vuoto o porta 0 nel server di default");console.log("🔍 [SERVER CHECK] ✅ Server di default valido, procedo con test connessione..."),console.log("🔄 [GETMIXEDSTREAM] FFmpeg verrà avviato da StreamingManager.startStreaming()");const Jt=`http://${De.host}:${De.port}${De.mount}`;console.log("🔍 [SERVER CHECK] Connessione Icecast configurata:",Jt),console.log("🔍 [SERVER CHECK] Server:",De.name,"Host:",De.host,", Porta:",De.port),console.log("🔍 [SERVER CHECK] Test connessione HTTP su:",Jt);try{await fetch(Jt,{method:"HEAD",mode:"no-cors"}),console.log("✅ [SERVER CHECK] Server Icecast raggiungibile su",Jt)}catch(Ot){console.warn("⚠️ [SERVER CHECK] Test HTTP fallito, ma continuo con streaming:",Ot)}console.log("✅ [STREAMING] Server streaming verificato, procedo con la cattura audio...")}catch(z){throw console.error("❌ [SERVER CHECK] Errore verifica server:",z),z}let ee=S();if(!ee)throw new Error("Impossibile creare AudioContext per streaming");if(console.log("🎵 [MIX] AudioContext principale disponibile per streaming"),!ee||typeof ee.createMediaElementSource!="function")throw new Error("AudioContext non valido");if(!ee.destination)throw new Error("AudioContext non ha destination");const xe=ee.createMediaStreamDestination(),$e=ee.createGain();$e.connect(xe),$e.gain.setValueAtTime(1,ee.currentTime),window.mixerGain=$e,window.destinationStream=xe,window.globalAudioContext=t.audioContext,window.globalMixerGain=$e,console.log("🌍 [GLOBAL] AudioContext e MixerGain esposti globalmente per StreamingManager");const dt=window.streamingManager;dt&&dt.connectDirectly&&(console.log("🔄 [GLOBAL] StreamingManager trovato - connessione diretta immediata..."),dt.connectDirectly(ee,$e)),window.currentMixerGain=$e,window.currentMixContext=ee,window.audioContextSetMasterVolume=z=>{$e&&ee&&$e.gain.setValueAtTime(z,ee.currentTime)};let Ce=!1;const st=k||r.current||document.querySelector('audio.deck-audio[data-deck="A"]'),Ct=E||i.current||document.querySelector('audio.deck-audio[data-deck="B"]');console.log("🔍 [DEBUG AUDIO ELEMENTS] Elementi audio trovati:",{leftElement:!!k,leftAudioRef:!!r.current,leftAudioDOM:!!document.querySelector('audio.deck-audio[data-deck="A"]'),leftAudioElement:!!st,leftAudioSrc:st==null?void 0:st.src,rightElement:!!E,rightAudioRef:!!i.current,rightAudioDOM:!!document.querySelector('audio.deck-audio[data-deck="B"]'),rightAudioElement:!!Ct,rightAudioSrc:Ct==null?void 0:Ct.src});const wo=document.querySelectorAll("audio");console.log("🔍 [DEBUG ALL AUDIO] Tutti gli elementi audio nel DOM:",{total:wo.length,elements:Array.from(wo).map((z,De)=>({index:De,tagName:z.tagName,className:z.className,dataDeck:z.getAttribute("data-deck"),src:z.src,id:z.id}))});const Vt=document.querySelector('audio[data-deck="A"]')||document.querySelector('audio[data-deck="left"]')||document.querySelector("audio.left-deck")||document.querySelector('audio[data-side="left"]'),Z=document.querySelector('audio[data-deck="B"]')||document.querySelector('audio[data-deck="right"]')||document.querySelector("audio.right-deck")||document.querySelector('audio[data-side="right"]');console.log("🔍 [DEBUG ALTERNATIVE AUDIO] Elementi audio alternativi trovati:",{leftAlternative:!!Vt,leftAlternativeSrc:Vt==null?void 0:Vt.src,rightAlternative:!!Z,rightAlternativeSrc:Z==null?void 0:Z.src});const Pe=st||Vt,Dt=Ct||Z;if(console.log("🔍 [DEBUG FINAL AUDIO] Elementi audio finali selezionati:",{finalLeft:!!Pe,finalLeftSrc:Pe==null?void 0:Pe.src,finalRight:!!Dt,finalRightSrc:Dt==null?void 0:Dt.src}),Pe&&Pe.src&&Pe.src.trim()!=="")try{console.log("🎵 [STREAMING] Tentativo cattura deck sinistro per streaming..."),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("info","Cattura Audio","Tentativo cattura deck sinistro per streaming...","audio");const z=new Audio(Pe.src);z.currentTime=Pe.currentTime,z.playbackRate=Pe.playbackRate,z.loop=Pe.loop,z.muted=Pe.muted,z.volume=1,Pe.paused?z.pause():z.play().catch(console.error);const De=()=>{const ze=r.current;if(z&&ze)if(z.src!==ze.src)console.log("🔄 [SYNC LEFT] Rilevato cambio traccia - aggiornando elemento audio dello streaming"),z.src=ze.src,z.load(),z.currentTime=ze.currentTime,z.playbackRate=ze.playbackRate,z.loop=ze.loop,z.muted=ze.muted,z.volume=1,ze.paused?(console.log("🔄 [SYNC LEFT] Pausa leftStreamAudio - audio originale in pausa"),z.pause()):(console.log("🔄 [SYNC LEFT] Riproduzione leftStreamAudio - audio originale in riproduzione"),z.play().catch(Rn=>{console.error("❌ [SYNC LEFT] Errore riproduzione leftStreamAudio:",Rn)}));else{const Rn=Math.abs(z.currentTime-ze.currentTime);Rn>.05&&(console.log(`🔄 [SYNC LEFT] Sincronizzazione posizione: ${ze.currentTime.toFixed(2)}s (diff: ${Rn.toFixed(2)}s)`),z.currentTime=ze.currentTime)}};window.leftStreamAudio=z,window.leftSyncInterval||(console.log("🔄 [SYNC LEFT] Avvio sincronizzazione continua per deck sinistro"),window.leftSyncInterval=setInterval(De,200));const Jt=ee.createMediaElementSource(z),Ot=ee.createGain(),Uo=1-(t.crossfader||.5);Ot.gain.setValueAtTime(Uo,ee.currentTime),console.log("🔗 [STREAMING] Collegamento audio deck sinistro:",{leftSource:!!Jt,leftStreamGain:!!Ot,mixerGain:!!$e,destinationStream:!!xe,crossfaderVolume:Uo}),Jt.connect(Ot),Ot.connect($e),console.log("✅ [STREAMING] Audio deck sinistro collegato: leftStreamAudio → leftSource → leftStreamGain → mixerGain → destinationStream"),window.leftDeckStreamGain=Ot,typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Audio Catturato","Deck sinistro catturato con successo per streaming","audio"),z.currentTime=Pe.currentTime,console.log("🔍 [STREAMING] Stato audio originale:",{paused:Pe.paused,currentTime:Pe.currentTime,duration:Pe.duration,src:Pe.src,volume:Pe.volume,readyState:Pe.readyState,networkState:Pe.networkState}),console.log("🔍 [STREAMING] Stato leftStreamAudio:",{paused:z.paused,currentTime:z.currentTime,duration:z.duration,src:z.src,volume:z.volume,readyState:z.readyState,networkState:z.networkState}),z.volume=1,z.muted=!1,t.audioContext?(Ot.gain.setValueAtTime(1,t.audioContext.currentTime),$e.gain.setValueAtTime(1,t.audioContext.currentTime)):(Ot.gain.value=1,$e.gain.value=1),console.log("🔊 [STREAMING] Gain forzati - leftStreamGain: 1.0, mixerGain: 1.0"),Pe.paused?console.log("⚠️ [STREAMING] leftStreamAudio non avviato - audio originale in pausa"):(console.log("🎵 [STREAMING] Avvio riproduzione leftStreamAudio..."),z.play().then(()=>{console.log("✅ [STREAMING] leftStreamAudio riprodotto con successo")}).catch(ze=>{console.error("❌ [STREAMING] Errore riproduzione leftStreamAudio:",ze)})),console.log("🎵 [STREAMING] FORZO SEMPRE riproduzione leftStreamAudio per streaming..."),console.log("🔍 [DEBUG] finalLeftAudio:",Pe),console.log("🔍 [DEBUG] leftStreamAudio:",z),console.log("🔍 [DEBUG] finalLeftAudio.currentTime:",Pe==null?void 0:Pe.currentTime),console.log("🔍 [DEBUG] leftStreamAudio.src:",z==null?void 0:z.src);try{z.currentTime=Pe.currentTime,z.playbackRate=Pe.playbackRate||1,console.log("✅ [STREAMING] Sincronizzazione tempo completata"),await z.play(),console.log("✅ [STREAMING] leftStreamAudio FORZATO riprodotto con successo"),window.leftStreamAudioSync||(window.leftStreamAudioSync=setInterval(()=>{Pe&&z&&(Math.abs(z.currentTime-Pe.currentTime)>.5&&(z.currentTime=Pe.currentTime,console.log("🔄 [STREAMING] Sincronizzato leftStreamAudio:",Pe.currentTime)),z.paused&&!Pe.paused&&z.play().catch(console.warn))},1e3)),console.log("🔍 [STREAMING] Verifica leftStreamAudio FINALE:",{paused:z.paused,currentTime:z.currentTime,volume:z.volume,muted:z.muted,duration:z.duration,readyState:z.readyState})}catch(ze){console.error("❌ [STREAMING] Errore riproduzione FORZATA leftStreamAudio:",ze)}Ce=!0,console.log("✅ [STREAMING] Deck sinistro catturato con successo (volume streaming: 100%, separato dal locale)")}catch(z){console.error("❌ [STREAMING] Errore cattura deck sinistro:",z.message)}else console.log("⚠️ [STREAMING] Deck sinistro non disponibile per cattura");if(Dt&&Dt.src&&Dt.src.trim()!=="")try{console.log("🎵 [STREAMING] Tentativo cattura deck destro per streaming..."),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("info","Cattura Audio","Tentativo cattura deck destro per streaming...","audio");const z=new Audio(Dt.src);z.currentTime=Dt.currentTime,z.playbackRate=Dt.playbackRate,z.loop=Dt.loop,z.muted=Dt.muted,z.volume=1,Dt.paused?z.pause():z.play().catch(console.error);const De=()=>{const ze=i.current;if(z&&ze)if(z.src!==ze.src)console.log("🔄 [SYNC RIGHT] Rilevato cambio traccia - aggiornando elemento audio dello streaming"),z.src=ze.src,z.load(),z.currentTime=ze.currentTime,z.playbackRate=ze.playbackRate,z.loop=ze.loop,z.muted=ze.muted,z.volume=1,ze.paused?z.pause():z.play().catch(console.error);else{const Rn=Math.abs(z.currentTime-ze.currentTime);Rn>.05&&(console.log(`🔄 [SYNC RIGHT] Sincronizzazione posizione: ${ze.currentTime.toFixed(2)}s (diff: ${Rn.toFixed(2)}s)`),z.currentTime=ze.currentTime)}};window.rightStreamAudio=z,window.rightSyncInterval||(console.log("🔄 [SYNC RIGHT] Avvio sincronizzazione continua per deck destro"),window.rightSyncInterval=setInterval(De,200));const Jt=ee.createMediaElementSource(z),Ot=ee.createGain(),Uo=t.crossfader||.5;Ot.gain.setValueAtTime(Uo,ee.currentTime),Jt.connect(Ot),Ot.connect($e),window.rightDeckStreamGain=Ot,typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Audio Catturato","Deck destro catturato con successo per streaming","audio"),Ce=!0,console.log("✅ [STREAMING] Deck destro catturato con successo (volume streaming: 100%, separato dal locale)")}catch(z){console.error("❌ [STREAMING] Errore cattura deck destro:",z.message)}else console.log("⚠️ [STREAMING] Deck destro non disponibile per cattura");if(console.log("🎤 [MIC CHECK] Stato microfono:",{micStreamRef:!!a.current,isEnabled:t.microphone.isEnabled,isMuted:t.microphone.isMuted,micStream:a.current}),!a.current)try{console.log("🎤 [MIC] Richiesta accesso al microfono con impostazioni settings...");const z=await he();if(z)a.current=z,console.log("🎤 [MIC] Accesso al microfono ottenuto con impostazioni corrette:",z);else{console.warn("⚠️ [MIC] Fallback a microfono generico...");const De=await navigator.mediaDevices.getUserMedia({audio:!0});a.current=De,console.log("🎤 [MIC] Fallback microfono ottenuto:",De)}}catch(z){console.error("❌ [MIC] Errore accesso al microfono:",z.message)}if(a.current){console.log("🎤 [MIC] Creazione MediaStreamSource per microfono...");try{const z=ee.createMediaStreamSource(a.current),De=ee.createGain();z.connect(De),De.connect(xe),console.log("🎤 [MIC] Microfono connesso al MediaStreamDestination per streaming"),De.connect($e),console.log("🎤 [MIC] Microfono connesso anche al mixer locale per PTT"),window.currentPTTMicGain=De,window.currentPTTMixerGain=$e,window.currentPTTContext=ee,T?(De.gain.setValueAtTime(1,ee.currentTime),console.log("🎤 [PTT] Microfono attivato al 100% per PTT e streaming")):(De.gain.setValueAtTime(0,ee.currentTime),console.log("🎤 [MIC] Microfono creato ma silenziato (PTT non attivo) - disponibile per streaming")),console.log("🎤 [MIC] Riferimenti PTT salvati globalmente:",{currentPTTMicGain:!!window.currentPTTMicGain,currentPTTMixerGain:!!window.currentPTTMixerGain,currentPTTContext:!!window.currentPTTContext}),Ce=!0,console.log("✅ [MIC] Microfono creato e connesso con successo per streaming e PTT"),console.log("🔄 [GETMIXEDSTREAM] Passaggio critico - prima del return...");try{typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Microfono Attivo","Microfono creato e connesso con successo per streaming e PTT","audio"),console.log("🔄 [GETMIXEDSTREAM] Notifica microfono inviata...")}catch(Jt){console.error("❌ [GETMIXEDSTREAM] Errore notifica microfono:",Jt)}}catch(z){console.error("❌ [MIC] Errore creazione microfono:",z.message)}}else console.warn("⚠️ [MIC] Microfono non disponibile per streaming:",{micStreamRef:!!a.current,isEnabled:t.microphone.isEnabled,isMuted:t.microphone.isMuted});if(!Ce)try{const z=ee.createOscillator(),De=ee.createGain();z.frequency.setValueAtTime(440,ee.currentTime),De.gain.setValueAtTime(.1,ee.currentTime),z.connect(De),De.connect($e),z.start()}catch{}if(Ce?typeof window<"u"&&window.addStreamingNotification?window.addStreamingNotification("success","Streaming Successo","✅ STREAMING SUCCESSO: Audio reale catturato!","streaming"):console.log("✅ [STREAMING] Audio reale catturato con successo!"):typeof window<"u"&&window.addStreamingNotification?window.addStreamingNotification("warning","Streaming Warning","⚠️ STREAMING PROBLEMA: Solo oscillator, nessun audio reale!","streaming"):console.warn("⚠️ [STREAMING] Solo oscillator, nessun audio reale!"),!Ce){console.log("⚠️ [STREAMING] Nessun audio attivo, creo stream silenzioso per mantenere connessione...");const z=ee.createOscillator(),De=ee.createGain();De.gain.setValueAtTime(0,ee.currentTime),z.connect(De),De.connect(xe),z.start(),console.log("✅ [STREAMING] Stream silenzioso creato per mantenere connessione streaming")}try{typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Streaming Ready","🎵 Mixed stream creato con successo! Audio pronto per streaming.","streaming"),console.log("🔄 [GETMIXEDSTREAM] Notifica completamento inviata...")}catch(z){console.error("❌ [GETMIXEDSTREAM] Errore notifica completamento:",z)}return console.log("✅ [STREAMING] getMixedStream completato - stream valido restituito"),console.log("🎵 [GETMIXEDSTREAM] Stream restituito:",!!xe.stream,(me=xe.stream)==null?void 0:me.active,(ue=xe.stream)==null?void 0:ue.getTracks().length),typeof window<"u"&&window.startContinuousSync?(console.log("🔄 [GETMIXEDSTREAM] Avvio sincronizzazione continua..."),window.startContinuousSync()):(console.log("⚠️ [GETMIXEDSTREAM] startContinuousSync non disponibile, riprovo tra 500ms..."),setTimeout(()=>{typeof window<"u"&&window.startContinuousSync?(console.log("🔄 [GETMIXEDSTREAM] Avvio sincronizzazione continua (ritardato)..."),window.startContinuousSync()):console.error("❌ [GETMIXEDSTREAM] startContinuousSync ancora non disponibile")},500)),console.log("🔄 [GETMIXEDSTREAM] Ultimo passaggio - prima del return finale..."),console.log("📡 [GETMIXEDSTREAM] Ritorno destinationStream.stream:",{hasDestinationStream:!!xe,hasStream:!!xe.stream,streamType:typeof xe.stream,streamConstructor:(Ye=(ht=xe.stream)==null?void 0:ht.constructor)==null?void 0:Ye.name,isMediaStream:xe.stream instanceof MediaStream,active:(Gt=xe.stream)==null?void 0:Gt.active,tracks:(ln=(hn=xe.stream)==null?void 0:hn.getTracks())==null?void 0:ln.length}),xe.stream}catch(ee){return typeof window<"u"&&window.addStreamingNotification?window.addStreamingNotification("error","Errore Critico",`❌ ERRORE CRITICO STREAMING: ${ee.message}`,"streaming"):console.error("❌ [STREAMING] Errore critico:",ee.message),null}}catch(Ae){return console.error("Error initializing stream:",Ae),null}};window.localDatabase=Y,window.getMixedStream=d,window.startContinuousSync=()=>{if(console.log("🔄 [SYNC] Avvio sincronizzazione continua richiesto..."),!r.current&&!i.current){console.log("🔄 [SYNC] Nessun elemento audio disponibile per sincronizzazione");return}r.current&&!window.leftSyncInterval&&(console.log("🔄 [SYNC] Avvio sincronizzazione deck sinistro..."),window.leftSyncInterval=setInterval(()=>{const k=r.current;if(k&&window.leftStreamAudio)if(window.leftStreamAudio.src!==k.src)console.log("🔄 [SYNC LEFT] Rilevato cambio traccia - aggiornando elemento audio dello streaming"),window.leftStreamAudio.src=k.src,window.leftStreamAudio.load(),window.leftStreamAudio.currentTime=k.currentTime,window.leftStreamAudio.playbackRate=k.playbackRate,window.leftStreamAudio.loop=k.loop,window.leftStreamAudio.muted=k.muted,window.leftStreamAudio.volume=1,k.paused?(console.log("🔄 [SYNC LEFT] Pausa leftStreamAudio - audio originale in pausa"),window.leftStreamAudio.pause()):(console.log("🔄 [SYNC LEFT] Riproduzione leftStreamAudio - audio originale in riproduzione"),window.leftStreamAudio.play().catch(E=>{console.error("❌ [SYNC LEFT] Errore riproduzione leftStreamAudio:",E)}));else{const E=Math.abs(window.leftStreamAudio.currentTime-k.currentTime);E>.05&&(console.log(`🔄 [SYNC LEFT] Sincronizzazione posizione: ${k.currentTime.toFixed(2)}s (diff: ${E.toFixed(2)}s)`),window.leftStreamAudio.currentTime=k.currentTime)}},200)),i.current&&!window.rightSyncInterval&&(console.log("🔄 [SYNC] Avvio sincronizzazione deck destro..."),window.rightSyncInterval=setInterval(()=>{const k=i.current;if(k&&window.rightStreamAudio)if(window.rightStreamAudio.src!==k.src)console.log("🔄 [SYNC RIGHT] Rilevato cambio traccia - aggiornando elemento audio dello streaming"),window.rightStreamAudio.src=k.src,window.rightStreamAudio.load(),window.rightStreamAudio.currentTime=k.currentTime,window.rightStreamAudio.playbackRate=k.playbackRate,window.rightStreamAudio.loop=k.loop,window.rightStreamAudio.muted=k.muted,window.rightStreamAudio.volume=1,k.paused?window.rightStreamAudio.pause():window.rightStreamAudio.play().catch(console.error);else{const E=Math.abs(window.rightStreamAudio.currentTime-k.currentTime);E>.05&&(console.log(`🔄 [SYNC RIGHT] Sincronizzazione posizione: ${k.currentTime.toFixed(2)}s (diff: ${E.toFixed(2)}s)`),window.rightStreamAudio.currentTime=k.currentTime)}},200)),console.log("🔄 [SYNC] Sincronizzazione continua avviata")},window.stopContinuousSync=()=>{window.leftSyncInterval&&(clearInterval(window.leftSyncInterval),window.leftSyncInterval=null,console.log("🔄 [SYNC] Sincronizzazione sinistra fermata")),window.rightSyncInterval&&(clearInterval(window.rightSyncInterval),window.rightSyncInterval=null,console.log("🔄 [SYNC] Sincronizzazione destra fermata"))};const h=async(k=5e3)=>{const E=Date.now();for(console.log("🔍 [WAIT] Inizio ricerca StreamingManager...");Date.now()-E<k;){if(window.streamingManager)return console.log("📡 [WAIT] StreamingManager trovato dopo",Date.now()-E,"ms"),console.log("📡 [WAIT] StreamingManager type:",typeof window.streamingManager),console.log("📡 [WAIT] StreamingManager updateStream method:",typeof window.streamingManager.updateStream),window.streamingManager;await new Promise(T=>setTimeout(T,100))}return console.warn("⚠️ [WAIT] StreamingManager non trovato entro",k,"ms"),console.warn("⚠️ [WAIT] window.streamingManager:",window.streamingManager),null};window.activeAudioStreams=[];const p=k=>{window.activeAudioStreams||(window.activeAudioStreams=[]),window.activeAudioStreams.push(k),console.log("🎵 [TRACKING] Stream audio aggiunto al tracking:",k.id)},y=k=>{if(window.activeAudioStreams){const E=window.activeAudioStreams.indexOf(k);E>-1&&(window.activeAudioStreams.splice(E,1),console.log("🎵 [TRACKING] Stream audio rimosso dal tracking:",k.id))}};window.addAudioStreamToTracking=p,window.removeAudioStreamFromTracking=y;const x=async()=>{try{const E=(await navigator.mediaDevices.enumerateDevices()).filter(T=>T.kind==="audiooutput");return console.log("🔊 [AUDIO] Dispositivi audio output disponibili:",E),E}catch(k){return console.error("❌ [AUDIO] Errore enumerazione dispositivi output:",k),[]}};window.getAvailableAudioOutputDevices=x;const S=u.useCallback(()=>{if(!window.__audioContexts||!window.__audioContexts[0]){const E=window.AudioContext||window.webkitAudioContext;if(E){const T=new E;return window.__audioContexts||(window.__audioContexts=[]),window.__audioContexts[0]=T,window.globalAudioContext=T,n({type:"SET_AUDIO_CONTEXT",payload:T}),console.log("🎵 [INIT] AudioContext principale inizializzato e esposto globalmente"),T}}const k=window.__audioContexts&&window.__audioContexts[0];return k&&!window.globalAudioContext&&(window.globalAudioContext=k,n({type:"SET_AUDIO_CONTEXT",payload:k}),console.log("🎵 [INIT] AudioContext principale esistente esposto globalmente")),k},[n]);window.ensureMainAudioContext=S;const w=u.useCallback(()=>{try{if(console.log("🧹 [CLEANUP] Inizio cleanup completo stream audio..."),window.activeAudioStreams&&Array.isArray(window.activeAudioStreams)&&(console.log(`🧹 [CLEANUP] Trovati ${window.activeAudioStreams.length} stream audio da fermare`),window.activeAudioStreams.forEach((E,T)=>{try{E&&E.getTracks&&E.getTracks().forEach(L=>{L.stop(),console.log(`🧹 [CLEANUP] Track fermato: ${L.kind} - ${L.label}`)})}catch(L){console.warn(`⚠️ [CLEANUP] Errore fermando stream ${T}:`,L)}}),window.activeAudioStreams=[],console.log("🧹 [CLEANUP] Array di tracking stream pulito")),a.current)try{a.current.getTracks().forEach(E=>{E.stop(),console.log(`🧹 [CLEANUP] Microfono fermato: ${E.label}`)}),a.current=null}catch(E){console.warn("⚠️ [CLEANUP] Errore fermando microfono:",E)}if(window.isCurrentlyStreaming)console.log("🧹 [CLEANUP] Audio locale mantenuto attivo durante streaming");else{if(r.current)try{r.current.pause(),r.current.currentTime=0,r.current.src="",console.log("🧹 [CLEANUP] Left deck audio fermato")}catch(E){console.warn("⚠️ [CLEANUP] Errore fermando left deck:",E)}if(i.current)try{i.current.pause(),i.current.currentTime=0,i.current.src="",console.log("🧹 [CLEANUP] Right deck audio fermato")}catch(E){console.warn("⚠️ [CLEANUP] Errore fermando right deck:",E)}}if(typeof window<"u"&&window.AudioContext)try{(window.__audioContexts||[]).forEach((T,L)=>{T&&T.state!=="closed"&&L>0?(T.close(),console.log(`🧹 [CLEANUP] AudioContext temporaneo ${L} chiuso`)):L===0&&console.log("🧹 [CLEANUP] AudioContext principale mantenuto attivo")})}catch(E){console.warn("⚠️ [CLEANUP] Errore chiudendo AudioContext temporanei:",E)}window.__currentStreamVolume__=void 0,window.__pttOriginalStreamVolume__=void 0,window.__audioContexts&&window.__audioContexts.length>0&&(window.__audioContexts=[window.__audioContexts[0]],console.log("🧹 [CLEANUP] Mantenuto solo AudioContext principale")),console.log("✅ [CLEANUP] Cleanup completo stream audio completato")}catch(k){console.error("❌ [CLEANUP] Errore durante cleanup stream audio:",k)}},[]);window.cleanupAllAudioStreams=w,window.reconnectDeckToStreaming=async k=>{try{if(console.log(`🎵 [AUTO-RECONNECT] Tentativo ricollegamento deck ${k} allo streaming...`),!window.isCurrentlyStreaming)return console.log(`🎵 [AUTO-RECONNECT] Streaming non attivo, salto ricollegamento deck ${k}`),!1;const E=document.querySelector(`audio.deck-audio[data-deck="${k}"]`);if(!E||!E.src||E.src.trim()==="")return console.log(`🎵 [AUTO-RECONNECT] Deck ${k} non ha audio valido, salto ricollegamento`),!1;console.log(`🎵 [AUTO-RECONNECT] Deck ${k} trovato con audio valido, procedo con ricollegamento...`);try{typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("info","Ricollegamento Deck",`Ricollegamento deck ${k} allo streaming...`,"audio"),console.log(`🎵 [AUTO-RECONNECT] Ricreazione mixed stream per includere deck ${k}...`);const T=await d();if(T)return window.streamingManager&&typeof window.streamingManager.updateStream=="function"?(await window.streamingManager.updateStream(T),console.log("✅ [AUTO-RECONNECT] Streaming aggiornato con nuovo mixed stream")):console.log("⚠️ [AUTO-RECONNECT] StreamingManager non disponibile per aggiornamento"),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Deck Ricollegato",`Deck ${k} ricollegato con successo allo streaming`,"audio"),console.log(`✅ [AUTO-RECONNECT] Deck ${k} ricollegato con successo allo streaming`),!0;throw new Error("getMixedStream ha restituito null")}catch(T){return console.error("❌ [AUTO-RECONNECT] Errore ricreazione mixed stream:",T.message),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("error","Errore Ricollegamento",`Errore ricollegamento deck ${k}: ${T.message}`,"audio"),!1}}catch(E){return console.error(`❌ [AUTO-RECONNECT] Errore generale ricollegamento deck ${k}:`,E.message),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("error","Errore Ricollegamento",`Errore ricollegamento deck ${k}: ${E.message}`,"audio"),!1}},window.startServerMonitoring=()=>{window.__serverMonitoringInterval__&&clearInterval(window.__serverMonitoringInterval__),console.log("🔍 [MONITORING] Avvio monitoraggio continuo del server..."),window.__serverMonitoringInterval__=setInterval(async()=>{var k,E;try{if((k=window.globalStreamingManager)!=null&&k.isUserRequestedDisconnect){console.log("🛑 [MONITORING] Disconnessione richiesta dall'utente - fermo monitoraggio");return}if(window.isCurrentlyStreaming){console.log("🔍 [MONITORING] Verifica server durante streaming...");const T=await Y.getDefaultIcecastServer();if(T!=null&&T.host&&(T!=null&&T.port)){const L=T.host,B=T.port,P=await fetch(`http://${L}:${B}/status-json.xsl`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(3e3)});if(!P.ok)throw P.status===404?new Error("Server non raggiungibile - Endpoint non trovato (404)"):P.status===403?new Error("Server non raggiungibile - Accesso negato (403)"):P.status>=500?new Error(`Server non raggiungibile - Errore server (${P.status})`):new Error(`Server non raggiungibile - HTTP ${P.status}`);console.log("✅ [MONITORING] Server OK durante streaming")}else throw new Error("Impostazioni streaming incomplete")}}catch(T){if((E=window.globalStreamingManager)!=null&&E.isUserRequestedDisconnect){console.log("🛑 [MONITORING] Disconnessione richiesta dall'utente - ignoro errore server");return}console.error("🚨 [MONITORING] SERVER CADUTO durante streaming!",T.message),typeof window<"u"&&window.addStreamingNotification?window.addStreamingNotification("error","Server Caduto",`🚨 SERVER CADUTO!

${T.message}

Lo streaming è stato fermato automaticamente.`,"streaming"):console.error("🚨 [MONITORING] Server caduto:",T.message),window.stopStreaming&&window.stopStreaming()}},5e3)},window.stopServerMonitoring=()=>{window.__serverMonitoringInterval__&&(clearInterval(window.__serverMonitoringInterval__),window.__serverMonitoringInterval__=null,console.log("🔍 [MONITORING] Monitoraggio server fermato"))},window.debugDatabaseStatus=async()=>{var k;try{if(console.log("🔍 [DB DEBUG] Verifica stato database..."),console.log("🔍 [DB DEBUG] Database importato:",!!Y),console.log("🔍 [DB DEBUG] Tipo database:",typeof Y),console.log("🔍 [DB DEBUG] Metodi disponibili:",Object.getOwnPropertyNames(Object.getPrototypeOf(Y))),Y){console.log("🔍 [DB DEBUG] Database disponibile, aspetto inizializzazione..."),await Y.waitForInitialization(),console.log("🔍 [DB DEBUG] Database inizializzato!");const E=await Y.getSettings();if(console.log("🔍 [DB DEBUG] Settings letti:",!!E),console.log("🔍 [DB DEBUG] Settings completi:",E),(k=E==null?void 0:E.streaming)!=null&&k.icecastServers&&E.streaming.icecastServers.length>0){console.log("🔍 [DB DEBUG] ✅ Icecast servers configurati:",E.streaming.icecastServers.length);const T=E.streaming.icecastServers.find(L=>L.isDefault)||E.streaming.icecastServers[0];T&&console.log("🔍 [DB DEBUG] Server di default:",{host:T.host,port:T.port,mount:T.mount})}else console.log("🔍 [DB DEBUG] ❌ Nessun server Icecast configurato")}}catch(E){console.error("❌ [DB DEBUG] Errore verifica database:",E.message)}},window.checkStreamingServerConnection=async k=>{var E,T,L,B;try{console.log("🔍 [SERVER CHECK] Verifica connessione al server streaming...");try{let P=k;console.log("🔍 [SERVER CHECK] Parametro settings ricevuto:",!!P),console.log("🔍 [SERVER CHECK] Tipo di settings:",typeof P),console.log("🔍 [SERVER CHECK] FORZO lettura dal database per evitare problemi..."),await Y.waitForInitialization(),P=await Y.getSettings(),console.log("🔍 [SERVER CHECK] Settings forzati dal database:",!!P);const H=await Y.getDefaultIcecastServer();if(console.log("🔍 [SERVER CHECK] DEBUG - Server di default:",H),!H)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Nessun server Icecast configurato");if(!H.host||!H.port)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Server di default non valido");if(H.host.trim()===""||H.port===0)throw new Error("IMPOSTAZIONI STREAMING INCOMPLETE: Host vuoto o porta 0 nel server di default");if(console.log("🔍 [SERVER CHECK] ✅ Server di default valido, procedo con test connessione..."),H!=null&&H.host&&(H!=null&&H.port)){const G=H.host,me=H.port;console.log(`🔍 [SERVER CHECK] Connessione Icecast configurata: http://${G}:${me}`),console.log(`🔍 [SERVER CHECK] Server: ${H.name}, Host: ${G}, Porta: ${me}`),console.log(`🔍 [SERVER CHECK] Test connessione HTTP su: http://${G}:${me}`);try{const ue=await fetch(`http://${G}:${me}/status-json.xsl`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(5e3)});if(!ue.ok)throw ue.status===404?new Error(`Server Icecast non raggiungibile su http://${G}:${me} - Endpoint non trovato (404)`):ue.status===403?new Error(`Server Icecast non raggiungibile su http://${G}:${me} - Accesso negato (403)`):ue.status>=500?new Error(`Server Icecast non raggiungibile su http://${G}:${me} - Errore server (${ue.status})`):new Error(`Server Icecast non raggiungibile su http://${G}:${me} - HTTP ${ue.status}`);return console.log(`✅ [SERVER CHECK] Server Icecast raggiungibile su http://${G}:${me}`),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Server Raggiungibile",`Server Icecast raggiungibile su http://${G}:${me}`,"streaming"),!0}catch(ue){throw console.error("❌ [SERVER CHECK] Errore connessione HTTP:",ue.message),new Error(`Server Icecast non raggiungibile su http://${G}:${me}`)}}else{const G=`🚨 IMPOSTAZIONI STREAMING INCOMPLETE!

Host o porta non configurati correttamente.

Configurazione attuale:
• Host: "${((T=(E=P==null?void 0:P.streaming)==null?void 0:E.icecast)==null?void 0:T.host)||"NON IMPOSTATO"}"
• Porta: ${((B=(L=P==null?void 0:P.streaming)==null?void 0:L.icecast)==null?void 0:B.port)||"NON IMPOSTATA"}

Vai in Settings e configura:
• Host: 82.145.63.6
• Porta: 5040`;throw console.error("❌ [SERVER CHECK]",G),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("error","Impostazioni Incomplete",G,"app"),new Error(G)}}catch(P){if(P.message.includes("IMPOSTAZIONI STREAMING INCOMPLETE")){const H=`🚨 IMPOSTAZIONI STREAMING INCOMPLETE!

${P.message}

Vai in Settings e configura:
• Host: 82.145.63.6
• Porta: 5040`;throw console.error("❌ [SERVER CHECK] Impostazioni incomplete:",H),new Error(H)}else{if(P.message.includes("Server Icecast non raggiungibile"))throw console.error("❌ [SERVER CHECK] Server non raggiungibile:",P.message),P;{const H=`🚨 ERRORE LETTURA IMPOSTAZIONI!

Impossibile leggere le impostazioni dal database.

Errore: ${P.message}

Verifica che il database sia accessibile e riprova.`;throw console.error("❌ [SERVER CHECK] Errore database:",H),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("error","Errore Database",H,"app"),new Error(H)}}}}catch(P){throw console.error("❌ [SERVER CHECK] Errore finale:",P.message),P}},window.updatePTTVolumesOnly=k=>{try{console.log(`🎤 [PTT UPDATE] Tentativo aggiornamento volumi PTT: ${k?"ON":"OFF"}`);const E=window.currentPTTMicGain,T=window.currentPTTMixerGain,L=window.currentPTTContext,B=window.__pttDuckingLevel__||.75;if(k){if(!window.__pttOriginalStreamVolume__){const G=window.__currentStreamVolume__||1;window.__pttOriginalStreamVolume__=G,console.log(`🎤 [PTT] Volume originale del LiveStream salvato: ${Math.round(G*100)}%`)}const P=window.__pttOriginalStreamVolume__||1,H=Math.max(0,P*(1-B));console.log(`🎤 [PTT DEBUG] Volume originale LiveStream: ${Math.round(P*100)}%, Ducking: ${Math.round(B*100)}%, Volume finale: ${Math.round(H*100)}%`),E&&L&&(E.gain.setValueAtTime(1,L.currentTime),console.log("🎤 [PTT UPDATE] Microfono attivato al 100% per streaming"),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("info","PTT Attivato","Microfono attivato al 100% per streaming","audio")),typeof window.setLiveStreamVolume=="function"?(window.setLiveStreamVolume(H),console.log(`🎤 [PTT UPDATE] LiveStream abbassato del ${Math.round(B*100)}% (da ${Math.round(P*100)}% a ${Math.round(H*100)}%)`)):console.warn("⚠️ [PTT] Funzione setLiveStreamVolume non disponibile"),T&&T.gain?(T.gain.setValueAtTime(H,L.currentTime),console.log(`🎤 [PTT UPDATE] Mixer WebAudio abbassato a ${Math.round(H*100)}% per ducking reale`)):console.warn("⚠️ [PTT] Mixer WebAudio non disponibile per ducking")}else{const P=window.__pttOriginalStreamVolume__||1;E&&L&&(E.gain.setValueAtTime(0,L.currentTime),console.log("🎤 [PTT UPDATE] Microfono disattivato per streaming"),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("info","PTT Disattivato","Microfono disattivato per streaming","audio")),typeof window.setLiveStreamVolume=="function"?(window.setLiveStreamVolume(P),console.log(`🎤 [PTT UPDATE] LiveStream ripristinato al volume originale: ${Math.round(P*100)}%`)):console.warn("⚠️ [PTT] Funzione setLiveStreamVolume non disponibile"),T&&T.gain?(T.gain.setValueAtTime(P,L.currentTime),console.log(`🎤 [PTT UPDATE] Mixer WebAudio ripristinato a ${Math.round(P*100)}%`)):console.warn("⚠️ [PTT] Mixer WebAudio non disponibile per ripristino"),window.__pttOriginalStreamVolume__=void 0}console.log("🎤 [PTT DEBUG] Riferimenti disponibili:",{micGain:!!E,context:!!L,setLiveStreamVolume:typeof window.setLiveStreamVolume=="function",originalStreamVolume:window.__pttOriginalStreamVolume__})}catch(E){console.error("❌ [PTT ERROR] Errore durante aggiornamento volumi PTT:",E)}};const C=u.useCallback(k=>{console.log(`🎵 [LEFT DECK] Riproduzione track: ${k.title}`);try{r.current&&(r.current.pause(),r.current.currentTime=0,r.current.src="",console.log("🧹 [LEFT DECK] Audio precedente pulito")),n({type:"SET_LEFT_DECK_TRACK",payload:k}),n({type:"SET_LEFT_DECK_PLAYING",payload:!0}),k.url&&r.current&&(r.current.src=k.url,r.current.load(),r.current.volume=t.leftDeck.localVolume,r.current.play().catch(E=>{console.error("❌ Errore avvio riproduzione left deck:",E),n({type:"SET_LEFT_DECK_PLAYING",payload:!1})})),console.log(`✅ [LEFT DECK] Track "${k.title}" caricata e avviata`),console.log("🎵 [TRACK CHANGE LEFT] Traccia cambiata - sistema gestirà automaticamente lo streaming"),typeof window<"u"&&window.startContinuousSync&&(console.log("🔄 [TRACK CHANGE] Avvio sincronizzazione continua per cambio traccia..."),window.startContinuousSync())}catch(E){console.error("❌ Errore caricamento left deck:",E),n({type:"SET_LEFT_DECK_PLAYING",payload:!1})}},[n,t.leftDeck.localVolume,d]),f=u.useCallback(k=>{console.log(`🎵 [RIGHT DECK] Riproduzione track: ${k.title}`);try{i.current&&(i.current.pause(),i.current.currentTime=0,i.current.src="",console.log("🧹 [RIGHT DECK] Audio precedente pulito")),n({type:"SET_RIGHT_DECK_TRACK",payload:k}),n({type:"SET_RIGHT_DECK_PLAYING",payload:!0}),k.url&&i.current&&(i.current.src=k.url,i.current.load(),i.current.volume=t.rightDeck.localVolume,i.current.play().catch(E=>{console.error("❌ Errore avvio riproduzione right deck:",E),n({type:"SET_RIGHT_DECK_PLAYING",payload:!1})})),console.log(`✅ [RIGHT DECK] Track "${k.title}" caricata e avviata`),console.log("🎵 [TRACK CHANGE RIGHT] Traccia cambiata - sistema gestirà automaticamente lo streaming"),typeof window<"u"&&window.startContinuousSync&&(console.log("🔄 [TRACK CHANGE] Avvio sincronizzazione continua per cambio traccia..."),window.startContinuousSync())}catch(E){console.error("❌ Errore caricamento right deck:",E),n({type:"SET_RIGHT_DECK_PLAYING",payload:!1})}},[n,t.rightDeck.localVolume,d]),g=u.useCallback(()=>{if(r.current){const k=Math.max(0,Math.min(1,t.leftDeck.localVolume));r.current.volume=k,console.log(`🔊 [LEFT DECK] Volume locale aggiornato: ${Math.round(k*100)}%`)}if(i.current){const k=Math.max(0,Math.min(1,t.rightDeck.localVolume));i.current.volume=k,console.log(`🔊 [RIGHT DECK] Volume locale aggiornato: ${Math.round(k*100)}%`)}},[t.leftDeck.localVolume,t.rightDeck.localVolume]);u.useEffect(()=>{console.log("🔊 [VOLUMES] Aggiornamento volumi locali richiesto"),g()},[g]),u.useEffect(()=>{console.log("🔊 [VOLUMES] Stato volumi cambiato - aggiornamento automatico"),g()},[t.leftDeck.localVolume,t.rightDeck.localVolume]);const m=u.useCallback(async()=>{var k;try{const E=(k=o==null?void 0:o.audio)==null?void 0:k.outputDevice;if(!E||E==="default"){console.log("🔊 [AUDIO] Usando dispositivo output predefinito");return}console.log(`🔊 [AUDIO] Configurazione dispositivo output: ${E}`);const T=[r.current,i.current].filter(Boolean);for(const L of T)if(L)try{"setSinkId"in L?(await L.setSinkId(E),console.log(`🔊 [AUDIO] Dispositivo output configurato per elemento audio: ${E}`)):console.warn("⚠️ [AUDIO] setSinkId non supportato, usa dispositivo predefinito")}catch(B){console.warn("⚠️ [AUDIO] Errore configurazione dispositivo output:",B)}}catch(E){console.error("❌ [AUDIO] Errore configurazione dispositivo output:",E)}},[(qe=o==null?void 0:o.audio)==null?void 0:qe.outputDevice]);u.useEffect(()=>{m()},[m]),u.useEffect(()=>{(r.current||i.current)&&(console.log("🔊 [AUDIO] Elementi audio pronti, riconfigurazione dispositivo output..."),m())},[r.current,i.current,m]),u.useEffect(()=>()=>{console.log("🧹 [CLEANUP] AudioProvider smontato, cleanup automatico..."),A.current&&(clearTimeout(A.current),A.current=null),w()},[w]),u.useEffect(()=>{const k=()=>{console.log("🧹 [CLEANUP] App in chiusura, cleanup stream audio..."),w()},E=()=>{console.log("🧹 [CLEANUP] App chiusa, cleanup finale..."),w()};return window.addEventListener("beforeunload",k),window.addEventListener("unload",E),()=>{window.removeEventListener("beforeunload",k),window.removeEventListener("unload",E)}},[w]),u.useEffect(()=>{console.log("🧹 [CLEANUP] Cleanup iniziale per rimuovere stream residui..."),w(),S()},[w,S]);const v=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));n({type:"SET_LEFT_DECK_LOCAL_VOLUME",payload:E}),r.current&&(r.current.volume=E,console.log(`🔊 [LEFT DECK] Volume locale impostato: ${Math.round(E*100)}% (HTML solo)`))},[n]),N=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));n({type:"SET_RIGHT_DECK_LOCAL_VOLUME",payload:E}),i.current&&(i.current.volume=E,console.log(`🔊 [RIGHT DECK] Volume locale impostato: ${Math.round(E*100)}% (HTML solo)`))},[n]),A=u.useRef(null),b=u.useCallback(async k=>{var E;if(console.log("🎯 [SEEK LEFT] Funzione seekLeftTo chiamata con time:",k),console.log("🎯 [SEEK LEFT] leftAudioRef.current:",!!r.current),console.log("🎯 [SEEK LEFT] leftAudioRef.current.src:",(E=r.current)==null?void 0:E.src),r.current&&r.current.src){const T=r.current.duration||0,L=Math.max(0,Math.min(T,k));r.current.currentTime=L,n({type:"SET_LEFT_DECK_TIME",payload:L}),console.log(`⏩ [LEFT DECK] Seek to ${L.toFixed(2)}s`),A.current&&clearTimeout(A.current),console.log("🎯 [SEEK LEFT] Seek completato - sincronizzazione continua gestirà l'aggiornamento"),setTimeout(()=>{const B=r.current;B&&console.log(`🔄 [SEEK SYNC] Forzando sincronizzazione posizione: ${B.currentTime.toFixed(2)}s`)},100)}},[n,d]),I=u.useCallback(async k=>{var E;if(console.log("🎯 [SEEK RIGHT] Funzione seekRightTo chiamata con time:",k),console.log("🎯 [SEEK RIGHT] rightAudioRef.current:",!!i.current),console.log("🎯 [SEEK RIGHT] rightAudioRef.current.src:",(E=i.current)==null?void 0:E.src),i.current&&i.current.src){const T=i.current.duration||0,L=Math.max(0,Math.min(T,k));i.current.currentTime=L,n({type:"SET_RIGHT_DECK_TIME",payload:L}),console.log(`⏩ [RIGHT DECK] Seek to ${L.toFixed(2)}s`),A.current&&clearTimeout(A.current),console.log("🎯 [SEEK RIGHT] Seek completato - sincronizzazione continua gestirà l'aggiornamento"),setTimeout(()=>{const B=i.current;B&&console.log(`🔄 [SEEK SYNC] Forzando sincronizzazione posizione: ${B.currentTime.toFixed(2)}s`)},100)}},[n,d]),j=u.useCallback(()=>{r.current&&r.current.src&&(r.current.pause(),n({type:"SET_LEFT_DECK_PLAYING",payload:!1}),console.log("⏸️ [LEFT DECK] Paused"),typeof window<"u"&&window.streamingManager&&window.streamingManager.isCurrentlyStreaming()&&(console.log("⏸️ [STREAMING SYNC] Pausa streaming per sincronizzazione con deck A"),typeof window<"u"&&window.pauseStreaming?(window.pauseStreaming(),console.log("⏸️ [STREAMING SYNC] Streaming pausato per sincronizzazione")):console.log("⚠️ [STREAMING SYNC] Funzione pauseStreaming non disponibile")))},[n]),R=u.useCallback(()=>{r.current&&r.current.src&&(r.current.play().catch(k=>{console.error("❌ Errore resume left deck:",k)}),n({type:"SET_LEFT_DECK_PLAYING",payload:!0}),console.log("▶️ [LEFT DECK] Resumed"),typeof window<"u"&&window.streamingManager&&window.streamingManager.isCurrentlyStreaming()&&(console.log("▶️ [STREAMING SYNC] Riprendi streaming per sincronizzazione con deck A"),typeof window<"u"&&window.resumeStreaming?(window.resumeStreaming(),console.log("▶️ [STREAMING SYNC] Streaming ripreso per sincronizzazione")):console.log("⚠️ [STREAMING SYNC] Funzione resumeStreaming non disponibile")))},[n]),F=u.useCallback(()=>{r.current&&(r.current.pause(),r.current.currentTime=0,n({type:"SET_LEFT_DECK_PLAYING",payload:!1}),n({type:"SET_LEFT_DECK_TIME",payload:0}),console.log("⏹️ [LEFT DECK] Stopped"))},[n]),te=u.useCallback(()=>{i.current&&i.current.src&&(i.current.pause(),n({type:"SET_RIGHT_DECK_PLAYING",payload:!1}),console.log("⏸️ [RIGHT DECK] Paused"),typeof window<"u"&&window.streamingManager&&window.streamingManager.isCurrentlyStreaming()&&(console.log("⏸️ [STREAMING SYNC] Pausa streaming per sincronizzazione con deck B"),typeof window<"u"&&window.pauseStreaming?(window.pauseStreaming(),console.log("⏸️ [STREAMING SYNC] Streaming pausato per sincronizzazione")):console.log("⚠️ [STREAMING SYNC] Funzione pauseStreaming non disponibile")))},[n]),oe=u.useCallback(()=>{i.current&&i.current.src&&(i.current.play().catch(k=>{console.error("❌ Errore resume right deck:",k)}),n({type:"SET_RIGHT_DECK_PLAYING",payload:!0}),console.log("▶️ [RIGHT DECK] Resumed"),typeof window<"u"&&window.streamingManager&&window.streamingManager.isCurrentlyStreaming()&&(console.log("▶️ [STREAMING SYNC] Riprendi streaming per sincronizzazione con deck B"),typeof window<"u"&&window.resumeStreaming?(window.resumeStreaming(),console.log("▶️ [STREAMING SYNC] Streaming ripreso per sincronizzazione")):console.log("⚠️ [STREAMING SYNC] Funzione resumeStreaming non disponibile")))},[n]),ie=u.useCallback(()=>{i.current&&(i.current.pause(),i.current.currentTime=0,n({type:"SET_RIGHT_DECK_PLAYING",payload:!1}),n({type:"SET_RIGHT_DECK_TIME",payload:0}),console.log("⏹️ [RIGHT DECK] Stopped"))},[n]),V=u.useCallback(async k=>{const E=k==="left"?r:i,T=k==="left"?t.leftDeck.isPlaying:t.rightDeck.isPlaying;if(E.current&&E.current.src)if(T)E.current.pause(),n({type:k==="left"?"SET_LEFT_DECK_PLAYING":"SET_RIGHT_DECK_PLAYING",payload:!1}),console.log(`⏸️ [${k.toUpperCase()} DECK] Paused`),window.pauseStreaming&&(console.log(`⏸️ [STREAMING] Pausa streaming richiesta da ${k} deck`),window.pauseStreaming());else try{await E.current.play(),n({type:k==="left"?"SET_LEFT_DECK_PLAYING":"SET_RIGHT_DECK_PLAYING",payload:!0}),console.log(`▶️ [${k.toUpperCase()} DECK] Playing`),window.resumeStreaming&&(console.log(`▶️ [STREAMING] Riprendi streaming richiesto da ${k} deck`),window.resumeStreaming())}catch(L){console.error(`❌ Errore play ${k} deck:`,L)}},[r,i,t.leftDeck.isPlaying,t.rightDeck.isPlaying,n]),se=u.useCallback(k=>{var E;if(console.log(`🎤 [STREAMING] Ducking ${k?"attivato":"disattivato"}`),typeof window.updatePTTVolumesOnly=="function"){const T=((E=o==null?void 0:o.microphone)==null?void 0:E.duckingPercent)??75,L=T/100;window.__pttDuckingLevel__=L,typeof console<"u"&&console.log&&console.log(`🎤 [PTT] Ducking level impostato dalle impostazioni: ${T}% (${L})`),window.updatePTTVolumesOnly(k)}else console.warn("⚠️ [PTT] Funzione updatePTTVolumesOnly non disponibile")},[(Fe=o==null?void 0:o.microphone)==null?void 0:Fe.duckingPercent]),ae=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));console.log(`🔊 [STREAMING] Volume master streaming impostato: ${Math.round(E*100)}%`),window.__currentStreamVolume__=E,r.current&&(r.current.volume=E),i.current&&(i.current.volume=E)},[r.current,i.current]),W=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));console.log(`🔊 [MASTER] Volume master generale impostato: ${Math.round(E*100)}%`),typeof window.audioContextSetMasterVolume=="function"&&window.audioContextSetMasterVolume(E)},[]),D=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));console.log(`🎚️ [CROSSFADER] Crossfader impostato: ${Math.round(E*100)}% (A=${Math.round((1-E)*100)}%, B=${Math.round(E*100)}%)`),n({type:"SET_CROSSFADER",payload:E}),typeof window<"u"&&window.updateStreamingCrossfader&&window.updateStreamingCrossfader(E)},[]),M=u.useCallback(k=>{const E=Math.max(0,Math.min(1,k));console.log(`🔊 [LIVE STREAM] Volume Live Stream impostato: ${Math.round(E*100)}%`),window.dispatchEvent(new CustomEvent("djconsole:stream-volume-change",{detail:{volume:E}})),window.__currentStreamVolume__=E,console.log(`🔊 [INTERFACE] Volume Live Stream aggiornato nell'interfaccia: ${Math.round(E*100)}%`)},[]);window.setStreamMasterVolume=ae,window.setMasterVolume=W,window.setLiveStreamVolume=M,window.updateStreamingCrossfader=k=>{try{console.log(`🎚️ [CROSSFADER] Aggiornamento crossfader streaming a ${Math.round(k*100)}%`);const E=window.leftDeckStreamGain,T=window.rightDeckStreamGain,L=window.currentMixContext;if(E&&T&&L){const B=1-k;E.gain.setValueAtTime(B,L.currentTime);const P=k;T.gain.setValueAtTime(P,L.currentTime),console.log(`🎚️ [CROSSFADER] Streaming aggiornato: A=${Math.round(B*100)}%, B=${Math.round(P*100)}%`)}else console.warn("⚠️ [CROSSFADER] Gain nodes non disponibili per aggiornamento crossfader")}catch(E){console.error("❌ [CROSSFADER] Errore aggiornamento crossfader streaming:",E.message)}},window.__currentStreamVolume__=1;const J=async(k,E)=>{console.log(`🎵 [DECK] Aggiunta track "${k.title}" al deck ${E}`);try{const T={id:k.id,title:k.title,artist:k.artist,duration:k.duration,url:""};if(E==="left"){if(n({type:"SET_LEFT_DECK_TRACK",payload:T}),r.current){const L=await ci(k.blobId);if(L){const B=URL.createObjectURL(L);if(r.current.src=B,r.current.load(),console.log(`✅ [DECK] Track caricata nel deck sinistro: ${k.title}`),typeof window<"u"&&window.reconnectDeckToStreaming)try{console.log("🎵 [DECK] Aspetto caricamento completo deck A prima del ricollegamento..."),await new Promise(P=>setTimeout(P,500)),await window.reconnectDeckToStreaming("A"),console.log("✅ [DECK] Deck A ricollegato automaticamente allo streaming")}catch(P){console.warn("⚠️ [DECK] Ricollegamento automatico deck A fallito:",P.message)}if(typeof window<"u"&&window.isCurrentlyStreaming)try{console.log("🎵 [DECK LEFT] Streaming attivo rilevato - forzo ricreazione mixed stream..."),console.log("🎵 [DECK LEFT] isCurrentlyStreaming:",window.isCurrentlyStreaming);const P=await d();if(console.log("🎵 [DECK LEFT] newMixedStream creato:",!!P,P==null?void 0:P.active,P==null?void 0:P.getTracks().length),P){console.log("🎵 [DECK LEFT] Chiamata waitForStreamingManager...");const H=await h();if(console.log("🎵 [DECK LEFT] streamingManager ricevuto:",!!H),H){console.log("📡 [DECK LEFT] StreamingManager disponibile, aggiorno stream..."),console.log("📡 [DECK LEFT] Chiamata updateStream con stream:",!!P);const G=await H.updateStream(P);console.log("📡 [DECK LEFT] updateStream risultato:",G),G?(console.log("✅ [DECK] Mixed stream ricreato e aggiornato con successo per deck A"),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Deck A Connesso","Deck A connesso automaticamente allo streaming","audio")):console.warn("⚠️ [DECK] Aggiornamento streaming fallito per deck A")}else console.warn("⚠️ [DECK] StreamingManager non disponibile per aggiornamento")}else console.warn("⚠️ [DECK] Nuovo mixed stream non valido")}catch(P){console.error("❌ [DECK] Errore ricreazione mixed stream per deck A:",P.message)}}else console.error(`❌ [DECK] Blob non trovato per track: ${k.title}`)}}else if(n({type:"SET_RIGHT_DECK_TRACK",payload:T}),i.current){const L=await ci(k.blobId);if(L){const B=URL.createObjectURL(L);if(i.current.src=B,i.current.load(),console.log(`✅ [DECK] Track caricata nel deck destro: ${k.title}`),typeof window<"u"&&window.reconnectDeckToStreaming)try{console.log("🎵 [DECK] Aspetto caricamento completo deck B prima del ricollegamento..."),await new Promise(P=>setTimeout(P,500)),await window.reconnectDeckToStreaming("B"),console.log("✅ [DECK] Deck B ricollegato automaticamente allo streaming")}catch(P){console.warn("⚠️ [DECK] Ricollegamento automatico deck B fallito:",P.message)}if(typeof window<"u"&&window.isCurrentlyStreaming)try{console.log("🎵 [DECK] Streaming attivo rilevato - forzo ricreazione mixed stream...");const P=await d();if(P){const H=await h();if(H){console.log("📡 [DECK RIGHT] StreamingManager disponibile, aggiorno stream..."),console.log("📡 [DECK RIGHT] Chiamata updateStream con stream:",!!P);const G=await H.updateStream(P);console.log("📡 [DECK RIGHT] updateStream risultato:",G),G?(console.log("✅ [DECK] Mixed stream ricreato e aggiornato con successo per deck B"),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification("success","Deck B Connesso","Deck B connesso automaticamente allo streaming","audio")):console.warn("⚠️ [DECK] Aggiornamento streaming fallito per deck B")}else console.warn("⚠️ [DECK] StreamingManager non disponibile per aggiornamento")}else console.warn("⚠️ [DECK] Nuovo mixed stream non valido")}catch(P){console.error("❌ [DECK] Errore ricreazione mixed stream per deck B:",P.message)}}else console.error(`❌ [DECK] Blob non trovato per track: ${k.title}`)}}catch(T){console.error(`❌ [DECK] Errore caricamento track nel deck ${E}:`,T)}},Q=async k=>{try{await Y.waitForInitialization();const E=await Y.getTrack(k);if(E){const T=(E.playCount||0)+1;await Y.updateTrack(k,{playCount:T}),console.log(`✅ Play count incrementato per track ${k}: ${T}`)}}catch(E){console.error(`❌ Errore incremento play count per track ${k}:`,E)}};u.useEffect(()=>{if(window.indexedDB){const k=window.indexedDB.open("djconsole",1);k.onerror=()=>{console.error("❌ Error opening IndexedDB for audio persistence")},k.onsuccess=()=>{console.log("✅ IndexedDB opened successfully for audio persistence")},k.onupgradeneeded=E=>{const T=E.target.result;T.objectStoreNames.contains("audioState")||(T.createObjectStore("audioState",{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("✅ Audio state store created in IndexedDB"))}}},[]);const he=async()=>{try{if(a.current){console.log("🧹 [MICROPHONE] Pulizia stream microfono precedente...");try{a.current.getTracks().forEach(q=>{q.stop(),console.log(`🧹 [MICROPHONE] Track microfono fermato: ${q.label}`)})}catch(q){console.warn("⚠️ [MICROPHONE] Errore fermando track precedenti:",q)}a.current=null}const k=await Y.getSettings(),E=(k==null?void 0:k.microphone)||{inputDevice:"default",sampleRate:48e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1};console.log("🎤 [MIC] Usando impostazioni microfono dalle settings:",E);let T;if(E.inputDevice&&E.inputDevice!=="default")try{const fe=(await navigator.mediaDevices.enumerateDevices()).filter(xe=>xe.kind==="audioinput");console.log("🎤 [MIC] Dispositivi audio input disponibili:",fe);const ee=fe.find(xe=>xe.label===E.inputDevice||xe.deviceId===E.inputDevice);ee?(T=ee.deviceId,console.log("🎤 [MIC] Usando dispositivo microfono specifico:",ee.label,ee.deviceId)):console.warn("⚠️ [MIC] Dispositivo microfono non trovato, uso default")}catch(q){console.warn("⚠️ [MIC] Errore enumerazione dispositivi:",q)}const L={audio:{echoCancellation:E.echoCancellation,noiseSuppression:E.noiseSuppression,autoGainControl:E.autoGainControl,latency:0,sampleRate:E.sampleRate,channelCount:1,sampleSize:16,...T&&{deviceId:T},googEchoCancellation:!0,googNoiseSuppression:!0,googAutoGainControl:!1,googHighpassFilter:!0,googTypingNoiseDetection:!0,googAudioMirroring:!1,googDAEchoCancellation:!0,googNoiseReduction:!0,googBeamforming:!0,suppressLocalAudioPlayback:!0,googEchoCancellation2:!0,googNoiseSuppression2:!0,googHighpassFilter2:!0,googTypingNoiseDetection2:!0,googAudioMirroring2:!1}};console.log("🎤 [MIC] Configurazione anti-eco + esclusione audio live applicata:",L);const B=await navigator.mediaDevices.getUserMedia(L);if(console.log("🎤 [MIC] Stream microfono creato con esclusione audio live"),console.log("🎤 [MIC] Audio tracks:",B.getAudioTracks().map(q=>({id:q.id,label:q.label,enabled:q.enabled,muted:q.muted,settings:q.getSettings()}))),window.addAudioStreamToTracking&&window.addAudioStreamToTracking(B),typeof window<"u"&&window.AudioContext)try{(window.__audioContexts||[]).forEach((fe,ee)=>{fe&&fe.state!=="closed"&&ee>0?(fe.close(),console.log(`🧹 [MICROPHONE] AudioContext temporaneo ${ee} chiuso`)):ee===0&&console.log("🧹 [MICROPHONE] AudioContext principale mantenuto attivo")})}catch(q){console.warn("⚠️ [MICROPHONE] Errore chiudendo AudioContext temporanei:",q)}let P=S();if(!P)throw new Error("Impossibile creare AudioContext per microfono");console.log("🎤 [MIC] AudioContext principale disponibile per microfono");const H=P.createMediaStreamSource(B),G=P.createMediaStreamDestination(),me=P.createBiquadFilter();me.type="lowpass",me.frequency.value=8e3,me.Q.value=.5;const ue=P.createBiquadFilter();ue.type="highpass",ue.frequency.value=80,ue.Q.value=1;const ht=P.createGain();ht.gain.setValueAtTime(1,P.currentTime);const Ye=P.createConvolver(),Gt=P.createGain(),hn=P.createGain(),ln=P.sampleRate*2,Ae=P.createBuffer(2,ln,P.sampleRate),Gn=Ae.getChannelData(0),ne=Ae.getChannelData(1);for(let q=0;q<ln;q++){const fe=q/P.sampleRate,ee=Math.exp(-fe*2)*(Math.random()*2-1)*.3;Gn[q]=ee,ne[q]=ee*.8}return Ye.buffer=Ae,Gt.gain.setValueAtTime(0,P.currentTime),hn.gain.setValueAtTime(1,P.currentTime),H.connect(me),me.connect(ue),ue.connect(ht),ht.connect(hn),ht.connect(Ye),Ye.connect(Gt),hn.connect(G),Gt.connect(G),window.microphoneGain=ht,window.microphoneReverbGain=Gt,window.microphoneDryGain=hn,window.destinationStream=G,console.log("🎤 [MIC] Filtri anti-eco e reverbero applicati con successo"),G.stream}catch(k){return console.error("❌ [MIC] Errore creazione stream microfono anti-eco:",k),null}},Be=()=>{let k=!1,E=null;const T=async()=>{try{if(k&&E)return console.log("🎤 [SMART-MIC] Microfono già attivo"),!0;if(console.log("🎤 [SMART-MIC] Attivazione microfono..."),console.log("🎤 [SMART-MIC] Creazione stream microfono con impostazioni settings..."),E=await he(),!E)throw new Error("Impossibile creare stream microfono");return console.log("🎤 [SMART-MIC] Stream microfono creato con successo:",{id:E.id,active:E.active,tracks:E.getTracks().length}),window.addAudioStreamToTracking&&window.addAudioStreamToTracking(E),k=!0,console.log("✅ [SMART-MIC] Microfono attivato con successo"),!0}catch(H){return console.error("❌ [SMART-MIC] Errore attivazione microfono:",H),!1}},L=()=>{try{console.log("🎤 [SMART-MIC] Disattivazione microfono..."),E&&(window.removeAudioStreamFromTracking&&window.removeAudioStreamFromTracking(E),E.getTracks().forEach(H=>{H.stop(),H.enabled=!1}),E=null),k=!1,console.log("✅ [SMART-MIC] Microfono disattivato")}catch(H){console.error("❌ [SMART-MIC] Errore disattivazione microfono:",H)}},B=()=>E,P=()=>k;return window.smartMicrophone={enable:T,disable:L,getStream:B,isActive:P},{enable:T,disable:L,getStream:B,isActive:P}},ut=Be();return window.smartMicrophoneControl=ut,s.jsxs(Pf.Provider,{value:{state:t,leftAudioRef:r,rightAudioRef:i,micStreamRef:a,soundEffectsManagerRef:l,microphoneEffectsManagerRef:c,getMixedStream:d,createMicrophoneStream:he,createSmartMicrophoneControl:Be,getAvailableAudioOutputDevices:x,ensureMainAudioContext:S,playLeftTrack:C,playRightTrack:f,pauseLeftTrack:j,resumeLeftTrack:R,stopLeftTrack:F,pauseRightTrack:te,resumeRightTrack:oe,stopRightTrack:ie,handlePlayPauseDefinitive:V,setLeftLocalVolume:v,setRightLocalVolume:N,seekLeftTo:b,seekRightTo:I,setStreamDucking:se,setStreamMasterVolume:ae,setMasterVolume:W,setCrossfader:D,addToDeck:J,incrementPlayCount:Q,dispatch:n},children:[s.jsx("audio",{ref:r,preload:"metadata","data-deck":"A",className:"deck-audio",onLoadedMetadata:()=>{r.current&&n({type:"SET_LEFT_DECK_DURATION",payload:r.current.duration})},onTimeUpdate:()=>{if(r.current){const k=r.current.currentTime,E=r.current.duration;k<=E&&k>=0&&(n({type:"SET_LEFT_DECK_TIME",payload:k}),console.log(`⏰ [LEFT DECK] Time update: ${k.toFixed(2)}s / ${E.toFixed(2)}s`))}},onPlay:()=>n({type:"SET_LEFT_DECK_PLAYING",payload:!0}),onPause:()=>n({type:"SET_LEFT_DECK_PLAYING",payload:!1}),onEnded:()=>{console.log("🔚 [LEFT DECK] onEnded event triggered!"),n({type:"SET_LEFT_DECK_PLAYING",payload:!1}),n({type:"SET_LEFT_DECK_TIME",payload:0});const k=new CustomEvent("djconsole:track-ended",{detail:{deckId:"A"}});window.dispatchEvent(k),console.log("🔚 [LEFT DECK] Track ended - auto-advance event emitted")},onVolumeChange:()=>{r.current&&n({type:"SET_LEFT_DECK_LOCAL_VOLUME",payload:r.current.volume})}}),s.jsx("audio",{ref:i,preload:"metadata","data-deck":"B",className:"deck-audio",onLoadedMetadata:()=>{i.current&&n({type:"SET_RIGHT_DECK_DURATION",payload:i.current.duration})},onTimeUpdate:()=>{if(i.current){const k=i.current.currentTime,E=i.current.duration;k<=E&&k>=0&&(n({type:"SET_RIGHT_DECK_TIME",payload:k}),console.log(`⏰ [RIGHT DECK] Time update: ${k.toFixed(2)}s / ${E.toFixed(2)}s`))}},onPlay:()=>n({type:"SET_RIGHT_DECK_PLAYING",payload:!0}),onPause:()=>n({type:"SET_RIGHT_DECK_PLAYING",payload:!1}),onEnded:()=>{console.log("🔚 [RIGHT DECK] onEnded event triggered!"),n({type:"SET_RIGHT_DECK_PLAYING",payload:!1}),n({type:"SET_RIGHT_DECK_TIME",payload:0});const k=new CustomEvent("djconsole:track-ended",{detail:{deckId:"B"}});window.dispatchEvent(k),console.log("🔚 [RIGHT DECK] Track ended - auto-advance event emitted")},onVolumeChange:()=>{i.current&&n({type:"SET_RIGHT_DECK_LOCAL_VOLUME",payload:i.current.volume})}}),e]})};function an(){const e=u.useContext(Pf);if(e===void 0)throw new Error("useAudio must be used within an AudioProvider");return e}const sv={library:{tracks:[],playlists:[],genres:[],artists:[],albums:[]},currentPlaylist:null,currentTrack:null,searchQuery:"",filterGenre:"",filterArtist:"",sortBy:"title",sortOrder:"asc",isLoading:!1,error:null};function av(e,t){var n,o;switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"SET_SEARCH_QUERY":return{...e,searchQuery:t.payload};case"SET_FILTER_GENRE":return{...e,filterGenre:t.payload};case"SET_FILTER_ARTIST":return{...e,filterArtist:t.payload};case"SET_SORT_BY":return{...e,sortBy:t.payload};case"SET_SORT_ORDER":return{...e,sortOrder:t.payload};case"SET_CURRENT_PLAYLIST":return{...e,currentPlaylist:t.payload};case"SET_CURRENT_TRACK":return{...e,currentTrack:t.payload};case"ADD_TRACK":return{...e,library:{...e.library,tracks:[...e.library.tracks,t.payload],artists:e.library.artists.includes(t.payload.artist)?e.library.artists:[...e.library.artists,t.payload.artist],genres:t.payload.genre&&!e.library.genres.includes(t.payload.genre)?[...e.library.genres,t.payload.genre]:e.library.genres,albums:t.payload.album&&!e.library.albums.includes(t.payload.album)?[...e.library.albums,t.payload.album]:e.library.albums}};case"REMOVE_TRACK":return{...e,library:{...e.library,tracks:e.library.tracks.filter(r=>r.id!==t.payload),playlists:e.library.playlists.map(r=>({...r,tracks:r.tracks.filter(i=>i.id!==t.payload)}))}};case"UPDATE_TRACK":return{...e,library:{...e.library,tracks:e.library.tracks.map(r=>r.id===t.payload.id?t.payload:r)}};case"CREATE_PLAYLIST":return{...e,library:{...e.library,playlists:[...e.library.playlists,t.payload]}};case"DELETE_PLAYLIST":return{...e,library:{...e.library,playlists:e.library.playlists.filter(r=>r.id!==t.payload)},currentPlaylist:((n=e.currentPlaylist)==null?void 0:n.id)===t.payload?null:e.currentPlaylist};case"UPDATE_PLAYLIST":return{...e,library:{...e.library,playlists:e.library.playlists.map(r=>r.id===t.payload.id?t.payload:r)},currentPlaylist:((o=e.currentPlaylist)==null?void 0:o.id)===t.payload.id?t.payload:e.currentPlaylist};case"ADD_TRACK_TO_PLAYLIST":return{...e,library:{...e.library,playlists:e.library.playlists.map(r=>r.id===t.payload.playlistId?{...r,tracks:[...r.tracks,t.payload.track],updatedAt:new Date}:r)}};case"REMOVE_TRACK_FROM_PLAYLIST":return{...e,library:{...e.library,playlists:e.library.playlists.map(r=>r.id===t.payload.playlistId?{...r,tracks:r.tracks.filter(i=>i.id!==t.payload.trackId),updatedAt:new Date}:r)}};case"REORDER_PLAYLIST_TRACKS":return{...e,library:{...e.library,playlists:e.library.playlists.map(r=>r.id===t.payload.playlistId?{...r,tracks:t.payload.trackIds.map(i=>r.tracks.find(a=>a.id===i)),updatedAt:new Date}:r)}};case"LOAD_LIBRARY":return{...e,library:t.payload};case"INCREMENT_PLAY_COUNT":return{...e,library:{...e.library,tracks:e.library.tracks.map(r=>r.id===t.payload?{...r,playCount:r.playCount+1}:r)}};default:return e}}const Lf=u.createContext(void 0);function lv({children:e}){const t=u.useRef(0),n=u.useRef(Date.now());u.useEffect(()=>{t.current++;const m=Date.now(),v=m-n.current;n.current=m,t.current%10===0&&console.log(`🔄 [PLAYLIST_CONTEXT] Re-render #${t.current} - Time since last: ${v}ms`)});const[o,r]=u.useReducer(av,sv);u.useEffect(()=>{const m=async()=>{try{r({type:"SET_LOADING",payload:!0}),await Y.waitForInitialization();const I=await Y.getAllTracks(),j=await Y.getAllPlaylists(),R=await Promise.all(j.map(async V=>{const ae=(await Promise.all(V.tracks.map(D=>Y.getTrack(D)))).filter(D=>D!==null),W=ae.reduce((D,M)=>D+M.duration,0);return{...V,tracks:ae,isPublic:!0,totalDuration:W}})),F=[...new Set(I.map(V=>V.genre).filter(Boolean))],te=[...new Set(I.map(V=>V.artist).filter(Boolean))],oe=[...new Set(I.map(V=>V.album).filter(Boolean))];r({type:"LOAD_LIBRARY",payload:{tracks:I,playlists:R,genres:F,artists:te,albums:oe}})}catch(I){console.error("Failed to load library:",I),r({type:"SET_ERROR",payload:"Failed to load library"})}finally{r({type:"SET_LOADING",payload:!1})}};m();const v=async()=>{console.log("🔄 [PLAYLIST_CONTEXT] Page focused - reloading data for sync");try{const I=await Y.getAllPlaylists(),j=await Promise.all(I.map(async R=>{const te=(await Promise.all(R.tracks.map(ie=>Y.getTrack(ie)))).filter(ie=>ie!==null),oe=te.reduce((ie,V)=>ie+V.duration,0);return{...R,tracks:te,isPublic:!0,totalDuration:oe}}));r({type:"LOAD_LIBRARY",payload:{...o.library,playlists:j}}),console.log("✅ [PLAYLIST_CONTEXT] Data reloaded on focus:",{playlists:j.length})}catch(I){console.error("❌ [PLAYLIST_CONTEXT] Error reloading data on focus:",I)}};window.addEventListener("focus",v);const N=async I=>{const R=I.detail;if((R==null?void 0:R.kind)==="playlists"){console.log("🔄 [PLAYLIST] Playlist updated, skipping full reload to avoid re-render loop");return}console.log("🔄 [PLAYLIST] Database updated, refreshing library...",R),await m()},A=async I=>{const{playlistId:j,updatedTracks:R,updatedPlaylists:F}=I.detail;console.log("🔄 [PLAYLIST_CONTEXT] Library playlist updated - syncing:",{playlistId:j,trackCount:(R==null?void 0:R.length)||0});try{if(F&&Array.isArray(F)){const te=await Promise.all(F.map(async oe=>{if(oe.tracks&&Array.isArray(oe.tracks)&&oe.tracks.length>0&&oe.tracks[0].title){const ie=oe.tracks.filter(se=>se&&se.title),V=ie.reduce((se,ae)=>se+ae.duration,0);return{...oe,tracks:ie,isPublic:!0,totalDuration:V}}else{const V=(await Promise.all(oe.tracks.map(ae=>Y.getTrack(ae)))).filter(ae=>ae!==null),se=V.reduce((ae,W)=>ae+W.duration,0);return{...oe,tracks:V,isPublic:!0,totalDuration:se}}}));r({type:"LOAD_LIBRARY",payload:{...o.library,playlists:te}}),console.log("✅ [PLAYLIST_CONTEXT] Playlists synced from library")}}catch(te){console.error("❌ [PLAYLIST_CONTEXT] Error syncing playlists from library:",te),await m()}},b=async I=>{const{updatedPlaylists:j}=I.detail;if(console.log("🔄 [PLAYLIST_CONTEXT] Force playlist refresh requested:",{count:j==null?void 0:j.length}),j){const R=await Promise.all(j.map(async F=>{const oe=(await Promise.all(F.tracks.map(V=>Y.getTrack(V)))).filter(V=>V!==null),ie=oe.reduce((V,se)=>V+se.duration,0);return{...F,tracks:oe,isPublic:!0,totalDuration:ie}}));r({type:"LOAD_LIBRARY",payload:{...o.library,playlists:R}}),console.log("✅ [PLAYLIST_CONTEXT] Playlists force refreshed")}};return window.addEventListener("djconsole:db-updated",N),window.addEventListener("djconsole:library-playlist-updated",A),window.addEventListener("djconsole:force-playlist-refresh",b),()=>{window.removeEventListener("djconsole:db-updated",N),window.removeEventListener("djconsole:library-playlist-updated",A),window.removeEventListener("djconsole:force-playlist-refresh",b),window.removeEventListener("focus",v)}},[]);const g={state:o,dispatch:r,getFilteredTracks:()=>{let m=o.library.tracks;if(o.searchQuery){const v=o.searchQuery.toLowerCase();m=m.filter(N=>{var A,b;return N.title.toLowerCase().includes(v)||N.artist.toLowerCase().includes(v)||((A=N.album)==null?void 0:A.toLowerCase().includes(v))||((b=N.genre)==null?void 0:b.toLowerCase().includes(v))})}return o.filterGenre&&(m=m.filter(v=>v.genre===o.filterGenre)),o.filterArtist&&(m=m.filter(v=>v.artist===o.filterArtist)),m.sort((v,N)=>{let A=v[o.sortBy],b=N[o.sortBy];return o.sortBy==="addedAt"&&(A=A.getTime(),b=b.getTime()),A<b?o.sortOrder==="asc"?-1:1:A>b?o.sortOrder==="asc"?1:-1:0}),m},getFilteredPlaylists:()=>{let m=o.library.playlists;if(o.searchQuery){const v=o.searchQuery.toLowerCase();m=m.filter(N=>{var A;return N.name.toLowerCase().includes(v)||((A=N.description)==null?void 0:A.toLowerCase().includes(v))})}return m},createPlaylist:async(m,v)=>{try{const A={id:await Y.createPlaylist({name:m,description:v,tracks:[],isAutoPlaylist:!1}),name:m,description:v,tracks:[],createdAt:new Date,updatedAt:new Date,isPublic:!0,totalDuration:0,isAutoPlaylist:!1};r({type:"CREATE_PLAYLIST",payload:A})}catch(N){console.error("Failed to create playlist:",N),r({type:"SET_ERROR",payload:"Failed to create playlist"})}},deletePlaylist:async m=>{try{await Y.deletePlaylist(m),r({type:"DELETE_PLAYLIST",payload:m})}catch(v){console.error("Failed to delete playlist:",v),r({type:"SET_ERROR",payload:"Failed to delete playlist"})}},updatePlaylist:async m=>{try{await Y.updatePlaylist(m.id,{name:m.name,description:m.description,tracks:m.tracks.map(v=>v.id)}),r({type:"UPDATE_PLAYLIST",payload:m})}catch(v){console.error("Failed to update playlist:",v),r({type:"SET_ERROR",payload:"Failed to update playlist"})}},reorderPlaylist:async(m,v)=>{try{await Y.reorderPlaylist(m,v),r({type:"REORDER_PLAYLIST_TRACKS",payload:{playlistId:m,trackIds:v}})}catch(N){console.error("Failed to reorder playlist:",N),r({type:"SET_ERROR",payload:"Failed to reorder playlist"})}},addTrackToPlaylist:async(m,v)=>{try{await Y.addTrackToPlaylist(m,v.id),r({type:"ADD_TRACK_TO_PLAYLIST",payload:{playlistId:m,track:v}})}catch(N){console.error("Failed to add track to playlist:",N),r({type:"SET_ERROR",payload:"Failed to add track to playlist"})}},removeTrackFromPlaylist:async(m,v)=>{try{await Y.removeTrackFromPlaylist(m,v),r({type:"REMOVE_TRACK_FROM_PLAYLIST",payload:{playlistId:m,trackId:v}})}catch(N){console.error("Failed to remove track from playlist:",N),r({type:"SET_ERROR",payload:"Failed to remove track from playlist"})}},searchTracks:m=>o.library.tracks.filter(v=>v.title.toLowerCase().includes(m.toLowerCase())||v.artist.toLowerCase().includes(m.toLowerCase())),getTracksByGenre:m=>o.library.tracks.filter(v=>v.genre===m),getTracksByArtist:m=>o.library.tracks.filter(v=>v.artist===m),getPlaylistById:m=>o.library.playlists.find(v=>v.id===m),getTrackById:m=>o.library.tracks.find(v=>v.id===m)};return s.jsx(Lf.Provider,{value:g,children:e})}function xr(){const e=u.useContext(Lf);if(e===void 0)throw new Error("usePlaylist must be used within a PlaylistProvider");return e}const Tc=({waveformData:e,currentTime:t,duration:n,isPlaying:o,deck:r,className:i="",onSeek:a})=>{const{settings:l}=Bn(),c=u.useRef(null),d=u.useRef(),[h,p]=u.useState(null);if(!l.interface.showWaveforms)return null;const y=n>0?t/n*e.length:0;u.useEffect(()=>{const C=c.current;if(!C||e.length===0)return;const f=C.getContext("2d");if(!f)return;const{width:g,height:m}=C;f.clearRect(0,0,g,m);const v=g/e.length,N=m*.8;if(e.forEach((A,b)=>{const I=b*v,j=A*N,R=(m-j)/2;let F="#6366f1";b<=y&&(F="#f59e0b"),b===h&&(F="#ef4444"),f.fillStyle=F,f.fillRect(I,R,v-1,j),o&&b<=y&&(f.fillStyle="rgba(255, 255, 255, 0.3)",f.fillRect(I,R,v-1,j))}),n>0&&t>=0){const A=t/n*g;if(f.strokeStyle="#ef4444",f.lineWidth=4,f.shadowColor="#ef4444",f.shadowBlur=8,f.beginPath(),f.moveTo(A,0),f.lineTo(A,m),f.stroke(),f.shadowColor="transparent",f.shadowBlur=0,f.fillStyle="#ef4444",f.beginPath(),f.arc(A,m/2,8,0,2*Math.PI),f.fill(),f.fillStyle="#ffffff",f.beginPath(),f.arc(A,m/2,4,0,2*Math.PI),f.fill(),o){const b=.7+Math.sin(Date.now()*.008)*.3;f.fillStyle=`rgba(239, 68, 68, ${b})`,f.beginPath(),f.arc(A,m/2,12,0,2*Math.PI),f.fill()}}},[e,t,n,o,h]);const x=C=>{const f=c.current;if(!f||n<=0)return;const g=f.getBoundingClientRect(),N=(C.clientX-g.left)/f.width*n;if(console.log(`🎵 Waveform seek: ${N.toFixed(2)}s`),a)a(N);else{const A=new CustomEvent("waveform:seek",{detail:{time:N,deck:r}});window.dispatchEvent(A)}},S=C=>{const f=c.current;if(!f||e.length===0)return;const g=f.getBoundingClientRect(),m=C.clientX-g.left,v=f.width/e.length,N=Math.floor(m/v);N>=0&&N<e.length?p(N):p(null)},w=()=>{p(null)};return u.useEffect(()=>{if(o&&l.interface.animations){const C=()=>{if(c.current){const m=c.current.getContext("2d");if(m){const v=.9+Math.sin(Date.now()*.005)*.1;m.globalAlpha=v}}d.current=requestAnimationFrame(C)},f=setInterval(()=>{d.current&&cancelAnimationFrame(d.current),d.current=requestAnimationFrame(C)},100);return()=>clearInterval(f)}else d.current&&cancelAnimationFrame(d.current);return()=>{d.current&&cancelAnimationFrame(d.current)}},[o,l.interface.animations]),s.jsxs("div",{className:`dynamic-waveform ${i}`,children:[s.jsx("canvas",{ref:c,width:400,height:80,className:"w-full h-20 cursor-pointer rounded-lg",onClick:x,onMouseMove:S,onMouseLeave:w,style:{background:"linear-gradient(180deg, #1e293b 0%, #334155 100%)",border:"1px solid rgba(99, 102, 241, 0.2)"}}),h!==null&&s.jsxs("div",{className:"absolute bg-dj-secondary border border-dj-accent/30 rounded px-2 py-1 text-xs text-white pointer-events-none z-10",children:["Barra ",h+1,": ",Math.round(e[h]*100),"%"]})]})},bc=u.memo(({deck:e,className:t=""})=>{const{state:n}=an(),o=e==="left"?n.leftDeck.currentTime:n.rightDeck.currentTime,r=e==="left"?n.leftDeck.duration:n.rightDeck.duration,i=a=>{const l=Math.floor(a/60),c=Math.floor(a%60);return`${l}:${c.toString().padStart(2,"0")}`};return s.jsx("div",{className:`timer-display ${t}`,children:s.jsxs("span",{className:"text-sm font-mono",children:[i(o)," / ",i(r)]})})});bc.displayName="TimerDisplay";const Ju=({side:e,isActive:t,onActivate:n,track:o})=>{var V,se,ae,W;const{playLeftTrack:r,pauseLeftTrack:i,resumeLeftTrack:a,stopLeftTrack:l,playRightTrack:c,pauseRightTrack:d,resumeRightTrack:h,stopRightTrack:p,setLeftLocalVolume:y,setRightLocalVolume:x,seekLeftTo:S,seekRightTo:w,handlePlayPauseDefinitive:C,state:f}=an(),[g,m]=u.useState(.8);u.useState([]),u.useState(0);const[v,N]=u.useState(!1);Qn.useEffect(()=>{m(e==="left"?f.leftDeck.localVolume:f.rightDeck.localVolume)},[e,f.leftDeck.localVolume,f.rightDeck.localVolume]),Qn.useEffect(()=>{const D=M=>{t&&(e==="left"?S(M.detail.time):w(M.detail.time))};return window.addEventListener("waveform:seek",D),()=>window.removeEventListener("waveform:seek",D)},[t,e,S,w]);const A=()=>{o&&!v&&(N(!0),setTimeout(()=>N(!1),500),console.log(`🎮 AudioDeck ${e} handlePlay called with DEFINITIVE function`),e==="left"&&!f.leftDeck.track?(console.log("🎵 Loading track in left deck first"),r(o),setTimeout(()=>{C("left")},100)):e==="right"&&!f.rightDeck.track?(console.log("🎵 Loading track in right deck first"),c(o),setTimeout(()=>{C("right")},100)):C(e))},b=()=>{C(e)},I=()=>{const D=document.querySelector(`audio[data-deck="${e}"]`);if(D&&D.src){const M=D.currentTime,J=Math.max(0,M-10);D.currentTime=J,console.log(`⏪ [SKIP] Deck ${e}: Skip backward to ${J.toFixed(1)}s`)}},j=()=>{const D=document.querySelector(`audio[data-deck="${e}"]`);if(D&&D.src){const M=D.currentTime,J=D.duration||0,Q=Math.min(J,M+10);D.currentTime=Q,console.log(`⏩ [SKIP] Deck ${e}: Skip forward to ${Q.toFixed(1)}s`)}},R=D=>{m(D),e==="left"?y(D):x(D);const M=document.querySelector(`audio[data-deck="${e}"]`);M&&(M.volume=D,console.log(`🔊 [VOLUME] Deck ${e}: ${Math.round(D*100)}%`))},F=(e==="left"?f.leftDeck.track:f.rightDeck.track)||o,te=e==="left"?((V=f.leftDeck.track)==null?void 0:V.id)===(F==null?void 0:F.id)&&f.leftDeck.isPlaying:((se=f.rightDeck.track)==null?void 0:se.id)===(F==null?void 0:F.id)&&f.rightDeck.isPlaying,oe=e==="left"?f.leftDeck.currentTime||0:f.rightDeck.currentTime||0,ie=(F==null?void 0:F.duration)||(te?e==="left"?(ae=f.leftDeck.track)==null?void 0:ae.duration:(W=f.rightDeck.track)==null?void 0:W.duration:0);return s.jsxs("div",{className:`deck-container p-2 md:p-3 ${t?"ring-2 ring-dj-highlight":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h3",{className:"text-sm md:text-base font-dj font-bold text-white",children:["Deck ",e==="left"?"A":"B"]}),s.jsx("button",{onClick:n,className:`px-2 py-0.5 rounded text-[11px] md:text-xs font-medium transition-all duration-200 ${t?"bg-dj-highlight text-white":"bg-dj-secondary text-dj-light hover:bg-dj-accent"}`,children:t?"Active":"Activate"})]}),s.jsxs("div",{className:"bg-dj-primary rounded-lg p-2 md:p-3 mb-2 border border-dj-accent/20",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:[s.jsx(xc,{className:"w-5 h-5 md:w-6 md:h-6 text-dj-highlight"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-white text-sm md:text-base truncate",children:(F==null?void 0:F.title)||"No Track Loaded"}),s.jsx("p",{className:"text-[11px] md:text-xs text-dj-light/60 truncate",children:(F==null?void 0:F.artist)||"Unknown Artist"})]})]}),F&&s.jsxs("div",{className:"flex items-center justify-between text-[11px] md:text-xs",children:[s.jsxs("div",{className:"flex items-center space-x-1.5",children:[s.jsx(Ks,{className:"w-3.5 h-3.5 md:w-4 md:h-4 text-dj-light/60"}),s.jsx("span",{className:"text-dj-light",children:typeof F.duration=="number"?`${Math.floor(F.duration/60)}:${String(Math.floor(F.duration%60)).padStart(2,"0")}`:F.duration})]}),s.jsx("div",{className:"text-dj-light/50 hidden md:block",children:"BPM —"})]})]}),F&&s.jsx("div",{className:"mb-2",children:s.jsx(Tc,{waveformData:(F==null?void 0:F.waveform)||Array.from({length:120},()=>.3+Math.random()*.4),currentTime:oe,duration:ie||0,isPlaying:!0,deck:e,className:"relative"})}),s.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[s.jsx("button",{onClick:I,className:"w-8 h-8 md:w-9 md:h-9 bg-dj-secondary hover:bg-dj-accent rounded-md flex items-center justify-center transition-all duration-200",title:"Skip Backward (-10s)",children:s.jsx(Ec,{className:"w-4 h-4"})}),s.jsx("button",{onClick:t&&te?b:A,className:`w-10 h-10 md:w-12 md:h-12 rounded-md flex items-center justify-center transition-all duration-200 ${t&&te?"bg-dj-accent hover:bg-dj-highlight":"bg-dj-highlight hover:bg-dj-accent"}`,title:t&&te?"Pausa":"Play",children:t&&te?s.jsx(Sc,{className:"w-4.5 h-4.5"}):s.jsx(hr,{className:"w-4.5 h-4.5"})}),s.jsx("button",{onClick:j,className:"w-8 h-8 md:w-9 md:h-9 bg-dj-secondary hover:bg-dj-accent rounded-md flex items-center justify-center transition-all duration-200",title:"Skip Forward (+10s)",children:s.jsx(Cc,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-0.5",children:[s.jsx(tn,{className:"w-3.5 h-3.5 text-dj-light/60"}),s.jsx("span",{className:"text-[11px] md:text-xs text-dj-light",children:"Vol"})]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,onChange:D=>R(parseFloat(D.target.value)),className:"dj-slider w-full h-1","aria-label":`Volume control for ${e} deck`}),s.jsxs("span",{className:"text-[10px] md:text-xs text-dj-light/60",children:[Math.round(g*100),"%"]})]}),s.jsx("div",{className:"text-center text-[11px] md:text-xs text-dj-light/60",children:"Pitch: n/a"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"flex items-center justify-between text-[11px] md:text-xs text-dj-light/60 mb-1",children:s.jsx(bc,{deck:e,className:"text-[11px] md:text-xs text-dj-light/60"})}),s.jsx("input",{type:"range",min:0,max:Math.max(ie||0,.001),step:.1,value:oe,onChange:D=>{t&&(e==="left"?S(parseFloat(D.target.value)):w(parseFloat(D.target.value)))},className:"dj-slider w-full h-1","aria-label":`Seek control for ${e} deck`})]})]})},cv=({leftVolume:e,rightVolume:t,onLeftVolumeChange:n,onRightVolumeChange:o,crossfadeValue:r,onCrossfadeChange:i})=>{const[a,l]=u.useState("smooth"),{t:c}=yc(),d=h=>{i(h)};return s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-sm font-medium text-dj-light/60 mb-4 uppercase tracking-wider",children:"Crossfader"}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"bg-dj-secondary rounded-xl p-4",children:[s.jsxs("div",{className:"text-center mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-dj-light/80 mb-1",children:c("console.mixer").toUpperCase()}),s.jsx("p",{className:"text-xs text-dj-light/60",children:c("console.mixerDesc")})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r,onChange:h=>d(parseFloat(h.target.value)),className:"dj-slider w-full h-3"}),s.jsxs("div",{className:"flex justify-between mt-2",children:[s.jsx("span",{className:"text-xs font-medium text-dj-accent",children:c("console.deckA").toUpperCase()}),s.jsx("span",{className:"text-xs font-medium text-dj-highlight",children:c("console.deckB").toUpperCase()})]}),s.jsx("div",{className:"text-center mt-2",children:s.jsx("div",{className:"inline-block bg-dj-primary px-3 py-1 rounded-full",children:s.jsxs("span",{className:"text-sm font-mono text-white",children:[r<=.5?"A":"B"," ",Math.round(r*100),"%"]})})})]})]})}),s.jsxs("div",{className:"space-y-3 mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(tn,{className:"w-4 h-4 text-dj-light/60"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:h=>n(parseFloat(h.target.value)),className:"flex-1 dj-slider h-2"}),s.jsxs("span",{className:"text-xs text-dj-light/60 w-8 text-right",children:[Math.round(e*100),"%"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(tn,{className:"w-4 h-4 text-dj-light/60"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:h=>o(parseFloat(h.target.value)),className:"flex-1 dj-slider h-2"}),s.jsxs("span",{className:"text-xs text-dj-light/60 w-8 text-right",children:[Math.round(t*100),"%"]})]})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3",children:[s.jsx("h4",{className:"text-xs text-dj-light/80 mb-3 text-center uppercase tracking-wider",children:c("console.transitionType").toUpperCase()}),s.jsx("div",{className:"flex space-x-2 justify-center",children:["linear","smooth","sharp"].map(h=>s.jsx("button",{onClick:()=>l(h),className:`px-3 py-2 rounded-lg text-xs font-medium transition-all duration-200 ${a===h?"bg-dj-highlight text-white shadow-lg":"bg-dj-primary text-dj-light hover:bg-dj-accent hover:scale-105"}`,children:h==="linear"?c("console.linear").toUpperCase():h==="smooth"?c("console.smooth").toUpperCase():c("console.sharp").toUpperCase()},h))})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-xs text-dj-light/80 text-center uppercase tracking-wider",children:c("console.volumeControl").toUpperCase()}),s.jsx("div",{className:"bg-dj-secondary rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(tn,{className:"w-5 h-5 text-dj-accent"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-dj-light/80 mb-1",children:c("console.deckA").toUpperCase()}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:e,onChange:h=>n(parseFloat(h.target.value)),className:"dj-slider w-full h-2"})]}),s.jsxs("span",{className:"text-sm font-mono text-white bg-dj-primary px-2 py-1 rounded",children:[Math.round(e*100),"%"]})]})}),s.jsx("div",{className:"bg-dj-secondary rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(tn,{className:"w-5 h-5 text-dj-highlight"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-dj-light/80 mb-1",children:c("console.deckB").toUpperCase()}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:h=>o(parseFloat(h.target.value)),className:"dj-slider w-full h-2"})]}),s.jsxs("span",{className:"text-sm font-mono text-white bg-dj-primary px-2 py-1 rounded",children:[Math.round(t*100),"%"]})]})})]})]})};class $f{constructor(){U(this,"config",null);U(this,"serverUrl","");U(this,"isConnected",!1);U(this,"isStreaming",!1);U(this,"isPaused",!1);U(this,"retryCount",0);U(this,"maxRetries",5);U(this,"statusCallback");U(this,"debugCallback");U(this,"statsCallback");U(this,"silenceTimer",null);U(this,"pauseTimer",null);U(this,"lastAudioTime",0);U(this,"silenceThreshold",3e4);U(this,"pauseThreshold",3e4);U(this,"pauseTimestamp",0);U(this,"resumeTimestamp",0);U(this,"chunkTimestamp",0);U(this,"chunkCancelled",!1);U(this,"useDesktopStream",!0);U(this,"monitoringInterval",null);U(this,"audioContext",null);U(this,"analyser",null);U(this,"dataArray",null);U(this,"audioAnalysis",{level:0,peak:0,rms:0,frequency:0,hasAudio:!1,silenceDuration:0,lastAudioTime:0});U(this,"connectionPool",{primary:null,backup:null,isPrimaryActive:!0,failoverCount:0,lastFailover:0});U(this,"statistics",{totalBytesSent:0,totalPacketsSent:0,totalErrors:0,averageBitrate:0,peakBitrate:0,connectionUptime:0,reconnectionCount:0,lastErrorTime:0,qualityScore:100});U(this,"streamStatus",{isConnected:!1,isStreaming:!1,isPaused:!1,bytesSent:0,errors:0,retryCount:0,maxRetries:5,connectionQuality:"excellent",latency:0,bitrate:0,packetLoss:0,uptime:0,lastActivity:0});U(this,"lastMetadata",null);U(this,"autoReconnect",!1);U(this,"reconnectTimer",null);U(this,"connectionStartTime",0);U(this,"lastPingTime",0);U(this,"pingInterval",null);U(this,"mediaRecorder",null);console.log("🚀 StreamingManager inizializzato"),setTimeout(()=>{this.setupGlobalFunctions()},0)}setupGlobalFunctions(){if(typeof window<"u")try{window.streamingManager=this,typeof this.pauseStreaming=="function"&&(window.pauseStreaming=this.pauseStreaming.bind(this)),typeof this.resumeStreaming=="function"&&(window.resumeStreaming=this.resumeStreaming.bind(this)),typeof this.disconnect=="function"&&(window.stopStreaming=this.disconnect.bind(this)),console.log("📡 [GLOBAL] StreamingManager esposto con metodi pausa/ripresa")}catch(t){console.error("❌ [GLOBAL] Errore setup funzioni globali:",t)}}setServerUrl(t){this.serverUrl=t,console.log(`📡 Server URL impostato: ${t}`)}setCredentials(t){this.config||(this.config={host:"",port:8e3,username:"",password:"",mountpoint:"/stream",useSSL:!1,bitrate:128,format:"opus"}),Object.assign(this.config,t),console.log("📡 Credenziali aggiornate:",{host:this.config.host,port:this.config.port,username:this.config.username,password:this.config.password?"***":"(vuota)",mountpoint:this.config.mountpoint,useSSL:this.config.useSSL,bitrate:this.config.bitrate,format:this.config.format})}setStatusCallback(t){this.statusCallback=t}setDebugCallback(t){this.debugCallback=t}setStatsCallback(t){this.statsCallback=t}async connect(){return this.config?(this.retryCount=0,this.attemptConnection()):(this.addNotification("error","Configurazione Mancante","Configurazione streaming non impostata"),!1)}async attemptConnection(){if(this.retryCount>=this.maxRetries)return this.addNotification("error","Connessione Fallita",`Impossibile connettersi dopo ${this.maxRetries} tentativi. Server Icecast non raggiungibile.`),this.updateStatus("disconnected"),!1;this.retryCount++,this.addNotification("info","Tentativo Connessione",`Tentativo ${this.retryCount}/${this.maxRetries} - Connessione a ${this.config.host}:${this.config.port}`);try{if(await this.performConnection())return this.isConnected=!0,this.retryCount=0,this.addNotification("success","Connesso",`Connesso con successo a ${this.config.host}:${this.config.port}`),this.updateStatus("connected"),!0;throw new Error("Connessione fallita")}catch(t){const n=t instanceof Error?t.message:"Errore sconosciuto";return this.addNotification("warning","Tentativo Fallito",`Tentativo ${this.retryCount} fallito: ${n}`),await new Promise(o=>setTimeout(o,2e3*this.retryCount)),this.attemptConnection()}}async performConnection(){if(!this.config)return!1;try{const t=this.config.useSSL?"https":"http",n=`${t}://${this.config.host}:${this.config.port}/admin/stats`,o=`${t}://${this.config.host}:${this.config.port}${this.config.mountpoint}`;console.log(`🔗 [CONNECTION] Test connessione Icecast admin: ${n}`);const r={};if(this.config.username&&this.config.password){const a=btoa(`${this.config.username}:${this.config.password}`);r.Authorization=`Basic ${a}`,console.log(`🔐 [CONNECTION] Usando autenticazione Basic per: ${this.config.username}`)}const i=await fetch(n,{method:"GET",headers:r,signal:AbortSignal.timeout(5e3)});if(i.ok)return console.log(`✅ [CONNECTION] Server Icecast raggiungibile: ${i.status}`),this.connectionPool.primary=o,this.connectionPool.isPrimaryActive=!0,this.startHttpMonitoring(),!0;{console.log("🔄 [CONNECTION] Admin non disponibile, test diretto su mountpoint...");const a=await fetch(o,{method:"POST",headers:{...r,"Content-Type":"application/octet-stream","User-Agent":"DJ-Console/1.0"},signal:AbortSignal.timeout(5e3)});if(a.status===200||a.status===400)return console.log(`✅ [CONNECTION] Mountpoint Icecast raggiungibile: ${a.status}`),this.connectionPool.primary=o,this.connectionPool.isPrimaryActive=!0,this.startHttpMonitoring(),!0;throw new Error(`HTTP ${a.status}: ${a.statusText}`)}}catch(t){return console.error("❌ [CONNECTION] Errore connessione Icecast:",t),!1}}startHttpMonitoring(){console.log("🔍 [MONITORING] Ping HTTP disabilitato - monitoraggio tramite FFmpeg")}async checkHttpConnection(){if(!(!this.connectionPool.primary||!this.config))try{const t={};if(this.config.username&&this.config.password){const i=btoa(`${this.config.username}:${this.config.password}`);t.Authorization=`Basic ${i}`}const o=`${this.config.useSSL?"https":"http"}://${this.config.host}:${this.config.port}/admin/stats`,r=await fetch(o,{method:"GET",headers:t,signal:AbortSignal.timeout(3e3)});if(r.ok)this.lastPingTime=Date.now(),this.streamStatus.lastActivity=Date.now(),this.updateStatistics();else throw new Error(`HTTP ${r.status}`)}catch(t){console.error("❌ [HTTP] Errore monitoraggio:",t),this.handleConnectionLoss()}}handleConnectionLoss(){this.isConnected=!1,this.isStreaming=!1,this.addNotification("warning","Connessione Persa","Connessione al server interrotta"),this.autoReconnect&&this.scheduleReconnection()}scheduleReconnection(){if(this.reconnectTimer)return;const t=Math.min(1e3*Math.pow(2,this.statistics.reconnectionCount),3e4);console.log(`🔄 [RECONNECT] Riconnessione programmata tra ${t}ms`),this.reconnectTimer=setTimeout(async()=>{this.reconnectTimer=null,this.statistics.reconnectionCount++,this.addNotification("info","Riconnessione",`Tentativo riconnessione ${this.statistics.reconnectionCount}`),!await this.attemptConnection()&&this.autoReconnect&&this.scheduleReconnection()},t)}stopPing(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null)}disconnect(){var t,n;if(this.isConnected=!1,this.isStreaming=!1,this.isPaused=!1,this.retryCount=0,this.connectionPool.primary=null,this.connectionPool.backup=null,this.stopAudioMonitoring(),this.stopPing(),this.clearTimers(),this.stopMediaRecorder(),this.useDesktopStream&&typeof((t=window.desktopStream)==null?void 0:t.stop)=="function")try{window.desktopStream.stop(),console.log("✅ [STREAMING] DesktopStream fermato")}catch(o){console.log("ℹ️ [STREAMING] Errore fermando DesktopStream:",o)}else if(typeof((n=window.electronAPI)==null?void 0:n.invoke)=="function")try{window.electronAPI.invoke("icecast-stop"),console.log("✅ [STREAMING] FFmpeg fermato")}catch(o){console.log("ℹ️ [STREAMING] Errore fermando FFmpeg:",o)}this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.connectionStartTime=0,this.lastPingTime=0,this.addNotification("info","Disconnesso","Connessione streaming chiusa"),this.updateStatus("disconnected")}async startStreaming(t){var n,o,r,i,a,l,c,d,h,p,y,x,S,w,C,f;if(!this.isConnected)return this.addNotification("error","Non Connesso","Devi prima connetterti al server"),!1;try{if(this.isStreaming=!0,this.isPaused=!1,this.connectionStartTime=Date.now(),typeof((n=window.electronAPI)==null?void 0:n.invoke)=="function")try{console.log("🔍 [STREAMING] Fermando FFmpeg precedente..."),await window.electronAPI.invoke("icecast-stop"),console.log("✅ [STREAMING] FFmpeg precedente fermato")}catch{console.log("ℹ️ [STREAMING] Nessun FFmpeg precedente da fermare")}if(this.useDesktopStream&&typeof((o=window.desktopStream)==null?void 0:o.start)=="function"){console.log("🔍 [STREAMING] Avvio FFmpeg con desktopStream...");const g={host:(r=this.config)==null?void 0:r.host,port:(i=this.config)==null?void 0:i.port,mount:(a=this.config)==null?void 0:a.mountpoint,username:(l=this.config)==null?void 0:l.username,password:(c=this.config)==null?void 0:c.password,useSSL:(d=this.config)==null?void 0:d.useSSL,bitrateKbps:(h=this.config)==null?void 0:h.bitrate,format:(p=this.config)==null?void 0:p.format};if(console.log("🔍 [STREAMING] Config desktopStream:",g),(y=window.globalStreamingManager)!=null&&y.isUserRequestedDisconnect)throw console.log("🛑 [STREAMING] Disconnessione richiesta dall'utente - blocco avvio FFmpeg"),new Error("User requested disconnect - blocking FFmpeg start");const m=await window.desktopStream.start(g);if(!(m!=null&&m.ok))throw new Error(`DesktopStream startup failed: ${m==null?void 0:m.error}`);console.log("✅ [STREAMING] DesktopStream avviato con successo")}else if(typeof((x=window.electronAPI)==null?void 0:x.startStreaming)=="function"){console.log("🔍 [STREAMING] Avvio FFmpeg con electronAPI...");const g={...this.config},m=await window.electronAPI.startStreaming(g);if(!(m!=null&&m.ok))throw new Error(`FFmpeg startup failed: ${m==null?void 0:m.error}`);console.log("✅ [STREAMING] FFmpeg avviato con successo")}return this.connectAudioSource(t),this.startAudioMonitoring(),this.startMediaRecorder(t),this.sendStreamCommand("start",{bitrate:(S=this.config)==null?void 0:S.bitrate,format:(w=this.config)==null?void 0:w.format,sampleRate:((C=this.config)==null?void 0:C.sampleRate)||44100,channels:((f=this.config)==null?void 0:f.channels)||2}),this.addNotification("success","Streaming Avviato","Trasmissione audio iniziata"),this.updateStatus("streaming"),!0}catch(g){const m=g instanceof Error?g.message:"Errore sconosciuto";return this.addNotification("error","Errore Streaming",`Impossibile avviare streaming: ${m}`),!1}}async sendStreamCommand(t,n){if(this.connectionPool.primary)try{const o=new URL(this.connectionPool.primary);t==="start"?(o.searchParams.set("mode","updinfo"),n!=null&&n.bitrate&&o.searchParams.set("bitrate",n.bitrate.toString()),n!=null&&n.format&&o.searchParams.set("format",n.format)):t==="stop"?(o.searchParams.set("mode","updinfo"),o.searchParams.set("action","stop")):t==="pause"?(o.searchParams.set("mode","updinfo"),o.searchParams.set("action","pause")):t==="resume"&&(o.searchParams.set("mode","updinfo"),o.searchParams.set("action","resume"));const r=await fetch(o.toString(),{method:"GET",signal:AbortSignal.timeout(5e3)});r.ok?console.log(`📤 [STREAM] Comando ${t} inviato con successo`):console.warn(`⚠️ [STREAM] Comando ${t} fallito: ${r.status}`)}catch(o){console.error(`❌ [STREAM] Errore invio comando ${t}:`,o)}}stopStreaming(){this.isStreaming=!1,this.isPaused=!1,this.sendStreamCommand("stop"),this.stopSilenceDetection(),this.stopAudioMonitoring(),this.clearTimers(),this.addNotification("info","Streaming Fermato","Trasmissione audio fermata"),this.updateStatus("connected")}pauseStreaming(){this.isStreaming&&(this.isPaused=!0,this.pauseTimestamp=Date.now(),console.log(`⏸️ [STREAMING] Pausa timestamp: ${this.pauseTimestamp}`),this.stopMediaRecorder(),console.log("⏸️ [STREAMING] MediaRecorder fermato completamente - nessun loop"),this.disconnectAudioSource(),console.log("⏸️ [STREAMING] Audio source disconnesso"),this.pauseDeckAudio(),console.log("⏸️ [STREAMING] Audio deck messo in pausa - sincronizzazione locale/streaming"),this.addNotification("info","Streaming Pausato","Trasmissione in pausa - audio sincronizzato"),console.log("⏸️ [STREAMING] Streaming messo in pausa - audio sincronizzato"),this.startPauseTimeout())}resumeStreaming(){if(!this.isStreaming||!this.isPaused)return;this.isPaused=!1,this.resumeTimestamp=Date.now();const t=this.resumeTimestamp-this.pauseTimestamp;console.log(`▶️ [STREAMING] Ripresa timestamp: ${this.resumeTimestamp}`),console.log(`▶️ [STREAMING] Durata pausa: ${t}ms`),this.resumeDeckAudio(),console.log("▶️ [STREAMING] Audio deck ripreso - sincronizzazione locale/streaming"),this.currentStream&&(this.connectAudioSource(this.currentStream),console.log("▶️ [STREAMING] Audio source riconnesso per riprendere streaming")),this.currentStream&&(this.startMediaRecorder(this.currentStream),console.log("▶️ [STREAMING] MediaRecorder riavviato per riprendere streaming")),this.addNotification("success","Streaming Ripreso",`Trasmissione ripresa - audio sincronizzato - pausa: ${t}ms`),console.log("▶️ [STREAMING] Streaming ripreso - audio sincronizzato"),this.clearPauseTimeout(),this.startSilenceDetection()}pauseDeckAudio(){try{if(typeof window.globalAudioContext<"u"){const t=window.globalAudioContext,n=window.globalMixerGain;t&&n&&(n.gain.setValueAtTime(0,t.currentTime),console.log("⏸️ [DECK AUDIO] Mixer gain messo a 0 - audio deck in pausa"))}if(typeof window.leftStreamAudio<"u"){const t=window.leftStreamAudio;t&&!t.paused&&(t.pause(),console.log("⏸️ [DECK AUDIO] Left deck audio messo in pausa"))}if(typeof window.rightStreamAudio<"u"){const t=window.rightStreamAudio;t&&!t.paused&&(t.pause(),console.log("⏸️ [DECK AUDIO] Right deck audio messo in pausa"))}}catch(t){console.error("❌ [DECK AUDIO] Errore pausa audio deck:",t)}}resumeDeckAudio(){try{if(typeof window.globalAudioContext<"u"){const t=window.globalAudioContext,n=window.globalMixerGain;t&&n&&(n.gain.setValueAtTime(1,t.currentTime),console.log("▶️ [DECK AUDIO] Mixer gain ripristinato a 1.0 - audio deck ripreso"))}if(typeof window.leftStreamAudio<"u"){const t=window.leftStreamAudio;t&&t.paused&&(t.play(),console.log("▶️ [DECK AUDIO] Left deck audio ripreso"))}if(typeof window.rightStreamAudio<"u"){const t=window.rightStreamAudio;t&&t.paused&&(t.play(),console.log("▶️ [DECK AUDIO] Right deck audio ripreso"))}}catch(t){console.error("❌ [DECK AUDIO] Errore ripresa audio deck:",t)}}startAudioMonitoring(){this.monitoringInterval||(this.initializeAudioAnalysis(),this.monitoringInterval=setInterval(()=>{this.checkAudioLevel()},100))}initializeAudioAnalysis(){try{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8;const t=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(t),console.log(`🎵 [AUDIO] Analisi audio inizializzata (buffer: ${t})`)}catch(t){console.error("❌ [AUDIO] Errore inizializzazione analisi:",t)}}connectDirectly(t,n){console.log("🎵 [DIRECT] Connessione diretta analyser al mixer...");try{if(!this.analyser){this.audioContext=t,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=1024;const o=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(o),console.log(`🎵 [DIRECT] Analyser inizializzato (buffer: ${o})`)}n.connect(this.analyser),console.log("🎵 [DIRECT] Analyser connesso DIRETTAMENTE al mixer globale"),console.log("🔍 [DIRECT] AudioContext:",t),console.log("🔍 [DIRECT] MixerGain:",n),this.startAudioMonitoring()}catch(o){console.error("❌ [DIRECT] Errore connessione diretta:",o)}}connectAudioSource(t){if(console.log("🎵 [AUDIO] Connessione sorgente audio per analisi..."),console.log("🔍 [AUDIO DEBUG] Stream ricevuto:",{type:typeof t,isMediaStream:t instanceof MediaStream,active:t.active,id:t.id,tracks:t.getTracks().length,audioTracks:t.getAudioTracks().length,videoTracks:t.getVideoTracks().length}),(!this.audioContext||!this.analyser)&&this.initializeAudioAnalysis(),!this.audioContext||!this.analyser){console.error("❌ [AUDIO] AudioContext o Analyser non disponibili");return}try{const n=window.globalAudioContext;if(!n){console.error("❌ [AUDIO] AudioContext globale non disponibile - STATO DEBUG:",{globalAudioContext:window.globalAudioContext,globalMixerGain:window.globalMixerGain,currentMixerGain:window.currentMixerGain,currentMixContext:window.currentMixContext}),console.log("🔄 [AUDIO] Fallback al sistema MediaStream originale..."),this.audioContext.createMediaStreamSource(t).connect(this.analyser),console.log("🎵 [AUDIO] Fallback - Sorgente audio connessa per analisi");return}const o=window.globalMixerGain;if(!o){console.error("❌ [AUDIO] MixerGain globale non disponibile"),console.log("🔄 [AUDIO] Fallback al sistema MediaStream originale..."),this.audioContext.createMediaStreamSource(t).connect(this.analyser),console.log("🎵 [AUDIO] Fallback - Sorgente audio connessa per analisi");return}this.audioContext=n,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=1024;const r=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(r),o.connect(this.analyser),console.log("🎵 [AUDIO] Analyser connesso DIRETTAMENTE al mixer globale"),console.log("🔍 [AUDIO] AudioContext globale:",n),console.log("🔍 [AUDIO] MixerGain globale:",o)}catch(n){console.error("❌ [AUDIO] Errore connessione sorgente:",n)}}stopAudioMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}checkAudioLevel(){if(!this.analyser||!this.dataArray)return;this.analyser.getByteFrequencyData(this.dataArray);let t=0,n=0;for(let i=0;i<this.dataArray.length;i++){const a=this.dataArray[i];t+=a*a,n=Math.max(n,a)}const o=Math.sqrt(t/this.dataArray.length),r=o/255;this.audioAnalysis.level=r,this.audioAnalysis.peak=n/255,this.audioAnalysis.rms=o,this.audioAnalysis.hasAudio=r>.01,Date.now()%5e3<100&&console.log(`🎵 [AUDIO DEBUG] Level: ${r.toFixed(4)}, Peak: ${(n/255).toFixed(4)}, HasAudio: ${this.audioAnalysis.hasAudio}`),this.audioAnalysis.frequency=this.calculateDominantFrequency(),this.updateStreamQuality(r)}calculateDominantFrequency(){if(!this.analyser||!this.dataArray)return 0;this.analyser.getByteFrequencyData(this.dataArray);let t=0,n=0;for(let r=0;r<this.dataArray.length;r++)this.dataArray[r]>t&&(t=this.dataArray[r],n=r);const o=this.analyser.context.sampleRate/2;return n/this.dataArray.length*o}updateStreamQuality(t){const n=this.calculateLatency(),o=this.calculatePacketLoss();let r=100;t<.1?r-=20:t<.3&&(r-=10),n>1e3?r-=30:n>500?r-=15:n>200&&(r-=5),o>.1?r-=40:o>.05?r-=20:o>.01&&(r-=10),this.statistics.qualityScore=Math.max(0,r),r>=90?this.streamStatus.connectionQuality="excellent":r>=70?this.streamStatus.connectionQuality="good":r>=50?this.streamStatus.connectionQuality="fair":r>=30?this.streamStatus.connectionQuality="poor":this.streamStatus.connectionQuality="critical"}calculateLatency(){return this.lastPingTime===0?0:Date.now()-this.lastPingTime}calculatePacketLoss(){return this.statistics.totalPacketsSent===0?0:this.statistics.totalErrors/this.statistics.totalPacketsSent}updateStatistics(){this.connectionStartTime>0&&(this.statistics.connectionUptime=Date.now()-this.connectionStartTime,this.streamStatus.uptime=this.statistics.connectionUptime),this.statistics.connectionUptime>0&&(this.statistics.averageBitrate=this.statistics.totalBytesSent*8/(this.statistics.connectionUptime/1e3),this.streamStatus.bitrate=this.statistics.averageBitrate),this.streamStatus.latency=this.calculateLatency(),this.streamStatus.packetLoss=this.calculatePacketLoss(),this.statsCallback&&this.statsCallback({...this.statistics})}startSilenceDetection(){this.clearSilenceTimeout(),this.lastAudioTime=Date.now()}stopSilenceDetection(){this.clearSilenceTimeout()}clearSilenceTimeout(){this.silenceTimer&&(clearTimeout(this.silenceTimer),this.silenceTimer=null)}startMediaRecorder(t){var n,o,r;try{console.log("🎵 [MEDIARECORDER] Avvio MediaRecorder...");let i="audio/webm; codecs=opus",a=128e3;(((n=this.config)==null?void 0:n.format)==="mp3"||((o=this.config)==null?void 0:o.format)==="aac")&&(i="audio/webm; codecs=opus",a=128e3),console.log("🎵 [MEDIARECORDER] Configurazione:",{mimeType:i,audioBitsPerSecond:a,format:(r=this.config)==null?void 0:r.format}),this.mediaRecorder=new MediaRecorder(t,{mimeType:i,audioBitsPerSecond:a}),this.mediaRecorder.ondataavailable=async l=>{var c,d;if(l.data&&l.data.size>0){this.chunkTimestamp=Date.now(),console.log(`🎵 [MEDIARECORDER] Chunk ricevuto: ${l.data.size} bytes - timestamp: ${this.chunkTimestamp}`);try{const h=await l.data.arrayBuffer(),p=new Uint8Array(h);this.useDesktopStream&&typeof((c=window.desktopStream)==null?void 0:c.write)=="function"?(window.desktopStream.write(h),console.log(`📡 [DESKTOPSTREAM] Chunk inviato: ${p.length} bytes`)):typeof((d=window.electronAPI)==null?void 0:d.send)=="function"&&(window.electronAPI.send("icecast-write-chunk",p),console.log(`📡 [ELECTRONAPI] Chunk inviato: ${p.length} bytes`))}catch(h){console.error("❌ [MEDIARECORDER] Errore conversione chunk:",h)}}},this.mediaRecorder.onerror=l=>{console.error("❌ [MEDIARECORDER] Errore:",l),this.addNotification("error","Errore MediaRecorder","Errore nella cattura audio")},this.mediaRecorder.start(100),console.log("✅ [MEDIARECORDER] MediaRecorder avviato con successo")}catch(i){console.error("❌ [MEDIARECORDER] Errore avvio:",i),this.addNotification("error","Errore MediaRecorder",`Impossibile avviare cattura audio: ${i}`)}}stopMediaRecorder(){if(this.mediaRecorder)try{this.mediaRecorder.requestData(),this.mediaRecorder.stop(),this.mediaRecorder=null,console.log("✅ [MEDIARECORDER] MediaRecorder fermato e buffer svuotato")}catch(t){console.error("❌ [MEDIARECORDER] Errore stop:",t)}}startPauseTimeout(){}clearPauseTimeout(){this.pauseTimer&&(clearTimeout(this.pauseTimer),this.pauseTimer=null)}clearTimers(){this.clearSilenceTimeout(),this.clearPauseTimeout()}updateMetadata(t){this.lastMetadata=t,console.log("📝 Metadata aggiornati:",t),this.isConnected&&this.connectionPool.primary&&this.sendMetadataToServer(t)}async sendMetadataToServer(t){var n,o;if(this.connectionPool.primary)try{const r=new URL(this.connectionPool.primary);r.searchParams.set("mode","updinfo");const i={song:`${t.artist} - ${t.title}`,title:t.title,artist:t.artist,album:t.album,genre:t.genre};t.year&&(i.year=t.year),t.comment&&(i.comment=t.comment),t.url&&(i.url=t.url);const a=await fetch(r.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${(n=this.config)==null?void 0:n.username}:${(o=this.config)==null?void 0:o.password}`)}`},body:new URLSearchParams(i).toString(),signal:AbortSignal.timeout(5e3)});a.ok?console.log("📤 [METADATA] Inviato al server Icecast:",t):console.warn(`⚠️ [METADATA] Invio fallito: ${a.status}`)}catch(r){console.error("❌ [METADATA] Errore invio:",r)}}getLastMetadata(){return this.lastMetadata}getStatistics(){return{...this.statistics}}getStreamStatus(){return{...this.streamStatus}}getAudioAnalysis(){return{...this.audioAnalysis}}setAutoReconnect(t){this.autoReconnect=t,console.log(`🔄 [RECONNECT] Auto-reconnect ${t?"abilitato":"disabilitato"}`)}setSilenceThreshold(t){this.silenceThreshold=t,console.log(`🔇 [SILENCE] Soglia silenzio impostata a ${t}ms`)}setPauseThreshold(t){this.pauseThreshold=t,console.log(`⏸️ [PAUSE] Soglia pausa impostata a ${t}ms`)}getDiagnostics(){return{connection:{isConnected:this.isConnected,isStreaming:this.isStreaming,isPaused:this.isPaused,quality:this.streamStatus.connectionQuality,uptime:this.streamStatus.uptime,latency:this.streamStatus.latency,packetLoss:this.streamStatus.packetLoss},audio:{level:this.audioAnalysis.level,peak:this.audioAnalysis.peak,rms:this.audioAnalysis.rms,frequency:this.audioAnalysis.frequency,hasAudio:this.audioAnalysis.hasAudio,silenceDuration:this.audioAnalysis.silenceDuration},statistics:this.statistics,config:this.config}}forceReconnect(){console.log("🔄 [RECONNECT] Riconnessione forzata richiesta"),this.disconnect(),setTimeout(()=>{this.connect()},1e3)}switchToBackup(){if(this.connectionPool.backup){this.connectionPool.isPrimaryActive=!1,this.connectionPool.failoverCount++,this.connectionPool.lastFailover=Date.now();const t=this.connectionPool.primary;this.connectionPool.primary=this.connectionPool.backup,this.connectionPool.backup=t,console.log("🔄 [FAILOVER] Passaggio a connessione di backup"),this.addNotification("warning","Failover","Passaggio a connessione di backup")}}isCurrentlyStreaming(){return this.isStreaming&&!this.isPaused}getStreamUrl(){return this.config?`${this.config.useSSL?"https":"http"}://${this.config.host}:${this.config.port}${this.config.mountpoint}`:""}getPublicStreamUrl(){return this.getStreamUrl()}getHttpBaseUrl(){return this.config?`${this.config.useSSL?"https":"http"}://${this.config.host}:${this.config.port}`:""}getServerUrl(){return this.serverUrl}addNotification(t,n,o){var r;console.log(`📢 [${t.toUpperCase()}] ${n}: ${o}`),typeof window<"u"&&window.addStreamingNotification&&window.addStreamingNotification(t,n,o,"streaming"),(r=this.debugCallback)==null||r.call(this,`[${t.toUpperCase()}] ${n}: ${o}`)}updateStatus(t){var n;(n=this.statusCallback)==null||n.call(this,t)}async updateStream(t){return this.isStreaming?(console.log("🔄 Stream aggiornato"),!0):!1}}const uv=({onStreamStart:e,onStreamStop:t,onMetadataUpdate:n})=>{var se,ae,W,D;const[o]=u.useState(()=>new $f),{getMixedStream:r,audioState:i}=an(),{settings:a}=Bn(),[l,c]=u.useState(!1),[d,h]=u.useState(!1),[p,y]=u.useState("disconnected"),[x,S]=u.useState(null),[w,C]=u.useState([]),[f,g]=u.useState({title:"DJ Console Pro",artist:"Live Stream",album:"Live Session",genre:"Electronic"}),[m,v]=u.useState(((se=a.streaming)==null?void 0:se.defaultFormat)||"opus"),[N,A]=u.useState(((ae=a.streaming)==null?void 0:ae.defaultBitrate)||128),[b,I]=u.useState(!1),[j,R]=u.useState(null);u.useEffect(()=>{var Q,he;const M=((Q=a.streaming)==null?void 0:Q.defaultFormat)||"opus",J=((he=a.streaming)==null?void 0:he.defaultBitrate)||128;console.log("🎛️ [STREAMING] Settings cambiati:",{format:M,bitrate:J}),v(M),A(J),o._desiredFormat=M,o._desiredBitrate=J,console.log("🎛️ [STREAMING] StreamingManager aggiornato con formato:",M,"bitrate:",J)},[(W=a.streaming)==null?void 0:W.defaultFormat,(D=a.streaming)==null?void 0:D.defaultBitrate]),u.useEffect(()=>{(async()=>{try{await Y.waitForInitialization();const Q=await Y.getSettings(),he=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");let Be="ws://127.0.0.1:8000";he||(Be=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.hostname}:8000`);let ut=Q.streaming.bridgeUrl&&Q.streaming.bridgeUrl.length>0?Q.streaming.bridgeUrl:Be;o.setServerUrl(ut),o.setCredentials({host:Q.streaming.icecast.host,port:Q.streaming.icecast.port,username:Q.streaming.icecast.username,password:Q.streaming.icecast.password,mountpoint:Q.streaming.icecast.mount,useSSL:!!Q.streaming.icecast.useSSL}),v(Q.streaming.defaultFormat||"opus"),A(Q.streaming.defaultBitrate||128)}catch{}})();const M=async Q=>{var he,Be,ut,qe,Fe,k,E;try{const T=Q;if((he=T==null?void 0:T.detail)!=null&&he.kind&&T.detail.kind!=="settings")return;await Y.waitForInitialization();const L=await Y.getSettings(),B=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");let P="ws://127.0.0.1:8000";B||(P=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.hostname}:8000`);const H=L.streaming.bridgeUrl&&L.streaming.bridgeUrl.length>0?L.streaming.bridgeUrl:P;o.setServerUrl(H);const G=await Y.getDefaultIcecastServer();G?(o.setCredentials({host:G.host,port:G.port,username:G.username,password:G.password,mountpoint:G.mount,useSSL:!!G.useSSL}),C(me=>[`Settings reloaded: WS=${H} host=${G.host}:${G.port} mount=${G.mount} [${G.name}]`,...me].slice(0,20))):(o.setCredentials({host:((Be=L.streaming.icecast)==null?void 0:Be.host)||"localhost",port:((ut=L.streaming.icecast)==null?void 0:ut.port)||5040,username:((qe=L.streaming.icecast)==null?void 0:qe.username)||"source",password:((Fe=L.streaming.icecast)==null?void 0:Fe.password)||"",mountpoint:((k=L.streaming.icecast)==null?void 0:k.mount)||"/stream",useSSL:!!((E=L.streaming.icecast)!=null&&E.useSSL)}),C(me=>{var ue,ht,Ye;return[`Settings reloaded: WS=${H} host=${((ue=L.streaming.icecast)==null?void 0:ue.host)||"localhost"}:${((ht=L.streaming.icecast)==null?void 0:ht.port)||5040} mount=${((Ye=L.streaming.icecast)==null?void 0:Ye.mount)||"/stream"} [LEGACY]`,...me].slice(0,20)}))}catch{}};window.addEventListener("djconsole:db-updated",M);const J=async()=>{try{await Y.waitForInitialization();const Q=await Y.getSettings(),he=await Y.getDefaultIcecastServer();he&&(o.setCredentials({host:he.host,port:he.port,username:he.username,password:he.password,mountpoint:he.mount,useSSL:!!he.useSSL}),C(Be=>[`Server updated: ${he.name} (${he.host}:${he.port}${he.mount})`,...Be].slice(0,20)))}catch(Q){console.error("Error updating server:",Q)}};return window.addEventListener("djconsole:db-updated",J),o.setStatusCallback(Q=>{y(Q),c(Q==="connected"),h(Q==="streaming"),window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:Q,isStreaming:Q==="streaming",error:null}}))}),o.setStatsCallback(Q=>{S(Q)}),o.setDebugCallback(Q=>{C(he=>[Q,...he].slice(0,20)),(Q.toLowerCase().includes("error")||Q.toLowerCase().includes("fail"))&&window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:p,isStreaming:d,error:Q}}))}),()=>{window.removeEventListener("djconsole:db-updated",M),window.removeEventListener("djconsole:db-updated",J),o.disconnect()}},[o]);const F=async()=>{var M,J,Q,he,Be,ut,qe,Fe,k;try{try{await Y.waitForInitialization();const T=await Y.getSettings(),L=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");let B="ws://127.0.0.1:8000";L||(B=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.hostname}:8000`);const P=T.streaming.bridgeUrl&&T.streaming.bridgeUrl.length>0?T.streaming.bridgeUrl:B;o.setServerUrl(P);const H=await Y.getDefaultIcecastServer();H?(o.setCredentials({host:H.host,port:H.port,username:H.username,password:H.password,mountpoint:H.mount,useSSL:!!H.useSSL}),console.log(`Connecting to server: ${H.name} (${H.host}:${H.port}${H.mount})`)):(o.setCredentials({host:((M=T.streaming.icecast)==null?void 0:M.host)||"localhost",port:((J=T.streaming.icecast)==null?void 0:J.port)||5040,username:((Q=T.streaming.icecast)==null?void 0:Q.username)||"source",password:((he=T.streaming.icecast)==null?void 0:he.password)||"",mountpoint:((Be=T.streaming.icecast)==null?void 0:Be.mount)||"/stream",useSSL:!!((ut=T.streaming.icecast)!=null&&ut.useSSL)}),console.log(`Connecting to legacy server: ${((qe=T.streaming.icecast)==null?void 0:qe.host)||"localhost"}:${((Fe=T.streaming.icecast)==null?void 0:Fe.port)||5040}${((k=T.streaming.icecast)==null?void 0:k.mount)||"/stream"}`))}catch{}await o.connect()?console.log("Connected to streaming server"):window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:"disconnected",isStreaming:!1,error:"Failed to connect to streaming server"}}))}catch(E){console.error("Failed to connect:",E)}},te=()=>{o.disconnect()},oe=async()=>{try{const J=await r(!0);if(console.log("🎛️ [STREAMING] Avvio streaming con formato:",m,"bitrate:",N),o._desiredFormat=m,o._desiredBitrate=N,!await o.startStreaming(J)){const he="Start failed: streamingManager.startStreaming returned false";C(Be=>[he,...Be].slice(0,20)),window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:"connected",isStreaming:!1,error:he}}));return}h(!0),e==null||e(o.getStreamUrl()),o.updateMetadata(f),R(o.getLastMetadata())}catch(M){console.error("Failed to start streaming:",M);const J=`Start error: ${M instanceof Error?M.message:String(M)}`;C(Q=>[J,...Q].slice(0,20)),window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:"connected",isStreaming:!1,error:J}}))}},ie=()=>{o.stopStreaming(),h(!1),t==null||t(),window.dispatchEvent(new CustomEvent("djconsole:streaming-status-changed",{detail:{status:"connected",isStreaming:!1,error:null}}))},V=(M,J)=>{const Q={...f,[M]:J};g(Q),d&&(o.updateMetadata(Q),R(o.getLastMetadata())),n==null||n(Q)};return s.jsxs("div",{className:"bg-dj-primary rounded-lg p-4 border border-dj-accent/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(jo,{className:"w-5 h-5 text-dj-highlight"}),s.jsx("h3",{className:"text-lg font-dj font-bold text-white",children:"Live Streaming"})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${p==="connected"?"bg-dj-success":p==="streaming"?"bg-dj-highlight":p==="error"?"bg-dj-error":"bg-dj-light/40"}`}),s.jsx("span",{className:"text-sm text-dj-light/60 capitalize",children:p}),l?s.jsx("button",{onClick:te,className:"text-xs text-dj-light/70 hover:text-white underline underline-offset-2",children:"Disconnect"}):s.jsx("button",{onClick:F,className:"text-xs text-dj-light/70 hover:text-white underline underline-offset-2",children:"Connect"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[l?s.jsx(Xu,{className:"w-4 h-4 text-dj-success"}):s.jsx(Yu,{className:"w-4 h-4 text-dj-light/60"}),s.jsx("span",{className:"text-sm text-dj-light",children:l?"Connected to Server":"Not Connected"})]}),s.jsxs("div",{className:"text-xs text-dj-light/60 mb-3",children:["Server: ",o.getServerUrl()]}),s.jsx("div",{className:"flex space-x-2",children:l?s.jsxs("button",{onClick:te,className:"px-4 py-2 bg-dj-secondary hover:bg-dj-accent text-dj-light rounded-lg transition-all duration-200 flex items-center space-x-2",children:[s.jsx(Yu,{className:"w-4 h-4"}),s.jsx("span",{children:"Disconnect"})]}):s.jsxs("button",{onClick:F,className:"px-4 py-2 bg-dj-accent hover:bg-dj-highlight text-white rounded-lg transition-all duration-200 flex items-center space-x-2",children:[s.jsx(Xu,{className:"w-4 h-4"}),s.jsx("span",{children:"Connect to Server"})]})})]}),l&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(jo,{className:"w-4 h-4 text-dj-highlight"}),s.jsx("span",{className:"text-sm text-dj-light",children:"Stream Control"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("label",{className:"flex items-center space-x-1 text-xs",children:[s.jsx("input",{type:"checkbox",checked:b,onChange:M=>I(M.target.checked)}),s.jsx("span",{children:"Send Mic"})]}),s.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[s.jsx("span",{children:"Format"}),s.jsxs("select",{value:m,onChange:M=>v(M.target.value),className:"dj-input py-1 px-2",title:"Select audio format","aria-label":"Audio format selection",children:[s.jsx("option",{value:"opus",children:"Opus (Ogg)"}),s.jsx("option",{value:"mp3",children:"MP3"}),s.jsx("option",{value:"ogg",children:"Vorbis (Ogg)"}),s.jsx("option",{value:"aac",children:"AAC"})]}),s.jsx("span",{children:"Bitrate"}),s.jsxs("select",{value:N,onChange:M=>A(parseInt(M.target.value)),className:"dj-input py-1 px-2",title:"Select bitrate","aria-label":"Bitrate selection",children:[s.jsx("option",{value:96,children:"96"}),s.jsx("option",{value:128,children:"128"}),s.jsx("option",{value:192,children:"192"})]})]}),d?s.jsxs("button",{onClick:ie,className:"px-4 py-2 bg-dj-error hover:bg-red-600 text-white rounded-lg transition-all duration-200 flex items-center space-x-2",children:[s.jsx(Rf,{className:"w-4 h-4"}),s.jsx("span",{children:"Stop Streaming"})]}):s.jsxs("button",{onClick:oe,className:"px-4 py-2 bg-dj-highlight hover:bg-dj-accent text-white rounded-lg transition-all duration-200 flex items-center space-x-2",children:[s.jsx(hr,{className:"w-4 h-4"}),s.jsx("span",{children:"Start Streaming"})]})]})]}),l&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(Ws,{className:"w-4 h-4 text-dj-accent"}),s.jsx("span",{className:"text-sm text-dj-light",children:"Stream Metadata"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-dj-light/60 mb-1",children:"Title"}),s.jsx("input",{type:"text",value:f.title,onChange:M=>V("title",M.target.value),className:"w-full dj-input bg-dj-secondary border-dj-accent/30 text-sm",placeholder:"Track title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-dj-light/60 mb-1",children:"Artist"}),s.jsx("input",{type:"text",value:f.artist,onChange:M=>V("artist",M.target.value),className:"w-full dj-input bg-dj-secondary border-dj-accent/30 text-sm",placeholder:"Artist name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-dj-light/60 mb-1",children:"Album"}),s.jsx("input",{type:"text",value:f.album||"",onChange:M=>V("album",M.target.value),className:"w-full dj-input bg-dj-secondary border-dj-accent/30 text-sm",placeholder:"Album name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs text-dj-light/60 mb-1",children:"Genre"}),s.jsx("input",{type:"text",value:f.genre||"",onChange:M=>V("genre",M.target.value),className:"w-full dj-input bg-dj-secondary border-dj-accent/30 text-sm",placeholder:"Genre"})]})]})]}),d&&x&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(tn,{className:"w-4 h-4 text-dj-accent"}),s.jsx("span",{className:"text-sm text-dj-light",children:"Stream Statistics"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-dj-light/60",children:"Listeners:"}),s.jsx("span",{className:"text-white ml-2",children:x.listeners||0})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-dj-light/60",children:"Bitrate:"}),s.jsxs("span",{className:"text-white ml-2",children:[x.bitrate||128,"kbps"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-dj-light/60",children:"Uptime:"}),s.jsxs("span",{className:"text-white ml-2",children:[Math.floor(x.uptime/60),"m"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-dj-light/60",children:"Status:"}),s.jsx("span",{className:"text-dj-success ml-2",children:"Live"})]})]})]}),d&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(jo,{className:"w-4 h-4 text-dj-highlight"}),s.jsx("span",{className:"text-sm text-dj-light",children:"Stream URL"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("input",{type:"text",value:o.getPublicStreamUrl(),readOnly:!0,className:"flex-1 dj-input bg-dj-secondary border-dj-accent/30 text-sm text-dj-light/60",title:"Stream URL for listeners","aria-label":"Public stream URL"}),s.jsx("button",{onClick:()=>navigator.clipboard.writeText(o.getPublicStreamUrl()),className:"px-3 py-2 bg-dj-secondary hover:bg-dj-accent text-dj-light rounded transition-all duration-200",children:"Copy"})]}),s.jsx("p",{className:"text-xs text-dj-light/40 mt-2",children:"Share this URL with your listeners to tune in to your live stream"}),s.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs text-dj-light/70",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-dj-light/60",children:"Last metadata sent"}),s.jsxs("div",{children:["Title: ",(j==null?void 0:j.title)||"-"]}),s.jsxs("div",{children:["Artist: ",(j==null?void 0:j.artist)||"-"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-dj-light/60",children:"HTTP base"}),s.jsx("div",{children:o.getHttpBaseUrl()})]})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(mo,{className:"w-4 h-4 text-dj-accent"}),s.jsx("span",{className:"text-xs text-dj-light/60",children:"Microphone Active"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-dj-success rounded-full animate-pulse"}),s.jsx("span",{className:"text-xs text-dj-light/60",children:"Audio Mixing"})]})]})]})},Of=u.memo(()=>{var Be,ut,qe,Fe,k,E;const e=u.useRef(`djconsole-${Math.random().toString(36).substr(2,9)}`),t=u.useRef(!1),n=u.useRef(!1);u.useEffect(()=>{if(n.current){console.log("🔄 DJConsole already permanently stabilized, preventing ANY re-mount");return}console.log("🎯 DJConsole permanently stabilizing component:",e.current),t.current=!0,n.current=!0,Object.freeze(e.current),Object.freeze(t.current),Object.freeze(n.current)},[]);const{state:o,playLeftTrack:r,pauseLeftTrack:i,resumeLeftTrack:a,stopLeftTrack:l,playRightTrack:c,pauseRightTrack:d,resumeRightTrack:h,stopRightTrack:p,setLeftLocalVolume:y,setRightLocalVolume:x,setCrossfader:S,toggleMicrophone:w,setStreamDucking:C}=an(),{state:f,reorderPlaylist:g}=xr(),[m,v]=u.useState(null),[N,A]=u.useState(null),[b,I]=u.useState(null),[j,R]=u.useState("left");u.useState(!1);const[F,te]=u.useState(!0),oe=u.useRef(!1),ie=u.useRef(!1),V=u.useRef(null),se=u.useRef(!1),ae=u.useCallback((T,L)=>{if(console.log("📥 [DJConsole] memoizedOnLoad called:",{deck:T,track:{id:L.id,title:L.title,artist:L.artist},timestamp:new Date().toISOString()}),se.current){console.log("⚠️ [DJConsole] Load already in progress, skipping");return}se.current=!0;try{const B=L;T==="left"?(console.log("🎵 [DJConsole] Loading track in LEFT deck"),v(B),B!=null&&B.url&&r({id:B.id,title:B.title,artist:B.artist,duration:B.duration,url:B.url})):(console.log("🎵 [DJConsole] Loading track in RIGHT deck"),A(B),B!=null&&B.url&&c({id:B.id,title:B.title,artist:B.artist,duration:B.duration,url:B.url})),console.log("🎯 [DJConsole] Activating deck:",T),R(T)}catch(B){console.warn("Errore nel caricamento traccia:",B)}finally{se.current=!1}},[r,c,v,A,R]);u.useEffect(()=>(console.log("🎛️ [DJConsole] Component mounted"),console.log("🎛️ [DJConsole] Component ID:",Math.random().toString(36).substr(2,9)),console.log("🎛️ [DJConsole] Initial state:",{leftDeck:{track:o.leftDeck.track,isPlaying:o.leftDeck.isPlaying,isActive:o.leftDeck.isActive},rightDeck:{track:o.rightDeck.track,isPlaying:o.rightDeck.isPlaying,isActive:o.rightDeck.isActive}}),window.dispatchEvent(new CustomEvent("djconsole:console-mounted")),()=>{console.log("🎛️ [DJConsole] Component unmounting"),console.log("🎛️ [DJConsole] Component ID:",Math.random().toString(36).substr(2,9)),window.dispatchEvent(new CustomEvent("djconsole:console-unmounted"))}),[]),u.useEffect(()=>{var T,L;console.log("🔄 [DJConsole] Track changed:",{leftDeck:{track:(T=o.leftDeck.track)==null?void 0:T.title,isPlaying:o.leftDeck.isPlaying,isActive:o.leftDeck.isActive},rightDeck:{track:(L=o.rightDeck.track)==null?void 0:L.title,isPlaying:o.rightDeck.isPlaying,isActive:o.rightDeck.isActive}})},[(Be=o.leftDeck.track)==null?void 0:Be.id,(ut=o.rightDeck.track)==null?void 0:ut.id,o.leftDeck.isPlaying,o.rightDeck.isPlaying]),u.useEffect(()=>{console.log("🔄 [DJConsole] Component re-rendered (no unmount)")}),u.useEffect(()=>{const T=L=>{const{deck:B}=L.detail;if(console.log("🔄 Auto-advance requested for deck:",B),b&&f.library.playlists.length>0){const P=f.library.playlists.find(H=>H.id===b);if(P&&P.tracks.length>0){const H=B==="left"?m:N;if(H){const G=P.tracks.findIndex(me=>me.id===H.id);if(G!==-1&&G<P.tracks.length-1){const me=P.tracks[G+1];if(!o.leftDeck.track)console.log("🔄 Auto-loading and playing next track in left deck (free):",me.title),ae("left",me),setTimeout(()=>{var ue;((ue=o.leftDeck.track)==null?void 0:ue.id)===me.id&&(console.log("▶️ Auto-starting left deck"),r(me))},100);else if(!o.rightDeck.track)console.log("🔄 Auto-loading and playing next track in right deck (free):",me.title),ae("right",me),setTimeout(()=>{var ue;((ue=o.rightDeck.track)==null?void 0:ue.id)===me.id&&(console.log("▶️ Auto-starting right deck"),c(me))},100);else{const ue=o.leftDeck.track?o.leftDeck.track.duration-o.leftDeck.currentTime:0,ht=o.rightDeck.track?o.rightDeck.track.duration-o.rightDeck.currentTime:0;ue<ht?(console.log("🔄 Auto-loading next track in left deck (less time left):",me.title),ae("left",me),setTimeout(()=>{var Ye;((Ye=o.leftDeck.track)==null?void 0:Ye.id)===me.id&&(console.log("▶️ Auto-starting left deck"),r(me))},100)):(console.log("🔄 Auto-loading next track in right deck (less time left):",me.title),ae("right",me),setTimeout(()=>{var Ye;((Ye=o.rightDeck.track)==null?void 0:Ye.id)===me.id&&(console.log("▶️ Auto-starting right deck"),c(me))},100))}}}}}};return window.addEventListener("djconsole:request-next-track",T),()=>window.removeEventListener("djconsole:request-next-track",T)},[b,f.library.playlists,m,N,o.leftDeck,o.rightDeck,ae]),u.useEffect(()=>{b===null&&f.library.playlists.length>0&&I(f.library.playlists[0].id)},[b,f.library.playlists]),u.useEffect(()=>{(async()=>{try{await Y.waitForInitialization();const T=await Y.getSettings();te(!!T.interface.autoAdvance)}catch{}})()},[]),u.useEffect(()=>{(async()=>{try{await Y.waitForInitialization();const T=await Y.getSettings();await Y.updateSettings({interface:{...T.interface,autoAdvance:F}})}catch{}})()},[F]),u.useEffect(()=>{const T=B=>{var G;if((B.code==="Space"?"Space":B.key)!=="KeyM"||oe.current)return;if(oe.current=!0,console.log("🎤 PTT started (keyboard)"),(G=o.microphone)!=null&&G.isEnabled||(console.log("🎤 Activating microphone for PTT"),w()),V.current===null){let me=0,ue=0;o.leftDeck.isPlaying&&(me+=o.leftDeck.localVolume,ue++),o.rightDeck.isPlaying&&(me+=o.rightDeck.localVolume,ue++),V.current=ue>0?me/ue:1}const H=Math.max(0,V.current*.3);o.leftDeck.isPlaying&&y(H),o.rightDeck.isPlaying&&x(H),C(!0)},L=B=>{(B.code==="Space"?"Space":B.key)==="KeyM"&&(oe.current=!1,console.log("🎤 PTT stopped (keyboard)"),V.current!==null&&(o.leftDeck.isPlaying&&y(V.current),o.rightDeck.isPlaying&&x(V.current),V.current=null),C(!1))};return window.addEventListener("keydown",T),window.addEventListener("keyup",L),()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",L)}},[o.leftDeck,o.rightDeck,y,x,C,w]);const W=u.useRef(!1);u.useEffect(()=>{if(!n.current){console.log("🔄 DJConsole not yet permanently stabilized, skipping mount logic");return}if(W.current){console.log("🔄 DJConsole already mounted, preventing re-mount");return}if(console.log("🔄 DJConsole mounted, current audio state:",o),W.current)console.log("🔄 DJConsole re-mounted - global controls handle everything");else{W.current=!0;const T=new CustomEvent("djconsole:console-mounted");window.dispatchEvent(T)}},[o]),u.useEffect(()=>()=>{console.log("🔄 [DJConsole] Component re-rendered (no unmount)")},[]),u.useEffect(()=>{const T=()=>{console.log("🔄 Audio controls restored event received - ensuring UI controls work"),m&&(console.log("🔄 Refreshing left deck state after controls restoration"),v({...m})),N&&(console.log("🔄 Refreshing right deck state after controls restoration"),A({...N}))},L=()=>{console.log("🔄 Database restored event received - refreshing console state"),m&&v({...m}),N&&A({...N})},B=P=>{const{trackId:H,updatedPlaylists:G}=P.detail;console.log("🔄 Track deleted event received - syncing console state",{trackId:H}),m&&m.id===H&&(console.log("🔄 Left deck track was deleted - clearing deck"),v(null),window.dispatchEvent(new CustomEvent("djconsole:force-audio-recreation"))),N&&N.id===H&&(console.log("🔄 Right deck track was deleted - clearing deck"),A(null),window.dispatchEvent(new CustomEvent("djconsole:force-audio-recreation"))),G&&(console.log("🔄 Updating playlist state after track deletion"),window.dispatchEvent(new CustomEvent("djconsole:playlists-updated",{detail:{updatedPlaylists:G}})))};return window.addEventListener("djconsole:audio-controls-restored",T),window.addEventListener("djconsole:db-restored",L),window.addEventListener("djconsole:track-deleted",B),()=>{window.removeEventListener("djconsole:audio-controls-restored",T),window.removeEventListener("djconsole:db-restored",L),window.removeEventListener("djconsole:track-deleted",B)}},[m,N,o.leftDeck.isActive,o.rightDeck.isActive]);const D=T=>{var L,B;oe.current=!0,console.log("🎤 PTT activated (hold)"),ie.current=((L=o.microphone)==null?void 0:L.isEnabled)||!1,console.log("🎤 Microphone was active before PTT:",ie.current),(B=o.microphone)!=null&&B.isEnabled||(console.log("🎤 Activating microphone for PTT"),typeof w=="function"?w():console.error("🚨 toggleMicrophone is not a function!",typeof w)),M()},M=()=>{if(V.current===null){let L=0,B=0;o.leftDeck.isPlaying&&(L+=o.leftDeck.localVolume,B++),o.rightDeck.isPlaying&&(L+=o.rightDeck.localVolume,B++),V.current=B>0?L/B:1}const T=Math.max(0,V.current*.3);o.leftDeck.isPlaying&&y(T),o.rightDeck.isPlaying&&x(T),C(!0)},J=()=>{var L,B;if(!oe.current)return;oe.current=!1,console.log("🎤 PTT deactivated (release)");const T=((L=o.microphone)==null?void 0:L.isEnabled)&&!ie.current;console.log("🎤 Should deactivate mic:",T,{micCurrentlyEnabled:(B=o.microphone)==null?void 0:B.isEnabled,wasActiveBeforePTT:ie.current}),T&&(console.log("🎤 Deactivating microphone after PTT"),typeof w=="function"?w():console.error("🚨 toggleMicrophone is not a function!",typeof w)),V.current!==null&&(o.leftDeck.isPlaying&&y(V.current),o.rightDeck.isPlaying&&x(V.current),V.current=null),C(!1)},Q=u.useCallback(async(T,L)=>{try{console.log("🔄 Removing track from playlist:",{trackId:T,playlistId:L});const B=f.library.playlists.find(P=>P.id===L);if(B){const P=B.tracks.filter(G=>G.id!==T);await Y.updatePlaylist(L,{tracks:P.map(G=>G.id)});const H=f.library.playlists.map(G=>G.id===L?{...G,tracks:P}:G);window.dispatchEvent(new CustomEvent("djconsole:playlist-updated",{detail:{playlistId:L,updatedTracks:P,updatedPlaylists:H}})),console.log("✅ Track removed from playlist and synchronized")}}catch(B){console.error("❌ Error removing track from playlist:",B)}},[f.library.playlists]);u.useEffect(()=>{const T=B=>{const{playlistId:P,updatedTracks:H,updatedPlaylists:G}=B.detail;console.log("🔄 Playlist updated event received:",{playlistId:P,trackCount:H.length}),G&&window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:G}}))},L=B=>{const{updatedPlaylists:P}=B.detail;console.log("🔄 Playlists updated event received:",{count:P.length}),window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:P}}))};return window.addEventListener("djconsole:playlist-updated",T),window.addEventListener("djconsole:playlists-updated",L),()=>{window.removeEventListener("djconsole:playlist-updated",T),window.removeEventListener("djconsole:playlists-updated",L)}},[]),u.useEffect(()=>{const T=H=>{const{playlistId:G,updatedTracks:me,updatedPlaylists:ue}=H.detail;console.log("🔄 Library playlist updated - syncing console:",{playlistId:G,trackCount:me.length}),ue&&window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:ue}}))},L=H=>{const{playlists:G}=H.detail;console.log("🔄 Library playlists sync request - updating console state:",{count:G.length}),window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:G}}))},B=H=>{const{playlists:G}=H.detail;console.log("🔄 Library playlists changed - syncing console:",{count:G.length}),window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:G}}))};return setTimeout(()=>{console.log("🔄 Requesting initial sync with library playlists"),window.dispatchEvent(new CustomEvent("djconsole:request-playlists-sync"))},1e3),window.addEventListener("djconsole:library-playlist-updated",T),window.addEventListener("djconsole:library-playlists-sync",L),window.addEventListener("djconsole:library-playlists-changed",B),()=>{window.removeEventListener("djconsole:library-playlist-updated",T),window.removeEventListener("djconsole:library-playlists-sync",L),window.removeEventListener("djconsole:library-playlists-changed",B)}},[]);const he=u.useCallback(()=>{console.log("🔄 Forcing library sync from console"),window.dispatchEvent(new CustomEvent("djconsole:request-playlists-sync"))},[]);return u.useEffect(()=>{const T=()=>{console.log("🔄 Syncing with library playlists"),window.dispatchEvent(new CustomEvent("djconsole:simple-sync-request"))},L=setInterval(T,3e4);return setTimeout(T,2e3),()=>clearInterval(L)},[]),s.jsxs("div",{className:"min-h-screen bg-dj-dark text-white overflow-y-auto dj-console","data-djconsole":"true",children:[s.jsx("header",{className:"bg-dj-primary border-b border-dj-accent/30 p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("h1",{className:"text-2xl font-dj font-bold text-white",children:"DJ Console"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-dj-success rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-dj-light/60",children:"Live Ready"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>{console.log("🎤 Mic toggle clicked"),typeof w=="function"?w():console.error("🚨 toggleMicrophone is not a function!",typeof w)},className:`p-2 rounded-lg transition-all duration-200 ${(qe=o.microphone)!=null&&qe.isEnabled?"bg-dj-success text-white":"bg-dj-secondary text-dj-light hover:bg-dj-accent"}`,title:"Toggle Microfono ON/OFF",children:(Fe=o.microphone)!=null&&Fe.isEnabled?s.jsx(mo,{className:"w-5 h-5"}):s.jsx(wc,{className:"w-5 h-5"})}),s.jsx("button",{onMouseDown:D,onMouseUp:J,onMouseLeave:J,onTouchStart:T=>{T.preventDefault(),D()},onTouchEnd:T=>{T.preventDefault(),J()},className:`relative p-2 rounded-lg transition-all duration-200 ${oe.current?"bg-dj-error text-white":"bg-dj-secondary text-dj-light hover:bg-dj-accent"}`,title:"Push-to-Talk (Hold)",children:s.jsx(mo,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>{console.log("🔄 Manual audio controls restoration requested"),window.dispatchEvent(new CustomEvent("djconsole:force-audio-recreation"))},className:"p-2 bg-dj-accent/20 hover:bg-dj-accent/30 rounded transition-all",title:"Ripristina Controlli Audio",children:"🔄"}),s.jsx("button",{onClick:he,className:"p-2 bg-green-600/20 hover:bg-green-600/30 rounded transition-all",title:"Sincronizza con Libreria",children:"📚"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded border text-[11px] font-semibold transition-opacity ${(k=o.microphone)!=null&&k.isEnabled||oe.current?"bg-dj-error/15 text-dj-error border-dj-error/40 opacity-100 visible":"opacity-0 invisible"}`,children:"MIC ON AIR"}),s.jsxs("label",{className:"flex items-center space-x-2 text-sm text-dj-light/80",children:[s.jsx("input",{type:"checkbox",checked:F,onChange:T=>te(T.target.checked),className:"rounded bg-dj-primary border-dj-accent/30"}),s.jsx("span",{children:"Auto-advance"})]})]})]})}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"grid grid-cols-12 gap-3 mb-3",children:[s.jsx("div",{className:"col-span-12 md:col-span-6",children:s.jsx(Ju,{side:"left",isActive:o.leftDeck.isPlaying,onActivate:()=>console.log("Left deck activated"),track:m})}),s.jsx("div",{className:"col-span-12 md:col-span-6",children:s.jsx(Ju,{side:"right",isActive:o.rightDeck.isPlaying,onActivate:()=>console.log("Right deck activated"),track:N})})]}),s.jsx("div",{className:"bg-dj-primary border border-dj-accent/30 rounded-xl p-3 mb-3",children:s.jsx(cv,{leftVolume:o.leftDeck.localVolume,rightVolume:o.rightDeck.localVolume,onLeftVolumeChange:y,onRightVolumeChange:x,crossfadeValue:o.crossfader,onCrossfadeChange:S})}),s.jsxs("div",{className:"bg-dj-secondary rounded-xl border border-dj-accent/20 p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("div",{className:"text-sm text-dj-light/60",children:"Playlist"}),s.jsx("a",{href:"#live",className:"px-3 py-2 bg-dj-highlight hover:bg-dj-accent text-white rounded-lg text-sm transition-colors",children:"Go Live"})]}),s.jsx("div",{className:"flex items-center space-x-2 mb-4 overflow-x-auto",children:f.library.playlists.map(T=>s.jsx("button",{onClick:()=>I(T.id),className:`px-3 py-2 rounded-md text-sm transition-colors ${b===T.id?"bg-dj-accent text-white":"bg-dj-primary text-dj-light/80 hover:bg-dj-accent/20 hover:text-white"}`,children:T.name},T.id))}),s.jsxs("div",{className:"max-h-[40vh] md:max-h-[52vh] overflow-y-auto divide-y divide-dj-accent/10",children:[b===null&&s.jsx("div",{className:"py-6 text-center text-dj-light/60",children:"Seleziona una playlist"}),(((E=f.library.playlists.find(T=>T.id===b))==null?void 0:E.tracks)||[]).map((T,L,B)=>s.jsxs("div",{draggable:!0,onDragStart:P=>{P.dataTransfer.setData("text/plain",String(L))},onDragOver:P=>P.preventDefault(),onDrop:P=>{P.preventDefault();const H=P.dataTransfer.getData("text/plain"),G=Number(H);if(Number.isNaN(G)||G===L||b===null)return;const me=[...B],[ue]=me.splice(G,1);me.splice(L,0,ue),g(b,me.map(ht=>ht.id))},onDoubleClick:()=>{!o.leftDeck.track||!o.leftDeck.isPlaying?ae("left",T):!o.rightDeck.track||!o.rightDeck.isPlaying?ae("right",T):ae("left",T)},className:"flex items-center justify-between py-2 px-2 hover:bg-dj-accent/10 cursor-pointer",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-2 h-2 bg-dj-highlight rounded-full"}),s.jsx("div",{className:"text-white text-sm",children:T.title}),s.jsx("div",{className:"text-xs text-dj-light/60",children:T.artist})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:P=>{P.stopPropagation(),ae("left",T)},className:"px-2 py-1 bg-dj-primary hover:bg-dj-accent/30 rounded text-xs text-white",children:j==="left"&&o.leftDeck.isPlaying?"Pause A":"Load A"}),s.jsx("button",{onClick:P=>{P.stopPropagation(),ae("right",T)},className:"px-2 py-1 bg-dj-primary hover:bg-dj-accent/30 rounded text-xs text-white",children:j==="right"&&o.rightDeck.isPlaying?"Pause B":"Load B"}),s.jsx("button",{onClick:P=>{P.stopPropagation(),b&&Q(T.id,b)},className:"px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-xs text-white",title:"Rimuovi dalla playlist",children:"×"}),s.jsxs("div",{className:"text-xs text-dj-light/60",children:[Math.floor(T.duration/60),":",String(Math.floor(T.duration%60)).padStart(2,"0")]})]})]},T.id))]}),s.jsxs("div",{className:"mt-3 text-right text-xs text-dj-light/70",children:["Totale: ",(()=>{const T=f.library.playlists.find(H=>H.id===b),L=((T==null?void 0:T.tracks)||[]).reduce((H,G)=>H+G.duration,0),B=Math.floor(L/60),P=Math.floor(L%60);return`${B}:${String(P).padStart(2,"0")}`})()]})]}),s.jsx("div",{id:"live",className:"mt-4",children:s.jsx(uv,{})})]})]})});Of.displayName="DJConsole";const Wn=class Wn{constructor(){U(this,"state");U(this,"listeners",new Map);U(this,"persistenceKey","djconsole_audio_state");U(this,"persistenceTimeout",null);U(this,"deckAAudio",null);U(this,"deckBAudio",null);U(this,"timeUpdateInterval",null);U(this,"microphoneStream",null);U(this,"audioContext",null);U(this,"streamDestination",null);U(this,"isStreaming",!1);this.state=this.getInitialState(),this.initializeGlobalAudio(),this.setupAudioEventListeners(),this.loadPersistedState(),this.addEventListener("stateChanged",()=>{this.persistState()}),window.addEventListener("beforeunload",()=>{this.persistState()}),window.addEventListener("focus",()=>{this.loadPersistedState()}),console.log("🎵 AudioManager initialized with simple audio system")}static getInstance(){return Wn.instance||(Wn.instance=new Wn),Wn.instance}getInitialState(){return{deckA:{id:"A",track:null,isPlaying:!1,currentTime:0,duration:0,volume:.8,isActive:!1,isMuted:!1,volumeBeforeMute:.8},deckB:{id:"B",track:null,isPlaying:!1,currentTime:0,duration:0,volume:.8,isActive:!1,isMuted:!1,volumeBeforeMute:.8},crossfader:.5,masterVolume:.8,micEnabled:!1,micVolume:.7,cueEnabled:!1}}initializeGlobalAudio(){this.deckAAudio=document.createElement("audio"),this.deckAAudio.setAttribute("data-deck","A"),this.deckAAudio.volume=this.state.deckA.volume,this.deckAAudio.preload="metadata",this.deckBAudio=document.createElement("audio"),this.deckBAudio.setAttribute("data-deck","B"),this.deckBAudio.volume=this.state.deckB.volume,this.deckBAudio.preload="metadata",document.body.appendChild(this.deckAAudio),document.body.appendChild(this.deckBAudio),this.startTimeUpdateTimer(),console.log("🎵 Global audio elements created and attached to DOM")}setupAudioEventListeners(){this.deckAAudio&&(this.deckAAudio.addEventListener("play",()=>{this.state.deckA.isPlaying=!0,this.emitEvent("playbackStarted",{deckId:"A"}),this.emitEvent("stateChanged")}),this.deckAAudio.addEventListener("pause",()=>{this.state.deckA.isPlaying=!1,this.emitEvent("playbackPaused",{deckId:"A"}),this.emitEvent("stateChanged")}),this.deckAAudio.addEventListener("ended",()=>{this.state.deckA.isPlaying=!1,this.state.deckA.currentTime=0,this.emitEvent("trackEnded",{deckId:"A"}),this.emitEvent("stateChanged")})),this.deckBAudio&&(this.deckBAudio.addEventListener("play",()=>{this.state.deckB.isPlaying=!0,this.emitEvent("playbackStarted",{deckId:"B"}),this.emitEvent("stateChanged")}),this.deckBAudio.addEventListener("pause",()=>{this.state.deckB.isPlaying=!1,this.emitEvent("playbackPaused",{deckId:"B"}),this.emitEvent("stateChanged")}),this.deckBAudio.addEventListener("ended",()=>{this.state.deckB.isPlaying=!1,this.state.deckB.currentTime=0,this.emitEvent("trackEnded",{deckId:"B"}),this.emitEvent("stateChanged")}))}startTimeUpdateTimer(){this.timeUpdateInterval=setInterval(()=>{this.deckAAudio&&this.state.deckA.isPlaying&&(this.state.deckA.currentTime=this.deckAAudio.currentTime),this.deckBAudio&&this.state.deckB.isPlaying&&(this.state.deckB.currentTime=this.deckBAudio.currentTime),this.emitEvent("stateChanged")},100)}loadTrack(t,n){const o=t==="A"?this.state.deckA:this.state.deckB,r=t==="A"?this.deckAAudio:this.deckBAudio;if(!r){console.error(`❌ Audio element not found for deck ${t}`);return}r.src=n.url,r.load(),o.track=n,o.duration=n.duration,o.currentTime=0,o.isPlaying=!1,this.emitEvent("trackLoaded",{deckId:t,data:n}),this.emitEvent("stateChanged"),console.log(`🎵 Track loaded on deck ${t}: ${n.title}`)}play(t){const n=t==="A"?this.deckAAudio:this.deckBAudio;if(!n||!n.src)return console.warn(`❌ No track loaded on deck ${t}`),!1;try{return n.play(),!0}catch(o){return console.error(`❌ Error playing deck ${t}:`,o),!1}}pause(t){const n=t==="A"?this.deckAAudio:this.deckBAudio;n&&n.pause()}setDeckVolume(t,n){const o=t==="A"?this.state.deckA:this.state.deckB,r=t==="A"?this.deckAAudio:this.deckBAudio,i=Math.max(0,Math.min(1,n));o.volume=i,r&&(r.volume=i),this.emitEvent("volumeChanged",{deckId:t,data:{volume:i}}),this.emitEvent("stateChanged")}setMasterVolume(t){const n=Math.max(0,Math.min(1,t));this.state.masterVolume=n,this.deckAAudio&&(this.deckAAudio.volume=this.state.deckA.volume*n),this.deckBAudio&&(this.deckBAudio.volume=this.state.deckB.volume*n),this.emitEvent("volumeChanged",{data:{masterVolume:n}}),this.emitEvent("stateChanged")}setCrossfader(t){const n=Math.max(0,Math.min(1,t));this.state.crossfader=n,this.deckAAudio&&(this.deckAAudio.volume=this.state.deckA.volume*(1-n)*this.state.masterVolume),this.deckBAudio&&(this.deckBAudio.volume=this.state.deckB.volume*n*this.state.masterVolume),this.emitEvent("crossfaderChanged",{data:{crossfader:n}}),this.emitEvent("stateChanged")}toggleDeckMute(t){const n=t==="A"?this.state.deckA:this.state.deckB,o=t==="A"?this.deckAAudio:this.deckBAudio;n.isMuted?(n.isMuted=!1,n.volume=n.volumeBeforeMute,o&&(o.volume=n.volume*this.state.masterVolume,o.muted=!1)):(n.isMuted=!0,n.volumeBeforeMute=n.volume,n.volume=0,o&&(o.volume=0,o.muted=!0)),this.emitEvent("muteChanged",{deckId:t,data:{muted:n.isMuted}}),this.emitEvent("stateChanged")}setMicrophoneEnabled(t){this.state.micEnabled=t,t?this.enableMicrophone():this.disableMicrophone(),this.emitEvent("stateChanged")}setMicrophoneVolume(t){const n=Math.max(0,Math.min(1,t));this.state.micVolume=n,this.emitEvent("micVolumeChanged",{data:{micVolume:n}}),this.emitEvent("stateChanged")}async enableMicrophone(){try{this.microphoneStream=await navigator.mediaDevices.getUserMedia({audio:!0}),console.log("🎤 Microphone enabled")}catch(t){console.error("❌ Error enabling microphone:",t)}}disableMicrophone(){this.microphoneStream&&(this.microphoneStream.getTracks().forEach(t=>t.stop()),this.microphoneStream=null,console.log("🎤 Microphone disabled"))}startStreaming(){var t;if(this.isStreaming)return console.warn("📡 Streaming already active"),((t=this.streamDestination)==null?void 0:t.stream)||null;try{return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.streamDestination=this.audioContext.createMediaStreamDestination(),this.deckAAudio&&this.audioContext.createMediaElementSource(this.deckAAudio).connect(this.streamDestination),this.deckBAudio&&this.audioContext.createMediaElementSource(this.deckBAudio).connect(this.streamDestination),this.microphoneStream&&this.state.micEnabled&&this.audioContext.createMediaStreamSource(this.microphoneStream).connect(this.streamDestination),this.isStreaming=!0,console.log("📡 Streaming started"),this.streamDestination.stream}catch(n){return console.error("❌ Error starting streaming:",n),null}}stopStreaming(){this.streamDestination&&(this.streamDestination=null),this.isStreaming=!1,console.log("📡 Streaming stopped")}isStreamingActive(){return this.isStreaming}getStreamDestination(){var t;return((t=this.streamDestination)==null?void 0:t.stream)||null}addEventListener(t,n){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n)}removeEventListener(t,n){const o=this.listeners.get(t);if(o){const r=o.indexOf(n);r>-1&&o.splice(r,1)}}emitEvent(t,n){const o={type:t,...n};(this.listeners.get(t)||[]).forEach(i=>i(o))}persistState(){this.persistenceTimeout&&clearTimeout(this.persistenceTimeout),this.persistenceTimeout=setTimeout(()=>{try{localStorage.setItem(this.persistenceKey,JSON.stringify(this.state)),console.log("💾 Audio state persisted")}catch(t){console.error("❌ Error persisting audio state:",t)}},1e3)}loadPersistedState(){try{const t=localStorage.getItem(this.persistenceKey);if(t){const n=JSON.parse(t);this.state={...this.state,...n},this.deckAAudio&&(this.deckAAudio.volume=this.state.deckA.volume*this.state.masterVolume),this.deckBAudio&&(this.deckBAudio.volume=this.state.deckB.volume*this.state.masterVolume),console.log("🔄 Audio state restored from persistence")}}catch(t){console.error("❌ Error loading persisted state:",t)}}getState(){return{...this.state}}getDeckState(t){return t==="A"?{...this.state.deckA}:{...this.state.deckB}}destroy(){console.log("💀 Destroying audio manager"),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.stopStreaming(),this.disableMicrophone(),this.deckAAudio&&this.deckAAudio.remove(),this.deckBAudio&&this.deckBAudio.remove(),this.audioContext&&this.audioContext.close(),this.listeners.clear(),Wn.instance=null}};U(Wn,"instance",null);let ui=Wn;const Zu=({deckId:e,track:t,isActive:n,volume:o,isMuted:r,onVolumeChange:i,onActivate:a,onTrackEnd:l})=>{const[c,d]=u.useState(!1),[h,p]=u.useState(0),[y,x]=u.useState(0),[S,w]=u.useState(!1),[C,f]=u.useState(!0),g=u.useRef(null),m=u.useRef(null),v=ui.getInstance(),N=V=>{const se=Math.floor(V/60),ae=Math.floor(V%60);return`${se}:${ae.toString().padStart(2,"0")}`},A=y-h,b=u.useCallback(()=>{if(audioRef.current&&!audioRef.current.paused){const V=audioRef.current.currentTime;if(p(V),g.current){const se=y>0?V/y*100:0;g.current.style.background=`linear-gradient(to right, #10b981 0%, #10b981 ${se}%, #374151 ${se}%, #374151 100%)`}}},[y]);u.useCallback(()=>{m.current&&clearInterval(m.current),m.current=setInterval(b,100)},[b]);const I=u.useCallback(()=>{m.current&&(clearInterval(m.current),m.current=null)},[]);u.useEffect(()=>{t?(console.log(`🎵 [DECK ${e}] Track loaded: ${t.title}`),w(!1),x(t.duration)):(console.log(`🧹 [DECK ${e}] No track`),w(!1),d(!1),p(0),x(0))},[t,e]),u.useEffect(()=>{(async()=>{var se;try{await Y.waitForInitialization();const ae=await Y.getSettings();f(((se=ae.ui)==null?void 0:se.showWaveform)??!0)}catch(ae){console.warn("Could not load waveform settings:",ae)}})()},[]),u.useEffect(()=>()=>{I()},[I]),u.useEffect(()=>{console.log(`🔊 [DECK ${e}] Volume set to ${Math.round(o*100)}%`)},[o,e]),u.useEffect(()=>{const V=()=>{const se=v.getDeck(e);if(d(se.isPlaying),p(se.currentTime),x(se.duration),g.current&&se.duration>0){const ae=se.currentTime/se.duration*100;g.current.style.background=`linear-gradient(to right, #10b981 0%, #10b981 ${ae}%, #374151 ${ae}%, #374151 100%)`}};return v.addEventListener("stateChanged",V),V(),()=>{v.removeEventListener("stateChanged",V)}},[v,e]);const j=u.useCallback(()=>{if(t)try{c?(console.log(`⏸️ [DECK ${e}] Pausing via AudioManager...`),v.pause(e)):(console.log(`▶️ [DECK ${e}] Playing via AudioManager...`),n||a(),v.play(e))}catch(V){console.error(`❌ [DECK ${e}] Play/Pause error:`,V)}},[c,t,e,n,a,v]),R=u.useCallback(()=>{console.log(`⏹️ [DECK ${e}] Stopping via AudioManager...`),v.stop(e)},[e,v]),F=u.useCallback(V=>{if(!t)return;const se=Math.max(0,Math.min(y,h+V));v.seek(e,se),console.log(`⏩ [DECK ${e}] Skipped ${V}s to ${N(se)}`)},[h,y,t,e,v]),te=u.useCallback(V=>{if(!t)return;const se=parseFloat(V.target.value);v.seek(e,se);const ae=y>0?se/y*100:0;V.target.style.background=`linear-gradient(to right, #10b981 0%, #10b981 ${ae}%, #374151 ${ae}%, #374151 100%)`},[t,y,e,v]),oe=u.useCallback(V=>{const se=parseFloat(V.target.value);i(se)},[i]),ie=u.useCallback(()=>{v.seek(e,0),console.log(`🔄 [DECK ${e}] Reset to start`)},[e,v]);return s.jsxs("div",{className:`bg-gray-900 rounded-lg p-4 border-2 transition-all duration-200 ${n?"border-green-500 shadow-lg shadow-green-500/20":"border-gray-700 hover:border-gray-600"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("h3",{className:"text-lg font-bold text-white",children:["Deck ",e]}),S&&s.jsx("div",{className:"w-4 h-4 border-2 border-green-500 border-t-transparent rounded-full animate-spin"})]}),s.jsx("button",{onClick:a,className:`px-3 py-1 rounded text-sm font-medium transition-all duration-200 ${n?"bg-green-500 text-white shadow-lg":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:n?"ACTIVE":"ACTIVATE"})]}),t&&C&&s.jsx("div",{className:"mb-3",children:s.jsx(Tc,{waveformData:Array.from({length:120},()=>.3+Math.random()*.4),currentTime:h,duration:y,isPlaying:c,deck:e,className:"h-16 bg-gray-800 rounded cursor-pointer",onSeek:te})}),s.jsx("div",{className:"bg-gray-800 rounded-lg p-3 mb-3",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`p-2 rounded-full ${c?"bg-green-500/20":"bg-gray-700"}`,children:s.jsx(xc,{className:`w-5 h-5 ${c?"text-green-500 animate-spin":"text-gray-400"}`})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-white truncate",children:(t==null?void 0:t.title)||"No Track Loaded"}),s.jsx("p",{className:"text-sm text-gray-400 truncate",children:(t==null?void 0:t.artist)||"Unknown Artist"})]}),t&&s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-400",children:[s.jsx(Ks,{className:"w-4 h-4"}),s.jsx("span",{children:N(y)})]})})]})}),t&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-1",children:[s.jsx("span",{children:N(h)}),s.jsxs("span",{children:["-",N(A)]})]}),s.jsx("input",{ref:g,type:"range",min:0,max:y||.1,step:.1,value:h,onChange:te,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider","aria-label":`Seek control for Deck ${e}`,title:`Seek control for Deck ${e}`,style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${y>0?h/y*100:0}%, #374151 ${y>0?h/y*100:0}%, #374151 100%)`}})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[s.jsx("button",{onClick:ie,disabled:!t,className:"w-8 h-8 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 rounded flex items-center justify-center transition-all duration-200",title:"Reset to start",children:s.jsx(Hy,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>F(-10),disabled:!t,className:"w-8 h-8 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 rounded flex items-center justify-center transition-all duration-200",title:"Skip backward 10s",children:s.jsx(Ec,{className:"w-4 h-4"})}),s.jsx("button",{onClick:j,disabled:!t||S,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 ${c?"bg-yellow-500 hover:bg-yellow-400 text-gray-900":"bg-green-500 hover:bg-green-400 text-white"} disabled:bg-gray-800 disabled:text-gray-600`,title:c?"Pause":"Play",children:c?s.jsx(Sc,{className:"w-5 h-5"}):s.jsx(hr,{className:"w-5 h-5 ml-0.5"})}),s.jsx("button",{onClick:()=>F(10),disabled:!t,className:"w-8 h-8 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:text-gray-600 rounded flex items-center justify-center transition-all duration-200",title:"Skip forward 10s",children:s.jsx(Cc,{className:"w-4 h-4"})}),s.jsx("button",{onClick:R,disabled:!t,className:"w-8 h-8 bg-red-600 hover:bg-red-500 disabled:bg-gray-800 disabled:text-gray-600 rounded flex items-center justify-center transition-all duration-200",title:"Stop",children:s.jsx(Rf,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>v.toggleDeckMute(e),disabled:!t,className:`w-8 h-8 rounded flex items-center justify-center transition-all duration-200 ${r?"bg-red-500 hover:bg-red-400 text-white":"bg-gray-600 hover:bg-gray-500 text-white"} disabled:bg-gray-800 disabled:text-gray-600`,title:r?"Unmute":"Mute",children:r?s.jsx(Xi,{className:"w-4 h-4"}):s.jsx(tn,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(tn,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Volume"})]}),s.jsxs("span",{className:"text-sm text-white font-medium",children:[Math.round(o*100),"%"]})]}),s.jsx("input",{type:"range",min:0,max:1,step:.01,value:o,onChange:oe,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider","aria-label":`Volume control for Deck ${e}`,title:`Volume control for Deck ${e}`,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${o*100}%, #374151 ${o*100}%, #374151 100%)`}})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${c?"bg-green-500":"bg-gray-600"}`}),s.jsx("span",{className:"text-gray-400",children:c?"PLAYING":S?"LOADING":"READY"})]}),t&&s.jsx("div",{className:"text-gray-400",children:"BPM: --"})]})]})},dv=({deckAVolume:e,deckBVolume:t,onDeckAVolumeChange:n,onDeckBVolumeChange:o,deckAMuted:r,deckBMuted:i,onDeckAMuteToggle:a,onDeckBMuteToggle:l,crossfaderValue:c,onCrossfaderChange:d,masterVolume:h,onMasterVolumeChange:p,micEnabled:y,micVolume:x,onMicToggle:S,onMicVolumeChange:w,cueEnabled:C,onCueToggle:f})=>{const[g,m]=u.useState(!1),v=u.useCallback(()=>{m(!g),p(g?h:0)},[g,h,p]),N=c*100;return s.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 border border-gray-700",children:[s.jsx("h2",{className:"text-lg font-bold text-white mb-4 text-center",children:"MIXER"}),s.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"DECK A"})}),s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("button",{onClick:a,className:`w-8 h-8 rounded flex items-center justify-center transition-all duration-200 ${r?"bg-red-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Mute Deck A",children:r?s.jsx(Xi,{className:"w-4 h-4"}):s.jsx(tn,{className:"w-4 h-4"})}),s.jsx("div",{className:"flex flex-col items-center h-32",children:s.jsx("input",{type:"range",min:0,max:1,step:.01,value:e,onChange:A=>n(parseFloat(A.target.value)),className:"h-full w-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider vertical-slider","aria-label":"Deck A Volume",title:"Deck A Volume",orient:"vertical",style:{writingMode:"bt-lr",WebkitAppearance:"slider-vertical",background:r?`linear-gradient(to top, #ef4444 0%, #ef4444 ${e*100}%, #374151 ${e*100}%, #374151 100%)`:`linear-gradient(to top, #10b981 0%, #10b981 ${e*100}%, #374151 ${e*100}%, #374151 100%)`}})}),s.jsxs("div",{className:"text-xs text-center",children:[s.jsxs("div",{className:r?"text-red-400":"text-gray-400",children:[Math.round(e*100),"%"]}),r&&s.jsx("div",{className:"text-xs text-red-500 font-bold",children:"MUTED"})]})]}),s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-all duration-200 ${C?"bg-yellow-500 text-black":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Cue Deck A",children:"CUE"})]}),s.jsxs("div",{className:"col-span-3 space-y-4",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"CROSSFADER"})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[s.jsx("span",{className:c<.3?"text-green-400":"",children:"A"}),s.jsx("span",{className:c>.7?"text-blue-400":"",children:"B"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"range",min:0,max:1,step:.01,value:c,onChange:A=>d(parseFloat(A.target.value)),className:"w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer slider crossfader","aria-label":"Crossfader",title:"Crossfader",style:{background:`linear-gradient(to right, #10b981 0%, #10b981 ${N}%, #3b82f6 ${N}%, #3b82f6 100%)`}}),s.jsx("div",{className:"absolute top-0 w-1 h-3 bg-white rounded shadow-lg pointer-events-none",style:{left:`calc(${N}% - 2px)`}})]}),s.jsx("div",{className:"text-center text-xs text-gray-400",children:c<.3?"DECK A":c>.7?"DECK B":"CENTER"})]}),s.jsxs("div",{className:"flex justify-center space-x-2 mt-4",children:[s.jsx("button",{className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 text-xs rounded",children:"SMOOTH"}),s.jsx("button",{className:"px-2 py-1 bg-blue-600 text-xs rounded",children:"SHARP"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"DECK B"})}),s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("button",{onClick:l,className:`w-8 h-8 rounded flex items-center justify-center transition-all duration-200 ${i?"bg-red-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Mute Deck B",children:i?s.jsx(Xi,{className:"w-4 h-4"}):s.jsx(tn,{className:"w-4 h-4"})}),s.jsx("div",{className:"flex flex-col items-center h-32",children:s.jsx("input",{type:"range",min:0,max:1,step:.01,value:t,onChange:A=>o(parseFloat(A.target.value)),className:"h-full w-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider vertical-slider","aria-label":"Deck B Volume",title:"Deck B Volume",orient:"vertical",style:{writingMode:"bt-lr",WebkitAppearance:"slider-vertical",background:i?`linear-gradient(to top, #ef4444 0%, #ef4444 ${t*100}%, #374151 ${t*100}%, #374151 100%)`:`linear-gradient(to top, #3b82f6 0%, #3b82f6 ${t*100}%, #374151 ${t*100}%, #374151 100%)`}})}),s.jsxs("div",{className:"text-xs text-center",children:[s.jsxs("div",{className:i?"text-red-400":"text-gray-400",children:[Math.round(t*100),"%"]}),i&&s.jsx("div",{className:"text-xs text-red-500 font-bold",children:"MUTED"})]})]}),s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-all duration-200 ${C?"bg-yellow-500 text-black":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Cue Deck B",children:"CUE"})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-gray-700",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"MIC"})}),s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("button",{onClick:S,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${y?"bg-red-500 text-white shadow-lg animate-pulse":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:y?"Disable Microphone":"Enable Microphone",children:y?s.jsx(mo,{className:"w-5 h-5"}):s.jsx(wc,{className:"w-5 h-5"})}),s.jsx("div",{className:"w-full",children:s.jsx("input",{type:"range",min:0,max:2,step:.01,value:x,onChange:A=>w(parseFloat(A.target.value)),disabled:!y,className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider disabled:opacity-50","aria-label":"Microphone Volume",title:"Microphone Volume",style:{background:`linear-gradient(to right, #ef4444 0%, #ef4444 ${x/2*100}%, #374151 ${x/2*100}%, #374151 100%)`}})}),s.jsx("div",{className:"text-xs text-gray-400 text-center",children:x===0?"-∞ dB":`${(20*Math.log10(x)).toFixed(1)} dB`})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"MONITOR"})}),s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("button",{onClick:f,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${C?"bg-yellow-500 text-black shadow-lg":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:C?"Disable Monitor":"Enable Monitor",children:s.jsx(jf,{className:"w-5 h-5"})}),s.jsx("div",{className:"text-xs text-gray-400 text-center",children:C?"ON":"OFF"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"text-center",children:s.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"MASTER"})}),s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("button",{onClick:v,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${g?"bg-red-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Mute Master",children:g?s.jsx(Xi,{className:"w-5 h-5"}):s.jsx(tn,{className:"w-5 h-5"})}),s.jsx("div",{className:"w-full",children:s.jsx("input",{type:"range",min:0,max:1,step:.01,value:h,onChange:A=>p(parseFloat(A.target.value)),className:"w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer slider","aria-label":"Master Volume",title:"Master Volume",style:{background:`linear-gradient(to right, #f59e0b 0%, #f59e0b ${h*100}%, #374151 ${h*100}%, #374151 100%)`}})}),s.jsxs("div",{className:"text-xs text-gray-400 text-center font-bold",children:[Math.round(h*100),"%"]})]})]})]}),s.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-700",children:[s.jsx("div",{className:"text-center text-xs text-gray-400 mb-2",children:"OUTPUT LEVEL"}),s.jsx("div",{className:"flex justify-center space-x-1",children:Array.from({length:10},(A,b)=>s.jsx("div",{className:`w-2 h-6 rounded ${b<Math.floor(h*10)?b<6?"bg-green-500":b<8?"bg-yellow-500":"bg-red-500":"bg-gray-700"}`},b))})]})]})},qn=class qn{constructor(){U(this,"audioManager");U(this,"isInitialized",!1);this.audioManager=ui.getInstance(),this.initialize()}static getInstance(){return qn.instance||(qn.instance=new qn),qn.instance}initialize(){this.isInitialized||(console.log("🔄 Initializing Global Audio Persistence"),window.addEventListener("beforeunload",this.handleBeforeUnload.bind(this)),window.addEventListener("unload",this.handleUnload.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),window.addEventListener("pageshow",this.handlePageShow.bind(this)),window.addEventListener("popstate",this.handlePopState.bind(this)),this.setupNavigationPersistence(),this.isInitialized=!0,console.log("✅ Global Audio Persistence initialized"))}handleBeforeUnload(){console.log("🔄 Page unloading - preserving audio state"),this.saveCurrentState()}handleUnload(){console.log("🔄 Page unloaded - audio state preserved")}handleWindowFocus(){console.log("🔄 Window focused - checking audio state"),this.restoreAudioIfNeeded()}handlePageShow(t){console.log("🔄 Page shown - restoring audio state"),t.persisted&&this.restoreAudioIfNeeded()}handlePopState(){console.log("🔄 Navigation detected - maintaining audio state")}setupNavigationPersistence(){const t=history.pushState,n=history.replaceState;history.pushState=function(...o){return console.log("🔄 Navigation (pushState) - preserving audio"),t.apply(history,o)},history.replaceState=function(...o){return console.log("🔄 Navigation (replaceState) - preserving audio"),n.apply(history,o)}}saveCurrentState(){try{const t=this.audioManager.getState(),n={deckA:{track:t.deckA.track,isPlaying:t.deckA.isPlaying,currentTime:t.deckA.currentTime,volume:t.deckA.volume},deckB:{track:t.deckB.track,isPlaying:t.deckB.isPlaying,currentTime:t.deckB.currentTime,volume:t.deckB.volume},crossfader:t.crossfader,masterVolume:t.masterVolume,timestamp:Date.now()};sessionStorage.setItem("dj_audio_persistent_state",JSON.stringify(n)),console.log("💾 Audio state saved for persistence")}catch(t){console.error("❌ Error saving persistent audio state:",t)}}restoreAudioIfNeeded(){try{const t=sessionStorage.getItem("dj_audio_persistent_state");if(!t)return;const n=JSON.parse(t),o=5*60*1e3;if(Date.now()-n.timestamp>o){console.log("⏰ Persistent state is too old, skipping restore");return}console.log("🔄 Restoring audio state from persistence"),n.deckA.track&&(this.audioManager.loadTrack("A",n.deckA.track),this.audioManager.setDeckVolume("A",n.deckA.volume),n.deckA.isPlaying&&setTimeout(()=>{this.audioManager.play("A")},100)),n.deckB.track&&(this.audioManager.loadTrack("B",n.deckB.track),this.audioManager.setDeckVolume("B",n.deckB.volume),n.deckB.isPlaying&&setTimeout(()=>{this.audioManager.play("B")},100)),this.audioManager.setCrossfader(n.crossfader),this.audioManager.setMasterVolume(n.masterVolume),console.log("✅ Audio state restored from persistence")}catch(t){console.error("❌ Error restoring persistent audio state:",t)}}forceSave(){this.saveCurrentState()}forceRestore(){this.restoreAudioIfNeeded()}destroy(){window.removeEventListener("beforeunload",this.handleBeforeUnload.bind(this)),window.removeEventListener("unload",this.handleUnload.bind(this)),window.removeEventListener("focus",this.handleWindowFocus.bind(this)),window.removeEventListener("pageshow",this.handlePageShow.bind(this)),window.removeEventListener("popstate",this.handlePopState.bind(this)),this.isInitialized=!1,qn.instance=null,console.log("💀 Global Audio Persistence destroyed")}};U(qn,"instance",null);let wl=qn;wl.getInstance();const mv=()=>{const e=Cf(),[t]=u.useState(()=>{const O=ui.getInstance();return window.audioManager=O,O}),[n]=u.useState(()=>new $f),{settings:o}=Bn(),{getMixedStream:r}=an(),[i,a]=u.useState(null),[l,c]=u.useState(null),[d,h]=u.useState(.8),[p,y]=u.useState(.8),[x,S]=u.useState(.8),[w,C]=u.useState(!0),[f,g]=u.useState(()=>{const O=window.__micVolume__||.1;return window.__micVolume__=O,console.log("🎤 [INIT] Microphone initialized at",Math.round(O*100),"% (always enabled)"),O}),[m,v]=u.useState(!1),[N,A]=u.useState("A"),[b,I]=u.useState(!1),[j,R]=u.useState(!1),[F,te]=u.useState("disconnected"),[oe,ie]=u.useState(null),V=u.useRef(null),se=u.useRef(null),ae=u.useRef(null),W=u.useRef(!1),[D,M]=u.useState(!1),[J,Q]=u.useState(!1),[he,Be]=u.useState([]),[ut,qe]=u.useState(!1),[Fe,k]=u.useState(!1),[E,T]=u.useState(!1),[L,B]=u.useState(!1),[P,H]=u.useState(!1),{state:G,dispatch:me}=xr(),[ue,ht]=u.useState(null),[Ye,Gt]=u.useState(null),[hn,ln]=u.useState(null),[Ae,Gn]=u.useState(null),ne=u.useRef(0),q=u.useRef(null),[fe,ee]=u.useState(null);u.useEffect(()=>{console.log("🎤 [STARTUP] Auto-enabling microphone at startup"),t.setMicrophoneEnabled(!0),t.setMicVolume(f),console.log("🎤 [STARTUP] Microphone auto-enabled at",Math.round(f*100),"%")},[t,f]),u.useEffect(()=>{const O=()=>{const $=t.getState();a($.deckA.track),c($.deckB.track),h($.deckA.volume),y($.deckB.volume),S($.masterVolume),C($.micEnabled),g($.micVolume),v($.cueEnabled),k($.deckA.isActive),T($.deckB.isActive),B($.deckA.isMuted),H($.deckB.isMuted),$.deckA.isPlaying&&$.deckB.isPlaying?A(N||"A"):$.deckA.isPlaying?A("A"):$.deckB.isPlaying?A("B"):$.deckA.isActive?A("A"):$.deckB.isActive&&A("B")};t.addEventListener("stateChanged",O);const _=$=>{$.deckId&&(console.log(`🔊 Volume changed for Deck ${$.deckId}: ${Math.round($.data*100)}%`),O())};return t.addEventListener("volumeChanged",_),O(),()=>{t.removeEventListener("stateChanged",O),t.removeEventListener("volumeChanged",_)}},[t,N]),u.useEffect(()=>{!ue&&G.library.playlists.length>0&&ht(G.library.playlists[0].id)},[ue,G.library.playlists]);const xe=u.useCallback(O=>{t.setDeckVolume("A",O),console.log("🔊 Deck A volume updated to",O,"(LIVE MIXER COMPLETELY UNAFFECTED)")},[t]),$e=u.useCallback(O=>{t.setDeckVolume("B",O),console.log("🔊 Deck B volume updated to",O,"(LIVE MIXER COMPLETELY UNAFFECTED)")},[t]),dt=u.useCallback(()=>{t.setDeckActive("A",!0)},[t]),Ce=u.useCallback(()=>{t.setDeckActive("B",!0)},[t]),st=u.useCallback(O=>{if(console.log(`🔊 [MASTER VOLUME] Changing master volume to ${Math.round(O*100)}%`),t.setMasterVolume(O),window.updatePTTVolumesOnly){const _=window.__pttActive__??!1;console.log(`🔊 [MASTER VOLUME] Updating mixer gain with PTT state: ${_}`),window.updatePTTVolumesOnly(_)}else console.log("🔊 [MASTER VOLUME] Warning: updatePTTVolumesOnly function not available yet")},[t]),Ct=u.useCallback(()=>{t.toggleMicrophone()},[t]),wo=u.useCallback(()=>{t.toggleCue()},[t]),Vt=u.useCallback(async(O,_)=>{try{console.log(`🎵 Loading track "${O.title}" in Deck ${_}`);const $=await ci(O.blobId);if(!$){console.error(`❌ Blob not found for track: ${O.title}`);return}const X=URL.createObjectURL($),de={id:O.id,title:O.title,artist:O.artist,duration:O.duration,url:X};t.loadTrack(_,de),console.log(`✅ Track loaded in Deck ${_}`)}catch($){console.error(`❌ Error loading track in Deck ${_}:`,$)}},[t]),Z=u.useCallback((O,_,$)=>{const de=`[${new Date().toLocaleTimeString()}] ${O.toUpperCase()}: ${_} - ${$}`;console.log(`📡 ${de}`),Be(be=>[de,...be].slice(0,50)),!D&&O==="error"&&Q(!0)},[D]);u.useEffect(()=>{n.onStatusChange=_=>{switch(console.log(`📡 Stream status changed: ${_}`),te(_),R(_==="connected"||_==="streaming"),I(_==="streaming"),_){case"connected":console.log("📡 STATUS CHANGE: Connected - Direct mode initialized, waiting for server verification..."),Z("info","Modalità Diretta Attiva","ffmpeg inizializzato, verifica connessione server in corso..."),console.log("📡 DIAGNOSTIC TIMER: Setting up 3-second diagnostic check..."),setTimeout(async()=>{var be,ye;try{console.log("🔍 DEEP DIAGNOSTIC: Starting ffmpeg connection status check..."),Z("info","Diagnostica Avviata","Verifica stato connessione ffmpeg in corso..."),console.log("🔍 DEEP DIAGNOSTIC: Calling streamingManager methods...");let Ee=!1,Ge=!1;try{Ee=n.isCurrentlyStreaming(),console.log("🔍 DEEP DIAGNOSTIC: isCurrentlyStreaming() =",Ee)}catch(Ke){console.error("❌ DEEP DIAGNOSTIC: Error calling isCurrentlyStreaming():",Ke),Z("error","Errore Diagnostica","Errore nel controllo stato streaming locale")}try{Ge=n.isConnectedToServer(),console.log("🔍 DEEP DIAGNOSTIC: isConnectedToServer() =",Ge)}catch(Ke){console.error("❌ DEEP DIAGNOSTIC: Error calling isConnectedToServer():",Ke),Z("error","Errore Diagnostica","Errore nel controllo connessione server")}if(console.log("🔍 DEEP DIAGNOSTIC: Final status:",{locallyStreaming:Ee,connectedToServer:Ge}),Z("info","Status Diagnostica",`Locale: ${Ee?"Attivo":"Inattivo"}, Server: ${Ge?"Connesso":"Non Connesso"}`),Ee||(console.log("❌ DEEP DIAGNOSTIC: Local streaming process is NOT active!"),Z("error","Processo Locale Inattivo","Il processo di streaming locale (ffmpeg) non è attivo!")),Ge){console.log("✅ DEEP DIAGNOSTIC: Connected to server, but mountpoint verification will follow..."),Z("warning","Connessione Anomala","ffmpeg dice di essere connesso ma il server remoto non mostra connessioni. Investigando..."),console.log("🧪 DECISIVE TEST: Checking if ffmpeg connected to wrong server...");try{const ge=await fetch("http://localhost:8000/status-json.xsl",{signal:AbortSignal.timeout(3e3)});if(ge.ok){const Oe=((ye=(await ge.json()).icestats)==null?void 0:ye.source)||[],Re=Array.isArray(Oe)?Oe:[Oe];if(console.log("🧪 DECISIVE TEST: Localhost Icecast sources:",Re),Re.length>0){console.log("🚨 DECISIVE TEST: FOUND IT! ffmpeg is connected to LOCALHOST, not remote server!"),Z("error","ffmpeg su Localhost","PROBLEMA TROVATO: ffmpeg si è connesso a localhost:8000 invece del server remoto!");const kt=Re.map(at=>at.mount||at.listenurl||"unknown");Z("info","Mountpoint Localhost",`Mountpoint trovati su localhost: ${kt.join(", ")}`)}else console.log("🧪 DECISIVE TEST: Localhost Icecast exists but no sources")}else console.log("🧪 DECISIVE TEST: Localhost Icecast not responding")}catch{console.log("🧪 DECISIVE TEST: No localhost Icecast server running")}const Ke=[8e3,8001,8004,9e3];for(const ge of Ke)if(ge!==8e3)try{(await fetch(`http://localhost:${ge}/status-json.xsl`,{signal:AbortSignal.timeout(2e3)})).ok&&(console.log(`🧪 DECISIVE TEST: Found Icecast on localhost:${ge}!`),Z("warning","Icecast Locale Trovato",`Trovato server Icecast su localhost:${ge} - potrebbe interferire!`))}catch{}}else{console.log("❌ DEEP DIAGNOSTIC: NOT connected to Icecast server!"),Z("error","Server Non Connesso","Non siamo connessi al server Icecast! Possibili cause: credenziali errate, server irraggiungibile."),console.log("🔍 DEEP DIAGNOSTIC: Checking if ffmpeg is connecting to wrong server...");try{const Re=await fetch("http://localhost:8000/status-json.xsl",{signal:AbortSignal.timeout(3e3)});if(Re.ok){const at=((be=(await Re.json()).icestats)==null?void 0:be.source)||[],jt=Array.isArray(at)?at:[at];if(console.log("🔍 DEEP DIAGNOSTIC: Localhost Icecast sources:",jt),jt.length>0){console.log("⚠️ DEEP DIAGNOSTIC: ffmpeg might be connecting to localhost instead of remote server!"),Z("warning","ffmpeg Misdirected","ffmpeg potrebbe essere connesso a localhost invece del server remoto. Verifica configurazione Electron.");const Rt=jt.map(pn=>pn.mount||pn.listenurl||"unknown");console.log("🔍 DEEP DIAGNOSTIC: Localhost mountpoints found:",Rt),Z("info","Localhost Mountpoints",`Trovati mountpoint su localhost: ${Rt.join(", ")}`)}else console.log("✅ DEEP DIAGNOSTIC: Localhost Icecast has no sources (this is expected)")}}catch{console.log("🔍 DEEP DIAGNOSTIC: No localhost Icecast running (this is normal)")}const ge=(await Y.getSettings()).streaming.icecast,Oe=`${ge.useSSL?"https":"http"}://${ge.host}:${ge.port||8e3}/`;try{console.log(`🔍 DEEP DIAGNOSTIC: Testing direct connection to ${Oe}`);const Re=await fetch(Oe,{method:"GET",signal:AbortSignal.timeout(5e3)});Re.ok?(console.log(`✅ DEEP DIAGNOSTIC: Server reachable, status ${Re.status}`),Z("warning","Server Raggiungibile",`Server ${ge.host}:${ge.port} risponde, ma ffmpeg non si connette. Verifica credenziali.`)):(console.log(`❌ DEEP DIAGNOSTIC: Server error ${Re.status}`),Z("error","Server Error",`Server ${ge.host}:${ge.port} risponde con errore ${Re.status}.`))}catch(Re){console.error("❌ DEEP DIAGNOSTIC: Connection test failed:",Re),Z("error","Server Irraggiungibile",`Impossibile raggiungere ${ge.host}:${ge.port}. Verifica host e porta.`)}}console.log("🔍 DEEP DIAGNOSTIC: Diagnostic check completed successfully"),Z("info","Diagnostica Completata","Controllo stato connessione terminato")}catch(Ee){console.error("❌ DEEP DIAGNOSTIC: Error during check:",Ee),Z("error","Errore Diagnostica",`Errore durante controllo: ${Ee.message}`)}},2e3),ie(null);break;case"streaming":console.log("📡 Local streaming started, waiting for server verification...");const $=setInterval(async()=>{try{const be=n.isCurrentlyStreaming(),ye=n.isConnectedToServer();console.log("🔍 CONNECTION MONITOR:",{streaming:be,connected:ye,timestamp:new Date().toISOString()}),(!be||!ye)&&(console.log("⚠️ CONNECTION LOST DETECTED!"),Z("warning","Connessione Persa","La connessione al server si è interrotta. Tentativo di riconnessione..."),clearInterval($))}catch(be){console.error("❌ CONNECTION MONITOR ERROR:",be),clearInterval($)}},5e3),X=n.stopStreaming.bind(n);n.stopStreaming=()=>(clearInterval($),X()),ae.current&&clearInterval(ae.current);let de=0;ae.current=setInterval(async()=>{var Ee,Ge;const be=n.isCurrentlyStreaming(),ye=n.isConnectedToServer();if(!be||!ye){console.log("📡 Periodic check: streaming lost!"),Z("error","Streaming Perso","La connessione di streaming si è interrotta. Riprova a connetterti."),ie("Streaming connection lost"),te("disconnected"),I(!1),R(!1),ae.current&&(clearInterval(ae.current),ae.current=null);return}try{const Ke=await Y.getSettings();if((Ee=Ke==null?void 0:Ke.streaming)!=null&&Ee.icecast){const ge=Ke.streaming.icecast,ft=ge.useSSL?"https":"http",Oe=`${ft}://${ge.host}:${ge.port||8e3}/admin/stats.xml`;try{const Re=await fetch(Oe,{signal:AbortSignal.timeout(3e3),headers:{Authorization:`Basic ${btoa(`${ge.username}:${ge.password}`)}`}});if(Re.ok){const at=(await Re.text()).match(/source_connection_refused|source_already_connected|client_connection_refused/gi),jt=at?at.length:0;if(jt>de){const Rt=jt-de;console.log(`📡 Detected ${Rt} rejected connection attempts`),Z("info","Server Occupato Confermato",`${Rt} tentativo/i di connessione rifiutato/i dal server. Il mountpoint è effettivamente occupato da te.`),de=jt}}}catch{const kt=`${ft}://${ge.host}:${ge.port||8e3}/status-json.xsl`;try{const at=await fetch(kt,{signal:AbortSignal.timeout(3e3)});if(at.ok){const Rt=((Ge=(await at.json()).icestats)==null?void 0:Ge.source)||[],pn=Array.isArray(Rt)?Rt:[Rt],Ht=ge.mount||"/live",yn=pn.filter(Le=>{const le=Le.mount||"",pe=Le.listenurl||"";if(le===Ht||pe.endsWith(Ht))return!0;if(Ht&&Ht.length>1){const Xe=Ht.replace("/","");if(pe.includes(Xe)||le.includes(Xe))return!0}return!1});yn.length>1&&Z("warning","Conflitto Mountpoint",`Rilevate ${yn.length} sorgenti per lo stesso mountpoint. Possibili connessioni concorrenti.`)}}catch{}}}}catch(Ke){console.warn("📡 Monitoring error:",Ke)}},15e3);break;case"disconnected":oe&&Z("error","Disconnesso",`Connessione persa: ${oe}`),ie(null),ae.current&&(clearInterval(ae.current),ae.current=null);break}},n.onDebug=_=>{console.log(`📡 [STREAMING] ${_}`);const $=_.toLowerCase();if($.includes("error")||$.includes("failed")){const X=`Debug: ${_}`;ie(X),te("disconnected"),I(!1),R(!1),$.includes("mountpoint")||$.includes("already")||$.includes("occupied")||$.includes("in use")?Z("error","Server Occupato","Il mountpoint è già in uso da un altro utente. Prova più tardi o usa un mountpoint diverso."):$.includes("auth")||$.includes("password")||$.includes("credentials")?Z("error","Credenziali Errate","Username o password non corretti. Verifica le credenziali nelle impostazioni."):$.includes("connection")||$.includes("connect")?Z("error","Connessione Fallita","Impossibile connettersi al server. Verifica URL e porta nelle impostazioni."):Z("error","Errore Streaming",X)}else $.includes("connected")?Z("info","Debug",_):($.includes("rejected")||$.includes("denied"))&&(ie("Connection rejected"),te("disconnected"),I(!1),R(!1),Z("error","Connessione Rifiutata","Il server ha rifiutato la connessione. Potrebbe essere già occupato."))};const O=async()=>{var _,$,X,de,be,ye,Ee,Ge,Ke,ge,ft,Oe,Re,kt,at,jt,Rt,pn,Ht,yn;console.log("🔄 Loading streaming settings...");try{await Y.waitForInitialization();const Le=await Y.getSettings();if(console.log("📡 Raw settings loaded:",Le==null?void 0:Le.streaming),(_=Le.streaming)!=null&&_.bridgeUrl?(n.setServerUrl(Le.streaming.bridgeUrl),console.log(`📡 WebSocket bridge URL set to: ${Le.streaming.bridgeUrl}`)):console.log("📡 No WebSocket bridge configured - using direct Icecast mode only"),(!((X=($=Le.streaming)==null?void 0:$.icecast)!=null&&X.host)||!((be=(de=Le.streaming)==null?void 0:de.icecast)!=null&&be.password))&&console.warn("⚠️ Icecast credentials incomplete - streaming may not work"),(ye=Le.streaming)!=null&&ye.icecast){const pe=Le.streaming.icecast;if(console.log("📡 RAW ICECAST SETTINGS FROM DATABASE:",{host:pe.host,port:pe.port,username:pe.username,password:pe.password?`[${pe.password.length} chars]`:"[EMPTY]",mount:pe.mount,useSSL:pe.useSSL}),pe.host&&pe.password){const Xe={host:pe.host,port:pe.port,username:pe.username,password:pe.password,mountpoint:pe.mount,useSSL:pe.useSSL};n.setCredentials(Xe),console.log(`📡 Icecast credentials configured for ${pe.host}:${pe.port}${pe.mount}`),console.log(`📡 Username being used: "${pe.username}"`)}else console.error("📡 MISSING REQUIRED CREDENTIALS:",{hasHost:!!pe.host,hasPassword:!!pe.password})}else console.error("📡 NO ICECAST SETTINGS FOUND IN DATABASE!");console.log("📡 Streaming settings loaded successfully",{serverUrl,hasIcecastConfig:!!((Ge=(Ee=Le.streaming)==null?void 0:Ee.icecast)!=null&&Ge.host),icecastHost:((ge=(Ke=Le.streaming)==null?void 0:Ke.icecast)==null?void 0:ge.host)||"not set",autoConnect:((ft=Le.streaming)==null?void 0:ft.autoConnect)||!1});const le=(Oe=Le.streaming)!=null&&Oe.bridgeUrl?`Bridge: ${Le.streaming.bridgeUrl}`:"Direct mode";console.log(`📡 Settings loaded: ${le}${(kt=(Re=Le.streaming)==null?void 0:Re.icecast)!=null&&kt.host?` | Icecast: ${Le.streaming.icecast.host}`:""}`),(jt=(at=Le.streaming)==null?void 0:at.icecast)!=null&&jt.host&&((pn=(Rt=Le.streaming)==null?void 0:Rt.icecast)!=null&&pn.password)&&Z("success","Configurazione OK",`Server Icecast configurato: ${Le.streaming.icecast.host}:${Le.streaming.icecast.port||8e3}`)}catch(Le){console.error("❌ Error loading streaming settings:",Le),console.error("❌ Error details:",{message:Le instanceof Error?Le.message:"Unknown error",stack:Le instanceof Error?Le.stack:"No stack trace"});try{const le=await Y.getSettings();if((yn=(Ht=le==null?void 0:le.streaming)==null?void 0:Ht.icecast)!=null&&yn.host){console.log("📡 Settings actually loaded correctly on retry - ignoring previous error");return}}catch(le){console.error("❌ Retry also failed:",le)}console.log("📡 No valid streaming configuration - streaming will not be available"),Z("error","Errore Configurazione [LoadSettings]",`Errore nel caricamento settings: ${Le instanceof Error?Le.message:"Errore sconosciuto"}`)}};return W.current||(W.current=!0,setTimeout(()=>{O()},100)),()=>{j&&n.disconnect(),ae.current&&(clearInterval(ae.current),ae.current=null)}},[n,j,Z,oe]);const Pe=u.useCallback((O,_)=>{var de,be;const $=t.getDeck("A"),X=t.getDeck("B");return _==="A"&&((de=X.track)==null?void 0:de.id)===O.id?{isDuplicate:!0,sourceDeck:"B"}:_==="B"&&((be=$.track)==null?void 0:be.id)===O.id?{isDuplicate:!0,sourceDeck:"A"}:{isDuplicate:!1}},[t]),Dt=u.useCallback(O=>{if(!ue)return null;const _=G.library.playlists.find(X=>X.id===ue);if(!(_!=null&&_.tracks))return null;const $=_.tracks.findIndex(X=>X.id===O.id);return $===-1||$>=_.tracks.length-1?null:_.tracks[$+1]},[ue,G.library.playlists]),z=u.useCallback(async(O,_,$=!1)=>{var Ge;console.log(`🎵 Double-click on track: ${O.title} (autoAdvance: ${$})`),Ae&&clearTimeout(Ae);const X=setTimeout(()=>{console.log("🎵 Double-click timeout cleared"),Gn(null)},1e3);Gn(X);const de=t.getDeck("A"),be=t.getDeck("B");let ye;!de.track||!de.isPlaying?ye="A":!be.track||!be.isPlaying?ye="B":ye=de.isActive?"B":"A";const Ee=Pe(O,ye);if(Ee.isDuplicate)if(console.log(`⚠️ Track "${O.title}" already loaded in Deck ${Ee.sourceDeck}`),$){console.log("🔄 Auto-advance detected: skipping to next track");const Ke=Dt(O);if(Ke){console.log(`⏭️ Loading next track: ${Ke.title}`);const ge=((Ge=G.library.playlists.find(ft=>ft.id===ue))==null?void 0:Ge.tracks.findIndex(ft=>ft.id===Ke.id))??-1;await z(Ke,ge,!0);return}else{console.log("📋 No more tracks in playlist");return}}else{console.log("❓ Manual load: showing confirmation dialog"),ee({show:!0,track:O,targetDeck:ye,sourceDeck:Ee.sourceDeck});return}console.log(`🎯 Loading track in Deck ${ye}`),await Vt(O,ye),setTimeout(()=>{console.log(`▶️ Auto-starting playback in Deck ${ye}`),t.play(ye)},500)},[t,Vt,Ae,Pe,Dt,ue,G.library.playlists]),De=u.useCallback((O,_)=>{const $=Date.now(),X=$-ne.current;q.current===O.id&&X<400?(console.log(`🎵 Double click detected on track: ${O.title}`),z(O,_),ne.current=0,q.current=null):(console.log(`🎵 Single click on track: ${O.title}`),ne.current=$,q.current=O.id)},[z]),Jt=()=>{if(!ue)return[];const O=G.library.playlists.find(_=>_.id===ue);return O!=null&&O.tracks?O.tracks.map((_,$)=>s.jsxs("div",{draggable:Ae===null,onDragStart:X=>{if(Ae!==null){X.preventDefault();return}Rn(X,$)},onDragOver:X=>Ff(X,$),onDragLeave:zf,onDrop:X=>_f(X,$),onDragEnd:Uf,onClick:X=>{X.preventDefault(),X.stopPropagation(),De(_,$)},className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all duration-200 group ${Ye===$?"bg-blue-600 opacity-75 transform scale-95":hn===$?"bg-green-600 border-2 border-green-400 transform scale-105":"bg-gray-800 hover:bg-gray-700"}`,style:{minHeight:"60px",visibility:"visible",display:"flex"},children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(By,{className:"w-4 h-4 text-gray-500 group-hover:text-gray-300"}),s.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center text-sm font-bold",children:$+1}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-white group-hover:text-blue-400 transition-colors",children:_.title}),s.jsxs("p",{className:"text-sm text-gray-400",children:[_.artist," • ",Math.floor(_.duration/60),":",String(Math.floor(_.duration%60)).padStart(2,"0")]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("span",{className:"text-sm text-gray-400",children:[Math.floor(_.duration/60),":",String(Math.floor(_.duration%60)).padStart(2,"0")]}),s.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.jsx("button",{onClick:X=>{X.stopPropagation(),Vt(_,"A")},className:"px-2 py-1 bg-green-600 hover:bg-green-500 text-white text-xs rounded",title:"Load in Deck A",children:"A"}),s.jsx("button",{onClick:X=>{X.stopPropagation(),Vt(_,"B")},className:"px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white text-xs rounded",title:"Load in Deck B",children:"B"})]})]})]},_.id)):[]};u.useEffect(()=>()=>{Ae&&clearTimeout(Ae)},[Ae]);const[Ot,Uo]=u.useState(!0);u.useEffect(()=>{(async()=>{var _;try{await Y.waitForInitialization();const $=await Y.getSettings();Uo(((_=$.interface)==null?void 0:_.autoAdvance)??!0)}catch($){console.warn("Could not load auto-advance settings:",$)}})()},[]);const ze=u.useCallback(async O=>{if(console.log(`🔚 Track ended on Deck ${O}`),t.getDeck(O).volume===0){console.log(`🔇 [AUTO-ADVANCE] Skipping auto-advance for Deck ${O} (volume is 0% - avoiding audio jump)`);return}if(o.interface.autoAdvance&&ue){const X=G.library.playlists.find(de=>de.id===ue);if(X&&X.tracks&&X.tracks.length>0){const be=t.getDeck(O).track;if(be){const ye=X.tracks.findIndex(Ee=>Ee.id===be.id);if(ye!==-1&&ye<X.tracks.length-1){const Ee=X.tracks[ye+1];console.log(`🔄 Auto-advancing to next track: ${Ee.title}`);const Ge=ye+1;await z(Ee,Ge,!0)}else console.log("🔚 End of playlist reached")}}}},[o.interface.autoAdvance,ue,G.library.playlists,t,Vt,z]),Rn=u.useCallback((O,_)=>{console.log(`🎵 Drag started for track ${_}`),Gt(_),O.dataTransfer.effectAllowed="move",O.dataTransfer.setData("text/plain",_.toString())},[]),Ff=u.useCallback((O,_)=>{O.preventDefault(),O.dataTransfer.dropEffect="move",ln(_)},[]),zf=u.useCallback(()=>{ln(null)},[]),_f=u.useCallback((O,_)=>{if(O.preventDefault(),Ye===null||!ue)return;console.log(`🎵 Dropping track ${Ye} at position ${_}`);const $=G.library.playlists.find(ye=>ye.id===ue);if(!$||!$.tracks){console.error("❌ Playlist non trovata o senza tracks:",{activePlaylistId:ue,playlistFound:!!$});return}console.log("🔍 Playlist trovata:",{id:$.id,name:$.name,tracksCount:$.tracks.length,hasName:!!$.name,hasTracks:!!$.tracks});const X=[...$.tracks];if(console.log("🔍 Tracks originali:",X.length),Ye<0||Ye>=X.length){console.error("❌ Indice drag non valido:",Ye);return}const[de]=X.splice(Ye,1);X.splice(_,0,de),console.log("🔍 Tracks dopo riordino:",X.length),console.log("📤 Dispatching UPDATE_PLAYLIST:",{id:ue,tracksToUpdate:X.length,originalPlaylistName:$.name});const be={id:$.id,name:$.name,description:$.description||"",coverUrl:$.coverUrl||"",createdAt:$.createdAt,updatedAt:new Date().toISOString(),tracks:X};console.log("📋 Updated playlist object:",{id:be.id,name:be.name,tracksCount:be.tracks.length}),me({type:"UPDATE_PLAYLIST",payload:be}),console.log(`🎵 Track "${de.title}" moved from position ${Ye+1} to ${_+1}`),setTimeout(()=>{var Ee;const ye=G.library.playlists.find(Ge=>Ge.id===ue);console.log("🔍 Playlist dopo aggiornamento:",{found:!!ye,tracksCount:((Ee=ye==null?void 0:ye.tracks)==null?void 0:Ee.length)||0,totalPlaylists:G.library.playlists.length,playlistName:(ye==null?void 0:ye.name)||"N/A",hasTracksArray:!!(ye!=null&&ye.tracks)}),ye||(console.error("❌ Playlist scomparsa dopo l'aggiornamento!"),console.log("📋 Playlist disponibili:",G.library.playlists.map(Ge=>({id:Ge.id,name:Ge.name}))))},100),Gt(null),ln(null)},[Ye,ue,G.library.playlists,me]),Uf=u.useCallback(()=>{Gt(null),ln(null)},[]),Bf=u.useCallback(async()=>{var O,_,$,X,de,be,ye,Ee,Ge,Ke;try{if(b){if(console.log("📡 Stopping streaming..."),se.current)try{console.log("📡 Stopping MediaRecorder..."),se.current.stop(),se.current=null,console.log("📡 MediaRecorder stopped")}catch(ge){console.log("📡 Error stopping MediaRecorder:",ge)}if(V.current)try{V.current.stop(),V.current=null}catch{}if(window.desktopStream&&window.desktopStream.stop)try{window.desktopStream.stop(),console.log("📡 FFmpeg process stopped via desktopStream API")}catch(ge){console.log("📡 Error stopping desktopStream:",ge)}n.stopStreaming(),n.disconnect()}else{console.log("📡 Starting streaming..."),ie(null),te("connecting");const ge=await Y.getSettings();if(!((_=(O=ge==null?void 0:ge.streaming)==null?void 0:O.icecast)!=null&&_.host))throw new Error("Server Icecast non configurato. Vai nelle impostazioni e configura host, porta, username e password.");try{const le=ge.streaming.icecast.host,pe=ge.streaming.icecast.port||8e3,ve=`${ge.streaming.icecast.useSSL?"https":"http"}://${le}:${pe}/status-json.xsl`;console.log(`📡 PRE-CHECK: Verifying if mountpoint is free: ${ve}`),Z("info","Verifica Pre-Connessione",`Controllando se il mountpoint è libero su ${le}:${pe}...`);const Ze=new AbortController,ke=setTimeout(()=>Ze.abort(),5e3);try{const We=await fetch(ve,{signal:Ze.signal,headers:{Accept:"application/json"}});if(clearTimeout(ke),We.ok){const we=await We.json(),_e=ge.streaming.icecast.mount||"/live",Qe=(($=we.icestats)==null?void 0:$.source)||[],pt=Array.isArray(Qe)?Qe:[Qe];console.log("📡 PRE-CHECK: Current server sources:",pt.map(Ie=>({mount:Ie.mount,listenurl:Ie.listenurl,listeners:Ie.listeners}))),console.log(`📡 PRE-CHECK: Looking for mountpoint "${_e}" with flexible matching`);const Kt=!le.includes("localhost")&&!le.includes("127.0.0.1"),Se=Kt?pt.filter(Ie=>{const re=Ie.listenurl||"",Te=re.includes("localhost")||re.includes("127.0.0.1");return Te&&console.log("📡 PRE-CHECK: Ignoring localhost source on remote server:",Ie),!Te}):pt;if(console.log(`📡 PRE-CHECK: Filtered ${pt.length} → ${Se.length} sources (removed localhost from remote server)`),Kt&&pt.length>Se.length){const Ie=pt.filter(re=>{const Te=re.listenurl||"";return Te.includes("localhost")||Te.includes("127.0.0.1")});console.log("📡 PRE-CHECK: Removed localhost sources:",Ie),console.log("📡 PRE-CHECK: Remaining sources:",Se)}const je=Se.find(Ie=>{const re=Ie.mount||"",Te=Ie.listenurl||"";if(re===_e||Te.endsWith(_e))return!0;if(_e&&_e.length>1){const yt=_e.replace("/","");if(Te.includes(yt)||re.includes(yt))return!0}return!1});if(je){const Ie=je.listeners||0;throw console.log("📡 PRE-CHECK: MOUNTPOINT ALREADY OCCUPIED!",je),console.log(`📡 PRE-CHECK: Match found - mount: "${je.mount}", url: "${je.listenurl}"`),Z("error","Mountpoint Occupato",`Il mountpoint ${_e} è già in uso con ${Ie} ascoltatori. Non posso connettermi.`),new Error(`Il mountpoint ${_e} è già occupato da un altro utente`)}else console.log(`📡 PRE-CHECK: Mountpoint ${_e} is FREE - we can connect`),Z("success","Mountpoint Libero",`Il mountpoint ${_e} è libero. Procedo con la connessione.`)}else console.log(`📡 PRE-CHECK: Server error ${We.status}`),Z("warning","Server Non Accessibile",`Server ${le}:${pe} non accessibile (${We.status}). Procedo comunque.`)}catch(We){throw clearTimeout(ke),console.error("📡 PRE-CHECK: Cannot verify mountpoint status:",We),Z("error","Impossibile Verificare","Non riesco a verificare lo stato del mountpoint. Per sicurezza, non procedo."),new Error(`Impossibile verificare se il mountpoint è libero: ${We instanceof Error?We.message:"errore di rete"}`)}}catch(le){if(console.error("📡 PRE-CHECK failed:",le),le instanceof Error&&(le.message.includes("già occupato")||le.message.includes("Impossibile verificare")))throw le;console.warn("📡 PRE-CHECK: Unknown error, proceeding with caution")}if(!await n.connect())throw new Error("Failed to connect to streaming server");if(console.log("📡 INTEGRAZIONE DELICATA: Using working ffmpeg system for test tone..."),console.log("📡 FORZANDO ATTIVAZIONE AUDIO per mixing reale..."),!((de=(X=t.state)==null?void 0:X.microphone)!=null&&de.isEnabled)){console.log("📡 Forzando attivazione microfono...");try{await t.toggleMicrophone(),console.log("📡 Microfono attivato forzatamente")}catch(le){console.warn("📡 Non posso attivare microfono:",le)}}console.log("📡 Deck activation lasciata all'utente - non forziamo nulla"),await new Promise(le=>setTimeout(le,500));const Oe=await Y.getSettings();if((be=Oe==null?void 0:Oe.streaming)!=null&&be.icecast){const le=Oe.streaming.icecast;console.log("📡 CREDENZIALI USATE PER LA CONNESSIONE:"),console.log(`📡 Host: ${le.host}`),console.log(`📡 Port: ${le.port}`),console.log(`📡 Username: ${le.username}`),console.log(`📡 Password: ${le.password?"[NASCOSTA]":"[VUOTA]"}`),console.log(`📡 Mountpoint: ${le.mount}`),console.log(`📡 SSL: ${le.useSSL?"ON":"OFF"}`),Z("info","Credenziali Debug",`Connessione con: ${le.username}@${le.host}:${le.port}${le.mount}`);const Xe=`${le.useSSL,"icecast://"}${le.username}:***@${le.host}:${le.port}${le.mount}`;console.log("📡 FFMPEG URL (safe):",Xe),Z("info","URL ffmpeg",`URL di connessione: ${Xe}`)}const Re=Oe.streaming,kt=(Re==null?void 0:Re.defaultFormat)||"mp3",at=(Re==null?void 0:Re.defaultBitrate)||128;if(console.log("📡 FORMATO E BITRATE DAI SETTINGS:"),console.log(`📡 Format: ${kt}`),console.log(`📡 Bitrate: ${at} kbps`),n._desiredFormat=kt,n._desiredBitrate=at,Z("info","Parametri Streaming",`Formato: ${kt.toUpperCase()}, Bitrate: ${at} kbps`),console.log("📡 INTEGRAZIONE DELICATA: Starting ffmpeg streaming for test tone..."),window.desktopStream&&window.desktopStream.start)try{console.log("📡 Using desktopStream API for ffmpeg...");const le=(Oe==null?void 0:Oe.djName)||"DJ Console",pe={host:Oe.streaming.icecast.host,port:Oe.streaming.icecast.port||8e3,mount:Oe.streaming.icecast.mount||"/live",username:Oe.streaming.icecast.username,password:Oe.streaming.icecast.password,useSSL:Oe.streaming.icecast.useSSL||!1,bitrateKbps:at,format:kt,stationName:le,stationDescription:`${le} Live DJ Stream`,stationGenre:"Electronic/Live DJ"};console.log("📡 FFMPEG PARAMS:",pe);const Xe=await window.desktopStream.start(pe);if(console.log("📡 desktopStream.start result:",Xe),Xe&&Xe.ok){console.log("📡 Native streaming started successfully with",`${pe.host}:${pe.port}${pe.mount}`),Z("success","Streaming Avviato",`Streaming nativo avviato con successo verso ${pe.host}:${pe.port}${pe.mount}`),console.log("📡 CRITICAL FIX: Now starting MediaRecorder to send audio data to ffmpeg..."),console.log("📡 TIMING FIX: Waiting for audio elements to be fully loaded...");let Ne=document.querySelector('audio[data-deck="A"]'),ve=document.querySelector('audio[data-deck="B"]');if(!Ne){const re=document.querySelector('audio.deck-audio[data-deck="A"]');re&&(console.log("📡 TIMING FIX: Found left audio by class selector"),Ne=re)}if(!ve){const re=document.querySelector('audio.deck-audio[data-deck="B"]');re&&(console.log("📡 TIMING FIX: Found right audio by class selector"),ve=re)}console.log("📡 TIMING FIX: Audio element references:",{leftAudioRef:!!t.leftAudioRef,leftAudioElement:!!Ne,rightAudioRef:!!t.rightAudioRef,rightAudioElement:!!ve}),Ne&&console.log("📡 TIMING FIX: Left audio element details:",{tagName:Ne.tagName,id:Ne.id,className:Ne.className,src:Ne.src,srcLength:((ye=Ne.src)==null?void 0:ye.length)||0,readyState:Ne.readyState,currentTime:Ne.currentTime,duration:Ne.duration,paused:Ne.paused,volume:Ne.volume,muted:Ne.muted,networkState:Ne.networkState,error:Ne.error}),ve&&console.log("📡 TIMING FIX: Right audio element details:",{tagName:ve.tagName,id:ve.id,className:ve.className,src:ve.src,srcLength:((Ee=ve.src)==null?void 0:Ee.length)||0,readyState:ve.readyState,currentTime:ve.currentTime,duration:ve.duration,paused:ve.paused,volume:ve.volume,muted:ve.muted,networkState:ve.networkState,error:ve.error}),Ne&&Ne.src&&(console.log("📡 TIMING FIX: Left audio element found, waiting for loadeddata event..."),await new Promise(re=>{Ne.readyState>=2?(console.log("📡 TIMING FIX: Left audio already ready (readyState:",Ne.readyState,")"),re()):(Ne.addEventListener("loadeddata",()=>{console.log("📡 TIMING FIX: Left audio loadeddata event fired (readyState:",Ne.readyState,")"),re()},{once:!0}),setTimeout(()=>{console.log("📡 TIMING FIX: Left audio timeout - forcing continue"),re()},2e3))})),ve&&ve.src&&(console.log("📡 TIMING FIX: Right audio element found, waiting for loadeddata event..."),await new Promise(re=>{ve.readyState>=2?(console.log("📡 TIMING FIX: Right audio already ready (readyState:",ve.readyState,")"),re()):(ve.addEventListener("loadeddata",()=>{console.log("📡 TIMING FIX: Right audio loadeddata event fired (readyState:",ve.readyState,")"),re()},{once:!0}),setTimeout(()=>{console.log("📡 TIMING FIX: Right audio timeout - forcing continue"),re()},2e3))})),console.log("📡 TIMING FIX: Audio elements should be ready now"),console.log("📡 CRITICAL FIX: Waiting for audio src to be set...");let Ze=0;const ke=10;for(;Ze<ke&&(!(Ne!=null&&Ne.src)||!(ve!=null&&ve.src));)console.log(`📡 CRITICAL FIX: Retry ${Ze+1}/${ke} - Waiting for src...`),console.log("📡 CRITICAL FIX: Left src:",(Ne==null?void 0:Ne.src)||"NULL"),console.log("📡 CRITICAL FIX: Right src:",(ve==null?void 0:ve.src)||"NULL"),Ze<ke-1&&await new Promise(re=>setTimeout(re,500)),Ze++;const We=document.querySelector('audio.deck-audio[data-deck="A"]'),we=document.querySelector('audio.deck-audio[data-deck="B"]');We!=null&&We.src&&(we!=null&&we.src)?(console.log("📡 CRITICAL FIX: Audio src found after retries!"),console.log("📡 CRITICAL FIX: Left src:",We.src),console.log("📡 CRITICAL FIX: Right src:",we.src)):console.warn("📡 CRITICAL FIX: Audio src still not found after all retries!"),console.log("📡 TIMING FIX: Ensuring audio elements are fully loaded before mixing...");const _e=()=>{const re=Ne,Te=ve;console.log("📡 TIMING FIX: Audio readiness check:",{left:{exists:!!re,src:(re==null?void 0:re.src)||"none",readyState:re==null?void 0:re.readyState,duration:re==null?void 0:re.duration},right:{exists:!!Te,src:(Te==null?void 0:Te.src)||"none",readyState:Te==null?void 0:Te.readyState,duration:Te==null?void 0:Te.duration}});const yt=Ft=>!Ft||Ft===""||Ft==="about:blank"?!1:!!(Ft.startsWith("blob:")||Ft.startsWith("file://")||Ft.startsWith("http://")||Ft.startsWith("https://")||Ft.startsWith("data:")),It=re&&yt(re.src)&&re.readyState>=2,Tt=Te&&yt(Te.src)&&Te.readyState>=2;return console.log("📡 TIMING FIX: Audio source validation:",{leftSrc:re==null?void 0:re.src,leftValid:re?yt(re.src):!1,leftReadyState:re==null?void 0:re.readyState,leftReady:It,rightSrc:Te==null?void 0:Te.src,rightValid:Te?yt(Te.src):!1,rightReadyState:Te==null?void 0:Te.readyState,rightReady:Tt}),It||Tt};let Qe=!1,pt=0;const Kt=20;for(;!Qe&&pt<Kt;)Qe=_e(),Qe||(pt++,console.log(`📡 TIMING FIX: Audio not ready, attempt ${pt}/${Kt}`),await new Promise(re=>setTimeout(re,100)));console.log(Qe?"📡 TIMING FIX: Audio elements are ready for mixing!":"📡 TIMING FIX: Audio elements not ready after all attempts, proceeding anyway..."),console.log("📡 DEBUG: About to call getMixedStream() after audio loading"),console.log("📡 DEBUG: Passing audio elements to getMixedStream:",{leftElement:We,rightElement:we,leftSrc:We==null?void 0:We.src,rightSrc:we==null?void 0:we.src}),console.log("📡 DEBUG: Calling getMixedStream() with audio wait...");let Se=await r();if(console.log("📡 DEBUG: getMixedStream() result:",Se?"SUCCESS":"NULL"),Se)console.log("📡 REAL mixed audio stream created successfully!"),console.log("📡 DEBUG: Real stream tracks:",Se.getTracks().length),console.log("📡 DEBUG: Real stream active:",Se.active);else{console.warn("📡 Failed to get real mixed stream, creating fallback test tone"),console.log("📡 DEBUG: Creating fallback test tone because getMixedStream returned null");const re=new(window.AudioContext||window.webkitAudioContext),Te=re.createOscillator(),yt=re.createMediaStreamDestination();Te.connect(yt),Te.frequency.setValueAtTime(440,re.currentTime),Te.start(),V.current=Te,Se=yt.stream,console.log("📡 Fallback test tone created"),console.log("📡 DEBUG: Fallback stream tracks:",Se.getTracks().length)}console.log("📡 CRITICAL: Starting MediaRecorder with mixed stream...");const je=new MediaRecorder(Se,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:at*1e3});je.ondataavailable=async re=>{if(re.data.size>0){console.log("📡 DEBUG: MediaRecorder data available, size:",re.data.size);const Te=await re.data.arrayBuffer();window.desktopStream.write(Te)}},je.onstart=()=>{console.log("📡 SUCCESS: MediaRecorder started, audio data will flow to ffmpeg!")},je.onstop=()=>{console.log("📡 MediaRecorder stopped")},se.current=je;const Ie=()=>{if(se.current&&se.current.state==="recording"){const re=mt;console.log("🎤 PTT UPDATE: Updating mixed stream with current PTT state:",re),console.log("🎤 PTT UPDATE: Skipping mixed stream recreation - updating volumes only"),window.updatePTTVolumesOnly&&window.updatePTTVolumesOnly(re),console.log("🎤 PTT UPDATE: PTT volumes updated successfully (no stream recreation)")}};window.updateMixedStreamForPTT=Ie,window.updatePTTForAllSystems=re=>{console.log("🎤 PTT GLOBAL UPDATE: Updating PTT state for all systems:",re),console.log("🎤 PTT GLOBAL UPDATE: Updating PTT volumes only (no stream recreation)"),window.updateMixedStreamForPTT&&(console.log("🎤 PTT GLOBAL UPDATE: Updating native system volumes"),window.updateMixedStreamForPTT()),window.updateFallbackPTTVolumes&&(console.log("🎤 PTT GLOBAL UPDATE: Updating fallback system volumes"),window.updateFallbackPTTVolumes(re)),console.log("🎤 PTT GLOBAL UPDATE: All PTT volumes updated successfully (no stream recreation)")},je.start(50),console.log("📡 MediaRecorder.start(50) called - audio should flow now!")}else throw new Error("desktopStream.start failed: "+((Xe==null?void 0:Xe.error)||"unknown error"))}catch(le){throw console.error("📡 desktopStream error:",le),Z("warning","Streaming Native Fallito",`Streaming nativo fallito: ${le instanceof Error?le.message:"errore sconosciuto"}. Riprovo con sistema alternativo...`),new Error("desktopStream failed, need fallback")}else{console.log("📡 desktopStream not available, using fallback system..."),console.log("📡 Creating REAL mixed audio stream..."),console.log("📡 TIMING FIX: Fallback - ensuring audio elements are ready...");const le=()=>{const we=document.querySelector('audio.deck-audio[data-deck="A"]'),_e=document.querySelector('audio.deck-audio[data-deck="B"]'),Qe=Se=>!Se||Se===""||Se==="about:blank"?!1:!!(Se.startsWith("blob:")||Se.startsWith("file://")||Se.startsWith("http://")||Se.startsWith("https://")||Se.startsWith("data:")),pt=we&&Qe(we.src)&&we.readyState>=2,Kt=_e&&Qe(_e.src)&&_e.readyState>=2;return console.log("📡 TIMING FIX: Fallback audio source validation:",{leftSrc:we==null?void 0:we.src,leftValid:we?Qe(we.src):!1,leftReady:pt,rightSrc:_e==null?void 0:_e.src,rightValid:_e?Qe(_e.src):!1,rightReady:Kt}),pt||Kt};let pe=!1,Xe=0;const Ne=10;for(;!pe&&Xe<Ne;)pe=le(),pe||(Xe++,console.log(`📡 TIMING FIX: Fallback - audio not ready, attempt ${Xe}/${Ne}`),await new Promise(we=>setTimeout(we,100)));console.log(pe?"📡 TIMING FIX: Fallback - audio elements are ready for mixing!":"📡 TIMING FIX: Fallback - audio elements not ready, proceeding anyway..."),console.log("📡 DEBUG: About to call getMixedStream()");const ve=document.querySelector('audio.deck-audio[data-deck="A"]'),Ze=document.querySelector('audio.deck-audio[data-deck="B"]');console.log("📡 DEBUG: Fallback - Passing audio elements to getMixedStream:",{leftElement:ve,rightElement:Ze,leftSrc:ve==null?void 0:ve.src,rightSrc:Ze==null?void 0:Ze.src}),console.log("📡 DEBUG: Calling fallback getMixedStream() with audio wait...");let ke=await r();if(console.log("📡 DEBUG: getMixedStream() result:",ke?"SUCCESS":"NULL"),window.fallbackMixedStream=ke,window.fallbackLeftAudioElement=ve,window.fallbackRightAudioElement=Ze,window.updateFallbackPTTVolumes=we=>{console.log("🎤 PTT FALLBACK UPDATE: Updating PTT volumes for fallback system:",we),t&&console.log(we?"🎤 PTT FALLBACK UPDATE: Applying PTT ducking to fallback system":"🎤 PTT FALLBACK UPDATE: Clearing PTT ducking from fallback system")},ke)console.log("📡 REAL mixed audio stream created successfully!"),console.log("📡 DEBUG: Real stream tracks:",ke.getTracks().length),console.log("📡 DEBUG: Real stream active:",ke.active);else{console.warn("📡 Failed to get real mixed stream, creating fallback test tone"),console.log("📡 DEBUG: Creating fallback test tone because getMixedStream returned null");const we=new(window.AudioContext||window.webkitAudioContext),_e=we.createOscillator(),Qe=we.createMediaStreamDestination();_e.connect(Qe),_e.frequency.setValueAtTime(440,we.currentTime),_e.start(),V.current=_e,ke=Qe.stream,console.log("📡 Fallback test tone created"),console.log("📡 DEBUG: Fallback stream tracks:",ke.getTracks().length)}if(console.log("📡 Starting streaming process with fallback system..."),!await n.startStreaming(ke))throw new Error("Failed to start streaming - server rejected the connection (possibly already in use)");console.log("📡 Stream process started locally, now verifying server connection...")}let jt=!1;try{await new Promise(pe=>setTimeout(pe,3e3));const le=await Y.getSettings();if((Ge=le==null?void 0:le.streaming)!=null&&Ge.icecast){const pe=le.streaming.icecast,Ne=`${pe.useSSL?"https":"http"}://${pe.host}:${pe.port||8e3}/status-json.xsl`;console.log(`📡 IMMEDIATE CHECK: Verifying connection to ${Ne}`);const ve=new AbortController,Ze=setTimeout(()=>ve.abort(),5e3);try{const ke=await fetch(Ne,{signal:ve.signal,headers:{Accept:"application/json"}});if(clearTimeout(Ze),ke.ok){const We=await ke.json();console.log("📡 IMMEDIATE CHECK: Full server status:",JSON.stringify(We,null,2));const we=pe.mount||"/live",_e=((Ke=We.icestats)==null?void 0:Ke.source)||[],Qe=Array.isArray(_e)?_e:[_e];console.log(`📡 IMMEDIATE CHECK: Looking for mountpoint "${we}"`),console.log("📡 IMMEDIATE CHECK: All sources found:",Qe.map(je=>({mount:je.mount,listenurl:je.listenurl,server_name:je.server_name,listeners:je.listeners})));const Kt=!pe.host.includes("localhost")&&!pe.host.includes("127.0.0.1")?Qe.filter(je=>{const Ie=je.listenurl||"",re=Ie.includes("localhost")||Ie.includes("127.0.0.1");return re&&console.log("📡 POST-CHECK: Ignoring localhost source on remote server:",je),!re}):Qe;console.log(`📡 POST-CHECK: Filtered ${Qe.length} → ${Kt.length} sources (removed localhost from remote server)`),console.log("📡 POST-CHECK: Searching OUR mountpoint in ALL sources (ignoring localhost filter)");let Se=Qe.find(je=>{const Ie=je.mount||"",re=je.listenurl||"";if(console.log(`📡 POST-CHECK: Comparing mountpoint "${we}" with source:`,{mount:Ie,listenurl:re,server_name:je.server_name}),Ie===we)return console.log("📡 POST-CHECK: MATCH FOUND - Direct mount match"),!0;if(re.endsWith(we))return console.log("📡 POST-CHECK: MATCH FOUND - URL ends with mountpoint"),!0;if(we&&we.length>1){const yt=we.replace("/","");if(re.includes(yt)||Ie.includes(yt))return!0}const Te=je.server_name||"";if(we&&we.length>1){const yt=we.replace("/","");if(Te.toLowerCase().includes(yt.toLowerCase()))return console.log("📡 POST-CHECK: MATCH FOUND - Server name contains mountpoint:",Te),!0}return console.log("📡 POST-CHECK: NO MATCH for this source"),!1});if(!Se&&Qe.length===1){const je=Qe[0],Ie=je.connected||0,re=Ie<300;console.log("📡 POST-CHECK: FALLBACK - Single source analysis:",{connected:Ie,isRecent:re,serverName:je.server_name}),console.log("📡 POST-CHECK: FALLBACK MATCH - Assuming single source is us (aggressive mode)"),Se=je}if(!Se&&n.isCurrentlyStreaming()&&(console.log("📡 POST-CHECK: No mountpoint match but local streaming active - assuming SUCCESS (autopilot coexistence is normal)"),Se={listeners:0,server_name:"DJ Console (Autopilot Coexistence)"}),Se){console.log("📡 POST-CHECK: Our mountpoint is now active:",Se),console.log(`📡 POST-CHECK: Match found - mount: "${Se.mount}", url: "${Se.listenurl}"`);const je=Se.listeners||0;Z("info","Connessione Confermata",`Il nostro mountpoint ${we} è ora attivo con ${je} listener(s).`),jt=!0}else{console.log(`📡 POST-CHECK: WARNING - Mountpoint ${we} not yet visible on server (could be normal delay)`);const je=Kt.map(Ie=>Ie.mount||Ie.listenurl||"unknown");console.log("📡 POST-CHECK: Available mounts:",je),Z("warning","Verifica Impossibile",`Non riesco a verificare lo stato del server (${je.length>0?"Disponibili: "+je.join(", "):"Nessun mountpoint attivo"}). Lo streaming potrebbe non funzionare correttamente.`),console.log("📡 POST-CHECK: Continuing streaming - user can stop manually if needed"),jt=!1}}else console.log(`📡 IMMEDIATE CHECK: Server HTTP error ${ke.status} ${ke.statusText}`),Z("warning","Errore Server Status",`Il server ha risposto con errore ${ke.status}. Non posso verificare se il mountpoint è libero.`)}catch(ke){if(clearTimeout(Ze),console.error("📡 IMMEDIATE CHECK: Fetch failed:",ke),Z("warning","Verifica Impossibile",`Non riesco a verificare lo stato del server (${ke instanceof Error?ke.message:"errore di rete"}). Lo streaming potrebbe non funzionare correttamente.`),ke instanceof Error&&(ke.name==="TypeError"||ke.message.includes("CORS")))console.log("📡 IMMEDIATE CHECK: Assuming OK due to CORS restrictions"),jt=!0;else throw console.log("📡 IMMEDIATE CHECK: Network error, cannot verify - assuming FAILED for safety"),window.desktopStream&&window.desktopStream.stop&&window.desktopStream.stop(),new Error(`Impossibile verificare lo stato del server: ${ke instanceof Error?ke.message:"errore di connessione"}`)}}}catch(le){if(console.error("📡 IMMEDIATE CHECK: Verification failed:",le),le instanceof Error&&le.message.includes("Server occupato"))throw le}jt?(console.log("📡 ✅ Immediate verification passed - connection is real!"),Z("success","Streaming VERIFICATO e Attivo",`Server Icecast ${Oe.streaming.icecast.host}:${Oe.streaming.icecast.port||8e3} confermato! Mountpoint ${Oe.streaming.icecast.mount||"/live"} attivo.`)):(console.log("📡 ⚠️ Immediate verification not possible, but streaming continues"),Z("info","Streaming Avviato (Non Verificato)",`Streaming avviato verso ${Oe.streaming.icecast.host}:${Oe.streaming.icecast.port||8e3}. Verifica manualmente se funziona correttamente.`)),setTimeout(async()=>{var Ne,ve;const le=n.isCurrentlyStreaming(),pe=n.isConnectedToServer();console.log(`📡 Initial verification: streaming=${le}, connected=${pe}`);let Xe=!1;try{const Ze=await Y.getSettings();if((Ne=Ze==null?void 0:Ze.streaming)!=null&&Ne.icecast){const ke=Ze.streaming.icecast,we=`${ke.useSSL?"https":"http"}://${ke.host}:${ke.port||8e3}/status-json.xsl`;console.log(`📡 Checking real Icecast status: ${we}`);const _e=new AbortController,Qe=setTimeout(()=>_e.abort(),5e3);try{const pt=await fetch(we,{signal:_e.signal,headers:{Accept:"application/json"}});if(clearTimeout(Qe),pt.ok){const Kt=await pt.json();console.log("📡 Icecast status data:",Kt);const Se=ke.mount||"/live",je=((ve=Kt.icestats)==null?void 0:ve.source)||[],Ie=Array.isArray(je)?je:[je],Te=!ke.host.includes("localhost")&&!ke.host.includes("127.0.0.1")?Ie.filter(It=>{const Tt=It.listenurl||"",Ft=Tt.includes("localhost")||Tt.includes("127.0.0.1");return Ft&&console.log("📡 CONTINUOUS-CHECK: Ignoring localhost source on remote server:",It),!Ft}):Ie;console.log(`📡 CONTINUOUS-CHECK: Filtered ${Ie.length} → ${Te.length} sources`),console.log("📡 CONTINUOUS-CHECK: Searching OUR mountpoint in ALL sources (ignoring localhost filter)");let yt=Ie.find(It=>{const Tt=It.mount||"",Ft=It.listenurl||"";if(console.log(`📡 CONTINUOUS-CHECK: Comparing mountpoint "${Se}" with source:`,{mount:Tt,listenurl:Ft,server_name:It.server_name}),Tt===Se)return console.log("📡 CONTINUOUS-CHECK: MATCH FOUND - Direct mount match"),!0;if(Ft.endsWith(Se))return console.log("📡 CONTINUOUS-CHECK: MATCH FOUND - URL ends with mountpoint"),!0;if(Se&&Se.length>1){const vi=Se.replace("/","");if(Ft.includes(vi)||Tt.includes(vi))return!0}const jc=It.server_name||"";if(Se&&Se.length>1){const vi=Se.replace("/","");if(jc.toLowerCase().includes(vi.toLowerCase()))return console.log("📡 CONTINUOUS-CHECK: MATCH FOUND - Server name contains mountpoint:",jc),!0}return console.log("📡 CONTINUOUS-CHECK: NO MATCH for this source"),!1});if(!yt&&Ie.length===1){const It=Ie[0],Tt=It.connected||0;console.log("📡 CONTINUOUS-CHECK: FALLBACK - Single source analysis:",{connected:Tt,serverName:It.server_name}),console.log("📡 CONTINUOUS-CHECK: FALLBACK MATCH - Assuming single source is us (aggressive mode)"),yt=It}if(yt)console.log(`📡 REAL CHECK: Mountpoint ${Se} is ACTIVE on server:`,yt),Xe=!0;else if(n.isCurrentlyStreaming())console.log("📡 REAL CHECK: No mountpoint match but local streaming active - assuming SUCCESS (autopilot coexistence is normal)"),Xe=!0;else{console.log(`📡 REAL CHECK: Mountpoint ${Se} NOT FOUND on server`),console.log("📡 Available sources:",Ie.map(Tt=>Tt.listenurl||Tt.mount||"unknown"));const It=Ie.map(Tt=>Tt.listenurl||Tt.mount||"unknown").join(", ");Z("warning","Mountpoint Non Trovato",`Il mountpoint ${Se} non è attivo sul server. Mountpoint disponibili: ${It||"nessuno"}`)}}else console.log(`📡 REAL CHECK: Server responded with status ${pt.status}`)}catch(pt){clearTimeout(Qe),console.log("📡 REAL CHECK: Fetch failed (CORS or network):",pt),Xe=le}}}catch(Ze){console.error("📡 REAL CHECK: Error during verification:",Ze),Xe=le}te(Ze=>{if(console.log(`📡 FINAL VERIFICATION: localStreaming=${le}, reallyConnected=${Xe}, currentStatus=${Ze}`),Xe)return console.log("📡 Continuous verification PASSED - streaming confirmed via aggressive logic"),setTimeout(async()=>{var ke;try{const We=await Y.getSettings();(ke=We==null?void 0:We.streaming)!=null&&ke.icecast&&(console.log("📡 Testing if server rejects duplicate connections..."),Z("info","Test Duplicazione","Testando se il server rifiuta connessioni duplicate al mountpoint..."))}catch(We){console.warn("📡 Could not perform duplicate connection test:",We)}},2e3),I(!0),R(!0),ie(null),"streaming";if(le){if(console.log("📡 Verification FAILED - server verification failed despite local streaming"),Z("warning","Verifica Server Fallita","Lo streaming locale è attivo ma la verifica server è fallita. Lo streaming potrebbe funzionare comunque."),ie("Server verification failed"),I(!1),R(!1),V.current)try{V.current.stop(),V.current=null}catch{}return"disconnected"}else{if(console.log("📡 Verification FAILED - local streaming not active"),Z("error","Streaming Locale Non Attivo","Lo streaming locale non è attivo. Verifica la connessione ffmpeg."),ie("Local streaming not active"),I(!1),R(!1),V.current)try{V.current.stop(),V.current=null}catch{}return"disconnected"}})},8e3);const Rt=t.getDeck("A"),pn=t.getDeck("B");let Ht=null;Rt.isPlaying&&Rt.track?Ht=Rt.track:pn.isPlaying&&pn.track&&(Ht=pn.track);const yn=(Re==null?void 0:Re.serverName)||(ge==null?void 0:ge.djName)||"DJ Console",Le=Ht?{title:`${Ht.title}`,artist:`${Ht.artist||"Unknown Artist"} - Live by ${yn}`,album:`${yn} Live Stream`,genre:"Electronic/Live DJ"}:{title:`${yn} - Live DJ Set`,artist:`${yn}`,album:`${yn} Live Stream`,genre:"Electronic/Live DJ"};console.log("📡 Sending metadata:",Le),n.updateMetadata(Le),console.log("📡 Updated stream metadata:",Le),console.log("📡 ✅ Streaming started successfully!")}}catch(ge){console.error("📡 ❌ Streaming error:",ge);const ft=ge instanceof Error?ge.message:"Unknown streaming error";ie(ft),te("disconnected"),I(!1),R(!1),Z("error","Errore di Connessione",`Impossibile avviare lo streaming: ${ft}`)}},[b,n,r,t]),[mt,Nc]=u.useState(!1),[Ac,Dc]=u.useState(null),[So,Gf]=u.useState({enabled:!0,percentage:50});u.useRef(null);const Vf=u.useCallback(O=>{var $;console.log(`🎤 [MIC VOLUME] Changing microphone volume from ${f} to ${O}`),g(O),t.setMicVolume(O),window.__micVolume__=O;const _=mt?1:Math.max(.1,O);if(window.currentMicGain&&window.currentMixContext)try{window.currentMicGain.gain.setValueAtTime(_,window.currentMixContext.currentTime),console.log(`🎤 [MIC VOLUME] Live mixer updated to ${Math.round(_*100)}% ${mt?"(FORCED TO 100% DURING PTT)":""}`)}catch(X){console.warn("Failed to update mic volume in live mixer:",X)}if(window.currentPTTMicGain&&mt)try{window.currentPTTMicGain.gain.setValueAtTime(1,(($=window.currentMixContext)==null?void 0:$.currentTime)||0),console.log("🎤 [MIC VOLUME] PTT mic gain forced to 100%")}catch(X){console.warn("Failed to update PTT mic gain:",X)}console.log(`🎤 [MIC VOLUME] Microphone volume set to ${Math.round(_*100)}% ${mt?"(FORCED TO 100% DURING PTT)":""}`)},[f,t,mt]);u.useEffect(()=>{console.log("🎤 PTT STATE CHANGED:",mt),window.updatePTTForAllSystems?(console.log("🎤 PTT UPDATE: Calling global update function for all systems"),window.updatePTTForAllSystems(mt)):console.log("🎤 PTT UPDATE: Global update function not available yet")},[mt]),u.useEffect(()=>{(async()=>{var _,$;try{await Y.waitForInitialization();const X=await Y.getSettings(),de={enabled:((_=X.microphone)==null?void 0:_.ducking)??!0,percentage:(($=X.microphone)==null?void 0:$.duckingPercent)??50};console.log("🎤 Loaded ducking settings:",de),Gf(de)}catch(X){console.warn("Could not load ducking settings:",X)}})()},[]);const qs=u.useCallback(()=>{if(console.log("🎤 PTT START - Activating"),mt){console.log("🎤 PTT already active, skipping");return}console.log("🎤 PTT ACTIVATING - going ON AIR"),Nc(!0),window.__pttActive__=!0;const O={deckA:d,deckB:p};if(Dc(O),console.log("🎤 Saved original volumes:",O),console.log("🎤 Activating microphone for PTT"),t.setMicrophoneEnabled(!0),console.log("🎤 [PTT] Microphone will be forced to 100% during PTT (current volume preserved)"),So.enabled){let _=0;So.percentage>=100?_=0:_=(100-So.percentage)/100,console.log(`🎤 Applying ducking: ${So.percentage}% reduction, factor: ${_}`),t.debugPTTVolumes(),t.setPTTDucking("A",d*_),t.setPTTDucking("B",p*_),window.updatePTTVolumesOnly&&window.updatePTTVolumesOnly(!0),setTimeout(()=>{console.log("🎤 After PTT ducking:"),t.debugPTTVolumes()},50)}},[mt,d,p,t,So]),wr=u.useCallback(()=>{if(console.log("🎤 PTT END - Deactivating"),!mt){console.log("🎤 PTT already inactive, skipping");return}console.log("🎤 PTT DEACTIVATING - going OFF AIR"),t.debugPTTVolumes(),Nc(!1),window.__pttActive__=!1,console.log("🎤 Deactivating microphone"),t.setMicrophoneEnabled(!1),So.enabled&&(console.log("🎤 Clearing PTT ducking"),t.clearPTTDucking("A"),t.clearPTTDucking("B"),window.updatePTTVolumesOnly&&window.updatePTTVolumesOnly(!1),setTimeout(()=>{console.log("🎤 After PTT clear:"),t.debugPTTVolumes()},50)),Ac&&Dc(null),console.log("🎤 PTT deactivated successfully")},[mt,Ac,t,So]);return u.useEffect(()=>{const O=$=>{mt&&(console.log("🎤 Global mouse UP - releasing PTT"),wr())},_=$=>{var X;mt&&((X=$.target)==null?void 0:X.tagName)==="HTML"&&(console.log("🎤 Mouse left window - releasing PTT"),wr())};return mt&&(document.addEventListener("mouseup",O),document.addEventListener("mouseleave",_)),()=>{document.removeEventListener("mouseup",O),document.removeEventListener("mouseleave",_)}},[mt,wr]),u.useEffect(()=>{const O=$=>{$.code==="KeyM"&&!$.repeat&&qs()},_=$=>{$.code==="KeyM"&&wr()};return window.addEventListener("keydown",O),window.addEventListener("keyup",_),()=>{window.removeEventListener("keydown",O),window.removeEventListener("keyup",_)}},[qs,wr]),u.useEffect(()=>{const O=_=>{const{deckId:$}=_.detail;console.log(`🔚 [AUTO-ADVANCE] Track ended event received for Deck ${$}`),ze($)};return window.addEventListener("djconsole:track-ended",O),()=>{window.removeEventListener("djconsole:track-ended",O)}},[ze]),u.useEffect(()=>{if(!b||!j)return;(async()=>{var _;try{const $=t.getDeck("A"),X=t.getDeck("B");let de=null;$.isPlaying&&$.track?de=$.track:X.isPlaying&&X.track&&(de=X.track);const be=await Y.getSettings(),ye=(_=be==null?void 0:be.streaming)==null?void 0:_.icecast,Ee=(ye==null?void 0:ye.serverName)||(o==null?void 0:o.djName)||"DJ Console",Ge=de?{title:`${de.title}`,artist:`${de.artist||"Unknown Artist"} - Live by ${Ee}`,album:`${Ee} Live Stream`,genre:"Electronic/Live DJ"}:{title:`${Ee} - Live DJ Set`,artist:`${Ee}`,album:`${Ee} Live Stream`,genre:"Electronic/Live DJ"};console.log("📡 Auto-updating stream metadata:",Ge),n.updateMetadata(Ge)}catch($){console.error("📡 Error updating stream metadata:",$)}})()},[i,l,b,j,t,n,o]),s.jsxs("div",{className:"min-h-screen bg-gray-950 text-white",children:[s.jsx("header",{className:"bg-gray-900 border-b border-gray-800 p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"DJ Console v2.0"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm text-gray-400",children:"Ready"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[s.jsx("button",{onMouseDown:O=>{O.preventDefault(),O.stopPropagation(),console.log("🎤 Mouse DOWN on PTT button"),qs()},onContextMenu:O=>{O.preventDefault()},className:`p-3 rounded-lg transition-all duration-200 select-none ${mt?"bg-red-500 text-white shadow-lg animate-pulse ring-2 ring-red-300":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Push-to-Talk (Hold M key or mouse button)",style:{userSelect:"none",WebkitUserSelect:"none",touchAction:"none",WebkitTouchCallout:"none",WebkitUserDrag:"none"},children:s.jsx(mo,{className:"w-6 h-6"})}),mt&&s.jsx("span",{className:"px-2 py-1 bg-red-500/20 text-red-400 border border-red-500/40 rounded text-xs font-bold animate-pulse whitespace-nowrap",children:"MIC ON AIR"})]}),s.jsxs("button",{onClick:Bf,disabled:F==="connecting",className:`p-2 rounded-lg transition-all duration-200 relative ${b?"bg-blue-500 text-white shadow-lg ring-2 ring-blue-300":F==="connecting"?"bg-yellow-500 text-white animate-pulse cursor-not-allowed":F==="connected"?"bg-green-500 text-white shadow-lg":oe?"bg-red-500 text-white shadow-lg":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:F==="streaming"?"Stop Streaming":F==="connecting"?"Connecting...":F==="connected"?"Start Streaming":oe?`Error: ${oe}`:"Start Streaming",children:[s.jsx(jo,{className:"w-5 h-5"}),F==="connecting"&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-yellow-300 rounded-full animate-ping"}),b&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-blue-300 rounded-full animate-pulse"})]}),s.jsx("button",{onClick:()=>e("/settings"),className:"p-2 bg-gray-700 text-gray-300 hover:bg-gray-600 rounded-lg transition-all duration-200",title:"Settings",children:s.jsx(Ws,{className:"w-5 h-5"})})]})]})}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(Zu,{deckId:"A",track:i,isActive:Fe,volume:d,isMuted:L,onVolumeChange:xe,onActivate:dt,onTrackEnd:()=>ze("A")}),s.jsx(Zu,{deckId:"B",track:l,isActive:E,volume:p,isMuted:P,onVolumeChange:$e,onActivate:Ce,onTrackEnd:()=>ze("B")})]}),s.jsx(dv,{deckAVolume:d,deckBVolume:p,onDeckAVolumeChange:xe,onDeckBVolumeChange:$e,deckAMuted:L,deckBMuted:P,onDeckAMuteToggle:()=>t.toggleDeckMute("A"),onDeckBMuteToggle:()=>t.toggleDeckMute("B"),masterVolume:x,onMasterVolumeChange:st,micEnabled:w,micVolume:f,onMicToggle:Ct,onMicVolumeChange:Vf,cueEnabled:m,onCueToggle:wo}),s.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 border border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-bold",children:"Playlists"}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("span",{className:"text-sm text-gray-400",children:[G.library.playlists.length," playlist(s)"]})})]}),s.jsx("div",{className:"flex space-x-2 mb-4 overflow-x-auto",children:G.library.playlists.map(O=>{var _;return s.jsxs("button",{onClick:()=>ht(O.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 whitespace-nowrap ${ue===O.id?"bg-blue-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[O.name," (",((_=O.tracks)==null?void 0:_.length)||0,")"]},O.id)})}),s.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[ue&&(()=>{const O=Jt();return O.length>0?O:s.jsx("div",{className:"text-center py-8 text-gray-400",children:"Playlist vuota"})})(),!ue&&s.jsx("div",{className:"text-center py-8 text-gray-400",children:"Seleziona una playlist"})]})]})]}),s.jsx("footer",{className:"bg-gray-900 border-t border-gray-800 p-4",children:s.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-400",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("span",{children:["Deck A: ",Fe?"ACTIVE":"INACTIVE"]}),s.jsxs("span",{children:["Deck B: ",E?"ACTIVE":"INACTIVE"]}),s.jsxs("span",{children:["Master: ",Math.round(x*100),"%"]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[mt&&s.jsx("span",{className:"text-red-400 animate-pulse",children:"🎤 PTT ACTIVE"}),w&&!mt&&s.jsx("span",{className:"text-red-400",children:"🎤 MIC"}),F==="streaming"&&s.jsx("span",{className:"text-blue-400 animate-pulse",children:"📡 STREAMING"}),F==="connected"&&!b&&s.jsx("span",{className:"text-green-400",children:"📡 READY"}),F==="connecting"&&s.jsx("span",{className:"text-yellow-400 animate-pulse",children:"📡 CONNECTING"}),oe&&s.jsx("span",{className:"text-red-400",children:"📡 ERROR"}),m&&s.jsx("span",{className:"text-yellow-400",children:"🎧 CUE"}),o.interface.autoAdvance&&s.jsx("span",{className:"text-green-400",children:"🔄 AUTO"}),s.jsxs("button",{onClick:()=>{M(!D),Q(!1)},className:`text-xs px-2 py-1 rounded transition-colors relative ${J?"bg-red-600 hover:bg-red-500 text-white animate-pulse":"bg-gray-700 hover:bg-gray-600"}`,title:"Notifiche Streaming",children:["📡 NOTIFICHE",J&&s.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),s.jsx("button",{onClick:()=>qe(!ut),className:"text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Debug Avanzato",children:"📋 DEBUG"})]})]})}),D&&s.jsxs("div",{className:"fixed top-16 right-4 z-40 w-96 max-h-96 bg-gray-900 border border-gray-700 rounded-lg shadow-xl overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800 border-b border-gray-700",children:[s.jsx("h3",{className:"text-sm font-bold text-white flex items-center",children:"📡 Notifiche Streaming"}),s.jsx("button",{onClick:()=>{M(!1),Q(!1)},className:"text-gray-400 hover:text-white text-lg",children:"×"})]}),s.jsx("div",{className:"max-h-80 overflow-y-auto",children:he.length===0?s.jsx("div",{className:"p-4 text-center text-gray-400",children:"Nessuna notifica"}):s.jsx("div",{className:"divide-y divide-gray-700",children:he.slice(0,10).map((O,_)=>{const $=O.includes("ERROR:"),X=O.includes("SUCCESS:"),de=O.includes("WARNING:");return s.jsx("div",{className:`p-3 text-xs ${$?"bg-red-900/20 text-red-200":X?"bg-green-900/20 text-green-200":de?"bg-yellow-900/20 text-yellow-200":"bg-gray-800/20 text-gray-300"}`,children:s.jsx("div",{className:"font-mono whitespace-pre-wrap break-all",children:O})},_)})})}),s.jsxs("div",{className:"p-2 bg-gray-800 border-t border-gray-700 flex justify-between text-xs",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>{Be([]),Q(!1),console.log("🗑️ Streaming logs cleared")},className:"text-gray-400 hover:text-white",children:"🗑️ Pulisci"}),s.jsx("button",{onClick:async()=>{var O,_,$;try{const X=await Y.getSettings();if((O=X==null?void 0:X.streaming)!=null&&O.icecast){const de=X.streaming.icecast;Z("info","Credenziali Salvate",`DB: ${de.username}@${de.host}:${de.port}${de.mount} (pwd: ${de.password?de.password.length+" chars":"vuota"})`),console.log("📡 CREDENZIALI ATTUALMENTE SALVATE NEL DATABASE:"),console.log(`📡 Host: "${de.host}"`),console.log(`📡 Port: ${de.port}`),console.log(`📡 Username: "${de.username}"`),console.log(`📡 Password: "${de.password}"`),console.log(`📡 Mount: "${de.mount}"`),console.log(`📡 SSL: ${de.useSSL}`)}else Z("error","Nessuna Credenziale","Nessuna configurazione Icecast trovata nel database!");if(Z("info","Debug Server","Interrogando il server per informazioni dettagliate..."),(_=X==null?void 0:X.streaming)!=null&&_.icecast){const de=X.streaming.icecast,ye=`${de.useSSL?"https":"http"}://${de.host}:${de.port||8e3}/status-json.xsl`;console.log(`📡 Manual debug: querying ${ye}`);try{const Ee=await fetch(ye,{signal:AbortSignal.timeout(1e4),headers:{Accept:"application/json"}});if(Ee.ok){const Ge=await Ee.json();console.log("📡 MANUAL DEBUG: Full server response:",Ge);const Ke=(($=Ge.icestats)==null?void 0:$.source)||[],ge=Array.isArray(Ke)?Ke:[Ke];if(ge.length===0)Z("info","Server Vuoto","Il server non ha sorgenti attive. Tutti i mountpoint sono liberi.");else{const Re=ge.map(kt=>`${kt.mount||kt.listenurl||"unknown"} (${kt.listeners||0} listeners)`).join(", ");Z("info","Sorgenti Attive",`Mountpoint attivi sul server: ${Re}`)}const ft=de.mount||"/live",Oe=ge.find(Re=>Re.mount===ft||Re.listenurl&&Re.listenurl.endsWith(ft));Oe?Z("success","Mountpoint Confermato",`Il nostro mountpoint ${ft} è attivo con ${Oe.listeners||0} ascoltatori.`):Z("warning","Mountpoint Assente",`Il nostro mountpoint ${ft} NON è presente nella lista delle sorgenti attive!`)}else Z("error","Errore Server",`Server ha risposto con errore: ${Ee.status} ${Ee.statusText}`)}catch(Ee){Z("error","Errore Connessione",`Impossibile interrogare il server: ${Ee instanceof Error?Ee.message:"errore sconosciuto"}`)}}}catch(X){Z("error","Debug Fallito",`Errore durante il debug: ${X instanceof Error?X.message:"Errore sconosciuto"}`)}},className:"text-yellow-400 hover:text-yellow-300",title:"Mostra informazioni dettagliate sullo stato del server",children:"🔍 Debug Server"}),b&&s.jsx("button",{onClick:async()=>{var O;try{Z("info","Test Manuale","Testando se altri client vengono rifiutati dal server...");const _=await Y.getSettings();if((O=_==null?void 0:_.streaming)!=null&&O.icecast){const $=_.streaming.icecast,de=`${$.useSSL?"https":"http"}://${$.host}:${$.port||8e3}${$.mount||"/live"}`;console.log(`📡 Manual test: attempting connection to ${de}`);try{const be=await fetch(de,{method:"HEAD",signal:AbortSignal.timeout(5e3)});be.ok?Z("success","Test Riuscito",`Il mountpoint ${$.mount||"/live"} è raggiungibile e attivo. Altri client dovrebbero essere rifiutati.`):Z("warning","Test Inconclusivo",`Risposta server: ${be.status} ${be.statusText}`)}catch{Z("info","Test Limitato","Non è possibile testare direttamente, ma il mountpoint dovrebbe essere occupato se lo streaming è attivo.")}}}catch(_){Z("error","Test Fallito",`Errore durante il test: ${_ instanceof Error?_.message:"Errore sconosciuto"}`)}},className:"text-blue-400 hover:text-blue-300",title:"Testa se il server rifiuta connessioni duplicate",children:"🧪 Test"})]}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(he.join(`
`)),console.log("📋 Streaming logs copied to clipboard")},className:"text-gray-400 hover:text-white",children:"📋 Copia"})]})]}),ut&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-4xl mx-4 max-h-[80vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:"📋 Debug Streaming"}),s.jsx("button",{onClick:()=>qe(!1),className:"text-gray-400 hover:text-white text-xl",children:"×"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 flex-1 overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-800 rounded p-4",children:[s.jsx("h4",{className:"font-bold text-white mb-2",children:"📊 Status Attuale"}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{children:["Status: ",s.jsx("span",{className:`font-mono ${F==="streaming"?"text-blue-400":F==="connected"?"text-green-400":F==="connecting"?"text-yellow-400":"text-gray-400"}`,children:F})]}),s.jsxs("div",{children:["Connesso: ",s.jsx("span",{className:j?"text-green-400":"text-red-400",children:j?"Sì":"No"})]}),s.jsxs("div",{children:["Streaming: ",s.jsx("span",{className:b?"text-blue-400":"text-gray-400",children:b?"Attivo":"Inattivo"})]}),oe&&s.jsxs("div",{children:["Errore: ",s.jsx("span",{className:"text-red-400 font-mono text-xs",children:oe})]})]})]}),s.jsxs("div",{className:"bg-gray-800 rounded p-4 flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h4",{className:"font-bold text-white",children:"📝 Log Eventi"}),s.jsx("button",{onClick:()=>Be([]),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-500 text-white rounded",children:"Cancella"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto max-h-64 bg-gray-900 rounded p-2 font-mono text-xs",children:he.length===0?s.jsx("div",{className:"text-gray-500",children:"Nessun log disponibile"}):he.map((O,_)=>s.jsx("div",{className:`mb-1 ${O.includes("ERROR")?"text-red-400":O.includes("SUCCESS")?"text-green-400":O.includes("WARNING")?"text-yellow-400":"text-gray-300"}`,children:O},_))})]})]}),s.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(he.join(`
`)),Z("success","Copiato","Log copiati negli appunti")},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded",children:"📋 Copia Log"}),s.jsx("button",{onClick:()=>qe(!1),className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded",children:"Chiudi"})]})]})}),fe&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:[s.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"⚠️ Traccia già caricata"}),s.jsxs("p",{className:"text-gray-300 mb-4",children:["La traccia ",s.jsxs("strong",{children:['"',fe.track.title,'"']})," è già caricata nel Deck ",fe.sourceDeck,"."]}),s.jsxs("p",{className:"text-gray-400 mb-6",children:["Vuoi comunque caricarla nel Deck ",fe.targetDeck,"?"]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:async()=>{const O=fe;ee(null),console.log(`✅ User confirmed loading duplicate track in Deck ${O.targetDeck}`),await Vt(O.track,O.targetDeck),setTimeout(()=>{t.play(O.targetDeck)},500)},className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg",children:"Sì, carica comunque"}),s.jsx("button",{onClick:()=>{console.log("❌ User cancelled loading duplicate track"),ee(null)},className:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg",children:"Annulla"})]})]})})]})},fv=({track:e,activeDeck:t,onConfirm:n,onCancel:o,isVisible:r})=>{const[i,a]=u.useState(10),[l,c]=u.useState(!1);if(u.useEffect(()=>{if(!r){a(10);return}const p=setInterval(()=>{a(y=>y<=1?(l?n():o(),10):y-1)},1e3);return()=>clearInterval(p)},[r,l,n,o]),!r||!e)return null;const d=t==="left"?"B":"A",h=t==="left"?"A":"B";return s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-dj-primary border border-dj-accent/30 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx("div",{className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center",children:s.jsx(vc,{className:"w-5 h-5 text-yellow-500"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:"Traccia Duplicata"}),s.jsx("p",{className:"text-sm text-dj-light/60",children:"Stai caricando la stessa canzone"})]})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-4 mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx(hr,{className:"w-5 h-5 text-dj-highlight"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-white truncate",children:e.title}),s.jsx("p",{className:"text-sm text-dj-light/60 truncate",children:e.artist})]})]}),s.jsxs("div",{className:"text-xs text-dj-light/60 space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:["Deck ",d,":"]}),s.jsx("span",{className:"text-green-500",children:"GIÀ IN RIPRODUZIONE"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:["Deck ",h,":"]}),s.jsx("span",{className:"text-yellow-500",children:"STA PER ESSERE CARICATA"})]})]})]}),s.jsx("div",{className:"bg-yellow-500/20 border border-yellow-500/40 rounded-lg p-3 mb-4",children:s.jsxs("p",{className:"text-sm text-yellow-200",children:["La traccia ",s.jsxs("strong",{children:['"',e.title,'"']})," è già in riproduzione nel Deck ",d,". Vuoi caricarla comunque nel Deck ",h,"?"]})}),s.jsx("div",{className:"mb-4",children:s.jsxs("label",{className:"flex items-center space-x-2 text-sm text-dj-light/80 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:l,onChange:p=>c(p.target.checked),className:"rounded bg-dj-secondary border-dj-accent/30"}),s.jsx("span",{children:"Conferma automaticamente in futuro"})]})}),s.jsxs("div",{className:"text-center mb-4",children:[s.jsxs("div",{className:"text-xs text-dj-light/60",children:[l?"Caricamento automatico":"Annullamento automatico"," tra"]}),s.jsxs("div",{className:"text-2xl font-bold text-white",children:[i,"s"]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("button",{onClick:o,className:"flex-1 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors flex items-center justify-center space-x-2",children:[s.jsx(xl,{className:"w-4 h-4"}),s.jsx("span",{children:"Annulla"})]}),s.jsxs("button",{onClick:n,className:"flex-1 px-4 py-2 bg-dj-highlight hover:bg-dj-accent text-white rounded-lg transition-colors flex items-center justify-center space-x-2",children:[s.jsx(hr,{className:"w-4 h-4"}),s.jsx("span",{children:"Carica Comunque"})]})]}),s.jsx("div",{className:"mt-4 text-xs text-dj-light/50 text-center",children:"💡 Tip: Puoi disabilitare questo avviso nelle impostazioni"})]})})},ed=({side:e,deckId:t,track:n,onTrackLoad:o,onAutoAdvance:r})=>{const{state:i,playLeftTrack:a,pauseLeftTrack:l,resumeLeftTrack:c,stopLeftTrack:d,playRightTrack:h,pauseRightTrack:p,resumeRightTrack:y,stopRightTrack:x,setLeftLocalVolume:S,setRightLocalVolume:w,seekLeftTo:C,seekRightTo:f,handlePlayPauseDefinitive:g}=an(),{settings:m}=Bn(),[v,N]=u.useState(.8),[A,b]=u.useState(!1);u.useRef(null);const I=e==="left"?i.leftDeck:i.rightDeck,j=I.track||n,R=I.isPlaying,F=I.currentTime||0,te=!!(j&&R);u.useEffect(()=>{N(e==="left"?i.leftDeck.localVolume:i.rightDeck.localVolume)},[e,i.leftDeck.localVolume,i.rightDeck.localVolume]),u.useEffect(()=>{if(!j||!m.interface.autoAdvance||!R)return;const D=j.duration;D&&F>=D-1&&F>0&&(console.log(`🔄 Track ending in deck ${t}, triggering auto-advance`),r==null||r(e))},[F,j,m.interface.autoAdvance,t,e,r,R]);const oe=u.useCallback(()=>{!j||A||(b(!0),setTimeout(()=>b(!1),500),console.log(`🎮 Enhanced Deck ${t} play triggered`),I.track?g(e):(console.log(`🎵 Loading track in ${e} deck first`),e==="left"?a(j):h(j),setTimeout(()=>{g(e)},100)))},[j,A,I.track,e,a,h,g,t]),ie=u.useCallback(()=>{A||g(e)},[A,e,g]);u.useCallback(()=>{e==="left"?d():x()},[e,d,x]);const V=u.useCallback(()=>{const D=document.querySelector(`audio[data-deck="${e==="left"?"A":"B"}"]`);if(D&&D.src){const M=Math.max(0,D.currentTime-10);e==="left"?C(M):f(M),console.log(`⏪ Deck ${t}: Skip backward to ${M.toFixed(1)}s`)}},[e,t,C,f]),se=u.useCallback(()=>{const D=document.querySelector(`audio[data-deck="${e==="left"?"A":"B"}"]`);if(D&&D.src){const M=D.duration||0,J=Math.min(M,D.currentTime+10);e==="left"?C(J):f(J),console.log(`⏩ Deck ${t}: Skip forward to ${J.toFixed(1)}s`)}},[e,t,C,f]),ae=u.useCallback(D=>{N(D),e==="left"?(S(D),console.log(`🔊 Deck ${t} LOCAL volume: ${Math.round(D*100)}% (state only)`)):(w(D),console.log(`🔊 Deck ${t} LOCAL volume: ${Math.round(D*100)}% (state only)`))},[e,S,w,t]);u.useEffect(()=>{const D=M=>{te&&(e==="left"?C(M.detail.time):f(M.detail.time))};return window.addEventListener("waveform:seek",D),()=>window.removeEventListener("waveform:seek",D)},[te,e,C,f]);const W=D=>{const M=Math.floor(D/60),J=Math.floor(D%60);return`${M}:${String(J).padStart(2,"0")}`};return s.jsxs("div",{className:`
      relative p-4 rounded-xl border-2 transition-all duration-300 ease-in-out
      ${te?"border-green-500 bg-green-500/10 shadow-lg shadow-green-500/20":"border-dj-accent/30 bg-dj-primary"}
    `,children:[s.jsx("div",{className:"absolute top-2 right-2 flex items-center space-x-2",children:te&&s.jsxs(s.Fragment,{children:[s.jsx(Yi,{className:"w-4 h-4 text-green-500 animate-pulse"}),s.jsx("span",{className:"text-xs font-bold text-green-500 bg-green-500/20 px-2 py-1 rounded-full",children:"ATTIVO"})]})}),s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("h3",{className:"text-lg font-dj font-bold text-white flex items-center space-x-2",children:[s.jsx(xc,{className:"w-5 h-5"}),s.jsxs("span",{children:["Deck ",t]})]})}),s.jsx("div",{className:"mb-3",children:s.jsx("div",{className:"text-xs text-dj-light/60 text-center",children:te?"In riproduzione":"Standby"})}),s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3 mb-3 border border-dj-accent/20",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${te?"bg-green-500 animate-pulse":"bg-gray-500"}`}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-white text-sm truncate",children:(j==null?void 0:j.title)||"Nessuna traccia caricata"}),s.jsx("p",{className:"text-xs text-dj-light/60 truncate",children:(j==null?void 0:j.artist)||"Artista sconosciuto"})]})]}),j&&s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ks,{className:"w-3 h-3 text-dj-light/60"}),s.jsxs("span",{className:"text-dj-light",children:[W(F)," / ",W(j.duration)]})]}),s.jsxs("div",{className:"text-dj-light/50",children:["Rimanenti: ",W(j.duration-F)]})]})]}),j&&s.jsx("div",{className:"mb-3",children:s.jsx(Tc,{waveformData:(j==null?void 0:j.waveform)||Array.from({length:120},()=>.3+Math.random()*.4),currentTime:F,duration:j.duration||0,isPlaying:R,deck:e,className:"relative h-16"})}),s.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-3",children:[s.jsx("button",{onClick:V,className:"w-8 h-8 bg-dj-secondary hover:bg-dj-accent rounded-md flex items-center justify-center transition-all duration-200",title:"Salta indietro (-10s)",children:s.jsx(Ec,{className:"w-4 h-4"})}),s.jsx("button",{onClick:R?ie:oe,className:`w-12 h-12 rounded-md flex items-center justify-center transition-all duration-200 ${R?"bg-dj-accent hover:bg-dj-highlight":"bg-dj-highlight hover:bg-dj-accent"}`,title:R?"Pausa":"Play",disabled:!j||A,children:R?s.jsx(Sc,{className:"w-5 h-5"}):s.jsx(hr,{className:"w-5 h-5"})}),s.jsx("button",{onClick:se,className:"w-8 h-8 bg-dj-secondary hover:bg-dj-accent rounded-md flex items-center justify-center transition-all duration-200",title:"Salta avanti (+10s)",children:s.jsx(Cc,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx(tn,{className:"w-4 h-4 text-dj-accent"}),s.jsx("span",{className:"text-xs text-dj-light/80 font-medium",children:"Volume Locale"}),s.jsxs("span",{className:"text-xs text-dj-light/60 ml-auto",children:[Math.round(v*100),"%"]})]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:v,onChange:D=>ae(parseFloat(D.target.value)),className:"dj-slider w-full h-2","aria-label":`Volume locale deck ${t}`}),s.jsx("div",{className:"text-xs text-dj-light/50 mt-1",children:"Solo per monitoring locale - non influenza lo streaming"})]}),j&&s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"flex items-center justify-between text-xs text-dj-light/60 mb-1",children:s.jsx(bc,{deck:e,className:"text-xs text-dj-light/60"})}),s.jsx("input",{type:"range",min:0,max:Math.max(j.duration||0,.001),step:.1,value:F,onChange:D=>{te&&(e==="left"?C(parseFloat(D.target.value)):f(parseFloat(D.target.value)))},className:"dj-slider w-full h-1","aria-label":`Seek control per deck ${t}`})]})]})},gv=({leftDeckActive:e,rightDeckActive:t,onMasterVolumeChange:n,onStreamVolumeChange:o,onPTTActivate:r})=>{var N,A,b;const{state:i,setStreamDucking:a,setCrossfader:l}=an(),{settings:c}=Bn(),[d,h]=u.useState(.8),[p,y]=u.useState(1),[x,S]=u.useState(!1),[w,C]=u.useState(.5);u.useEffect(()=>{C(i.crossfader)},[i.crossfader]);const f=u.useCallback(I=>{S(I),r==null||r(I),I?(a(!0),console.log(`🎤 PTT attivato - ducking WebAudio al ${c.microphone.duckingPercent}%`)):(a(!1),console.log("🎤 PTT disattivato - ducking WebAudio rimosso"))},[c.microphone.duckingPercent,a,r]),g=u.useCallback(I=>{C(I),l(I),console.log(`🎚️ [CROSSFADER] Crossfader cambiato: ${Math.round(I*100)}% (A=${Math.round((1-I)*100)}%, B=${Math.round(I*100)}%)`)},[l]),m=u.useCallback(I=>{h(I),n==null||n(I),console.log(`🔊 MASTER Volume (locale): ${Math.round(I*100)}%`)},[n]),v=u.useCallback(I=>{y(I),o==null||o(I),console.log(`📡 STREAM Volume (live): ${Math.round(I*100)}%`)},[o]);return u.useEffect(()=>{const I=j=>{const R=j.detail.volume;console.log(`📡 [EVENT] Volume Live Stream aggiornato da evento: ${Math.round(R*100)}%`),y(R),o==null||o(R)};return window.addEventListener("djconsole:stream-volume-change",I),()=>{window.removeEventListener("djconsole:stream-volume-change",I)}},[o]),u.useEffect(()=>{const I=R=>{R.target&&R.target.tagName==="INPUT"||R.target&&R.target.tagName==="TEXTAREA"||R.code==="KeyM"&&!x&&(R.preventDefault(),f(!0))},j=R=>{R.target&&R.target.tagName==="INPUT"||R.target&&R.target.tagName==="TEXTAREA"||R.code==="KeyM"&&x&&(R.preventDefault(),f(!1))};return window.addEventListener("keydown",I),window.addEventListener("keyup",j),()=>{window.removeEventListener("keydown",I),window.removeEventListener("keyup",j)}},[x,f]),s.jsxs("div",{className:"bg-dj-primary rounded-xl border border-dj-accent/30 p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-dj font-bold text-white flex items-center space-x-2",children:[s.jsx(tn,{className:"w-5 h-5"}),s.jsx("span",{children:"Mixer & Controls"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${e?"bg-green-500":"bg-gray-500"}`}),s.jsx("span",{className:"text-xs text-dj-light/60",children:"A"}),s.jsx("div",{className:`w-2 h-2 rounded-full ${t?"bg-green-500":"bg-gray-500"}`}),s.jsx("span",{className:"text-xs text-dj-light/60",children:"B"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3",children:[s.jsxs("div",{className:"text-center mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-white mb-1",children:"Crossfader"}),s.jsxs("div",{className:"text-xs text-dj-light/60 mb-2",children:["A: ",Math.round((1-w)*100),"% | B: ",Math.round(w*100),"%"]}),s.jsx("div",{className:"text-xs text-yellow-400 bg-yellow-400/10 px-3 py-1.5 rounded-md border border-yellow-400/30 font-medium",children:"⚠️ Solo per streaming"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:w,onChange:I=>g(parseFloat(I.target.value)),className:"dj-slider w-full h-3","aria-label":"Crossfader"}),s.jsxs("div",{className:"flex justify-between text-xs text-dj-light/60 mt-1",children:[s.jsx("span",{children:"A"}),s.jsx("span",{children:"CENTER"}),s.jsx("span",{children:"B"})]})]})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3",children:[s.jsx("h4",{className:"text-sm font-medium text-white mb-3 text-center",children:"Volume Controls"}),s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-dj-light/80",children:"Master (Locale)"}),s.jsxs("span",{className:"text-xs text-dj-light/60",children:[Math.round(d*100),"%"]})]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d,onChange:I=>m(parseFloat(I.target.value)),className:"dj-slider w-full h-2","aria-label":"Volume Master (Locale)"}),s.jsx("div",{className:"text-xs text-dj-light/50 mt-1",children:"Solo per monitoring locale"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(jo,{className:"w-3 h-3 text-red-500"}),s.jsx("span",{className:"text-xs text-dj-light/80",children:"Live Stream"})]}),s.jsxs("span",{className:"text-xs text-dj-light/60",children:[Math.round(p*100),"%"]})]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:p,onChange:I=>v(parseFloat(I.target.value)),className:"dj-slider w-full h-2 accent-red-500","aria-label":"Volume Live Stream"}),s.jsx("div",{className:"text-xs text-red-400/70 mt-1",children:"Solo per lo streaming live"})]})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-lg p-3",children:[s.jsx("h4",{className:"text-sm font-medium text-white mb-3 text-center",children:"Microfono"}),s.jsx("div",{className:"mb-3",children:s.jsx("button",{onClick:()=>{console.log("🎤 Microfono gestito automaticamente dal PTT")},className:`w-full p-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 ${(N=i.microphone)!=null&&N.isEnabled?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 hover:bg-gray-700 text-white"}`,children:(A=i.microphone)!=null&&A.isEnabled?s.jsxs(s.Fragment,{children:[s.jsx(mo,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Microfono ON"})]}):s.jsxs(s.Fragment,{children:[s.jsx(wc,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Microfono OFF"})]})})}),s.jsxs("div",{className:"mb-3",children:[s.jsxs("button",{onMouseDown:()=>f(!0),onMouseUp:()=>f(!1),onMouseLeave:()=>f(!1),onTouchStart:I=>{I.preventDefault(),f(!0)},onTouchEnd:I=>{I.preventDefault(),f(!1)},className:`w-full p-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 ${x?"bg-red-600 text-white shadow-lg":"bg-dj-primary text-dj-light hover:bg-dj-accent"}`,children:[s.jsx(mo,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-bold",children:x?"PTT ACTIVE":"HOLD PTT"})]}),s.jsx("div",{className:"text-xs text-dj-light/50 mt-1 text-center",children:"Tieni premuto M o il pulsante"})]}),s.jsxs("div",{className:"text-xs text-dj-light/60 text-center",children:["Ducking: ",c.microphone.duckingPercent,"%",s.jsx("button",{className:"ml-2 text-dj-accent hover:text-dj-highlight",title:"Modifica nelle impostazioni",children:s.jsx(Ws,{className:"w-3 h-3 inline"})})]})]})]}),(x||((b=i.microphone)==null?void 0:b.isEnabled))&&s.jsx("div",{className:"mt-4 p-2 bg-red-600/20 border border-red-600/40 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx(mo,{className:"w-4 h-4 text-red-500"}),s.jsx("span",{className:"text-sm font-bold text-red-500",children:"MICROFONO IN ONDA"}),x&&s.jsxs("span",{className:"text-xs text-red-400",children:["(Musica abbassata al ",100-c.microphone.duckingPercent,"%)"]})]})})]})},hv=({activePlaylistId:e,onPlaylistChange:t,onTrackLoad:n,leftDeckActive:o,rightDeckActive:r})=>{const{state:i,reorderPlaylist:a}=xr(),{state:l}=an(),{settings:c}=Bn(),[d,h]=u.useState(null),[p,y]=u.useState(null),x=i.library.playlists.find(j=>j.id===e),S=(x==null?void 0:x.tracks)||[],w=S.reduce((j,R)=>j+R.duration,0),C=j=>{const R=Math.floor(j/3600),F=Math.floor(j%3600/60),te=Math.floor(j%60);return R>0?`${R}:${String(F).padStart(2,"0")}:${String(te).padStart(2,"0")}`:`${F}:${String(te).padStart(2,"0")}`},f=u.useCallback(()=>{if(c.interface.autoAdvance){if(!l.leftDeck.track||!l.leftDeck.isPlaying)return"left";if(!l.rightDeck.track||!l.rightDeck.isPlaying)return"right";const j=l.leftDeck.track?l.leftDeck.track.duration-l.leftDeck.currentTime:0,R=l.rightDeck.track?l.rightDeck.track.duration-l.rightDeck.currentTime:0;return j<R?"left":"right"}return!l.leftDeck.track||!l.leftDeck.isPlaying?"left":!l.rightDeck.track||!l.rightDeck.isPlaying?"right":"left"},[c.interface.autoAdvance,l.leftDeck,l.rightDeck]),g=u.useCallback(j=>{const R=f();console.log(`🎵 Doppio click su "${j.title}" - caricamento in deck ${R.toUpperCase()}`),y(j.id),setTimeout(()=>y(null),1e3),n(R,j)},[f,n]),m=u.useCallback((j,R)=>{console.log(`🎵 Caricamento manuale di "${j.title}" in deck ${R.toUpperCase()}`),n(R,j)},[n]),v=(j,R)=>{h(R),j.dataTransfer.setData("text/plain",String(R)),j.dataTransfer.effectAllowed="move"},N=j=>{j.preventDefault(),j.dataTransfer.dropEffect="move"},A=(j,R)=>{j.preventDefault();const F=j.dataTransfer.getData("text/plain"),te=parseInt(F);if(isNaN(te)||te===R||!e){h(null);return}try{const oe=[...S];if(te>=0&&te<oe.length&&R>=0&&R<oe.length){const[ie]=oe.splice(te,1);oe.splice(R,0,ie),a(e,oe.map(V=>V.id))}}catch(oe){console.error("Errore nel drag & drop:",oe)}h(null)},b=u.useCallback(j=>{var R,F;return((R=l.leftDeck.track)==null?void 0:R.id)===j.id&&l.leftDeck.isPlaying?{isPlaying:!0,deck:"left"}:((F=l.rightDeck.track)==null?void 0:F.id)===j.id&&l.rightDeck.isPlaying?{isPlaying:!0,deck:"right"}:{isPlaying:!1,deck:null}},[l.leftDeck,l.rightDeck]),I=u.useCallback(j=>{var R,F;return((R=l.leftDeck.track)==null?void 0:R.id)===j.id?{isLoaded:!0,deck:"left"}:((F=l.rightDeck.track)==null?void 0:F.id)===j.id?{isLoaded:!0,deck:"right"}:{isLoaded:!1,deck:null}},[l.leftDeck,l.rightDeck]);return s.jsxs("div",{className:"bg-dj-secondary rounded-xl border border-dj-accent/20 overflow-hidden",children:[s.jsxs("div",{className:"bg-dj-primary p-4 border-b border-dj-accent/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(qu,{className:"w-5 h-5 text-dj-highlight"}),s.jsx("h3",{className:"text-lg font-bold text-white",children:"Playlist"})]}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-dj-light/60",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(Ks,{className:"w-4 h-4"}),s.jsx("span",{children:C(w)})]}),s.jsxs("div",{children:[S.length," tracce"]})]})]}),s.jsx("div",{className:"flex items-center space-x-2 overflow-x-auto",children:i.library.playlists.map(j=>s.jsxs("button",{onClick:()=>t(j.id),className:`px-3 py-2 rounded-md text-sm transition-colors whitespace-nowrap ${e===j.id?"bg-dj-accent text-white":"bg-dj-secondary text-dj-light/80 hover:bg-dj-accent/20 hover:text-white"}`,children:[j.name,s.jsxs("span",{className:"ml-2 text-xs opacity-60",children:["(",j.tracks.length,")"]})]},j.id))})]}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:S.length===0?s.jsxs("div",{className:"p-8 text-center text-dj-light/60",children:[s.jsx(qu,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),s.jsx("p",{children:"Nessuna traccia nella playlist"}),s.jsx("p",{className:"text-xs mt-1",children:"Aggiungi tracce dalla libreria"})]}):s.jsx("div",{className:"divide-y divide-dj-accent/10",children:S.map((j,R)=>{var ie,V;const F=b(j),te=I(j),oe=p===j.id;return s.jsxs("div",{draggable:!0,onDragStart:se=>v(se,R),onDragOver:N,onDrop:se=>A(se,R),onDoubleClick:()=>g(j),className:`
                    flex items-center p-3 cursor-pointer transition-all duration-200
                    ${d===R?"opacity-50":""}
                    ${oe?"bg-dj-highlight/20 scale-105":"hover:bg-dj-accent/10"}
                    ${F.isPlaying?"bg-green-500/10 border-l-2 border-green-500":""}
                    ${te.isLoaded&&!F.isPlaying?"bg-yellow-500/10 border-l-2 border-yellow-500":""}
                  `,children:[s.jsx("div",{className:"w-8 text-xs text-dj-light/60 text-center",children:R+1}),s.jsx("div",{className:"w-6 flex justify-center",children:F.isPlaying?s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}):te.isLoaded?s.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}):s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"})}),s.jsxs("div",{className:"flex-1 min-w-0 px-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h4",{className:"text-sm font-medium text-white truncate",children:j.title}),s.jsx("p",{className:"text-xs text-dj-light/60 truncate",children:j.artist})]}),s.jsx("div",{className:"text-xs text-dj-light/60 ml-2",children:C(j.duration)})]}),(F.isPlaying||te.isLoaded)&&s.jsx("div",{className:"text-xs mt-1",children:s.jsxs("span",{className:`px-2 py-0.5 rounded-full ${F.isPlaying?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:["Deck ",((ie=F.deck)==null?void 0:ie.toUpperCase())||((V=te.deck)==null?void 0:V.toUpperCase())," - ",F.isPlaying?"In riproduzione":"Caricata"]})})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("button",{onClick:se=>{se.stopPropagation(),m(j,"left")},className:`px-2 py-1 text-xs rounded transition-colors ${te.deck==="left"?"bg-dj-accent text-white":"bg-dj-primary hover:bg-dj-accent/30 text-dj-light"}`,title:"Carica in Deck A",children:"A"}),s.jsx("button",{onClick:se=>{se.stopPropagation(),m(j,"right")},className:`px-2 py-1 text-xs rounded transition-colors ${te.deck==="right"?"bg-dj-accent text-white":"bg-dj-primary hover:bg-dj-accent/30 text-dj-light"}`,title:"Carica in Deck B",children:"B"})]})]},j.id)})})}),s.jsx("div",{className:"bg-dj-primary p-3 border-t border-dj-accent/20",children:s.jsxs("div",{className:"flex items-center justify-between text-xs text-dj-light/60",children:[s.jsx("div",{children:"💡 Doppio click per caricare automaticamente"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),s.jsx("span",{children:"In riproduzione"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),s.jsx("span",{children:"Caricata"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"}),s.jsx("span",{children:"Disponibile"})]})]})]})})]})},pv=({activePlaylistId:e,onTrackLoad:t,onDuplicateTrackWarning:n})=>{const{settings:o}=Bn(),{state:r}=xr(),{state:i}=an(),a=u.useRef(null),l=u.useRef(0),c=u.useRef({left:0,right:0}),d=u.useCallback(w=>{var m;if(console.log("🔍 [AUTO-ADVANCE DEBUG] getNextTrack chiamato con:",{activePlaylistId:e,currentTrack:w==null?void 0:w.title,currentTrackId:w==null?void 0:w.id}),!e||!w)return console.log("🔍 [AUTO-ADVANCE DEBUG] Mancano activePlaylistId o currentTrack"),null;const C=r.library.playlists.find(v=>v.id===e);if(console.log("🔍 [AUTO-ADVANCE DEBUG] Playlist trovata:",{playlistExists:!!C,playlistId:C==null?void 0:C.id,tracksCount:(m=C==null?void 0:C.tracks)==null?void 0:m.length}),!C)return console.log("🔍 [AUTO-ADVANCE DEBUG] Playlist non trovata"),null;const f=C.tracks.findIndex(v=>v.id===w.id);if(console.log("🔍 [AUTO-ADVANCE DEBUG] Indice traccia corrente:",{currentIndex:f,totalTracks:C.tracks.length,isLastTrack:f>=C.tracks.length-1}),f===-1)return console.log("🔍 [AUTO-ADVANCE DEBUG] Traccia corrente non trovata nella playlist"),null;if(f>=C.tracks.length-1)return console.log("🔍 [AUTO-ADVANCE DEBUG] È l'ultima traccia della playlist"),o.interface.playlistLoop&&C.tracks.length>0?(console.log("🔄 [AUTO-ADVANCE DEBUG] Loop playlist abilitato - riparto dalla prima traccia"),C.tracks[0]):null;const g=C.tracks[f+1];return console.log("🔍 [AUTO-ADVANCE DEBUG] Prossima traccia trovata:",{nextTrackTitle:g==null?void 0:g.title,nextTrackId:g==null?void 0:g.id}),g},[e,r.library.playlists]),h=u.useCallback(w=>{const C=w==="left"?i.leftDeck:i.rightDeck;return!C.track||!C.isPlaying},[i.leftDeck,i.rightDeck]),p=u.useCallback(()=>{const w=h("left"),C=h("right");if(w&&C||w)return"left";if(C)return"right";const f=i.leftDeck.track?i.leftDeck.track.duration-i.leftDeck.currentTime:0,g=i.rightDeck.track?i.rightDeck.track.duration-i.rightDeck.currentTime:0;return f<g?"left":"right"},[h,i.leftDeck,i.rightDeck]),y=u.useCallback((w,C)=>{var g;return((g=(C==="left"?i.rightDeck:i.leftDeck).track)==null?void 0:g.id)===w.id},[i.leftDeck,i.rightDeck]),x=u.useCallback((w,C)=>{console.log("🔍 [AUTO-ADVANCE DEBUG] getNextNonDuplicateTrack chiamato con:",{currentTrack:w==null?void 0:w.title,targetDeck:C});let f=d(w),g=0;const m=10;for(console.log("🔍 [AUTO-ADVANCE DEBUG] Prima traccia trovata:",{nextTrack:f==null?void 0:f.title,nextTrackId:f==null?void 0:f.id});f&&g<m;){const v=y(f,C);if(console.log("🔍 [AUTO-ADVANCE DEBUG] Controllo duplicato:",{track:f.title,isDuplicate:v,targetDeck:C}),!v)return console.log(`✅ Trovata traccia non duplicata: ${f.title} (tentativo ${g+1})`),f;console.log(`⚠️ Traccia duplicata saltata: ${f.title} (tentativo ${g+1})`),f=d(f),g++}return g>=m&&console.log(`⚠️ Raggiunto limite massimo di tentativi (${m}), usando ultima traccia trovata`),f},[d,y]),S=u.useCallback(w=>{if(!o.interface.autoAdvance){console.log("🔄 Auto-avanzamento disabilitato nelle impostazioni");return}const C=Date.now();if(C-l.current<1e3){console.log("🔄 Auto-avanzamento throttled (troppo veloce)");return}l.current=C;const f=w==="left"?i.leftDeck.track:i.rightDeck.track;if(!f){console.log("🔄 Nessuna traccia corrente per auto-avanzamento");return}const g=p();if(!g){console.log("🔄 Nessun deck disponibile per auto-avanzamento");return}console.log(`🔄 Auto-avanzamento richiesto da deck ${w.toUpperCase()}`),console.log(`🔄 Traccia corrente: ${f.title}`);const m=x(f,g);if(!m){console.log("🔄 Nessuna traccia successiva trovata per auto-avanzamento");return}if(console.log(`🔄 Prossima traccia: ${m.title}`),!h(g)){console.log(`🔄 Deck ${g.toUpperCase()} occupato, auto-avanzamento in attesa`),a.current={deck:g,track:m};return}console.log(`🔄 Caricamento auto-avanzamento: ${m.title} in deck ${g.toUpperCase()}`),t(g,m),a.current=null},[o.interface.autoAdvance,i.leftDeck.track,i.rightDeck.track,p,x,h,t]);return u.useEffect(()=>{if(!a.current)return;const{deck:w,track:C}=a.current;h(w)&&(console.log(`🔄 Deck ${w.toUpperCase()} ora libero, eseguendo auto-avanzamento pendente`),t(w,C),a.current=null)},[i.leftDeck.isPlaying,i.rightDeck.isPlaying,h,t]),u.useEffect(()=>{const w=C=>{console.log("🔄 [AUTO-ADVANCE] Evento djconsole:request-auto-advance ricevuto:",C.detail);const{deck:f}=C.detail;S(f)};return console.log("🔄 [AUTO-ADVANCE] Listener registrato per djconsole:request-auto-advance"),window.addEventListener("djconsole:request-auto-advance",w),()=>{console.log("🔄 [AUTO-ADVANCE] Listener rimosso per djconsole:request-auto-advance"),window.removeEventListener("djconsole:request-auto-advance",w)}},[S]),u.useEffect(()=>{if(!o.interface.autoAdvance)return;const C=setInterval(()=>{const f=Date.now(),g=i.leftDeck.track;if(g&&i.leftDeck.isPlaying&&i.leftDeck.currentTime>0){const v=g.duration-i.leftDeck.currentTime;console.log(`🔄 [AUTO-ADVANCE] Deck LEFT: ${i.leftDeck.currentTime.toFixed(2)}s / ${g.duration.toFixed(2)}s (${v.toFixed(2)}s rimanenti)`),v<=2&&v>0&&f-c.current.left>5e3&&(console.log("🔄 [AUTO-ADVANCE] Auto-avanzamento attivato per deck LEFT (2s rimanenti)"),c.current.left=f,S("left"))}const m=i.rightDeck.track;if(m&&i.rightDeck.isPlaying&&i.rightDeck.currentTime>0){const v=m.duration-i.rightDeck.currentTime;console.log(`🔄 [AUTO-ADVANCE] Deck RIGHT: ${i.rightDeck.currentTime.toFixed(2)}s / ${m.duration.toFixed(2)}s (${v.toFixed(2)}s rimanenti)`),v<=2&&v>0&&f-c.current.right>5e3&&(console.log("🔄 [AUTO-ADVANCE] Auto-avanzamento attivato per deck RIGHT (2s rimanenti)"),c.current.right=f,S("right"))}},1e3);return()=>clearInterval(C)},[o.interface.autoAdvance,i.leftDeck.track,i.rightDeck.track,i.leftDeck.isPlaying,i.rightDeck.isPlaying,S]),null};class yv{constructor(){U(this,"isStreaming",!1);U(this,"isConnected",!1);U(this,"isPaused",!1);U(this,"config",null);U(this,"pauseTimestamp",0);U(this,"resumeTimestamp",0);U(this,"silenceStartTime",0);U(this,"isSilent",!1);U(this,"silenceThreshold",30*1e3);U(this,"audioLevelThreshold",.01);U(this,"silenceWarningShown",!1);U(this,"silenceCheckInterval",null);U(this,"disconnectedForSilence",!1);U(this,"retryCount",0);U(this,"maxRetries",5);U(this,"retryDelay",1e3);U(this,"retryTimeout",null);U(this,"isRetrying",!1);U(this,"lastConfig",null);U(this,"retrySessionStart",0);U(this,"retrySessionDuration",3e4);U(this,"retrySessionCount",0);U(this,"retryPermanentlyStopped",!1);U(this,"userRequestedDisconnect",!1);U(this,"onStatusChange");U(this,"onError");U(this,"onDebug");U(this,"onSilenceWarning");U(this,"onSilenceDisconnect");U(this,"onRetryAttempt");U(this,"onRetryFailed");U(this,"onConnectionLost");U(this,"mediaRecorder",null);U(this,"audioStream",null);var t;(t=this.onDebug)==null||t.call(this,"🚀 ContinuousStreamingManager inizializzato"),this.setupFFmpegEventListeners()}get isUserRequestedDisconnect(){return this.userRequestedDisconnect}setCallbacks(t){this.onStatusChange=t.onStatusChange,this.onError=t.onError,this.onDebug=t.onDebug,this.onSilenceWarning=t.onSilenceWarning,this.onSilenceDisconnect=t.onSilenceDisconnect,this.onRetryAttempt=t.onRetryAttempt,this.onRetryFailed=t.onRetryFailed,this.onConnectionLost=t.onConnectionLost}setStatusCallback(t){this.onStatusChange=n=>{const o=n.isStreaming?"streaming":n.isConnected?"connected":"disconnected";t(o)}}setDebugCallback(t){this.onDebug=t}setErrorCallback(t){this.onError=t}setCredentials(t){var n;(n=this.onDebug)==null||n.call(this,"setCredentials chiamato (compatibilità)")}setServerUrl(t){var n;(n=this.onDebug)==null||n.call(this,"setServerUrl chiamato (compatibilità)")}async connect(){var t,n,o,r;try{return(t=this.onDebug)==null||t.call(this,"🔌 Connessione al server..."),this.isConnected=!0,(n=this.onStatusChange)==null||n.call(this,{isConnected:!0,isStreaming:!1,bytesSent:0,errors:0}),(o=this.onDebug)==null||o.call(this,"✅ Connesso al server"),!0}catch(i){return(r=this.onError)==null||r.call(this,`Errore connessione: ${i}`),!1}}async disconnect(){var t,n,o,r,i,a,l,c;try{(t=this.onDebug)==null||t.call(this,"🔌 [DISCONNECT] Disconnessione immediata dal server..."),this.userRequestedDisconnect=!0,this.retryPermanentlyStopped=!0,(n=this.onDebug)==null||n.call(this,"🛑 [DISCONNECT] Flag userRequestedDisconnect impostato a TRUE"),console.log("🛑 [DISCONNECT] Flag userRequestedDisconnect impostato a TRUE"),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null,(o=this.onDebug)==null||o.call(this,"🛑 [DISCONNECT] Retry timeout cancellato")),this.isRetrying=!1,this.stopSilenceMonitoring(),this.stopAudioDataSending();try{typeof window<"u"&&window.electronAPI&&(await window.electronAPI.invoke("icecast-stop"),(r=this.onDebug)==null||r.call(this,"🛑 [DISCONNECT] Processo FFmpeg fermato nel main process"))}catch(d){(i=this.onDebug)==null||i.call(this,`⚠️ [DISCONNECT] Errore fermando FFmpeg: ${d}`)}this.isConnected=!1,this.isStreaming=!1,this.isPaused=!1,(a=this.onStatusChange)==null||a.call(this,{isConnected:!1,isStreaming:!1,bytesSent:0,errors:0}),(l=this.onDebug)==null||l.call(this,"✅ [DISCONNECT] Disconnesso dal server - tutti i processi fermati")}catch(d){(c=this.onError)==null||c.call(this,`Errore disconnessione: ${d}`)}}async startStreaming(t){var n;return this.config?await this.startStreamingWithConfig(this.config,!1):((n=this.onError)==null||n.call(this,"Configurazione non impostata"),!1)}async startStreamingWithConfig(t,n=!1){var o,r,i,a,l,c,d,h,p,y,x,S,w,C,f,g,m,v,N,A,b,I,j,R,F,te;try{if((o=this.onDebug)==null||o.call(this,"🎵 Avvio streaming continuo..."),this.config=t,this.lastConfig=t,this.disconnectedForSilence=!1,n)(a=this.onDebug)==null||a.call(this,`🔄 [RETRY] Continuo retry ${this.retryCount}/${this.maxRetries}`);else if(!this.retryPermanentlyStopped)this.retryCount=0,this.isRetrying=!1,this.retrySessionCount=0,this.retrySessionStart=0,(r=this.onDebug)==null||r.call(this,"🔄 [RETRY] Reset contatori per nuovo streaming");else return(i=this.onDebug)==null||i.call(this,"🛑 [RETRY] Stop definitivo attivo - nessun reset contatori"),!1;const oe=`${t.useSSL?"https":"http"}://${t.host}:${t.port}${t.mountpoint}`;n?(l=this.onDebug)==null||l.call(this,`🔍 [RETRY] Test connessione server per retry ${this.retryCount}/${this.maxRetries}: ${oe}`):(c=this.onDebug)==null||c.call(this,`🔍 [CONNECTION TEST] Test connessione server: ${oe}`);try{const ie=await fetch(oe,{method:"HEAD",signal:AbortSignal.timeout(5e3)});if(ie.status===400||ie.status===200)n?(d=this.onDebug)==null||d.call(this,`✅ [RETRY] Server raggiungibile per retry ${this.retryCount}/${this.maxRetries} (status: ${ie.status})`):(h=this.onDebug)==null||h.call(this,`✅ [CONNECTION TEST] Server raggiungibile (status: ${ie.status})`);else throw new Error(`Server risponde con status: ${ie.status}`)}catch(ie){const V=ie instanceof Error?ie.message:String(ie);return n?(p=this.onDebug)==null||p.call(this,`❌ [RETRY] Server non raggiungibile per retry ${this.retryCount}/${this.maxRetries}: ${V}`):(y=this.onDebug)==null||y.call(this,`❌ [CONNECTION TEST] Server non raggiungibile: ${V}`),(x=this.onError)==null||x.call(this,`Server non raggiungibile: ${V}`),this.isStreaming=!1,this.isConnected=!1,(S=this.onStatusChange)==null||S.call(this,{isConnected:!1,isStreaming:!1,bytesSent:0,errors:1}),this.retryCount<this.maxRetries&&!this.userRequestedDisconnect?this.handleConnectionLost(`server_unreachable_${V}`):this.userRequestedDisconnect?(w=this.onDebug)==null||w.call(this,"🛑 [RETRY] Disconnessione richiesta dall'utente - nessun retry"):((C=this.onDebug)==null||C.call(this,`🛑 [RETRY] Limite retry raggiunto (${this.maxRetries}) - stop definitivo`),(f=this.onRetryFailed)==null||f.call(this)),!1}if(typeof window<"u"&&window.desktopStream){if(n?(g=this.onDebug)==null||g.call(this,`📡 [RETRY] Avvio FFmpeg per retry ${this.retryCount}/${this.maxRetries}...`):(m=this.onDebug)==null||m.call(this,"📡 Server raggiungibile, avvio FFmpeg..."),this.userRequestedDisconnect)return(v=this.onDebug)==null||v.call(this,"🛑 [STREAMING] Disconnessione richiesta dall'utente - blocco avvio FFmpeg"),!1;const ie=await window.desktopStream.start({host:t.host,port:t.port,mount:t.mountpoint,username:t.username,password:t.password,useSSL:t.useSSL,bitrateKbps:t.bitrate,format:t.format,stationName:t.djName||"DJ Console Pro",stationDescription:`${t.djName||"DJ Console Pro"} - Live DJ Set`,stationGenre:"Electronic/Live DJ"});return ie!=null&&ie.ok?(this.isStreaming=!1,this.isConnected=!1,this.startAudioDataSending(),this.startSilenceMonitoring(),(N=this.onDebug)==null||N.call(this,"⏳ [STREAMING] FFmpeg avviato, in attesa di conferma connessione..."),(A=this.onDebug)==null||A.call(this,"✅ Streaming continuo avviato con successo"),!0):((b=this.onError)==null||b.call(this,(ie==null?void 0:ie.error)||"Errore avvio FFmpeg"),this.userRequestedDisconnect?(I=this.onDebug)==null||I.call(this,"🛑 [STREAMING] Disconnessione richiesta dall'utente - nessun retry"):this.startRetryProcess(),!1)}else return(j=this.onError)==null||j.call(this,"Desktop streaming non disponibile"),this.userRequestedDisconnect?(R=this.onDebug)==null||R.call(this,"🛑 [STREAMING] Disconnessione richiesta dall'utente - nessun retry"):this.startRetryProcess(),!1}catch(oe){return(F=this.onError)==null||F.call(this,`Errore avvio streaming: ${oe}`),this.userRequestedDisconnect?(te=this.onDebug)==null||te.call(this,"🛑 [STREAMING] Disconnessione richiesta dall'utente - nessun retry"):this.startRetryProcess(),!1}}async stopStreaming(){var t,n,o,r,i;try{(t=this.onDebug)==null||t.call(this,"🛑 Arresto streaming continuo..."),this.userRequestedDisconnect=!0,this.retryPermanentlyStopped=!0,(n=this.onDebug)==null||n.call(this,"🛑 [STOP STREAMING] Flag userRequestedDisconnect impostato a TRUE"),console.log("🛑 [STOP STREAMING] Flag userRequestedDisconnect impostato a TRUE"),this.stopRetryProcess(),this.stopAudioDataSending(),this.stopSilenceMonitoring(),typeof window<"u"&&window.desktopStream&&await window.desktopStream.stop(),this.isStreaming=!1,this.isConnected=!1,this.isPaused=!1,(o=this.onStatusChange)==null||o.call(this,{isConnected:!1,isStreaming:!1,bytesSent:0,errors:0}),(r=this.onDebug)==null||r.call(this,"✅ Streaming continuo arrestato")}catch(a){(i=this.onError)==null||i.call(this,`Errore arresto streaming: ${a}`)}}async pauseStreaming(){var t,n,o,r,i;try{if(!this.isStreaming||this.isPaused)return;this.isPaused=!0,this.pauseTimestamp=Date.now(),(t=this.onDebug)==null||t.call(this,`⏸️ [CONTINUOUS] Pausa streaming - timestamp: ${this.pauseTimestamp}`),this.pauseDeckAudio(),this.setStreamingVolume(0),(n=this.onDebug)==null||n.call(this,"⏸️ [CONTINUOUS] Volume streaming abbassato a 0 - nessun audio inviato"),(o=this.onStatusChange)==null||o.call(this,{isConnected:this.isConnected,isStreaming:!1,bytesSent:0,errors:0}),(r=this.onDebug)==null||r.call(this,"✅ Streaming continuo in pausa - volume 0, connessione FFmpeg mantenuta")}catch(a){(i=this.onError)==null||i.call(this,`Errore pausa streaming: ${a}`)}}async resumeStreaming(){var t,n,o,r,i,a;try{if(!this.isStreaming||!this.isPaused)return;this.isPaused=!1,this.resumeTimestamp=Date.now();const l=this.resumeTimestamp-this.pauseTimestamp;(t=this.onDebug)==null||t.call(this,`▶️ [CONTINUOUS] Ripresa streaming - timestamp: ${this.resumeTimestamp}`),(n=this.onDebug)==null||n.call(this,`▶️ [CONTINUOUS] Durata pausa: ${l}ms`),this.resumeDeckAudio(),this.setStreamingVolume(1),(o=this.onDebug)==null||o.call(this,"▶️ [CONTINUOUS] Volume streaming ripristinato a 100% - audio inviato"),(r=this.onStatusChange)==null||r.call(this,{isConnected:this.isConnected,isStreaming:!0,bytesSent:0,errors:0}),(i=this.onDebug)==null||i.call(this,`✅ Streaming continuo ripreso - pausa: ${l}ms - volume ripristinato`)}catch(l){(a=this.onError)==null||a.call(this,`Errore ripresa streaming: ${l}`)}}pauseDeckAudio(){var t,n,o,r;try{if(typeof window.globalAudioContext<"u"){const i=window.globalAudioContext,a=window.globalMixerGain;i&&a&&(a.gain.setValueAtTime(0,i.currentTime),(t=this.onDebug)==null||t.call(this,"⏸️ [CONTINUOUS] Mixer gain messo a 0 - audio deck in pausa"))}if(typeof window.leftStreamAudio<"u"){const i=window.leftStreamAudio;i&&!i.paused&&(i.pause(),(n=this.onDebug)==null||n.call(this,"⏸️ [CONTINUOUS] Left deck audio messo in pausa"))}if(typeof window.rightStreamAudio<"u"){const i=window.rightStreamAudio;i&&!i.paused&&(i.pause(),(o=this.onDebug)==null||o.call(this,"⏸️ [CONTINUOUS] Right deck audio messo in pausa"))}}catch(i){(r=this.onError)==null||r.call(this,`Errore pausa audio deck: ${i}`)}}resumeDeckAudio(){var t,n,o,r;try{if(typeof window.globalAudioContext<"u"){const i=window.globalAudioContext,a=window.globalMixerGain;i&&a&&(a.gain.setValueAtTime(1,i.currentTime),(t=this.onDebug)==null||t.call(this,"▶️ [CONTINUOUS] Mixer gain ripristinato a 1.0 - audio deck ripreso"))}if(typeof window.leftStreamAudio<"u"){const i=window.leftStreamAudio;i&&i.paused&&(i.play(),(n=this.onDebug)==null||n.call(this,"▶️ [CONTINUOUS] Left deck audio ripreso"))}if(typeof window.rightStreamAudio<"u"){const i=window.rightStreamAudio;i&&i.paused&&(i.play(),(o=this.onDebug)==null||o.call(this,"▶️ [CONTINUOUS] Right deck audio ripreso"))}}catch(i){(r=this.onError)==null||r.call(this,`Errore ripresa audio deck: ${i}`)}}getStatus(){return{isConnected:this.isConnected,isStreaming:this.isStreaming,bytesSent:0,errors:0,lastError:void 0}}startAudioDataSending(){var t,n,o,r;try{(t=this.onDebug)==null||t.call(this,"🎵 Avvio invio dati audio..."),typeof window.getMixedStream=="function"?((n=this.onDebug)==null||n.call(this,"🎵 Ottenimento mixed stream per streaming..."),window.getMixedStream(void 0,void 0,!1).then(i=>{var a,l;i&&i.active?(this.audioStream=i,this.startMediaRecorder(i),(a=this.onDebug)==null||a.call(this,"✅ MediaRecorder avviato per invio dati audio")):(l=this.onError)==null||l.call(this,"Impossibile ottenere mixed stream valido")}).catch(i=>{var a;(a=this.onError)==null||a.call(this,`Errore ottenimento mixed stream: ${i}`)})):(o=this.onError)==null||o.call(this,"Funzione getMixedStream non disponibile")}catch(i){(r=this.onError)==null||r.call(this,`Errore avvio invio dati audio: ${i}`)}}startMediaRecorder(t){var n,o,r;try{this.mediaRecorder=new MediaRecorder(t,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:(((n=this.config)==null?void 0:n.bitrate)||128)*1e3}),this.mediaRecorder.ondataavailable=async i=>{var a,l,c;if(i.data&&i.data.size>0)try{const d=await i.data.arrayBuffer();this.analyzeAudioChunk(d),typeof((a=window.desktopStream)==null?void 0:a.write)=="function"&&(window.desktopStream.write(d),(l=this.onDebug)==null||l.call(this,`📡 Dati audio inviati: ${d.byteLength} bytes`))}catch(d){(c=this.onError)==null||c.call(this,`Errore invio chunk audio: ${d}`)}},this.mediaRecorder.start(100),(o=this.onDebug)==null||o.call(this,"✅ MediaRecorder avviato per streaming continuo")}catch(i){(r=this.onError)==null||r.call(this,`Errore avvio MediaRecorder: ${i}`)}}stopAudioDataSending(){var t,n;try{this.mediaRecorder&&this.mediaRecorder.state==="recording"&&(this.mediaRecorder.stop(),(t=this.onDebug)==null||t.call(this,"🛑 MediaRecorder fermato")),this.mediaRecorder=null,this.audioStream=null}catch(o){(n=this.onError)==null||n.call(this,`Errore arresto invio dati audio: ${o}`)}}setStreamingVolume(t){var n,o,r,i,a,l;try{if(typeof window.globalAudioContext<"u"){const c=window.globalAudioContext,d=window.leftDeckStreamGain,h=window.rightDeckStreamGain;c?(d&&(d.gain.setValueAtTime(t,c.currentTime),(n=this.onDebug)==null||n.call(this,`🔊 [STREAMING VOLUME] Left deck gain impostato a: ${Math.round(t*100)}%`)),h&&(h.gain.setValueAtTime(t,c.currentTime),(o=this.onDebug)==null||o.call(this,`🔊 [STREAMING VOLUME] Right deck gain impostato a: ${Math.round(t*100)}%`)),!d&&!h&&((r=this.onDebug)==null||r.call(this,"⚠️ [STREAMING VOLUME] Nessun deck gain disponibile per streaming"))):(i=this.onDebug)==null||i.call(this,"⚠️ [STREAMING VOLUME] GlobalAudioContext non disponibile")}else(a=this.onDebug)==null||a.call(this,"⚠️ [STREAMING VOLUME] GlobalAudioContext non disponibile")}catch(c){(l=this.onError)==null||l.call(this,`Errore controllo volume streaming: ${c}`)}}analyzeAudioChunk(t){var n,o,r;try{const i=t.byteLength;this.detectSilenceFromChunkSize(i,t)?(this.isSilent||(this.isSilent=!0,this.silenceStartTime=Date.now(),this.silenceWarningShown=!1,(n=this.onDebug)==null||n.call(this,`🔇 [SILENCE] Inizio silenzio rilevato - chunk size: ${i} bytes`)),this.checkSilenceDuration()):this.isSilent&&(this.isSilent=!1,this.silenceWarningShown=!1,(o=this.onDebug)==null||o.call(this,`🔊 [SILENCE] Fine silenzio rilevato - chunk size: ${i} bytes`))}catch(i){(r=this.onError)==null||r.call(this,`Errore analisi chunk audio: ${i}`)}}detectSilenceFromChunkSize(t,n){var o;try{if(t<100)return!0;const r=new Uint8Array(n);let i=0,a=Math.min(r.length,1e3);for(let c=0;c<a;c++)r[c]===0&&i++;return!!(i/a>.8||this.hasSilencePattern(r))}catch(r){return(o=this.onDebug)==null||o.call(this,`Errore analisi pattern silenzio: ${r}`),!1}}hasSilencePattern(t){try{const n=[[0,0,0,0],[255,255,255,255],[128,128,128,128]];for(const o of n){let r=0;for(let i=0;i<Math.min(t.length-o.length,100);i++){let a=!0;for(let l=0;l<o.length;l++)if(t[i+l]!==o[l]){a=!1;break}a&&r++}if(r>10)return!0}return!1}catch{return!1}}checkSilenceDuration(){var o,r,i,a;if(!this.isSilent||this.disconnectedForSilence)return;const t=Date.now()-this.silenceStartTime,n=this.silenceThreshold-t;if(n<=0)(o=this.onDebug)==null||o.call(this,`🔇 [SILENCE] Silenzio di ${Math.round(t/1e3)}s - disconnessione automatica`),this.disconnectedForSilence=!0,(r=this.onSilenceDisconnect)==null||r.call(this),this.stopStreaming();else if(n<=1e4&&!this.silenceWarningShown){this.silenceWarningShown=!0;const l=Math.round(n/1e3);(i=this.onDebug)==null||i.call(this,`⚠️ [SILENCE] Avviso: disconnessione in ${l} secondi per silenzio`),(a=this.onSilenceWarning)==null||a.call(this,l)}}startSilenceMonitoring(){var t;this.stopSilenceMonitoring(),this.silenceCheckInterval=setInterval(()=>{this.isSilent&&this.checkSilenceDuration()},1e3),(t=this.onDebug)==null||t.call(this,"🔇 [SILENCE] Monitoraggio silenzio avviato")}stopSilenceMonitoring(){var t;this.silenceCheckInterval&&(clearInterval(this.silenceCheckInterval),this.silenceCheckInterval=null),this.isSilent=!1,this.silenceWarningShown=!1,this.disconnectedForSilence=!1,(t=this.onDebug)==null||t.call(this,"🔇 [SILENCE] Monitoraggio silenzio fermato")}startRetryProcess(){var o,r,i,a,l,c,d,h;if(console.log("🔄 [RETRY] startRetryProcess chiamato - controlli:",{isRetrying:this.isRetrying,disconnectedForSilence:this.disconnectedForSilence,retryPermanentlyStopped:this.retryPermanentlyStopped,userRequestedDisconnect:this.userRequestedDisconnect}),this.isRetrying||this.disconnectedForSilence||this.retryPermanentlyStopped||this.userRequestedDisconnect){(o=this.onDebug)==null||o.call(this,"🔄 [RETRY] Retry già in corso, disconnesso per silenzio, stop definitivo o disconnessione utente - skip"),console.log("🔄 [RETRY] Retry bloccato - userRequestedDisconnect:",this.userRequestedDisconnect);return}const t=Date.now();if(this.retrySessionStart===0&&(this.retrySessionStart=t,this.retrySessionCount=0),t-this.retrySessionStart>this.retrySessionDuration&&(this.retrySessionStart=t,this.retrySessionCount=0,this.retryCount=0),this.retrySessionCount>=5){const p=this.retrySessionDuration-(t-this.retrySessionStart);(r=this.onDebug)==null||r.call(this,`🔄 [RETRY] Limite sessione raggiunto (5/30s) - aspetta ${Math.round(p/1e3)}s`);return}if(this.retryCount>=this.maxRetries){(i=this.onDebug)==null||i.call(this,`🛑 [RETRY] Raggiunto limite massimo retry (${this.maxRetries}) - STOP DEFINITIVO`),this.retryPermanentlyStopped=!0,(a=this.onRetryFailed)==null||a.call(this);return}if(!this.lastConfig){(l=this.onDebug)==null||l.call(this,"🔄 [RETRY] Nessuna configurazione salvata per retry - abbandono"),(c=this.onRetryFailed)==null||c.call(this);return}this.retryCount++,this.retrySessionCount++,this.isRetrying=!0;const n=this.retryDelay*Math.pow(2,this.retryCount-1);(d=this.onDebug)==null||d.call(this,`🔄 [RETRY] Tentativo ${this.retryCount}/${this.maxRetries} (${this.retrySessionCount}/5 in sessione 30s) tra ${n}ms`),(h=this.onRetryAttempt)==null||h.call(this,this.retryCount,this.maxRetries),this.retryTimeout=setTimeout(async()=>{var p,y,x,S,w;try{(p=this.onDebug)==null||p.call(this,`🔄 [RETRY] Esecuzione tentativo ${this.retryCount}/${this.maxRetries}`),await this.startStreamingWithConfig(this.lastConfig,!0)?((y=this.onDebug)==null||y.call(this,`✅ [RETRY] Riconnessione riuscita al tentativo ${this.retryCount}`),this.isRetrying=!1,this.retryCount=0):((x=this.onDebug)==null||x.call(this,`❌ [RETRY] Tentativo ${this.retryCount} fallito - riprovo`),this.isRetrying=!1,this.userRequestedDisconnect?(S=this.onDebug)==null||S.call(this,"🛑 [RETRY] Disconnessione richiesta dall'utente - nessun retry"):this.startRetryProcess())}catch(C){(w=this.onError)==null||w.call(this,`Errore durante retry: ${C}`),this.isRetrying=!1}},n)}stopRetryProcess(){var t,n;this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=null),this.isRetrying=!1,this.retryCount=0,this.retrySessionCount=0,this.retrySessionStart=0,this.retryPermanentlyStopped?(n=this.onDebug)==null||n.call(this,"🛑 [RETRY] Processo retry fermato - stop definitivo attivo"):(t=this.onDebug)==null||t.call(this,"🔄 [RETRY] Processo retry fermato")}handleConnectionLost(t){var n,o,r;(n=this.onDebug)==null||n.call(this,`🚨 [CONNECTION] Connessione persa: ${t}`),(o=this.onConnectionLost)==null||o.call(this,t),console.log("🚨 [CONNECTION] handleConnectionLost chiamato - controlli:",{reason:t,isRetrying:this.isRetrying,disconnectedForSilence:this.disconnectedForSilence,retryPermanentlyStopped:this.retryPermanentlyStopped,userRequestedDisconnect:this.userRequestedDisconnect}),!this.isRetrying&&!this.disconnectedForSilence&&!this.retryPermanentlyStopped&&!this.userRequestedDisconnect?this.startRetryProcess():(this.retryPermanentlyStopped||this.userRequestedDisconnect)&&((r=this.onDebug)==null||r.call(this,"🛑 [CONNECTION] Retry stop definitivo o disconnessione utente - nessun tentativo di riconnessione"),console.log("🛑 [CONNECTION] Retry bloccato - userRequestedDisconnect:",this.userRequestedDisconnect))}resetRetryLimit(){var t;this.retryPermanentlyStopped=!1,this.retryCount=0,this.isRetrying=!1,this.retrySessionCount=0,this.retrySessionStart=0,(t=this.onDebug)==null||t.call(this,"🔄 [RETRY] Limite retry resettato manualmente - riprova disponibile")}resetUserDisconnectFlag(){var t;this.userRequestedDisconnect=!1,(t=this.onDebug)==null||t.call(this,"🔄 [USER DISCONNECT] Flag userRequestedDisconnect resettato - nuovo avvio manuale permesso"),console.log("🔄 [USER DISCONNECT] Flag userRequestedDisconnect resettato a FALSE")}setupFFmpegEventListeners(){var t,n;if(typeof window<"u"&&window.electronAPI){const o=window.electronAPI;o.onFFmpegError((r,i)=>{var a,l,c,d;(a=this.onDebug)==null||a.call(this,`🚨 [FFMPEG ERROR] ${i.type}: ${i.message}`),(l=this.onError)==null||l.call(this,`FFmpeg Error: ${i.message}`),this.stopAudioDataSending(),this.isStreaming=!1,this.isConnected=!1,(c=this.onStatusChange)==null||c.call(this,{isConnected:!1,isStreaming:!1,bytesSent:0,errors:1}),!this.isRetrying&&!this.disconnectedForSilence&&!this.userRequestedDisconnect?this.handleConnectionLost(`ffmpeg_error_${i.type}`):this.userRequestedDisconnect&&((d=this.onDebug)==null||d.call(this,"🛑 [FFMPEG ERROR] Disconnessione richiesta dall'utente - nessun retry"))}),(t=o.onFFmpegConnected)==null||t.call(o,(r,i)=>{var a,l,c;(a=this.onDebug)==null||a.call(this,`✅ [FFMPEG CONNECTED] Connesso con successo: ${i.message||"Connessione stabilita"}`),this.isStreaming=!0,this.isConnected=!0,(l=this.onStatusChange)==null||l.call(this,{isConnected:!0,isStreaming:!0,bytesSent:0,errors:0}),(c=this.onDebug)==null||c.call(this,"🎉 [STREAMING] FFmpeg connesso e streaming attivo!")}),o.onFFmpegDisconnected((r,i)=>{var a,l,c;(a=this.onDebug)==null||a.call(this,`🚨 [FFMPEG DISCONNECTED] Exit code: ${i.exitCode}, Reason: ${i.reason}`),this.stopAudioDataSending(),this.isStreaming=!1,this.isConnected=!1,(l=this.onStatusChange)==null||l.call(this,{isConnected:!1,isStreaming:!1,bytesSent:0,errors:1}),i.reason!=="normal_exit"&&!this.isRetrying&&!this.disconnectedForSilence&&!this.userRequestedDisconnect?this.handleConnectionLost(`ffmpeg_disconnected_${i.exitCode}`):this.userRequestedDisconnect&&((c=this.onDebug)==null||c.call(this,"🛑 [FFMPEG DISCONNECTED] Disconnessione richiesta dall'utente - nessun retry"))}),(n=this.onDebug)==null||n.call(this,"🔧 [FFMPEG] Event listeners setup completato")}}}const vv=({isVisible:e,onClose:t,streamStatus:n,isStreaming:o,streamError:r,debugMessages:i})=>{const[a,l]=u.useState("debug"),[c,d]=u.useState([]),[h]=u.useState(100);if(u.useEffect(()=>(window.addStreamingNotification=(m,v,N,A="streaming")=>{const b={id:Date.now().toString(),type:m,title:v,message:N,timestamp:new Date,category:A};d(I=>[b,...I].slice(0,h))},()=>{delete window.addStreamingNotification}),[h]),!e)return null;const p=()=>o?"text-blue-400":n==="connected"?"text-green-400":n==="connecting"?"text-yellow-400":r?"text-red-400":"text-gray-400",y=()=>o?"🔵":n==="connected"?"🟢":n==="connecting"?"🟡":r?"🔴":"⚫",x=m=>{switch(m){case"success":return s.jsx(Uy,{className:"w-3 h-3 text-green-500"});case"error":return s.jsx(zy,{className:"w-3 h-3 text-red-500"});case"warning":return s.jsx(vc,{className:"w-3 h-3 text-yellow-500"});case"info":return s.jsx(Wu,{className:"w-3 h-3 text-blue-500"});default:return s.jsx(Wu,{className:"w-3 h-3 text-gray-500"})}},S=m=>{switch(m){case"success":return"border-l-green-500 bg-green-900/20";case"error":return"border-l-red-500 bg-red-900/20";case"warning":return"border-l-yellow-500 bg-yellow-900/20";case"info":return"border-l-blue-500 bg-blue-900/20";default:return"border-l-gray-500 bg-gray-900/20"}},w=()=>{d([])},C=m=>{d(v=>v.filter(N=>N.id!==m))},f=c.filter(m=>m.category===a),g=m=>c.filter(v=>v.category===m).length;return s.jsxs("div",{className:"fixed bottom-4 right-4 w-96 bg-gray-900 border border-gray-700 rounded-lg shadow-2xl z-50 max-h-96 overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800 border-b border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ky,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm font-medium text-white",children:"Notifiche & Debug"})]}),s.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",title:"Chiudi notifiche",children:s.jsx(xl,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"p-3 bg-gray-850 border-b border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(jo,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-300",children:"Status:"}),s.jsxs("span",{className:`text-sm font-medium ${p()}`,children:[y()," ",n.toUpperCase(),o&&" (LIVE)"]})]}),r&&s.jsx("div",{className:"bg-red-900/20 border border-red-500/30 rounded p-2",children:s.jsxs("div",{className:"text-xs text-red-400 font-mono break-words",children:["❌ ",r]})})]}),s.jsxs("div",{className:"flex border-b border-gray-700",children:[s.jsx("button",{onClick:()=>l("debug"),className:`flex-1 px-2 py-2 text-xs font-medium border-b-2 transition-colors ${a==="debug"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:"🐛 DEBUG"}),s.jsxs("button",{onClick:()=>l("streaming"),className:`flex-1 px-2 py-2 text-xs font-medium border-b-2 transition-colors ${a==="streaming"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:["📡 STREAMING (",g("streaming"),")"]}),s.jsxs("button",{onClick:()=>l("audio"),className:`flex-1 px-2 py-2 text-xs font-medium border-b-2 transition-colors ${a==="audio"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:["🎵 AUDIO (",g("audio"),")"]}),s.jsxs("button",{onClick:()=>l("app"),className:`flex-1 px-2 py-2 text-xs font-medium border-b-2 transition-colors ${a==="app"?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-gray-300"}`,children:["⚙️ APP (",g("app"),")"]})]}),s.jsxs("div",{className:"h-48 overflow-y-auto bg-black",children:[a==="debug"&&s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Debug Log (ultimi ",i.length," messaggi):"]}),i.length===0?s.jsx("div",{className:"text-xs text-gray-600 italic",children:"Nessun messaggio di debug ancora..."}):s.jsx("div",{className:"space-y-1",children:i.map((m,v)=>s.jsx("div",{className:`text-xs font-mono break-words ${m.includes("error")||m.includes("fail")||m.includes("Error")||m.includes("Failed")?"text-red-400":m.includes("connected")||m.includes("success")||m.includes("started")?"text-green-400":m.includes("connecting")||m.includes("starting")?"text-yellow-400":"text-gray-300"}`,children:m},v))})]}),(a==="streaming"||a==="audio"||a==="app")&&s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"text-xs text-gray-500",children:["Notifiche ",a==="streaming"?"Streaming":a==="audio"?"Audio":"App",":"]}),s.jsx("button",{onClick:w,className:"text-xs text-gray-400 hover:text-gray-300 px-2 py-1 rounded hover:bg-gray-800",children:"Pulisci"})]}),f.length===0?s.jsx("div",{className:"text-xs text-gray-600 italic",children:"Nessuna notifica in questa categoria..."}):s.jsx("div",{className:"space-y-2",children:f.map(m=>s.jsx("div",{className:`p-2 rounded border-l-2 ${S(m.type)}`,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start space-x-2 flex-1 min-w-0",children:[x(m.type),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-xs font-medium text-gray-200 mb-1",children:m.title}),s.jsx("div",{className:"text-xs text-gray-300 break-words",children:m.message}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:m.timestamp.toLocaleTimeString()})]})]}),s.jsx("button",{onClick:()=>C(m.id),className:"text-gray-500 hover:text-gray-300 p-1 rounded hover:bg-gray-800",children:s.jsx(xl,{className:"w-3 h-3"})})]})},m.id))})]})]}),s.jsx("div",{className:"p-2 bg-gray-800 border-t border-gray-700",children:s.jsx("div",{className:"text-xs text-gray-500 text-center",children:"💡 Questo pannello si apre automaticamente in caso di errori"})})]})},Ca=({isOpen:e,title:t,message:n,confirmText:o,cancelText:r,onConfirm:i,onCancel:a,type:l="warning"})=>{if(!e)return null;const d=(()=>{switch(l){case"danger":return{icon:"⚠️",confirmBg:"bg-red-600 hover:bg-red-700",borderColor:"border-red-500"};case"info":return{icon:"ℹ️",confirmBg:"bg-blue-600 hover:bg-blue-700",borderColor:"border-blue-500"};default:return{icon:"⚠️",confirmBg:"bg-yellow-600 hover:bg-yellow-700",borderColor:"border-yellow-500"}}})();return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:`bg-dj-primary border-2 ${d.borderColor} rounded-lg p-6 max-w-md mx-4 shadow-2xl`,children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("span",{className:"text-2xl mr-3",children:d.icon}),s.jsx("h3",{className:"text-xl font-bold text-white",children:t})]}),s.jsx("p",{className:"text-dj-light mb-6 leading-relaxed",children:n}),s.jsxs("div",{className:"flex space-x-3 justify-end",children:[s.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors",children:r}),s.jsx("button",{onClick:i,className:`px-4 py-2 ${d.confirmBg} text-white rounded-md transition-colors font-medium`,children:o})]})]})})},xv=({className:e=""})=>{const{state:t,soundEffectsManagerRef:n,microphoneEffectsManagerRef:o}=an(),[r,i]=u.useState(null),[a,l]=u.useState(!1),[c,d]=u.useState(!1),[h,p]=u.useState(.5),[y,x]=u.useState(!1),[S,w]=u.useState(.5),[C,f]=u.useState(!1),[g,m]=u.useState(.5),[v,N]=u.useState(!1),[A,b]=u.useState(.5),[I,j]=u.useState(!1);u.useEffect(()=>{let D=0;const M=50,J=()=>{if(D++,n!=null&&n.current)i(n.current),l(!0),console.log("🎵 [DECK EFFECTS] SoundEffectsManager inizializzato");else if(D<M)setTimeout(J,100);else{console.warn("⚠️ [DECK EFFECTS] SoundEffectsManager non disponibile, creazione fallback...");try{const Q=new Mf;Q.setCallbacks({onDebug:he=>console.log(he),onError:he=>console.error(he)}),i(Q),l(!0),console.log("🎵 [DECK EFFECTS] SoundEffectsManager fallback creato")}catch(Q){j(!0),console.error("❌ [DECK EFFECTS] Errore creazione fallback:",Q)}}};J()},[n]);const R=async D=>{if(console.log(`🎵 [SOUND EFFECTS] Tentativo riproduzione: ${D}`),console.log(`🎵 [SOUND EFFECTS] soundEffectsManager: ${r?"✅ SÌ":"❌ NO"}`),console.log(`🎵 [SOUND EFFECTS] isInitialized: ${a?"✅ SÌ":"❌ NO"}`),!r||!a){console.warn(`🎵 [SOUND EFFECTS] ❌ Non posso riprodurre ${D} - manager o inizializzazione non disponibili`);return}try{console.log(`🎵 [SOUND EFFECTS] Chiamando playSoundEffect per: ${D}`);const M=await r.playSoundEffect(D,.8);console.log(`🎵 [SOUND EFFECTS] Risultato playSoundEffect: ${M}`)}catch(M){console.error("🎵 [SOUND EFFECTS] Errore riproduzione effetto:",M)}},F=()=>{const D=!c;d(D);const M=window.microphoneReverbGain,J=window.microphoneDryGain;M&&J?D?(M.gain.setValueAtTime(h,M.context.currentTime),J.gain.setValueAtTime(1-h,J.context.currentTime),console.log(`🎤 [REVERB] Reverbero attivato: ${Math.round(h*100)}%`)):(M.gain.setValueAtTime(0,M.context.currentTime),J.gain.setValueAtTime(1,J.context.currentTime),console.log("🎤 [REVERB] Reverbero disattivato")):console.warn("🎤 [REVERB] Controlli reverbero non disponibili")},te=D=>{if(p(D),c){const M=window.microphoneReverbGain,J=window.microphoneDryGain;M&&J&&(M.gain.setValueAtTime(D,M.context.currentTime),J.gain.setValueAtTime(1-D,J.context.currentTime),console.log(`🎤 [REVERB] Reverbero aggiornato: ${Math.round(D*100)}%`))}},oe=()=>{const D=!y;x(D);const M=window.microphoneGain;console.log(`🔍 [DISTORTION] Debug microphoneGain: ${M?"✅ DISPONIBILE":"❌ NON DISPONIBILE"}`),M?D?(M.gain.setValueAtTime(2+S*3,M.context.currentTime),console.log(`🎤 [DISTORTION] Distorsione attivata: ${Math.round(S*100)}%`)):(M.gain.setValueAtTime(1,M.context.currentTime),console.log("🎤 [DISTORTION] Distorsione disattivata")):console.warn("🎤 [DISTORTION] Controlli microfono non disponibili")},ie=D=>{if(w(D),y){const M=window.microphoneGain;M&&(M.gain.setValueAtTime(2+D*3,M.context.currentTime),console.log(`🎤 [DISTORTION] Distorsione aggiornata: ${Math.round(D*100)}%`))}},V=()=>{const D=!C;f(D);const M=window.microphoneGain;M?D?(M.gain.setValueAtTime(.5+g*.2,M.context.currentTime),console.log(`🎤 [PITCH] Voce donna attivata: ${Math.round(g*100)}%`)):(M.gain.setValueAtTime(1,M.context.currentTime),console.log("🎤 [PITCH] Voce donna disattivata")):console.warn("🎤 [PITCH] Controlli microfono non disponibili")},se=D=>{if(m(D),C){const M=window.microphoneGain;M&&(M.gain.setValueAtTime(.5+D*.2,M.context.currentTime),console.log(`🎤 [PITCH] Voce donna aggiornata: ${Math.round(D*100)}%`))}},ae=()=>{const D=!v;N(D);const M=window.microphoneGain;M?D?(M.gain.setValueAtTime(1.5+A*1,M.context.currentTime),console.log(`🎤 [ECHO] Eco attivato: ${Math.round(A*100)}%`)):(M.gain.setValueAtTime(1,M.context.currentTime),console.log("🎤 [ECHO] Eco disattivato")):console.warn("🎤 [ECHO] Controlli microfono non disponibili")},W=D=>{if(b(D),v){const M=window.microphoneGain;M&&(M.gain.setValueAtTime(1.5+D*1,M.context.currentTime),console.log(`🎤 [ECHO] Eco aggiornato: ${Math.round(D*100)}%`))}};return a?s.jsxs("div",{className:`deck-effects ${e}`,children:[s.jsx("div",{className:"effects-header",children:s.jsx("h3",{children:"🎵 Effetti Audio"})}),s.jsxs("div",{className:"sound-effects-section",children:[s.jsx("h4",{children:"🎶 Sound Effects"}),s.jsxs("div",{className:"effects-grid",children:[s.jsx("button",{onClick:()=>R("applause"),className:"effect-button applause",title:"Applausi del pubblico",children:"👏 Applausi"}),s.jsx("button",{onClick:()=>R("horn"),className:"effect-button horn",title:"Suono di trombetta",children:"📯 Trombetta"}),s.jsx("button",{onClick:()=>R("swoosh"),className:"effect-button swoosh",title:"Effetto di transizione",children:"💨 Swoosh"}),s.jsx("button",{onClick:()=>R("whoosh"),className:"effect-button whoosh",title:"Effetto di movimento",children:"🌪️ Whoosh"}),s.jsx("button",{onClick:()=>R("beep"),className:"effect-button beep",title:"Suono di notifica",children:"🔔 Beep"}),s.jsx("button",{onClick:()=>R("drop"),className:"effect-button drop",title:"Effetto di caduta",children:"📉 Drop"}),s.jsx("button",{onClick:()=>R("rise"),className:"effect-button rise",title:"Effetto di ascesa",children:"📈 Rise"}),s.jsx("button",{onClick:()=>R("squeak"),className:"effect-button squeak",title:"Suono che perde",children:"🎵 Squeak"})]})]}),s.jsxs("div",{className:"microphone-effects-section",children:[s.jsx("h4",{children:"🎤 Effetti Microfono"}),s.jsxs("div",{className:"mic-effects-grid",children:[s.jsxs("div",{className:"mic-effect-card",children:[s.jsx("div",{className:"effect-header",children:s.jsx("button",{onClick:F,className:`effect-button reverb ${c?"active":""}`,title:c?"Disattiva reverbero":"Attiva reverbero",children:"🎤 Reverbero"})}),c&&s.jsxs("div",{className:"effect-controls",children:[s.jsx("label",{children:"Intensità:"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:h,onChange:D=>te(parseFloat(D.target.value)),className:"slider"}),s.jsxs("span",{children:[Math.round(h*100),"%"]})]})]}),s.jsxs("div",{className:"mic-effect-card",children:[s.jsx("div",{className:"effect-header",children:s.jsx("button",{onClick:oe,className:`effect-button distortion ${y?"active":""}`,title:y?"Disattiva distorsione":"Attiva distorsione",children:"🔥 Distorsione"})}),y&&s.jsxs("div",{className:"effect-controls",children:[s.jsx("label",{children:"Intensità:"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:S,onChange:D=>ie(parseFloat(D.target.value)),className:"slider"}),s.jsxs("span",{children:[Math.round(S*100),"%"]})]})]}),s.jsxs("div",{className:"mic-effect-card",children:[s.jsx("div",{className:"effect-header",children:s.jsx("button",{onClick:V,className:`effect-button pitch ${C?"active":""}`,title:C?"Disattiva voce donna":"Attiva voce donna",children:"👩 Voce Donna"})}),C&&s.jsxs("div",{className:"effect-controls",children:[s.jsx("label",{children:"Intensità:"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:g,onChange:D=>se(parseFloat(D.target.value)),className:"slider"}),s.jsxs("span",{children:[Math.round(g*100),"%"]})]})]}),s.jsxs("div",{className:"mic-effect-card",children:[s.jsx("div",{className:"effect-header",children:s.jsx("button",{onClick:ae,className:`effect-button echo ${v?"active":""}`,title:v?"Disattiva eco":"Attiva eco",children:"🏔️ Eco"})}),v&&s.jsxs("div",{className:"effect-controls",children:[s.jsx("label",{children:"Intensità:"}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:A,onChange:D=>W(parseFloat(D.target.value)),className:"slider"}),s.jsxs("span",{children:[Math.round(A*100),"%"]})]})]}),s.jsx("div",{className:"mic-effect-card",children:s.jsx("div",{className:"effect-header",children:s.jsx("button",{onClick:()=>{o!=null&&o.current&&(o.current.applyPreset("cave"),console.log("🎤 [PRESET] Grotta applicata"))},className:"effect-button cave",title:"Applica preset grotta",children:"🕳️ Grotta"})})})]})]}),s.jsx("style",{jsx:!0,children:`
        .deck-effects {
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border-radius: 12px;
          padding: 20px;
          color: white;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.1);
          margin-top: 20px;
        }

        .loading {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 40px;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid rgba(255, 255, 255, 0.1);
          border-left: 4px solid #00d4ff;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .error {
          color: #ff6b6b;
          font-size: 0.9em;
          margin-top: 10px;
          text-align: center;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .effects-header h3 {
          margin: 0 0 20px 0;
          font-size: 1.5em;
          text-align: center;
          background: linear-gradient(45deg, #00d4ff, #ff6b6b);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }

        .sound-effects-section,
        .microphone-effects-section {
          margin-bottom: 25px;
          padding: 15px;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 8px;
          border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sound-effects-section h4,
        .microphone-effects-section h4 {
          margin: 0 0 15px 0;
          font-size: 1.2em;
          color: #00d4ff;
        }

        .effects-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 10px;
        }

        .effect-button {
          padding: 10px 15px;
          background: linear-gradient(45deg, #00d4ff, #0099cc);
          border: none;
          border-radius: 8px;
          color: white;
          font-size: 0.9em;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 2px 8px rgba(0, 212, 255, 0.2);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 5px;
        }

        .effect-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
          background: linear-gradient(45deg, #00e5ff, #00aadd);
        }

        .effect-button:active {
          transform: translateY(0);
          box-shadow: 0 2px 4px rgba(0, 212, 255, 0.3);
        }

        .reverb-controls {
          display: flex;
          flex-direction: column;
          gap: 15px;
        }

        .reverb-toggle {
          display: flex;
          justify-content: center;
        }

        .reverb-button {
          padding: 12px 24px;
          background: linear-gradient(45deg, #ff6b6b, #ee5a52);
          border: none;
          border-radius: 25px;
          color: white;
          font-size: 1em;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .reverb-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .reverb-button.active {
          background: linear-gradient(45deg, #00d4ff, #0099cc);
          box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .reverb-button.active:hover {
          box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .reverb-slider {
          display: flex;
          align-items: center;
          gap: 15px;
          padding: 10px;
          background: rgba(255, 255, 255, 0.05);
          border-radius: 8px;
        }

        .reverb-slider label {
          font-size: 0.9em;
          color: #ccc;
          min-width: 120px;
        }

        .slider {
          flex: 1;
          height: 6px;
          border-radius: 3px;
          background: rgba(255, 255, 255, 0.2);
          outline: none;
          -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #00d4ff;
          cursor: pointer;
          box-shadow: 0 2px 6px rgba(0, 212, 255, 0.3);
        }

        .reverb-slider span {
          font-size: 0.9em;
          color: #00d4ff;
          font-weight: 600;
          min-width: 40px;
          text-align: center;
        }

        /* Layout Orizzontale Effetti Microfono */
        .mic-effects-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
          gap: 20px;
          margin-top: 15px;
        }

        .mic-effect-card {
          background: rgba(255, 255, 255, 0.03);
          border-radius: 12px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          padding: 15px;
          transition: all 0.3s ease;
        }

        .mic-effect-card:hover {
          background: rgba(255, 255, 255, 0.05);
          border-color: rgba(255, 255, 255, 0.2);
        }

        .effect-button {
          width: 100%;
          padding: 12px 20px;
          border: none;
          border-radius: 8px;
          color: white;
          font-size: 1em;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          margin-bottom: 10px;
        }

        .effect-button.reverb {
          background: linear-gradient(45deg, #ff6b6b, #ee5a52);
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .effect-button.distortion {
          background: linear-gradient(45deg, #ff4757, #ff3742);
          box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        .effect-button.pitch {
          background: linear-gradient(45deg, #ff9f43, #ff8c42);
          box-shadow: 0 4px 15px rgba(255, 159, 67, 0.3);
        }

        .effect-button.echo {
          background: linear-gradient(45deg, #a55eea, #8b5cf6);
          box-shadow: 0 4px 15px rgba(165, 94, 234, 0.3);
        }

        .effect-button.cave {
          background: linear-gradient(45deg, #2c2c54, #40407a);
          box-shadow: 0 4px 15px rgba(44, 44, 84, 0.3);
        }

        .effect-button:hover {
          transform: translateY(-2px);
        }

        .effect-button.reverb:hover {
          box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .effect-button.distortion:hover {
          box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }

        .effect-button.pitch:hover {
          box-shadow: 0 6px 20px rgba(255, 159, 67, 0.4);
        }

        .effect-button.echo:hover {
          box-shadow: 0 6px 20px rgba(165, 94, 234, 0.4);
        }

        .effect-button.cave:hover {
          box-shadow: 0 6px 20px rgba(44, 44, 84, 0.4);
        }

        .effect-button.active {
          background: linear-gradient(45deg, #00d4ff, #0099cc);
          box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .effect-button.active:hover {
          box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .effect-controls {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .effect-controls label {
          font-size: 0.9em;
          color: #ccc;
          text-align: center;
        }

        .effect-controls span {
          font-size: 0.9em;
          font-weight: 600;
          text-align: center;
          padding: 4px 8px;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 4px;
        }
      `})]}):s.jsx("div",{className:`deck-effects ${e}`,children:s.jsxs("div",{className:"loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Caricamento effetti..."}),I&&s.jsx("p",{className:"error",children:"Errore caricamento effetti. Riprova a ricaricare la pagina."})]})})},wv=()=>{const{state:e,playLeftTrack:t,playRightTrack:n,setLeftLocalVolume:o,setRightLocalVolume:r,getMixedStream:i,setMasterVolume:a}=an(),{settings:l}=Bn(),{state:c}=xr(),[d,h]=u.useState(null),[p,y]=u.useState(null),[x,S]=u.useState(null),[w,C]=u.useState({track:null,activeDeck:null,isVisible:!1}),[f,g]=u.useState(!1),[m,v]=u.useState("disconnected"),[N,A]=u.useState(null),[b]=u.useState(()=>new yv),[I,j]=u.useState([]),[R,F]=u.useState(!1),[te,oe]=u.useState(!1),[ie,V]=u.useState(0),[se,ae]=u.useState(!1),[W,D]=u.useState(!1),[M,J]=u.useState(null),[Q,he]=u.useState(!1),[Be,ut]=u.useState(0);u.useEffect(()=>(window.streamingManager=b,window.pauseStreaming=()=>{b&&typeof b.pauseStreaming=="function"&&(b.pauseStreaming(),console.log("⏸️ [CONTINUOUS] Pausa streaming richiesta"))},window.resumeStreaming=()=>{b&&typeof b.resumeStreaming=="function"&&(b.resumeStreaming(),console.log("▶️ [CONTINUOUS] Ripresa streaming richiesta"))},console.log("📡 [GLOBAL] ContinuousStreamingManager esposto globalmente per AudioContext"),window.globalStreamingManager=b,()=>{window.streamingManager=null,window.globalStreamingManager=null,window.pauseStreaming=null,window.resumeStreaming=null}),[b]),u.useEffect(()=>{(()=>{const q=I.filter(fe=>fe.includes("❌")||fe.includes("ERROR")||fe.includes("Errore"));V(q.length)})()},[I]);const qe=u.useRef(!1),Fe=u.useRef(null);u.useEffect(()=>{!d&&c.library.playlists.length>0&&h(c.library.playlists[0].id)},[d,c.library.playlists]),u.useEffect(()=>{const ne=fe=>{const{playlistId:ee,updatedTracks:xe,updatedPlaylists:$e}=fe.detail;console.log("🔄 [REBUILT_CONSOLE] Library playlist updated - syncing:",{playlistId:ee,trackCount:(xe==null?void 0:xe.length)||0}),$e&&window.dispatchEvent(new CustomEvent("djconsole:force-playlist-refresh",{detail:{updatedPlaylists:$e}}))},q=fe=>{const{updatedPlaylists:ee}=fe.detail;console.log("🔄 [REBUILT_CONSOLE] Force playlist refresh requested:",{count:ee==null?void 0:ee.length})};return window.addEventListener("djconsole:library-playlist-updated",ne),window.addEventListener("djconsole:force-playlist-refresh",q),()=>{window.removeEventListener("djconsole:library-playlist-updated",ne),window.removeEventListener("djconsole:force-playlist-refresh",q)}},[]),u.useEffect(()=>{e.leftDeck.track&&y(e.leftDeck.track),e.rightDeck.track&&S(e.rightDeck.track)},[e.leftDeck.track,e.rightDeck.track]),u.useEffect(()=>{(async()=>{try{const{localDatabase:q}=await uo(()=>Promise.resolve().then(()=>Ea),void 0,import.meta.url);await q.waitForInitialization();const fe=await q.getSettings(),ee=!!window.fileStore||typeof navigator<"u"&&(navigator.userAgent||"").includes("Electron");let xe="ws://127.0.0.1:8000";ee||(xe=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.hostname}:8000`);const $e=fe.streaming.bridgeUrl&&fe.streaming.bridgeUrl.length>0?fe.streaming.bridgeUrl:xe,dt=await q.getDefaultIcecastServer();dt?(b.setServerUrl($e),b.setCredentials({host:dt.host,port:dt.port,username:dt.username,password:dt.password,mountpoint:dt.mount,useSSL:!!dt.useSSL}),b.setCredentials({format:fe.streaming.defaultFormat||"mp3",bitrate:fe.streaming.defaultBitrate||128,channels:fe.streaming.channels||2,sampleRate:fe.audio.sampleRate||44100}),console.log(`📡 StreamingManager configurato con server: ${dt.name} (${dt.host}:${dt.port}${dt.mount})`),console.log(`📡 StreamingManager configurato con formato: ${fe.streaming.defaultFormat||"mp3"}, bitrate: ${fe.streaming.defaultBitrate||128}`)):(b.setServerUrl($e),b.setCredentials({host:"localhost",port:5040,username:"source",password:"",mountpoint:"/stream",useSSL:!1}),b.setCredentials({format:fe.streaming.defaultFormat||"mp3",bitrate:fe.streaming.defaultBitrate||128,channels:fe.streaming.channels||2,sampleRate:44100}),console.log("📡 StreamingManager configurato con settings legacy: localhost:5040/stream"),console.log(`📡 StreamingManager configurato con formato: ${fe.streaming.defaultFormat||"mp3"}, bitrate: ${fe.streaming.defaultBitrate||128}`)),b.setStatusCallback(Ce=>{v(Ce),g(Ce==="streaming"),console.log(`📡 Streaming status: ${Ce}`)}),b.setDebugCallback(Ce=>{j(st=>[`${new Date().toLocaleTimeString()}: ${Ce}`,...st].slice(0,50)),(Ce.toLowerCase().includes("error")||Ce.toLowerCase().includes("fail"))&&(A(Ce),F(!0))}),b.setCallbacks({onStatusChange:Ce=>{v(Ce.isStreaming?"streaming":Ce.isConnected?"connected":"disconnected"),g(Ce.isStreaming),console.log(`📡 Streaming status: ${Ce.isStreaming?"streaming":Ce.isConnected?"connected":"disconnected"}`)},onError:Ce=>{A(Ce),F(!0)},onDebug:Ce=>{j(st=>[`${new Date().toLocaleTimeString()}: ${Ce}`,...st].slice(0,50)),(Ce.toLowerCase().includes("error")||Ce.toLowerCase().includes("fail"))&&(A(Ce),F(!0))},onSilenceWarning:Ce=>{ut(Ce),he(!0),console.log(`⚠️ [SILENCE] Avviso: disconnessione in ${Ce} secondi`)},onSilenceDisconnect:()=>{he(!1)},onRetryAttempt:(Ce,st)=>{console.log(`🔄 [RETRY] Tentativo ${Ce}/${st} di riconnessione...`),j(Ct=>[`${new Date().toLocaleTimeString()}: 🔄 Tentativo ${Ce}/${st} di riconnessione...`,...Ct].slice(0,50))},onRetryFailed:()=>{console.log("❌ [RETRY] Riconnessione fallita dopo 5 tentativi"),A("Riconnessione fallita dopo 5 tentativi"),F(!0)},onConnectionLost:Ce=>{if(console.log(`🚨 [CONNECTION] Connessione persa: ${Ce}`),b.isUserRequestedDisconnect){console.log("🛑 [CONNECTION] Disconnessione richiesta dall'utente - ignoro perdita connessione");return}j(st=>[`${new Date().toLocaleTimeString()}: 🚨 Connessione persa: ${Ce}`,...st].slice(0,50))}}),console.log(`📡 StreamingManager inizializzato con server: ${$e}`)}catch(q){console.error("❌ Errore inizializzazione StreamingManager:",q),A(`Initialization error: ${q}`)}})()},[b]);const k=!!(e.leftDeck.track&&e.leftDeck.isPlaying),E=!!(e.rightDeck.track&&e.rightDeck.isPlaying),T=u.useCallback((ne,q)=>{if(qe.current){console.log("⚠️ Caricamento già in corso, saltando");return}const fe=ne==="left"?e.leftDeck.track:e.rightDeck.track;if((fe==null?void 0:fe.id)===q.id){console.log(`⚠️ Traccia "${q.title}" già caricata in deck ${ne.toUpperCase()}`);return}qe.current=!0;try{console.log(`🎵 Caricamento traccia "${q.title}" in deck ${ne.toUpperCase()}`),ne==="left"?(y(q),q!=null&&q.url&&t({id:q.id,title:q.title,artist:q.artist,duration:q.duration,url:q.url})):(S(q),q!=null&&q.url&&n({id:q.id,title:q.title,artist:q.artist,duration:q.duration,url:q.url})),console.log(`✅ Traccia caricata con successo in deck ${ne.toUpperCase()}`),console.log(`🎵 [TRACK CHANGE] Traccia cambiata in deck ${ne.toUpperCase()} - sincronizzazione continua gestirà l'aggiornamento`)}catch(ee){console.error("❌ Errore nel caricamento traccia:",ee)}finally{setTimeout(()=>{qe.current=!1},500)}},[t,n,e.leftDeck.track,e.rightDeck.track]),L=u.useCallback(ne=>{T("left",ne)},[T]),B=u.useCallback(ne=>{T("right",ne)},[T]),P=u.useCallback(ne=>{console.log(`🔄 [REBUILT DJ] Auto-avanzamento richiesto per deck ${ne.toUpperCase()}`),console.log(`🔄 [REBUILT DJ] Emettendo evento djconsole:request-auto-advance per deck ${ne}`),window.dispatchEvent(new CustomEvent("djconsole:request-auto-advance",{detail:{deck:ne}}))},[]),H=u.useCallback((ne,q)=>{console.log(`⚠️ Traccia duplicata rilevata: ${ne.title}`),C({track:ne,activeDeck:q,isVisible:!0})},[]),G=u.useCallback(()=>{w.track&&w.activeDeck&&T(w.activeDeck,w.track),C({track:null,activeDeck:null,isVisible:!1})},[w,T]),me=u.useCallback(()=>{console.log("🚫 Caricamento traccia duplicata annullato"),C({track:null,activeDeck:null,isVisible:!1})},[]),ue=u.useCallback(ne=>{console.log(`🔊 Master volume cambiato: ${Math.round(ne*100)}%`)},[]),ht=u.useCallback(ne=>{console.log(`📡 Stream volume cambiato: ${Math.round(ne*100)}%`),a(ne)},[a]),Ye=u.useCallback(ne=>{console.log(`🎤 PTT ${ne?"attivato":"disattivato"}`),oe(ne),window.updatePTTVolumesOnly&&(console.log(`🎤 Aggiornamento volumi PTT: ${ne?"ducking ON":"ducking OFF"}`),window.updatePTTVolumesOnly(ne)),console.log("🎤 PTT change completed - stream NOT recreated (volume-only update)")},[f,i]),Gt=u.useCallback(()=>{try{console.log("📡 Disconnessione..."),console.log("🛑 [REBUILT DJ] Chiamata handleDisconnect - flag userRequestedDisconnect sarà impostato a TRUE"),b.disconnect(),v("disconnected"),g(!1),window.stopServerMonitoring&&(window.stopServerMonitoring(),console.log("🛑 [DISCONNECT] Monitoraggio server fermato")),window.isCurrentlyStreaming=!1,console.log("⏹️ [DISCONNECT] Fermando riproduzione deck dopo disconnessione...");const ne=document.getElementById("left-audio");ne&&!ne.paused&&(console.log("⏹️ [DISCONNECT] Fermando deck LEFT"),ne.pause(),ne.currentTime=0,p&&y({...p,isPlaying:!1}));const q=document.getElementById("right-audio");q&&!q.paused&&(console.log("⏹️ [DISCONNECT] Fermando deck RIGHT"),q.pause(),q.currentTime=0,x&&S({...x,isPlaying:!1})),console.log("🧹 [STREAMING] Cleanup audio residuo dopo disconnessione..."),window.cleanupAllAudioStreams&&window.cleanupAllAudioStreams(),Fe.current=null,console.log("📡 Cache mixed stream pulita")}catch(ne){console.error("❌ Errore disconnessione:",ne),A(`Disconnect error: ${ne}`),F(!0)}},[b,p,x]),hn=u.useCallback(()=>{if(m==="disconnected"||m==="connected"&&!f)J("start"),ae(!0);else if(f)J("stop"),D(!0);else{console.log("📡 [DISCONNECT CLICK] Disconnessione immediata richiesta..."),console.log("⏹️ [DISCONNECT CLICK] Fermando immediatamente tutti i deck...");const ne=document.getElementById("left-audio");ne&&!ne.paused&&(console.log("⏹️ [DISCONNECT CLICK] Fermando deck LEFT"),ne.pause(),ne.currentTime=0,p&&y({...p,isPlaying:!1}));const q=document.getElementById("right-audio");q&&!q.paused&&(console.log("⏹️ [DISCONNECT CLICK] Fermando deck RIGHT"),q.pause(),q.currentTime=0,x&&S({...x,isPlaying:!1})),Gt()}},[m,f,p,x,Gt]),ln=u.useCallback(async()=>{var ne;ae(!1),J(null);try{if(m==="disconnected")console.log("📡 Connessione al server streaming..."),b.resetRetryLimit(),b.resetUserDisconnectFlag(),console.log("🔄 [REBUILT DJ] Flag userRequestedDisconnect resettato per nuovo avvio manuale"),v("connecting"),await b.connect()?(console.log("📡 Connesso! Avvio automatico streaming..."),setTimeout(async()=>{var fe,ee,xe,$e,dt,Ce;try{if(b.isUserRequestedDisconnect){console.log("🛑 [AUTO-START] Disconnessione richiesta dall'utente - salto auto-start");return}if(window.isCurrentlyStreaming=!0,console.log("📡 Flag isCurrentlyStreaming impostato PRIMA di getMixedStream"),console.log("🧹 [STREAMING] Cleanup audio residuo dopo aver impostato flag streaming..."),window.cleanupAllAudioStreams&&window.cleanupAllAudioStreams(),Fe.current?console.log("📡 Riuso mixed stream esistente (cached)"):(console.log("📡 Creazione NUOVO mixed stream (non cached)"),Fe.current=await i(void 0,void 0,te),console.log("📡 getMixedStream result:",{isNull:Fe.current===null,isUndefined:Fe.current===void 0,type:typeof Fe.current,constructor:(ee=(fe=Fe.current)==null?void 0:fe.constructor)==null?void 0:ee.name,isMediaStream:Fe.current instanceof MediaStream,active:(xe=Fe.current)==null?void 0:xe.active,tracks:(Ce=(dt=($e=Fe.current)==null?void 0:$e.getTracks)==null?void 0:dt.call($e))==null?void 0:Ce.length,actualValue:Fe.current})),!Fe.current){console.error("❌ getMixedStream ha restituito null - impossibile avviare streaming"),A("Errore audio - impossibile creare mixed stream"),v("connected");return}const{localDatabase:st}=await uo(()=>Promise.resolve().then(()=>Ea),void 0,import.meta.url),Ct=await st.getDefaultIcecastServer();if(!Ct){A("Nessun server Icecast configurato per auto-start"),F(!0);return}const wo=await st.getSettings(),Vt={host:Ct.host,port:Ct.port,username:Ct.username,password:Ct.password,mountpoint:Ct.mount,useSSL:!!Ct.useSSL,bitrate:wo.streaming.defaultBitrate||128,format:wo.streaming.defaultFormat||"mp3"};await b.startStreamingWithConfig(Vt)?console.log("📡 Streaming avviato con successo"):(A("Avvio streaming fallito dopo connessione"),F(!0))}catch(st){console.error("❌ Errore avvio automatico streaming:",st),A(`Auto-start error: ${st}`),F(!0)}},1e3)):(A("Connessione fallita - verifica le impostazioni"),v("disconnected"),F(!0));else if(m==="connected"&&!f){console.log("📡 Avvio streaming..."),window.isCurrentlyStreaming=!0,console.log("📡 Flag isCurrentlyStreaming impostato PRIMA di getMixedStream");const q=await i(void 0,void 0,te),{localDatabase:fe}=await uo(()=>Promise.resolve().then(()=>Ea),void 0,import.meta.url),ee=await fe.getDefaultIcecastServer();if(!ee){A("Nessun server Icecast configurato"),F(!0);return}const xe=await fe.getSettings(),$e={host:ee.host,port:ee.port,username:ee.username,password:ee.password,mountpoint:ee.mount,useSSL:!!ee.useSSL,bitrate:xe.streaming.defaultBitrate||128,format:xe.streaming.defaultFormat||"mp3",djName:((ne=xe.streaming.metadata)==null?void 0:ne.stationName)||"DJ Console Pro"};await b.startStreamingWithConfig($e)?console.log("📡 Streaming avviato con successo"):(A("Avvio streaming fallito"),F(!0))}else if(f)console.log("📡 Stop streaming..."),console.log("🛑 [STOP STREAMING] Impostando flag userRequestedDisconnect a TRUE"),b.disconnect(),v("disconnected"),g(!1),window.isCurrentlyStreaming=!1,console.log("🧹 [STREAMING] Cleanup audio residuo dopo stop streaming..."),window.cleanupAllAudioStreams&&window.cleanupAllAudioStreams(),console.log("🔄 [STREAMING STOP] Restoring original HTML volumes..."),console.log("📡 Streaming fermato - flag globale rimosso");else{console.log("📡 [DISCONNECT] Disconnessione immediata richiesta..."),console.log("⏹️ [DISCONNECT] Fermando immediatamente tutti i deck...");const q=document.getElementById("left-audio");q&&!q.paused&&(console.log("⏹️ [DISCONNECT] Fermando deck LEFT"),q.pause(),q.currentTime=0,p&&y({...p,isPlaying:!1}));const fe=document.getElementById("right-audio");fe&&!fe.paused&&(console.log("⏹️ [DISCONNECT] Fermando deck RIGHT"),fe.pause(),fe.currentTime=0,x&&S({...x,isPlaying:!1})),console.log("📡 [DISCONNECT] Disconnessione streaming manager..."),b.disconnect(),v("disconnected"),g(!1),window.isCurrentlyStreaming=!1,console.log("🧹 [DISCONNECT] Cleanup audio residuo dopo disconnessione..."),window.cleanupAllAudioStreams&&window.cleanupAllAudioStreams(),Fe.current=null,console.log("📡 [DISCONNECT] Cache mixed stream pulita - disconnessione completata")}}catch(q){console.error("❌ Errore pulsante streaming:",q),A(`Button error: ${q}`),F(!0)}},[m,f,b,i,te]),Ae=u.useCallback(()=>{D(!1),J(null);try{if(console.log("📡 Fermata streaming..."),console.log("🛑 [STOP STREAMING] Impostando flag userRequestedDisconnect a TRUE"),b.disconnect(),v("disconnected"),g(!1),window.isCurrentlyStreaming=!1,console.log("📡 Streaming fermato - flag globale rimosso"),console.log("⏹️ [STOP STREAMING] Fermando riproduzione deck dopo stop streaming..."),p&&p.isPlaying){console.log("⏹️ [STOP STREAMING] Fermando deck LEFT");const ne=document.getElementById("left-audio");ne&&(ne.pause(),ne.currentTime=0)}if(x&&x.isPlaying){console.log("⏹️ [STOP STREAMING] Fermando deck RIGHT");const ne=document.getElementById("right-audio");ne&&(ne.pause(),ne.currentTime=0)}}catch(ne){console.error("❌ Errore stop streaming:",ne),A(`Stop error: ${ne}`),F(!0)}},[b,p,x]);u.useEffect(()=>{const ne=fe=>{const{status:ee,isStreaming:xe,error:$e}=fe.detail;console.log(`📡 Streaming status changed: ${ee}, streaming: ${xe}`),v(ee),g(xe),A($e)},q=fe=>{const{deckId:ee}=fe.detail;if(console.log(`🔚 [REBUILT DJ] Track ended on deck ${ee}, checking auto-advance`),!l.interface.autoAdvance){console.log("🔄 [REBUILT DJ] Auto-avanzamento disabilitato nelle impostazioni");return}const xe=ee==="A"?"left":"right";console.log(`🔄 [REBUILT DJ] Chiamando handleAutoAdvance per deck ${xe}`),P(xe)};return window.addEventListener("djconsole:streaming-status-changed",ne),window.addEventListener("djconsole:track-ended",q),()=>{window.removeEventListener("djconsole:streaming-status-changed",ne),window.removeEventListener("djconsole:track-ended",q)}},[l.interface.autoAdvance,P]),window.getMixedStream=i;const Gn=u.useCallback(ne=>{const q=Math.max(0,Math.min(1,ne));console.log(`🔊 [LIVE STREAM] Volume Live Stream impostato: ${Math.round(q*100)}%`),window.__currentStreamVolume__=q,window.dispatchEvent(new CustomEvent("djconsole:stream-volume-change",{detail:{volume:q}}))},[]);return window.setLiveStreamVolume=Gn,window.__currentStreamVolume__=1,s.jsxs("div",{className:"min-h-screen bg-dj-dark text-white overflow-y-auto",children:[s.jsx("header",{className:"bg-dj-primary border-b border-dj-accent/30 p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("h1",{className:"text-2xl font-dj font-bold text-white flex items-center space-x-3",children:[s.jsx(Yi,{className:"w-8 h-8 text-dj-highlight"}),s.jsx("span",{children:"DJ Console Pro"})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-full transition-all duration-300 ${k?"bg-green-500/20 border border-green-500/40":"bg-gray-500/20 border border-gray-500/40"}`,children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${k?"bg-green-500 animate-pulse":"bg-gray-500"}`}),s.jsx("span",{className:"text-xs font-medium",children:"Deck A"})]}),s.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-full transition-all duration-300 ${E?"bg-green-500/20 border border-green-500/40":"bg-gray-500/20 border border-gray-500/40"}`,children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${E?"bg-green-500 animate-pulse":"bg-gray-500"}`}),s.jsx("span",{className:"text-xs font-medium",children:"Deck B"})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-lg ${l.interface.autoAdvance?"bg-dj-highlight/20 text-dj-highlight border border-dj-highlight/40":"bg-gray-500/20 text-gray-400 border border-gray-500/40"}`,children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${l.interface.autoAdvance?"bg-dj-highlight animate-pulse":"bg-gray-400"}`}),s.jsx("span",{className:"text-xs font-medium",children:"Auto-Advance"})]}),s.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-lg ${l.interface.playlistLoop?"bg-green-500/20 text-green-400 border border-green-500/40":"bg-gray-500/20 text-gray-400 border border-gray-500/40"}`,children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${l.interface.playlistLoop?"bg-green-500 animate-pulse":"bg-gray-400"}`}),s.jsx("span",{className:"text-xs font-medium",children:"Loop Playlist"})]}),s.jsx("button",{className:"p-2 bg-dj-secondary hover:bg-dj-accent rounded-lg transition-colors",title:"Impostazioni",children:s.jsx(Ws,{className:"w-5 h-5"})}),s.jsxs("button",{onClick:()=>F(!R),className:`relative p-2 rounded-lg transition-colors ${R?"bg-green-600 text-white":"bg-dj-secondary hover:bg-dj-accent text-dj-light"}`,title:"Notifiche e Debug",children:[s.jsx(_y,{className:"w-5 h-5"}),ie>0&&s.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:ie>99?"99+":ie})]}),s.jsxs("button",{onClick:hn,disabled:m==="connecting",className:`p-2 rounded-lg transition-all duration-200 relative ${f?"bg-blue-500 text-white shadow-lg ring-2 ring-blue-300":m==="connecting"?"bg-yellow-500 text-white animate-pulse cursor-not-allowed":m==="connected"?"bg-green-500 text-white shadow-lg":N?"bg-red-500 text-white shadow-lg":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:m==="streaming"?"LIVE STREAMING - Click to stop":m==="connecting"?"Connecting and starting streaming...":m==="connected"?"Connected - Starting stream...":N?`Stream Error: ${N}`:"Click to Start Live Streaming",children:[s.jsx(jo,{className:"w-5 h-5"}),m==="connecting"&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-yellow-300 rounded-full animate-ping"}),f&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-blue-300 rounded-full animate-pulse"}),m==="connected"&&!f&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-300 rounded-full animate-pulse"}),N&&s.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-300 rounded-full animate-bounce"})]})]})]})}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsx(ed,{side:"left",deckId:"A",track:p,onTrackLoad:L,onAutoAdvance:P}),s.jsx(ed,{side:"right",deckId:"B",track:x,onTrackLoad:B,onAutoAdvance:P})]}),s.jsx(xv,{}),s.jsx(gv,{leftDeckActive:k,rightDeckActive:E,onMasterVolumeChange:ue,onStreamVolumeChange:ht,onPTTActivate:Ye}),s.jsx(hv,{activePlaylistId:d,onPlaylistChange:h,onTrackLoad:T,leftDeckActive:k,rightDeckActive:E})]}),s.jsx(pv,{activePlaylistId:d,onTrackLoad:T,onDuplicateTrackWarning:H}),s.jsx(fv,{track:w.track,activeDeck:w.activeDeck,onConfirm:G,onCancel:me,isVisible:w.isVisible}),s.jsx(vv,{isVisible:R,onClose:()=>F(!1),streamStatus:m,isStreaming:f,streamError:N,debugMessages:I}),s.jsx("footer",{className:"bg-dj-primary border-t border-dj-accent/30 p-4 mt-8",children:s.jsxs("div",{className:"flex items-center justify-between text-sm text-dj-light/60",children:[s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(jf,{className:"w-4 h-4"}),s.jsx("span",{children:"Audio separato: Locale vs Streaming"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Yi,{className:"w-4 h-4"}),s.jsxs("span",{children:["Auto-avanzamento: ",l.interface.autoAdvance?"Attivo":"Disattivo"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Yi,{className:"w-4 h-4"}),s.jsxs("span",{children:["Loop Playlist: ",l.interface.playlistLoop?"Attivo":"Disattivo"]})]})]}),s.jsx("div",{children:s.jsx("span",{children:"PTT: Tieni premuto M per attivare il microfono"})})]})}),s.jsx(Ca,{isOpen:Q,title:"🔇 Avviso Silenzio",message:`Rilevato silenzio prolungato! Lo streaming verrà disconnesso automaticamente in ${Be} secondi se non viene rilevato audio.`,confirmText:"OK",cancelText:"",onConfirm:()=>he(!1),onCancel:()=>he(!1),type:"warning"}),s.jsx(Ca,{isOpen:se,title:"🚀 Avvio Streaming Live",message:"Sei sicuro di voler andare in diretta? Lo streaming inizierà immediatamente e sarà visibile a tutti gli ascoltatori.",confirmText:"SÌ, VAI IN DIRETTA",cancelText:"Annulla",onConfirm:ln,onCancel:()=>{ae(!1),J(null)},type:"warning"}),s.jsx(Ca,{isOpen:W,title:"⏹️ Stop Streaming Live",message:"Sei sicuro di voler interrompere la trasmissione? Lo streaming si fermerà immediatamente e gli ascoltatori perderanno la connessione.",confirmText:"SÌ, FERMA STREAMING",cancelText:"Annulla",onConfirm:Ae,onCancel:()=>{D(!1),J(null)},type:"danger"})]})},Sv=()=>{var d,h;const{state:e,handlePlayPauseDefinitive:t}=an(),[n,o]=u.useState([]),[r,i]=u.useState(!1),a=p=>{o(y=>[...y,`${new Date().toLocaleTimeString()}: ${p}`])},l=async()=>{i(!0),o([]),a("🚀 Iniziando test controlli audio...");try{if(a("📋 Test 1: Verifica stato iniziale"),a(`   - Left deck: ${e.leftDeck.track?"Track caricata":"Nessuna track"}`),a(`   - Right deck: ${e.rightDeck.track?"Track caricata":"Nessuna track"}`),a("🎮 Test 2: Verifica controlli play/pause"),e.leftDeck.track){a("   - Testando left deck...");const S=e.leftDeck.isPlaying;a(`   - Stato iniziale: ${S?"Playing":"Paused"}`),t("left"),await new Promise(C=>setTimeout(C,500));const w=e.leftDeck.isPlaying;a(`   - Stato dopo controllo: ${w?"Playing":"Paused"}`),w!==S?a("   ✅ Left deck: Controlli funzionanti"):(a("   ❌ Left deck: Controlli non funzionanti"),a("   🔍 Debug: Stato non è cambiato dopo handlePlayPauseDefinitive"))}else a("   ⚠️ Left deck: Nessuna track per testare");if(e.rightDeck.track){a("   - Testando right deck...");const S=e.rightDeck.isPlaying;a(`   - Stato iniziale: ${S?"Playing":"Paused"}`),t("right"),await new Promise(C=>setTimeout(C,500));const w=e.rightDeck.isPlaying;a(`   - Stato dopo controllo: ${w?"Playing":"Paused"}`),w!==S?a("   ✅ Right deck: Controlli funzionanti"):(a("   ❌ Right deck: Controlli non funzionanti"),a("   🔍 Debug: Stato non è cambiato dopo handlePlayPauseDefinitive"))}else a("   ⚠️ Right deck: Nessuna track per testare");a("🔄 Test 3: Verifica sincronizzazione stato"),a(`   - Left deck playing: ${e.leftDeck.isPlaying}`),a(`   - Right deck playing: ${e.rightDeck.isPlaying}`),a(`   - Left deck time: ${e.leftDeck.currentTime.toFixed(1)}s`),a(`   - Right deck time: ${e.rightDeck.currentTime.toFixed(1)}s`),a("🔊 Test 4: Verifica elementi HTML audio");const p=document.querySelector('audio[data-deck="left"]'),y=document.querySelector('audio[data-deck="right"]');p?(a(`   - Left audio element: ${p.paused?"Paused":"Playing"}`),a(`   - Left audio src: ${p.src?"Presente":"Mancante"}`),a(`   - Left audio currentTime: ${p.currentTime.toFixed(1)}s`)):a("   ❌ Left audio element non trovato"),y?(a(`   - Right audio element: ${y.paused?"Paused":"Playing"}`),a(`   - Right audio src: ${y.src?"Presente":"Mancante"}`),a(`   - Right audio currentTime: ${y.currentTime.toFixed(1)}s`)):a("   ❌ Right audio element non trovato"),a("💾 Test 5: Verifica persistenza"),a("   - Simulando cambio pagina...");const x={leftDeck:{...e.leftDeck},rightDeck:{...e.rightDeck}};a("   - Stato salvato per persistenza"),a("   - Simulando ritorno alla console..."),setTimeout(()=>{var S,w;a("   - Console ripristinata"),a(`   - Left deck ripristinato: ${((S=x.leftDeck.track)==null?void 0:S.title)||"Nessuna"}`),a(`   - Right deck ripristinato: ${((w=x.rightDeck.track)==null?void 0:w.title)||"Nessuna"}`),a("✅ Test completato con successo!"),i(!1)},1e3)}catch(p){a(`❌ Errore durante il test: ${p}`),i(!1)}},c=()=>{o([])};return s.jsxs("div",{className:"p-4 bg-dj-dark text-white",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"🧪 Test Controlli Audio"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("button",{onClick:l,disabled:r,className:"px-4 py-2 bg-dj-highlight text-white rounded hover:bg-dj-highlight-dark disabled:opacity-50",children:r?"🔄 Test in corso...":"🚀 Avvia Test"}),s.jsx("button",{onClick:c,className:"ml-2 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"🗑️ Pulisci Risultati"}),s.jsx("button",{onClick:()=>{if(a("🎮 Test diretto controlli audio..."),e.leftDeck.track){a("   - Testando left deck...");const p=e.leftDeck.isPlaying;a(`   - Stato prima: ${p?"Playing":"Paused"}`),t("left"),setTimeout(()=>{const y=e.leftDeck.isPlaying;a(`   - Stato dopo: ${y?"Playing":"Paused"}`),a(y!==p?"   ✅ Left deck: Controlli funzionanti!":"   ❌ Left deck: Controlli non funzionano")},1e3)}},className:"ml-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"🎮 Test Diretto"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📊 Stato Attuale:"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-dj-darker p-3 rounded",children:[s.jsx("h4",{className:"font-semibold text-dj-highlight",children:"Left Deck"}),s.jsxs("p",{children:["Track: ",((d=e.leftDeck.track)==null?void 0:d.title)||"Nessuna"]}),s.jsxs("p",{children:["Playing: ",e.leftDeck.isPlaying?"▶️":"⏸️"]}),s.jsxs("p",{children:["Time: ",e.leftDeck.currentTime.toFixed(1),"s"]})]}),s.jsxs("div",{className:"bg-dj-darker p-3 rounded",children:[s.jsx("h4",{className:"font-semibold text-dj-highlight",children:"Right Deck"}),s.jsxs("p",{children:["Track: ",((h=e.rightDeck.track)==null?void 0:h.title)||"Nessuna"]}),s.jsxs("p",{children:["Playing: ",e.rightDeck.isPlaying?"▶️":"⏸️"]}),s.jsxs("p",{children:["Time: ",e.rightDeck.currentTime.toFixed(1),"s"]})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"📋 Risultati Test:"}),s.jsx("div",{className:"bg-dj-darker p-3 rounded max-h-96 overflow-y-auto",children:n.length===0?s.jsx("p",{className:"text-gray-400",children:'Nessun test eseguito. Clicca "Avvia Test" per iniziare.'}):n.map((p,y)=>s.jsx("div",{className:"mb-1 font-mono text-sm",children:p},y))})]}),s.jsxs("div",{className:"mt-4 p-3 bg-blue-900 rounded",children:[s.jsx("h4",{className:"font-semibold text-blue-200",children:"💡 Come usare questo test:"}),s.jsxs("ol",{className:"list-decimal list-inside text-sm text-blue-100",children:[s.jsx("li",{children:"Carica una traccia in uno dei deck"}),s.jsx("li",{children:"Avvia il test per verificare i controlli"}),s.jsx("li",{children:"Cambia pagina e torna alla console"}),s.jsx("li",{children:"Verifica che i controlli funzionino ancora"}),s.jsx("li",{children:"Esegui nuovamente il test per confermare"})]})]})]})};function Ev(e=1,t=48e3){const r=e*t,i=t*1*16/8,a=1*16/8,l=r*a,c=new ArrayBuffer(44+l),d=new DataView(c),h=(p,y)=>{for(let x=0;x<y.length;x++)d.setUint8(p+x,y.charCodeAt(x))};return h(0,"RIFF"),d.setUint32(4,36+l,!0),h(8,"WAVE"),h(12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,1,!0),d.setUint32(24,t,!0),d.setUint32(28,i,!0),d.setUint16(32,a,!0),d.setUint16(34,16,!0),h(36,"data"),d.setUint32(40,l,!0),new Blob([c],{type:"audio/wav"})}const Cv=()=>{const[e,t]=u.useState([]),[n,o]=u.useState(!1),{playTrack:r}=an(),{state:i,createPlaylist:a}=xr(),l=y=>{t(x=>[...x,`${new Date().toLocaleTimeString()}: ${y}`])},c=async()=>{o(!0),t([]);try{l("Testing database initialization..."),await Y.waitForInitialization(),l("✅ Database initialized successfully"),l("Testing track addition...");const y=Ev(1),x=URL.createObjectURL(y),S=await Y.addTrack({title:"Test Track",artist:"Test Artist",album:"Test Album",genre:"Test",duration:1,url:x,bpm:128,key:"C",energy:"medium"});l(`✅ Track added with ID: ${S}`),l("Testing track retrieval...");const w=await Y.getTrack(S);l(w?`✅ Track retrieved: ${w.title} by ${w.artist}`:"❌ Failed to retrieve track"),l("Testing playlist creation...");const C=await Y.createPlaylist({name:"Test Playlist",description:"A test playlist",tracks:[S],isAutoPlaylist:!1});l(`✅ Playlist created with ID: ${C}`),l("Testing get all tracks...");const f=await Y.getAllTracks();l(`✅ Retrieved ${f.length} tracks`),l("Testing get all playlists...");const g=await Y.getAllPlaylists();l(`✅ Retrieved ${g.length} playlists`),l("Testing track search...");const m=await Y.searchTracks("Test");l(`✅ Search found ${m.length} tracks`),l("Testing settings..."),await Y.updateSettings({audio:{sampleRate:48e3,bitDepth:24,bufferSize:1024,latency:20}});const v=await Y.getSettings();l(`✅ Settings updated: ${v.audio.sampleRate}Hz`),l("Testing statistics...");const N=await Y.getStats();l(`✅ Stats: ${N.totalTracks} tracks, ${N.totalPlaylists} playlists`),l("🎉 All tests completed successfully!")}catch(y){l(`❌ Test failed: ${y instanceof Error?y.message:"Unknown error"}`)}finally{o(!1)}},d=()=>{t([])},h=()=>{if(i.library.tracks.length>0){const y=i.library.tracks[0];r({id:y.id,title:y.title,artist:y.artist,duration:y.duration,url:y.url}),l(`🎵 Playing track: ${y.title}`)}else l("❌ No tracks available to play")},p=async()=>{try{await a("Test Playlist from Context","Created via context test"),l("✅ Playlist created via context")}catch(y){l(`❌ Failed to create playlist via context: ${y}`)}};return s.jsx("div",{className:"h-full bg-dj-dark text-white p-6 overflow-auto",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsx("h1",{className:"text-3xl font-dj font-bold text-white mb-6",children:"DJ Console Test Suite"}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-dj-secondary rounded-xl p-6 border border-dj-accent/20",children:[s.jsx("h2",{className:"text-xl font-dj font-bold text-white mb-4",children:"Test Controls"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:c,disabled:n,className:"w-full dj-button",children:n?"Running Tests...":"Run All Tests"}),s.jsx("button",{onClick:h,className:"w-full dj-button-secondary",children:"Test Play Track"}),s.jsx("button",{onClick:p,className:"w-full dj-button-secondary",children:"Test Create Playlist"}),s.jsx("button",{onClick:d,className:"w-full bg-dj-error hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200",children:"Clear Results"})]})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-xl p-6 border border-dj-accent/20",children:[s.jsx("h2",{className:"text-xl font-dj font-bold text-white mb-4",children:"Database Status"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-dj-light/60",children:"Tracks:"}),s.jsx("span",{className:"text-white",children:i.library.tracks.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-dj-light/60",children:"Playlists:"}),s.jsx("span",{className:"text-white",children:i.library.playlists.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-dj-light/60",children:"Genres:"}),s.jsx("span",{className:"text-white",children:i.library.genres.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-dj-light/60",children:"Artists:"}),s.jsx("span",{className:"text-white",children:i.library.artists.length})]})]})]})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-xl p-6 border border-dj-accent/20",children:[s.jsx("h2",{className:"text-xl font-dj font-bold text-white mb-4",children:"Test Results"}),e.length===0?s.jsx("p",{className:"text-dj-light/60 text-center py-8",children:'No tests run yet. Click "Run All Tests" to start.'}):s.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map((y,x)=>s.jsx("div",{className:"text-sm font-mono bg-dj-primary rounded p-2",children:y},x))})]}),s.jsxs("div",{className:"bg-dj-secondary rounded-xl p-6 border border-dj-accent/20 mt-6",children:[s.jsx("h2",{className:"text-xl font-dj font-bold text-white mb-4",children:"🎵 Test Controlli Audio"}),s.jsx(Sv,{})]})]})})},kv=u.createContext(void 0),Tv=({children:e})=>{const[t,n]=u.useState({leftDeck:{currentTime:0,duration:0},rightDeck:{currentTime:0,duration:0}}),o=l=>{n(c=>({...c,leftDeck:{...c.leftDeck,currentTime:l}}))},r=l=>{n(c=>({...c,rightDeck:{...c.rightDeck,currentTime:l}}))},i=l=>{n(c=>({...c,leftDeck:{...c.leftDeck,duration:l}}))},a=l=>{n(c=>({...c,rightDeck:{...c.rightDeck,duration:l}}))};return s.jsx(kv.Provider,{value:{state:t,updateLeftDeckTime:o,updateRightDeckTime:r,updateLeftDeckDuration:i,updateRightDeckDuration:a},children:e})};class bv extends u.Component{constructor(n){super(n);U(this,"handleReload",()=>{window.location.reload()});U(this,"handleGoHome",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),window.dispatchEvent(new CustomEvent("djconsole:navigate-home"))});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n,errorInfo:null}}componentDidCatch(n,o){console.error("ErrorBoundary caught an error:",n,o),this.setState({error:n,errorInfo:o}),console.group("🚨 ErrorBoundary - Error Details"),console.error("Error:",n),console.error("Error Info:",o),console.error("Component Stack:",o.componentStack),console.groupEnd()}render(){return this.state.hasError?this.props.fallback?this.props.fallback:s.jsx("div",{className:"min-h-screen bg-dj-primary flex items-center justify-center p-4",children:s.jsx("div",{className:"max-w-md w-full bg-dj-secondary rounded-xl p-6 border border-dj-accent/20",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mb-4",children:s.jsx(vc,{className:"w-8 h-8 text-red-500"})}),s.jsx("h1",{className:"text-xl font-bold text-white mb-2",children:"Ops! Qualcosa è andato storto"}),s.jsx("p",{className:"text-dj-light/80 mb-6",children:"L'applicazione ha incontrato un errore inaspettato. Non preoccuparti, i tuoi dati sono al sicuro."}),!1,s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsxs("button",{onClick:this.handleReload,className:"flex-1 bg-dj-highlight hover:bg-dj-accent text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2",children:[s.jsx(Vy,{className:"w-4 h-4"}),s.jsx("span",{children:"Ricarica App"})]}),s.jsxs("button",{onClick:this.handleGoHome,className:"flex-1 bg-dj-primary hover:bg-dj-secondary text-white py-3 px-4 rounded-lg transition-colors border border-dj-accent/20 flex items-center justify-center space-x-2",children:[s.jsx(Gy,{className:"w-4 h-4"}),s.jsx("span",{children:"Torna alla Home"})]})]}),s.jsxs("div",{className:"mt-6 text-xs text-dj-light/60",children:[s.jsx("p",{children:"Se il problema persiste, prova a:"}),s.jsxs("ul",{className:"mt-2 space-y-1",children:[s.jsx("li",{children:"• Chiudere e riaprire l'applicazione"}),s.jsx("li",{children:"• Verificare che tutti i file audio siano validi"}),s.jsx("li",{children:"• Controllare che ci sia spazio sufficiente sul disco"})]})]})]})})}):this.props.children}}function Nv(){const e=u.useRef(0),t=u.useRef(Date.now());u.useEffect(()=>{e.current++;const h=Date.now(),p=h-t.current;t.current=h,console.log(`🔄 [APP] Re-render #${e.current} - Time since last: ${p}ms`),e.current>1&&console.trace("🔄 [APP] Stack trace for re-render")}),Qn.useEffect(()=>{const h=()=>{console.log("🔄 Force component refresh requested (but not reloading page)")};return window.addEventListener("djconsole:force-component-refresh",h),()=>{window.removeEventListener("djconsole:force-component-refresh",h)}},[]);const n=u.useRef({}),o=u.useMemo(()=>s.jsx(wv,{},"djconsole-rebuilt-stable"),[n.current]),r=u.useMemo(()=>s.jsx(mv,{},"djconsole-v2-stable"),[n.current]),i=u.useMemo(()=>s.jsx(Of,{},"djconsole-old-stable"),[n.current]),a=u.useMemo(()=>Qn.lazy(()=>uo(()=>import("./LibraryManager-c9bac000.js"),["./LibraryManager-c9bac000.js","./upload-d716cde2.js"],import.meta.url)),[]),l=u.useMemo(()=>Qn.lazy(()=>uo(()=>import("./Settings-65111e78.js"),["./Settings-65111e78.js","./upload-d716cde2.js"],import.meta.url)),[]),c=u.useMemo(()=>s.jsx(Cv,{},"test-stable"),[n.current]);return u.useMemo(()=>s.jsx(tv,{children:s.jsx(Tv,{children:s.jsx(iv,{children:s.jsx(lv,{children:s.jsx(bv,{children:s.jsxs("div",{className:"flex flex-col min-h-screen bg-dj-dark",children:[s.jsx(Ly,{}),s.jsx("main",{className:"flex-1 overflow-y-auto transition-opacity duration-200 ease-in-out",children:s.jsx(Qn.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-full bg-dj-dark",children:s.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-dj-accent"}),s.jsx("div",{className:"text-white text-sm opacity-75",children:"Caricamento..."})]})}),children:s.jsxs(ly,{children:[s.jsx(ko,{path:"/",element:o}),s.jsx(ko,{path:"/v2",element:r}),s.jsx(ko,{path:"/old",element:i}),s.jsx(ko,{path:"/library",element:s.jsx(a,{})}),s.jsx(ko,{path:"/settings",element:s.jsx(l,{})}),s.jsx(ko,{path:"/test",element:c})]})})})]})})})})})}),[o,r,i,a,l,c])}pc("it");const Av=window.location.protocol==="file:"?yy:py;ka.createRoot(document.getElementById("root")).render(s.jsx(Qn.StrictMode,{children:s.jsx(Av,{children:s.jsx(Nv,{})})}));try{window.addEventListener("error",e=>{var t,n;try{(n=(t=window.log)==null?void 0:t.error)==null||n.call(t,`window.onerror: ${e.message}`)}catch{}}),window.addEventListener("unhandledrejection",e=>{var t,n;try{(n=(t=window.log)==null?void 0:t.error)==null||n.call(t,`unhandledrejection: ${String(e.reason)}`)}catch{}})}catch{}export{vc as A,Uy as C,bv as E,jf as H,Wu as I,qu as M,jo as R,Ws as S,tn as V,xl as X,Yi as a,Ks as b,He as c,zy as d,an as e,yc as f,ci as g,mo as h,Hy as i,s as j,Y as l,Xy as p,u as r,Bn as u};
//# sourceMappingURL=index-5b2d746f.js.map
